(function(e,t){function N(e,t,n){e!=null&&("number"==typeof e?this.fromNumber(e,t,n):t==null&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function C(){return new N(null)}function k(e,t,n,r,i,s){while(--s>=0){var o=t*this[e++]+n[r]+i;i=Math.floor(o/67108864),n[r++]=o&67108863}return i}function L(e,t,n,r,i,s){var o=t&32767,u=t>>15;while(--s>=0){var a=this[e]&32767,f=this[e++]>>15,l=u*a+f*o;a=o*a+((l&32767)<<15)+n[r]+(i&1073741823),i=(a>>>30)+(l>>>15)+u*f+(i>>>30),n[r++]=a&1073741823}return i}function A(e,t,n,r,i,s){var o=t&16383,u=t>>14;while(--s>=0){var a=this[e]&16383,f=this[e++]>>14,l=u*a+f*o;a=o*a+((l&16383)<<14)+n[r]+i,i=(a>>28)+(l>>14)+u*f,n[r++]=a&268435455}return i}function H(e){return M.charAt(e)}function B(e,t){var n=_[e.charCodeAt(t)];return n==null?-1:n}function j(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function F(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+DV:this.t=0}function I(e){var t=C();return t.fromInt(e),t}function q(e,t){var n;if(t==16)n=4;else if(t==8)n=3;else if(t==256)n=8;else if(t==2)n=1;else if(t==32)n=5;else{if(t!=4){this.fromRadix(e,t);return}n=2}this.t=0,this.s=0;var r=e.length,i=!1,s=0;while(--r>=0){var o=n==8?e[r]&255:B(e,r);if(o<0){e.charAt(r)=="-"&&(i=!0);continue}i=!1,s==0?this[this.t++]=o:s+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,s+=n,s>=this.DB&&(s-=this.DB)}n==8&&(e[0]&128)!=0&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&N.ZERO.subTo(this,this)}function R(){var e=this.s&this.DM;while(this.t>0&&this[this.t-1]==e)--this.t}function U(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e==8)t=3;else if(e==2)t=1;else if(e==32)t=5;else{if(e!=4)return this.toRadix(e);t=2}var n=(1<<t)-1,r,i=!1,s="",o=this.t,u=this.DB-o*this.DB%t;if(o-->0){u<this.DB&&(r=this[o]>>u)>0&&(i=!0,s=H(r));while(o>=0)u<t?(r=(this[o]&(1<<u)-1)<<t-u,r|=this[--o]>>(u+=this.DB-t)):(r=this[o]>>(u-=t)&n,u<=0&&(u+=this.DB,--o)),r>0&&(i=!0),i&&(s+=H(r))}return i?s:"0"}function z(){var e=C();return N.ZERO.subTo(this,e),e}function W(){return this.s<0?this.negate():this}function X(e){var t=this.s-e.s;if(t!=0)return t;var n=this.t;t=n-e.t;if(t!=0)return t;while(--n>=0)if((t=this[n]-e[n])!=0)return t;return 0}function V(e){var t=1,n;return(n=e>>>16)!=0&&(e=n,t+=16),(n=e>>8)!=0&&(e=n,t+=8),(n=e>>4)!=0&&(e=n,t+=4),(n=e>>2)!=0&&(e=n,t+=2),(n=e>>1)!=0&&(e=n,t+=1),t}function $(){return this.t<=0?0:this.DB*(this.t-1)+V(this[this.t-1]^this.s&this.DM)}function J(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function K(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function Q(e,t){var n=e%this.DB,r=this.DB-n,i=(1<<r)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM,u;for(u=this.t-1;u>=0;--u)t[u+s+1]=this[u]>>r|o,o=(this[u]&i)<<n;for(u=s-1;u>=0;--u)t[u]=0;t[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()}function G(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t){t.t=0;return}var r=e%this.DB,i=this.DB-r,s=(1<<r)-1;t[0]=this[n]>>r;for(var o=n+1;o<this.t;++o)t[o-n-1]|=(this[o]&s)<<i,t[o-n]=this[o]>>r;r>0&&(t[this.t-n-1]|=(this.s&s)<<i),t.t=this.t-n,t.clamp()}function Y(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r-=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()}function Z(e,t){var n=this.abs(),r=e.abs(),i=n.t;t.t=i+r.t;while(--i>=0)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&N.ZERO.subTo(t,t)}function et(e){var t=this.abs(),n=e.t=2*t.t;while(--n>=0)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function tt(e,t,n){var r=e.abs();if(r.t<=0)return;var i=this.abs();if(i.t<r.t){t!=null&&t.fromInt(0),n!=null&&this.copyTo(n);return}n==null&&(n=C());var s=C(),o=this.s,u=e.s,a=this.DB-V(r[r.t-1]);a>0?(r.lShiftTo(a,s),i.lShiftTo(a,n)):(r.copyTo(s),i.copyTo(n));var f=s.t,l=s[f-1];if(l==0)return;var c=l*(1<<this.F1)+(f>1?s[f-2]>>this.F2:0),h=this.FV/c,p=(1<<this.F1)/c,d=1<<this.F2,v=n.t,m=v-f,g=t==null?C():t;s.dlShiftTo(m,g),n.compareTo(g)>=0&&(n[n.t++]=1,n.subTo(g,n)),N.ONE.dlShiftTo(f,g),g.subTo(s,s);while(s.t<f)s[s.t++]=0;while(--m>=0){var y=n[--v]==l?this.DM:Math.floor(n[v]*h+(n[v-1]+d)*p);if((n[v]+=s.am(0,y,n,m,0,f))<y){s.dlShiftTo(m,g),n.subTo(g,n);while(n[v]<--y)n.subTo(g,n)}}t!=null&&(n.drShiftTo(f,t),o!=u&&N.ZERO.subTo(t,t)),n.t=f,n.clamp(),a>0&&n.rShiftTo(a,n),o<0&&N.ZERO.subTo(n,n)}function nt(e){var t=C();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(N.ZERO)>0&&e.subTo(t,t),t}function rt(e){this.m=e}function it(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function st(e){return e}function ot(e){e.divRemTo(this.m,null,e)}function ut(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function at(e,t){e.squareTo(t),this.reduce(t)}function ft(){if(this.t<1)return 0;var e=this[0];if((e&1)==0)return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function lt(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function ct(e){var t=C();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(N.ZERO)>0&&this.m.subTo(t,t),t}function ht(e){var t=C();return e.copyTo(t),this.reduce(t),t}function pt(e){while(e.t<=this.mt2)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=e[t]&32767,r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;n=t+this.m.t,e[n]+=this.m.am(0,r,e,t,0,this.m.t);while(e[n]>=e.DV)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function dt(e,t){e.squareTo(t),this.reduce(t)}function vt(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function mt(){return(this.t>0?this[0]&1:this.s)==0}function gt(e,t){if(e>4294967295||e<1)return N.ONE;var n=C(),r=C(),i=t.convert(this),s=V(e)-1;i.copyTo(n);while(--s>=0){t.sqrTo(n,r);if((e&1<<s)>0)t.mulTo(r,i,n);else{var o=n;n=r,r=o}}return t.revert(n)}function yt(e,t){var n;return e<256||t.isEven()?n=new rt(t):n=new lt(t),this.exp(e,n)}function bt(){var e=C();return this.copyTo(e),e}function wt(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Et(){return this.t==0?this.s:this[0]<<24>>24}function St(){return this.t==0?this.s:this[0]<<16>>16}function xt(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function Tt(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function Nt(e){e==null&&(e=10);if(this.signum()==0||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=I(n),i=C(),s=C(),o="";this.divRemTo(r,i,s);while(i.signum()>0)o=(n+s.intValue()).toString(e).substr(1)+o,i.divRemTo(r,i,s);return s.intValue().toString(e)+o}function Ct(e,t){this.fromInt(0),t==null&&(t=10);var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,s=0,o=0;for(var u=0;u<e.length;++u){var a=B(e,u);if(a<0){e.charAt(u)=="-"&&this.signum()==0&&(i=!0);continue}o=t*o+a,++s>=n&&(this.dMultiply(r),this.dAddOffset(o,0),s=0,o=0)}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(o,0)),i&&N.ZERO.subTo(this,this)}function kt(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(N.ONE.shiftLeft(e-1),Ht,this),this.isEven()&&this.dAddOffset(1,0);while(!this.isProbablePrime(t))this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(N.ONE.shiftLeft(e-1),this)}else{var r=new Array,i=e&7;r.length=(e>>3)+1,t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}}function Lt(){var e=this.t,t=new Array;t[0]=this.s;var n=this.DB-e*this.DB%8,r,i=0;if(e-->0){n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);while(e>=0){n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),(r&128)!=0&&(r|=-256),i==0&&(this.s&128)!=(r&128)&&++i;if(i>0||r!=this.s)t[i++]=r}}return t}function At(e){return this.compareTo(e)==0}function Ot(e){return this.compareTo(e)<0?this:e}function Mt(e){return this.compareTo(e)>0?this:e}function _t(e,t,n){var r,i,s=Math.min(e.t,this.t);for(r=0;r<s;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){i=e.s&this.DM;for(r=s;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{i=this.s&this.DM;for(r=s;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function Dt(e,t){return e&t}function Pt(e){var t=C();return this.bitwiseTo(e,Dt,t),t}function Ht(e,t){return e|t}function Bt(e){var t=C();return this.bitwiseTo(e,Ht,t),t}function jt(e,t){return e^t}function Ft(e){var t=C();return this.bitwiseTo(e,jt,t),t}function It(e,t){return e&~t}function qt(e){var t=C();return this.bitwiseTo(e,It,t),t}function Rt(){var e=C();for(var t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e}function Ut(e){var t=C();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function zt(e){var t=C();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function Wt(e){if(e==0)return-1;var t=0;return(e&65535)==0&&(e>>=16,t+=16),(e&255)==0&&(e>>=8,t+=8),(e&15)==0&&(e>>=4,t+=4),(e&3)==0&&(e>>=2,t+=2),(e&1)==0&&++t,t}function Xt(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+Wt(this[e]);return this.s<0?this.t*this.DB:-1}function Vt(e){var t=0;while(e!=0)e&=e-1,++t;return t}function $t(){var e=0,t=this.s&this.DM;for(var n=0;n<this.t;++n)e+=Vt(this[n]^t);return e}function Jt(e){var t=Math.floor(e/this.DB);return t>=this.t?this.s!=0:(this[t]&1<<e%this.DB)!=0}function Kt(e,t){var n=N.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function Qt(e){return this.changeBit(e,Ht)}function Gt(e){return this.changeBit(e,It)}function Yt(e){return this.changeBit(e,jt)}function Zt(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r+=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()}function en(e){var t=C();return this.addTo(e,t),t}function tn(e){var t=C();return this.subTo(e,t),t}function nn(e){var t=C();return this.multiplyTo(e,t),t}function rn(){var e=C();return this.squareTo(e),e}function sn(e){var t=C();return this.divRemTo(e,t,null),t}function on(e){var t=C();return this.divRemTo(e,null,t),t}function un(e){var t=C(),n=C();return this.divRemTo(e,t,n),new Array(t,n)}function an(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function fn(e,t){if(e==0)return;while(this.t<=t)this[this.t++]=0;this[t]+=e;while(this[t]>=this.DV)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}function ln(){}function cn(e){return e}function hn(e,t,n){e.multiplyTo(t,n)}function pn(e,t){e.squareTo(t)}function dn(e){return this.exp(e,new ln)}function vn(e,t,n){var r=Math.min(this.t+e.t,t);n.s=0,n.t=r;while(r>0)n[--r]=0;var i;for(i=n.t-this.t;r<i;++r)n[r+this.t]=this.am(0,e[r],n,r,0,this.t);for(i=Math.min(e.t,t);r<i;++r)this.am(0,e[r],n,r,0,t-r);n.clamp()}function mn(e,t,n){--t;var r=n.t=this.t+e.t-t;n.s=0;while(--r>=0)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function gn(e){this.r2=C(),this.q3=C(),N.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function yn(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=C();return e.copyTo(t),this.reduce(t),t}function bn(e){return e}function wn(e){e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(e.compareTo(this.r2)<0)e.dAddOffset(1,this.m.t+1);e.subTo(this.r2,e);while(e.compareTo(this.m)>=0)e.subTo(this.m,e)}function En(e,t){e.squareTo(t),this.reduce(t)}function Sn(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function xn(e,t){var n=e.bitLength(),r,i=I(1),s;if(n<=0)return i;n<18?r=1:n<48?r=3:n<144?r=4:n<768?r=5:r=6,n<8?s=new rt(t):t.isEven()?s=new gn(t):s=new lt(t);var o=new Array,u=3,a=r-1,f=(1<<r)-1;o[1]=s.convert(this);if(r>1){var l=C();s.sqrTo(o[1],l);while(u<=f)o[u]=C(),s.mulTo(l,o[u-2],o[u]),u+=2}var c=e.t-1,h,p=!0,d=C(),v;n=V(e[c])-1;while(c>=0){n>=a?h=e[c]>>n-a&f:(h=(e[c]&(1<<n+1)-1)<<a-n,c>0&&(h|=e[c-1]>>this.DB+n-a)),u=r;while((h&1)==0)h>>=1,--u;(n-=u)<0&&(n+=this.DB,--c);if(p)o[h].copyTo(i),p=!1;else{while(u>1)s.sqrTo(i,d),s.sqrTo(d,i),u-=2;u>0?s.sqrTo(i,d):(v=i,i=d,d=v),s.mulTo(d,o[h],i)}while(c>=0&&(e[c]&1<<n)==0)s.sqrTo(i,d),v=i,i=d,d=v,--n<0&&(n=this.DB-1,--c)}return s.revert(i)}function Tn(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),s=n.getLowestSetBit();if(s<0)return t;i<s&&(s=i),s>0&&(t.rShiftTo(s,t),n.rShiftTo(s,n));while(t.signum()>0)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n}function Nn(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(t==0)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n}function Cn(e){var t=e.isEven();if(this.isEven()&&t||e.signum()==0)return N.ZERO;var n=e.clone(),r=this.clone(),i=I(1),s=I(0),o=I(0),u=I(1);while(n.signum()!=0){while(n.isEven()){n.rShiftTo(1,n);if(t){if(!i.isEven()||!s.isEven())i.addTo(this,i),s.subTo(e,s);i.rShiftTo(1,i)}else s.isEven()||s.subTo(e,s);s.rShiftTo(1,s)}while(r.isEven()){r.rShiftTo(1,r);if(t){if(!o.isEven()||!u.isEven())o.addTo(this,o),u.subTo(e,u);o.rShiftTo(1,o)}else u.isEven()||u.subTo(e,u);u.rShiftTo(1,u)}n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(o,i),s.subTo(u,s)):(r.subTo(n,r),t&&o.subTo(i,o),u.subTo(s,u))}return r.compareTo(N.ONE)!=0?N.ZERO:u.compareTo(e)>=0?u.subtract(e):u.signum()<0?(u.addTo(e,u),u.signum()<0?u.add(e):u):u}function An(e){var t,n=this.abs();if(n.t==1&&n[0]<=kn[kn.length-1]){for(t=0;t<kn.length;++t)if(n[0]==kn[t])return!0;return!1}if(n.isEven())return!1;t=1;while(t<kn.length){var r=kn[t],i=t+1;while(i<kn.length&&r<Ln)r*=kn[i++];r=n.modInt(r);while(t<i)if(r%kn[t++]==0)return!1}return n.millerRabin(e)}function On(e){var t=this.subtract(N.ONE),r=t.getLowestSetBit();if(r<=0)return!1;var i=t.shiftRight(r);e=e+1>>1,e>kn.length&&(e=kn.length);var s=C();for(var o=0;o<e;++o){s.fromInt(kn[Math.floor(n.Util.random()*kn.length)]);var u=s.modPow(i,this);if(u.compareTo(N.ONE)!=0&&u.compareTo(t)!=0){var a=1;while(a++<r&&u.compareTo(t)!=0){u=u.modPowInt(2,this);if(u.compareTo(N.ONE)==0)return!1}if(u.compareTo(t)!=0)return!1}}return!0}function Mn(){this.i=0,this.j=0,this.S=new Array}function _n(e){var t,n,r;for(t=0;t<256;++t)this.S[t]=t;n=0;for(t=0;t<256;++t)n=n+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.i=0,this.j=0}function Dn(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]}function Pn(){return new Mn}function In(e){jn[Fn++]^=e&255,jn[Fn++]^=e>>8&255,jn[Fn++]^=e>>16&255,jn[Fn++]^=e>>24&255,Fn>=Hn&&(Fn-=Hn)}function qn(){In((new Date).getTime())}function zn(){if(Bn==null){qn(),Bn=Pn(),Bn.init(jn);for(Fn=0;Fn<jn.length;++Fn)jn[Fn]=0;Fn=0}return Bn.next()}function Wn(e){var t;for(t=0;t<e.length;++t)e[t]=zn()}function Xn(){}function Jn(e){var t,n,r="";for(t=0;t+3<=e.length;t+=3)n=parseInt(e.substring(t,t+3),16),r+=Vn.charAt(n>>6)+Vn.charAt(n&63);t+1==e.length?(n=parseInt(e.substring(t,t+1),16),r+=Vn.charAt(n<<2)):t+2==e.length&&(n=parseInt(e.substring(t,t+2),16),r+=Vn.charAt(n>>2)+Vn.charAt((n&3)<<4));while((r.length&3)>0)r+=$n;return r}function Kn(e){var t="",n,r=0,i;for(n=0;n<e.length;++n){if(e.charAt(n)==$n)break;v=Vn.indexOf(e.charAt(n));if(v<0)continue;r==0?(t+=H(v>>2),i=v&3,r=1):r==1?(t+=H(i<<2|v>>4),i=v&15,r=2):r==2?(t+=H(i),t+=H(v>>2),i=v&3,r=3):(t+=H(i<<2|v>>4),t+=H(v&15),r=0)}return r==1&&(t+=H(i<<2)),t}function Qn(e){var t=Kn(e),n,r=new Array;for(n=0;2*n<t.length;++n)r[n]=parseInt(t.substring(2*n,2*n+2),16);return r}function Gn(e,t){return new N(e,t)}function Yn(e){return e<16?"0"+e.toString(16):e.toString(16)}function Zn(e,t){if(t<e.length+11)return null;var n=new Array,r=e.length-1;while(r>=0&&t>0){var i=e.charCodeAt(r--);i<128?n[--t]=i:i>127&&i<2048?(n[--t]=i&63|128,n[--t]=i>>6|192):(n[--t]=i&63|128,n[--t]=i>>6&63|128,n[--t]=i>>12|224)}n[--t]=0;var s=new Xn,o=new Array;while(t>2){o[0]=0;while(o[0]==0)s.nextBytes(o);n[--t]=o[0]}return n[--t]=2,n[--t]=0,new N(n)}function er(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function tr(e,t){this.n=Gn(e,16),this.e=parseInt(t,16)}function nr(e){return e.modPowInt(this.e,this.n)}function rr(e){var t=Zn(e,this.n.bitLength()+7>>3);if(t==null)return null;var n=this.doPrivate(t);if(n==null)return null;var r=n.toString(16);return(r.length&1)==0?r:"0"+r}function ir(e,t){var n=e.toByteArray(),r=0;while(r<n.length&&n[r]==0)++r;if(n.length-r!=t-1||n[r]!=2)return null;++r;while(n[r]!=0)if(++r>=n.length)return null;var i="";while(++r<n.length){var s=n[r]&255;s<128?i+=String.fromCharCode(s):s>191&&s<224?(i+=String.fromCharCode((s&31)<<6|n[r+1]&63),++r):(i+=String.fromCharCode((s&15)<<12|(n[r+1]&63)<<6|n[r+2]&63),r+=2)}return i}function sr(e,t,n){this.n=Gn(e,16),this.e=parseInt(t,16),this.d=Gn(n,16)}function or(e,t,n,r,i,s,o,u){this.n=Gn(e,16),this.e=parseInt(t,16),this.d=Gn(n,16),this.p=Gn(r,16),this.q=Gn(i,16),this.dmp1=Gn(s,16),this.dmq1=Gn(o,16),this.coeff=Gn(u,16)}function ur(e){if(this.p==null||this.q==null)return e.modPow(this.d,this.n);var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);while(t.compareTo(n)<0)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)}function ar(e){var t=Gn(e,16),n=this.doPublic(t);return n==null?null:ir(n,this.n.bitLength()+7>>3)}function Xr(e,t,n){var r=0,i=0,s=t.split("\n"),o=e.measureText("e").width*2;return s.forEach(function(t){if(n){var s=t.split(" "),u=s.length,a="",f,l,c,h,p;for(c=0;c<u;c++){f=s[c]+(c===u-1?"":" "),l=a+f,h=e.measureText(l).width;if(h<n)a=l;else if(h==n)a="",i+=o;else{for(p=0;p<f.length;p++){l=a+f.substr(0,p+1);if(e.measureText(l).width>n){a=f.substring(p,f.length),i+=o;break}}while(a.length>0&&e.measureText(a).width>n)for(p=0;p<a.length;p++){l=a.substr(0,p+1);if(e.measureText(l).width>n){a=a.substring(p,a.length),i+=o;break}}}}}else h=e.measureText(t).width,r=h>r?h:r;i+=o}),r=n?n:r,{w:r,h:i}}function ci(e,t,n,r){var i=e.animate,s=r._now,o=r._shapeDataIndex,u,a=n._animates;a||(a=n._animates={});if(o.length)for(var f=0;f<o.length;f++){u=o[f];var l=a[u];l||(l=a[u]={}),a=l}else u=o;var c=a[u];c||(c=a[u]={},i.forEach(function(i){var o=i.attr,u=c[o],a;i={attr:o,to:i.to,type:i.type||"number",delay:i.delay||0,dur:i.dur||1e3,interval:i.interval||0,finish:i.finish,repeat:i.repeat||1,reverse:i.reverse==null?!0:i.reverse,onDone:i.onDone,easing:i.easing,trigger:i.to==null,start:s,time:0,total:0,count:0,started:!1,stopped:!1,current:null},Array.isArray(i.dur)&&(i.groupDur=i.dur.slice(0,i.dur.length-1),i.dur=i.dur[i.dur.length-1],i.groupDurTotal=i.groupDur.reduce(function(e,t,n){return i.groupDur[n]=e+t},0),i.groupIndex=0,i.groupTime=0,i.groupStart=s),i.finish==null&&(i.finish=i.delay+i.dur+i.interval),u?Array.isArray(u)?(u.push(i),u=u[u.length-2]):c[o]=[u,i]:(a=Zr(n,t,e,o,r),c[o]=i),u&&(a=u.to,u.type==="group_set"&&(a=a[a.length-1])),i.from=a,i.trigger||(i.started=!0,Ei(i),Si(i))})),i=c,Object.keys(i).forEach(function(o){var u=i[o];if(Array.isArray(u)){var a=u[u.length-1];a.count+1===a.repeat?u.forEach(function(i){hi(i,e,t,n,r,!0)}):a.count+1<a.repeat&&(a.total>=a.finish&&u.forEach(function(e){e.trigger||(e.started=!0),e.stopped=!1,e.time=0,e.start=s,e.total=0,e.type==="group_set"&&(e.groupIndex=0,e.groupTime=0,e.groupStart=s)}),u.forEach(function(i){hi(i,e,t,n,r,!1)}))}else hi(u,e,t,n,r,!0)})}function hi(e,t,n,r,i,s){if(e.trigger){var o=Zr(r,n,t,e.attr,i,null,!1);if(!e.started){if(o===e.from)return;e.started=!0,e.start=i._now,e.to=o,Ei(e),Si(e)}e.started&&o!==e.to&&(e.start=i._now,e.from=e.current,e.to=o,e.time=0,e.total=0,e.count=0,Ei(e),Si(e))}if(e.started&&!e.stopped){var u=i._now,a=u-e.start;if(a>=e.delay){e.total=a,a-=e.delay,e.time=a>e.dur?e.dur:a,e.type==="group_set"&&(e.groupTime=u-e.groupStart,e.groupStart===e.start&&(e.groupTime-=e.delay),e.groupTime>=e.groupDur[e.groupIndex]&&e.groupIndex++,e.groupTime>=e.groupDurTotal&&(e.groupIndex=0,e.groupTime=e.groupTime-e.groupDurTotal,e.groupStart=u));if(e.total>=e.finish){e.count++,e.type==="group_set";if(e.count>=e.repeat)e.time=e.dur,e.stopped=!0,e.trigger&&(e.from=e.to,e.to=null,e.start=null,e.time=0,e.total=0,e.count=0,e.started=!1,e.stopped=!1),e.onDone&&e.onDone.call(n,r,i);else if(s){e.time=0,e.start=u,e.total=0;if(e.reverse){var f=e.from;e.from=e.to,e.to=f,Si(e)}}}}i&&!i._invalidate&&(i._invalidate=!0)}}function di(e){if(!Ti[e.id]){Ci=!0,Ti[e.id]=e;if(e.from==null&&e.attr&&e.source){var t;(t=e.attr.match(/^S[:@](.*)/i))?e.from=e.source.getStyle(t[1]):(t=e.attr.match(/^C[:@](.*)/i))?e.from=e.source.getClient(t[1]):e.from=n.Util.getValue(e.source,e.attr)}Ei(e),Si(e)}return e.resume(),e}function vi(e,t){return Ti[e.id]&&(t==null&&(t=!0),t&&wi(e,e.to),e.onStop&&e.onStop(),e.time=0,e.total=0,e.start=null,e.count=0,e.started=!1,e.stopped=!1,e.paused=!1,e.pausedTime=null,e.pausedTotal=0,e._oldSpeed=null,e._speedTotal=0,e._speedTime=null,e._percent=0,e._percentSet=null,e._percentDiff=0,delete Ti[e.id]),e}function mi(e){e==null&&(e=!0),Object.keys(Ti).forEach(function(t){var n=Ti[t];if(!n)return;e&&wi(n,n.to),n.onStop&&n.onStop()}),Ti={}}function gi(){Object.keys(Ti).forEach(function(e){var t=Ti[e];if(!t)return;t.pause()})}function yi(){Object.keys(Ti).forEach(function(e){var t=Ti[e];if(!t)return;t.resume()})}function bi(e){Object.keys(Ti).forEach(function(t){var n=Ti[t];if(!n)return;n.start==null&&(n._speedTime=n.start=e),n._percentSet!=null&&(n._percentDiff+=(n._percentSet-n._percent)*n.finish);if(n.paused){n.pausedTime||(n.pausedTime=e);if(n._percentSet==null)return}n._percentSet==null&&n.pausedTime&&(n.pausedTotal+=(e-n.pausedTime)*(n._oldSpeed||n._speed),n.pausedTime=null),n._oldSpeed&&!n.pausedTime&&(n._speedTotal=(e-n._speedTime)*n._oldSpeed-n.pausedTotal+n._percentDiff+n._speedTotal,n._percentDiff=0,n.pausedTotal=0,n._speedTime=e,n._oldSpeed=null),n.total=(e-n._speedTime)*n._speed-n.pausedTotal+n._percentDiff+n._speedTotal,n._percentSet!=null&&n.pausedTime&&(n.total-=(e-n.pausedTime)*(n._oldSpeed||n._speed)),n._percent=n.total>=n.finish?1:n.total/n.finish;if(n.total>n.delay){n.time=n.total-n.delay;var r=!1;n.time>=n.dur&&(n.time=n.dur,n.total>=n.finish&&(r=!0)),!n.stopped&&wi(n,xi(n)),n.stopped=r;if(n.total>=n.finish){n.count++;if(n.count>=n.repeat)vi(n,!1),n.onDone&&n.onDone();else{n.time=0,n.total=0,n.start=null,n.stopped=!1;if(n.reverse){var i=n.from;n.from=n.to,n.to=i,Si(n)}}}}n.paused||!Ci&&(Ci=!0),n._percentSet!=null&&(n._percentSet=null)})}function wi(e,t){e.started||(e.started=!0,e.onPlay&&e.onPlay()),e.filter&&(t=e.filter(t));if(e.attr&&e.source){var r;(r=e.attr.match(/^S[:@](.*)/i))?e.source.setStyle(r[1],t):(r=e.attr.match(/^C[:@](.*)/i))?e.source.setClient(r[1],t):n.Util.setValue(e.source,e.attr,t)}e.onUpdate&&e.onUpdate(t)}function Ei(e){var t=e.type,n=e.from,r=e.to;t==="number"?(e.from=n||0,e.to=r||0):t==="point"?(n?n.length&&(e.from={x:n[0],y:n[1]}):e.from=e.attr==="scale"?{x:1,y:1}:{x:0,y:0},r?r.length&&(e.to={x:r[0],y:r[1]}):e.to=e.attr==="scale"?{x:1,y:1}:{x:0,y:0}):t==="rect"?(n?n.length&&(e.from={x:n[0],y:n[1],w:n[2],h:n[3]}):e.from={x:0,y:0,w:0,h:0},r?r.length&&(e.to={x:r[0],y:r[1],w:r[2],h:r[3]}):e.to={x:0,y:0,w:0,h:0}):t==="color"?(e.from=Hi(n),e.to=Hi(r)):t!=="set"&&t==="group_set",e.current=e.from}function Si(e){var t=e.type,n=e.from,r=e.to;t==="number"?e.delta=r-n:t==="point"?e.delta={x:r.x-n.x,y:r.y-n.y}:t==="rect"?e.delta={x:r.x-n.x,y:r.y-n.y,w:r.w-n.w,h:r.h-n.h}:t==="color"?e.delta={r:r.r-n.r,g:r.g-n.g,b:r.b-n.b,a:r.a-n.a}:t!=="set"&&t==="group_set"}function xi(e,t){var n=e.type,r=e.delta,i=e.from,s=e.time,o=e.dur,u=ki[e.easing||"easeNone"];return u||(u=ki.easeNone),n==="number"?t=u(s,i,r,o):n==="point"?t={x:u(s,i.x,r.x,o),y:u(s,i.y,r.y,o)}:n==="rect"?t={x:u(s,i.x,r.x,o),y:u(s,i.y,r.y,o),w:u(s,i.w,r.w,o),h:u(s,i.h,r.h,o)}:n==="color"?t="rgba("+Math.floor(u(s,i.r,r.r,o))+","+Math.floor(u(s,i.g,r.g,o))+","+Math.floor(u(s,i.b,r.b,o))+","+Math.floor(u(s,i.a,r.a,o))+")":n==="set"?e.time&&(t=e.to):n==="group_set"&&(t=e.to[e.groupIndex]),e.current=t,t}e.twaver&&(e.twaver.animateLoopId&&cancelAnimationFrame(e.twaver.animateLoopId),e.twaver.animateLoopId=null),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t});var n={};n._isInitializing=!1;var r={isDeserializing:!1,isCalculatingBus:!1,images:{},registerImage:function(e,t,i,s,o){r.images[e]=new n.ImageAsset(e,t,i,s,o),Ri(e)},getRegisteredImageNames:function(){return Object.keys(r.images)},unregisterImage:function(e){delete r.images[e]},getImageAsset:function(e){if(typeof e!="string")return;var t=r.images[e];return t},showVersion:function(e){r.isCtrlDown(e)&&e.shiftKey&&e.keyCode==76&&alert("TWaver HTML5 "+n.Util.getVersion()+"\n"+o)},callLater:function(e,t,n,r){return setTimeout(function(){e.apply(t,n)},r||$i.CALL_LATER_DELAY)},isEmptyObject:function(e){for(var t in e)return!1;return!0},xml:function(t){if(e.DOMParser)return(new DOMParser).parseFromString(t,"text/xml");var n=new ActiveXObject("Microsoft.XmlDOM");return n.async=!1,n.loadXml(t),n},num:function(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)},getter:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1),n=/ble$/.test(e)||/ed$/.test(e)?"is":"get";return n+t},setter:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1);return"set"+t},_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(){var e=[];for(var t=0;t<32;t++)e[t]=this._id[Math.floor(n.Util.random()*16)];return e[12]="4",e[16]=this._id[e[16]&3|8],e.join("")},keys:function(e){var t=new Oi;for(var n in e)t.add(n);return t},es:["toString","toLocaleString","valueOf"],ip:function(e,t){var n="_"+t;e[r.getter(t)]=function(){return this[n]},e[r.setter(t)]=function(e){var r=this[n];this[n]=e,this.firePropertyChange(t,r,e)}},validateLicense:function(e){o=e,fr()},ibool:function(e,t){var n="_"+t,i=t.charAt(0).toUpperCase()+t.slice(1);e["is"+i]=function(){return this[n]},e[r.setter(t)]=function(e){var r=this[n];this[n]=e,this.firePropertyChange(t,r,e)}},getValue:function(e,t,n){var r=t.charAt(0).toUpperCase()+t.slice(1),i="get"+r,s="is"+r;return n?n==="boolean"?e[s]():e[i]():e[i]?e[i]():e[s]?e[s]():e[t]},setValue:function(e,t,n){e["set"+t.charAt(0).toUpperCase()+t.slice(1)](n)},clone:function(e){if(!e)return null;var t={};for(var n in e)t[n]=e[n];return t},cloneRect:function(e){return e?{x:e.x,y:e.y,width:e.width,height:e.height}:null},classCache:{},getClass:function(t){var i=r.classCache[t];if(!i){var s=t.split("."),o=s.length;i=e;for(var u=0;u<o;u++)i=i[s[u]],i||"twaver"===s[u]&&(i=n);r.classCache[t]=i}return i},newInstance:function(t){var n=r.getClass(t)||e[t];if(!n)return null;var i=arguments.length,s=arguments;if(i===1)return new n;if(i===2)return new n(s[1]);if(i===3)return new n(s[1],s[2]);if(i===4)return new n(s[1],s[2],s[3]);if(i===5)return new n(s[1],s[2],s[3],s[4]);if(i===6)return new n(s[1],s[2],s[3],s[4],s[5]);if(i===7)return new n(s[1],s[2],s[3],s[4],s[5],s[6]);if(i===8)return new n(s[1],s[2],s[3],s[4],s[5],s[6],s[7]);throw"don't support args more than 7"},addMethod:function(e,t){var n=e.prototype;for(var r in t)n[r]=t[r]},ext:function(e,t,n){var i;typeof e=="string"&&(i=e,e=r.getClass(e));if(t){var s=function(){};s.prototype=t.prototype,e.prototype=new s,e.prototype.constructor=e,e.superClass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}i&&(e.prototype.getClassName=function(){return i});if(n){var o=e.prototype;for(var u in n)p.ext(u,o,n);var a=r.es.length;for(var f=0;f<a;f++)u=r.es[f],n.hasOwnProperty(u)&&!n.propertyIsEnumerable(u)&&(o[u]=n[u])}},setViewBounds:function(e,t){if(!e)return;if(e.adjustBounds)e.adjustBounds(t);else{var n=e.style;!n&&e.getView()&&(n=e.getView().style),n&&(n.position="absolute",n.left=t.x+"px",n.top=t.y+"px",n.width=t.width+"px",n.height=t.height+"px")}},getImageSrc:function(e){var t=r.getImageAsset(e);return t?t.getSrc()?t.getSrc():t.getImage().getAttribute("src"):e},nextColorCount:0,nextColor:function(){return r.nextColorCount>=$i.COLORS.length&&(r.nextColorCount=0),$i.COLORS[r.nextColorCount++]},isCtrlDown:function(e){return e.ctrlKey||e.metaKey},isShiftDown:function(e){return e.shiftKey},isAltDown:function(e){return e.altKey},setText:function(e,t,n){n?h.isFirefox?e.textContent=t:e.innerText=t:e.innerHTML=t},fillDescendant:function(e,t){t.add(e),e.hasChildren()&&e.getChildren().forEach(function(e){r.fillDescendant(e,t)})}},s=Date,o="l=1.0\ntype=1\ngis=1\n3d=0\nstart=2017-03-27\nend=2017-07-01\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=18731fb79e3c5fec0ff3765b1f4fe3eb0e142f369f269b67bdd6022315a2354062d866453e3bb5d7296ee52093759f791e863eaadcd580d99be752b41ea21211e6f62e185f1bbe0051b897aa2786e26eed6a809031a8397a1c3365c913a3e6b28885405e68c9665873352f097ef2cce3b532a9c21d292f2b464b43e3a8fcc8a94ff822f77a9849fa79486ae199fdf2618151a765c2bc6fa04442d31e1c6d0cdb2e7b9ea1ae6bcaf03f9abd57f77bda8759dfcb871580db2452e3a9d54aa95bb98b29856e8bd9ba5ce729a5dc31585d63ec5b71e9b311d73623b12f528c9f1dad933d4d83b043b3a3d238e01a6a79d67c52d4de59a1e9e5ba8d9d1a649ed0889d1154dba88e1907397477a20f53bf61b969885676e33e4e92d0c032ad2ad07d7161b1e121c1b8332ea04c56f9572462df60de2ac905b3a4ae3117f9abca08a4115827a7ea459843d38a8be49ebdcb815a3980702a500c1a55da7ae6e0950ba3f80076de3203c9f5d40c202b7adac31289638e65001f2f8b0ef2faf9af17e67ee75927a51fa0e0a1c643c9d0e89ad593738413693ff32f363c31888ae911d43821648bacc93be141a479ecd06d6255012c686c9dbaa9611a5e88d41ae887ddb7fad27a9c6155ebf2986a131878c18c9ffd923a02289130a07a7919588e70a42d6d6779c35710d6c386f88aadaed0fc0c4ad4f9c75b0de8db4b7c232061e5da600429123592779201d8dca47879925be8e678be51bceb2956a35fff32bde78789c7565bd25810ef3aae3ee5816345069dd2577059f6c5c95aba3fc78e99f43bb7148d94062efaab769535b725cfc30764191da2f26692e26f830f4a259e2f980bdb4a433d5efbf414e61dde58535053eca09e0ce85a264ddd37e2a74615302c266a";e.twaver=n,e._twaver=r,n.animate={},n.network={},n.network.interaction={},n.controls={},n.charts={},n.layout={};var u,a,f=e.navigator,l=e.document,c=e.Image;e.document||(a=!0,u=require("canvas"),c=u.Image,f={userAgent:""},l={});var h=function(){var e={},t=f.userAgent.toLowerCase();return e.isOpera=/opera/.test(t),e.isIE=/msie/.test(t)||/trident/.test(t)||/edge/.test(t),e.isFirefox=/firefox/i.test(t),e.isChrome=/chrome/i.test(t),e.isSafari=!e.isChrome&&/safari/i.test(t),e.isIPhone=/iphone/.test(t),e.isIPod=/ipod/.test(t),e.isIPad=/ipad/.test(t),e.isAndroid=/android/i.test(t),e.isWebOS=/webos/i.test(t),e.isMSTouchable=e.isIE&&(f.msMaxTouchPoints&&f.msMaxTouchPoints>1||f.maxTouchPoints&&f.maxTouchPoints>1),e.isTouchable="ontouchend"in l||e.isMSTouchable,e}();r.ua=h;var p={__accessor:function(e,t){var n=t.__accessor,i=n.length;for(var s=0;s<i;s++)r.ip(e,n[s])},__bool:function(e,t){var n=t.__bool,i=n.length;for(var s=0;s<i;s++)r.ibool(e,n[s])},__client:function(e,t){e.getClient=function(e){return this._clientMap[e]},e.setClient=function(e,t){var n=this._clientMap[e];return t==null?delete this._clientMap[e]:this._clientMap[e]=t,this.firePropertyChange("C:"+e,n,t)&&this.onClientChanged(e,n,t),this},e.getClientProperties=function(){return r.keys(this._clientMap)},e.getClientMap=function(){return this._clientMap},e.onClientChanged=function(e,t,n){}},__style:function(e,i){e.getStyle=function(e,r){var i=this._styleMap[e];return r===t&&(r=!0),i==null&&r?n.Styles.getStyle(e):i},e.setStyle=function(e,t){var n=this._styleMap[e];return t==null?delete this._styleMap[e]:this._styleMap[e]=t,this
.firePropertyChange("S:"+e,n,t)&&this.onStyleChanged(e,n,t),this},e.getStyleProperties=function(){return r.keys(this._styleMap)},e.onStyleChanged=function(e,t,n){}},__new:function(e,t){e.newInstance=function(){var e=r.getClass(this.getClassName());if(!e)return null;var t=arguments.length,n=arguments;if(t===0)return new e;if(t===1)return new e(n[0]);if(t===2)return new e(n[0],n[1]);if(t===3)return new e(n[0],n[1],n[2]);if(t===4)return new e(n[0],n[1],n[2],n[3]);if(t===5)return new e(n[0],n[1],n[2],n[3],n[4]);if(t===6)return new e(n[0],n[1],n[2],n[3],n[4],n[5]);if(t===7)return new e(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);throw"don't support args more than 7"}},__property:function(e,t){e.getValue=function(e,t){return this._propertyType==="accessor"?r.getValue(e,this._propertyName):this._propertyType==="style"&&e.getStyle?e.getStyle(this._propertyName):this._propertyType==="client"&&e.getClient?e.getClient(this._propertyName):this._propertyType==="field"?e[this._propertyName]:null},e.setValue=function(e,t,n){if(this._propertyType==="accessor")e[r.setter(this._propertyName)](t);else{if(this._propertyType==="style"&&e.setStyle)return e.setStyle(this._propertyName,t);if(this._propertyType==="client"&&e.setClient)return e.setClient(this._propertyName,t);this._propertyType==="field"&&(e[this._propertyName]=t)}}},map:{__accessor:1,__bool:1,__client:1,__style:1,__new:1,__tree:1,__property:1},ext:function(e,t,n){p.map[e]===1?p[e](t,n):t[e]=n[e]}};r.extend=p;var d=r.Matrix=function(e,t,n,r,i,s){this.setMatrix(e,t,n,r,i,s)};d.identity=function(){return new d(1,0,0,1,0,0)},d.prototype.setMatrix=function(e,t,n,r,i,s){this._m11=e,this._m12=t,this._m21=n,this._m22=r,this._offsetX=i,this._offsetY=s,this._type=0;if(this._m21!=0||this._m12!=0)this._type=4;else{if(this._m11!=1||this._m22!=1)this._type=2;if(this._offsetX!=0||this._offsetY!=0)this._type|=1;(this._type&(2|1))==0&&(this._type=0)}},d.prototype.transform=function(){var e;arguments.length===2?e={x:arguments[0],y:arguments[1]}:e=arguments[0];if(!e||!r.num(e.x)||!r.num(e.y))throw"arguments should contain x, y";switch(this._type){case 0:return{x:e.x,y:e.y};case 1:return{x:this._offsetX+e.x,y:this._offsetY+e.y};case 2:return{x:e.x*this._m11,y:e.y*this._m22};case 3:return{x:e.x*this._m11+this._offsetX,y:e.y*this._m22+this._offsetY}}return{x:this._m11*e.x+e.y*this._m21+this._offsetX,y:this._m22*e.y+e.x*this._m12+this._offsetY}},d.prototype.translate=function(e,t){this.multiply(new d(1,0,0,1,e,t))},d.prototype.scale=function(e,t){this.multiply(new d(e,0,0,t,0,0))},d.prototype.rotate=function(e,t,n){e=e*Math.PI/180;var r=Math.sin(e),i=Math.cos(e),s=t*(1-i)+n*r,o=n*(1-i)-t*r;this.multiply(new d(i,r,-r,i,s,o))},d.prototype.skew=function(e,t){this.multiply(new d(1,Math.tan(t*Math.PI/180),Math.tan(e*Math.PI/180),1,0,0))},d.prototype.multiply=function(e){var t=this,n=e,r=t._type,i=n._type;if(i!=0)if(r==0)t.setMatrix(n._m11,n._m12,n._m21,n._m22,n._offsetX,n._offsetY);else if(i==1)t._offsetX+=n._offsetX,t._offsetY+=n._offsetY,r!=4&&(t._type|=1);else if(r==1){var s=t._offsetX,o=t._offsetY;t.setMatrix(n._m11,n._m12,n._m21,n._m22,n._offsetX,n._offsetY),t._offsetX=s*n._m11+o*n._m21+n._offsetX,t._offsetY=s*n._m12+o*n._m22+n._offsetY,i==4?t._type=4:t._type=3}else switch(r<<4|i){case 34:t._m11*=n._m11,t._m22*=n._m22;return;case 35:t._m11*=n._m11,t._m22*=n._m22,t._offsetX=n._offsetX,t._offsetY=n._offsetY,t._type=3;return;case 36:case 52:case 66:case 67:case 68:t.setMatrix(t._m11*n._m11+t._m12*n._m21,t._m11*n._m12+t._m12*n._m22,t._m21*n._m11+t._m22*n._m21,t._m21*n._m12+t._m22*n._m22,t._offsetX*n._m11+t._offsetY*n._m21+n._offsetX,t._offsetX*n._m12+t._offsetY*n._m22+n._offsetY);return;case 50:t._m11*=n._m11,t._m22*=n._m22,t._offsetX*=n._m11,t._offsetY*=n._m22;return;case 51:t._m11*=n._m11,t._m22*=n._m22,t._offsetX=n._m11*t._offsetX+n._offsetX,t._offsetY=n._m22*t._offsetY+n._offsetY;return;default:console.log("Matrix multiply hit an invalid case: "+combinedType)}};var m={getDistance:function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},getCenterPoint:function(e,t){if(e&&t)return{x:(e.x+t.x)/2,y:(e.y+t.y)/2};if(t==null&&e.width)return{x:e.x+e.width/2,y:e.y+e.height/2}},isPointInPolygon:function(e,t){e=e._as?e._as:e;var n=0,r=0,i=!1,s=e.length;for(n=0,r=s-1;n<s;r=n++){var o=e[n],u=e[r];o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(i=!i)}return i},unionRect:function(e,t){if(e&&!t)return r.cloneRect(e);if(!e&&t)return r.cloneRect(t);if(e&&t){var n={};return n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.width=Math.max(e.x+e.width,t.x+t.width)-n.x,n.height=Math.max(e.y+e.height,t.y+t.height)-n.y,n}return null},intersects:function(e,t){if(!e||!t)return!1;var n=t.width,r=t.height,i=e.width,s=e.height;if(i<=0||s<=0||n<=0||r<=0)return!1;var o=t.x,u=t.y,a=e.x,f=e.y;return i+=a,s+=f,n+=o,r+=u,(i<a||i>o)&&(s<f||s>u)&&(n<o||n>a)&&(r<u||r>f)},intersection:function(e,t){if(!e||!t)return!1;var n=t.x,r=t.y,i=e.x,s=e.y,o=n;o+=t.width;var u=r;u+=t.height;var a=i;a+=e.width;var f=s;return f+=e.height,n<i&&(n=i),r<s&&(r=s),o>a&&(o=a),u>f&&(u=f),o-=n,u-=r,o===0||u===0?null:{x:n,y:r,width:o,height:u}},contains:function(e,t){var n=t.x,r=t.y,i=t.width,s=t.height,o=e.width,u=e.height;if((o|u|i|s)<0)return!1;var a=e.x,f=e.y;if(n<a||r<f)return!1;o+=a,i+=n;if(i<=n){if(o>=a||i>o)return!1}else if(o>=a&&i>o)return!1;u+=f,s+=r;if(s<=r){if(u>=f||s>u)return!1}else if(u>=f&&s>u)return!1;return!0},getLinePoints:function(e){if(!e)return null;var t=new Oi;return e.forEach(function(e){t.addAll(e)}),t},getLineRect:function(e){var t=m.getLinePoints(e);return m.getRect(t)},getRect:function(e,t){if(!e)return null;e._as&&(e=e._as);var n=e.length;if(n<=0)return null;var r=e[0];t=t||{x:null,y:null,width:0,height:0};for(var i=0;i<n;i++){r=e[i];if(r instanceof Oi)m.getRect(r,t);else{t.x==null&&(t.x=r.x,t.y=r.y);var s=Math.min(t.x,r.x),o=Math.min(t.y,r.y),u=Math.max(t.x+t.width,r.x),a=Math.max(t.y+t.height,r.y);t.x=s,t.y=o,t.width=u-s,t.height=a-o}}return t},addPadding:function(e,t,n,r){r=r||-1;var i=t.getStyle(n)*r;i!=0&&m.grow(e,i,i),i=t.getStyle(n+".left")*r,i!=0&&(e.x-=i,e.width+=i),i=t.getStyle(n+".right")*r,i!=0&&(e.width+=i),i=t.getStyle(n+".top")*r,i!=0&&(e.y-=i,e.height+=i),i=t.getStyle(n+".bottom")*r,i!=0&&(e.height+=i),e.width<0&&(e.width=-e.width,e.x-=e.width),e.height<0&&(e.height=-e.height,e.y-=e.height)},grow:function(e,t,n){if(e==null)return null;n==null&&(n=t);var r=e.width+t+t;if(r<0)return;var i=e.height+n+n;if(i<0)return;return e.x-=t,e.y-=n,e.width=r,e.height=i,e},containsPoint:function(e,t,n){return arguments.length<3&&(n=t.y,t=t.x),!e||t<e.x||n<e.y||t>e.x+e.width||n>e.y+e.height?!1:!0},getHotSpot:function(e,t,n,r,i){if(i==="oval"){var s=.35;return{x:e+n*.5+n*s,y:t+r/2-Math.sqrt(.25-s*s)*r}}if(i==="circle"){var o=e+n/2,u=t+r/2,a=Math.min(n,r)/2;e=o-a,t=u-a,n=a*2,r=a*2;var f=n/2,l=r/2,c=f*l/Math.sqrt(f*f+l*l);return{x:e+n/2+c,y:t+r/2-c}}var h={x:e+n,y:t};return n>3&&(h.x-=3),r>3&&(h.y+=3),h},getCircleRect:function(e){var t=Math.min(e.width,e.height)/2;return{x:e.x+e.width/2-t,y:e.y+e.height/2-t,width:t*2,height:t*2}},getEllipsePoint:function(e,t){if(!e||!t)return null;var n=e.x+e.width/2,r=e.y+e.height/2,i=t.x-n,s=t.y-r,o=e.width/2,u=e.height/2,a=Math.sqrt(1/(1/o/o+s*s/i/i/u/u));i<0&&(a=-a);var f;return i==0?s>0?f=u:f=-u:f=a*s/i,{x:n+a,y:r+f}},createMatrix:function(e,t,n){var r=Math.sin(e),i=Math.cos(e),s=t*(1-i)+n*r,o=n*(1-i)-t*r;return new d(i,r,-r,i,s,o)},calculatePointInfoAlongLineBySegments:function(e,t,n,r,i){return m.calculatePointInfoAlongLine(m.getPointObject(e,t),n,r,i)},calculatePointInfoAlongLine:function(e,n,r,i){n=n===t?!0:n,r=r||0,i=i||0;if(!e||e.size()<2)throw"must more than two points";if(!n){var s=m.reversePath(e);return m.calculatePointInfoAlongLine(s,!0,r,i)}e._as&&(e=e._as);var o,u,a=0,f=0,l,c,h=e.length,p;for(c=0;c<h;c++){p=e[c];if(c==0){u=p;continue}if(r<=0){l=m.calculatePointInfoOnStraightLine(m._getPoint(u),m._getControlPoint(p),r,i),o=l;break}f=m._getLength(p,u);if(a+f>r){l=m.getPathInfo(p,u,r-a,i,f),o=l;break}a+=f,u=p}if(o==null){var d,v;u=e[h-1],v=m._getPoint(u),u instanceof Oi&&(u=u._as),d=u instanceof Array?m._getControlPoint(u):m._getPoint(e[h-2]);var g=Math.atan2(v.y-d.y,v.x-d.x);l=m.transformPoint(v,g,r-a,i),l.angle=g,o=l}return o},reversePath:function(e){var t=new Oi,n=null,r;e._as&&(e=e._as);for(var i=e.length-1;i>=0;i--)r=e[i],t.add(m._getReversePath(r,n)),n=r;return t},_getPoint:function(e){return e._as&&(e=e._as),e instanceof Array?e[e.length-1]:e},_getControlPoint:function(e){return e._as&&(e=e._as),e instanceof Array?e[e.length-2]:e},_getReversePath:function(e,t){var n=m._getPoint(e);return t&&t._as&&(t=t._as),t!=null&&t instanceof Array?t.length==2?new Oi([t[0],n]):new Oi([t[1],t[0],n]):n},_getLength:function(e,t){var n=m._getPoint(t),r=m._getPoint(e);e instanceof Oi&&(e=e._as);if(e instanceof Array)return m.calculateCurveLength(n,e,1);var i=r.y-n.y,s=r.x-n.x;return Math.sqrt(s*s+i*i)},getPathInfo:function(e,t,n,r,i){var s=m._getPoint(t),o=m._getPoint(e),u;e instanceof Oi&&(e=e._as);if(e instanceof Array){i<0&&(i=m._getLength(e,t));var a=n/i,f=m.calculatePointInfoOnCurveLine(s,e,a);s=f.point,u=f.angle,n=0}else u=Math.atan2(o.y-s.y,o.x-s.x);return m.transformPoint(s,u,n,r)},transformPoint:function(e,t,n,r){var i={x:n,y:r},s=m.createMatrix(t,0,0);return i=s.transform(i),i.x+=e.x,i.y+=e.y,{point:i,angle:t}},calculatePointInfoOnStraightLine:function(e,t,n,r){var i=Math.atan2(t.y-e.y,t.x-e.x);return m.transformPoint(e,i,n,r)},calculatePointInfoOnCurveLine:function(e,t,n){if(n<0||n>1)throw"Illegal arguments";return t._as&&(t=t._as),t.length==2?m._calculatePointInfoOnCurveLine2(e,t[0],t[1],n):m._calculatePointInfoOnCurveLine3(e,t[0],t[1],t[2],n)},_calculatePointInfoOnCurveLine2:function(e,t,n,r){var i=2*(e.x+n.x-2*t.x)*r+2*t.x-2*e.x,s=2*(e.y+n.y-2*t.y)*r+2*t.y-2*e.y,o=Math.atan2(s,i),u=(e.x+n.x-2*t.x)*r*r+(2*t.x-2*e.x)*r+e.x,a=(e.y+n.y-2*t.y)*r*r+(2*t.y-2*e.y)*r+e.y;return{point:{x:u,y:a},angle:o}},_calculatePointInfoOnCurveLine3:function(e,t,n,r,i){var s,o,u;s=1-i,o=s*s*s,u=i*i*i;var a=o*e.x+3*i*s*s*t.x+3*i*i*s*n.x+u*r.x,f=o*e.y+3*i*s*s*t.y+3*i*i*s*n.y+u*r.y;return{point:{x:a,y:f},angle:Math.atan2(m._bezeSpeedY(e,t,n,r,i),m._bezeSpeedX(e,t,n,r,i))}},calculateCurveLength:function(e,t,n){return t._as&&(t=t._as),t.length==2?m._calculateCurveLength(e,t[0],t[1],n):m._calculateBezierCurveLength(e,t[0],t[1],t[2],n)},_calculateCurveLength:function(e,t,n,r){if(r<=0||r>1)return 0;var i=Math.floor(r*(Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))+Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y)))/2),s=0;i<=0&&(i=1);var o=r/i,u,a,f=0;for(var l=0;l<i;l++)f=o*l,u=2*(e.x+n.x-2*t.x)*f+2*t.x-2*e.x,a=2*(e.y+n.y-2*t.y)*f+2*t.y-2*e.y,u*=o,a*=o,s+=Math.sqrt(u*u+a*a);return s},_calculateBezierCurveLength:function(e,t,n,r,i){if(i<=0||i>1)return 0;var s=1e4,o=Math.floor(s*i);(o&1)==1&&o++;if(o==0)return 0;var u=Math.floor(o/2),a=0,f=0,l=i/o,c;for(c=0;c<u;c++)a+=m._bezeSpeed(e,t,n,r,(2*c+1)*l);for(c=1;c<u;c++)f+=m._bezeSpeed(e,t,n,r,2*c*l);return(m._bezeSpeed(e,t,n,r,0)+m._bezeSpeed(e,t,n,r,1)+2*f+4*a)*l/3},_bezeSpeedX:function(e,t,n,r,i){var s=1-i;return-3*e.x*s*s+3*t.x*s*s-6*t.x*s*i+6*n.x*s*i-3*n.x*i*i+3*r.x*i*i},_bezeSpeedY:function(e,t,n,r,i){var s=1-i;return-3*e.y*s*s+3*t.y*s*s-6*t.y*s*i+6*n.y*s*i-3*n.y*i*i+3*r.y*i*i},_bezeSpeed:function(e,t,n,r,i){var s=m._bezeSpeedX(e,t,n,r,i),o=m._bezeSpeedY(e,t,n,r,i);return Math.sqrt(s*s+o*o)},getPointObject:function(e,t){if(!t||t.size()==0)return e;var n=new Oi;t=t._as,e=e._as;var r=0,i,s,o=t.length,u=e.length;for(i=0;i<o;i++){s=t[i];if(r==u)break;"cubicto"===s?r<u-2&&n.add([e[r++],e[r++],e[r++]]):"quadto"===s?r<u-1&&n.add([e[r++],e[r++]]):r<u&&n.add(e[r++])}for(;r<u;r++)n.add(e[r]);return n},calculateLineLength:function(e,t){if(!e||e.size()<2)return 0;if(t)return m.calculateLineLength(m.getPointObject(e,t));e=e._as;var n,r=e.length,i,s,o,u,a,f,l=0;for(n=0;n<r;n++){o=e[n];if(n==0){i=o;continue}s=o,s instanceof Oi&&(s=s._as),s instanceof Array?(u=m.calculateCurveLength(i,s,1),i=s[s.length-1]):(f=o.y-i.y,a=o.x-i.x,u=Math.sqrt(a*a+f*f),i=s),l+=u}return l},toDegrees:function(e){return e*180/Math.PI},toRadians:function(e){return e/180*Math.PI},getRadiansBetweenLines:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},getAngle:function(e,t){return e.x===t.x?t.y===e.y?0:t.y>e.y?Math.PI/2:-Math.PI/2:Math.atan((t.y-e.y)/(t.x-e.x))}};r.math=m;var g={getPoints:function(e){var t=new Oi;return e.forEach(function(e){t.add({x:e.x,y:e.y}),t.add({x:e.x+e.width,y:e.y+e.height}),t.add({x:e.x+e.width,y:e.y}),t.add({x:e.x,y:e.y+e.height})}),t},rectangle:function(e){var t;return e.forEach(function(e){t=m.unionRect(t,e)}),t},oval:function(e){var t=g.rectangle(e),n=0,r=t.height/t.width,i=r*r,s=t.x+t.width/2,o=t.y+t.height/2,u=g.getPoints(e);u.forEach(function(e){var t=e.x-s,r=e.y-o,u=t*t+r*r/i;u>n&&(n=u)}),n=Math.sqrt(n);var a=r*n;return{x:s-n,y:o-a,width:n*2,height:a*2}},circle:function(e){var t=g.rectangle(e),n=0,r=t.x+t.width/2,i=t.y+t.height/2,s=g.getPoints(e);return s.forEach(function(e){var t=e.x-r,s=e.y-i,o=t*t+s*s;o>n&&(n=o)}),n=Math.sqrt(n),{x:r-n,y:i-n,width:n*2,height:n*2}},roundrect:function(e){var t=g.rectangle(e),n=Math.min(t.width,t.height)/16;return m.grow(t,n,n),t},star:function(e){var t=g.rectangle(e);return m.grow(t,t.width,t.height),t},triangle:function(e){var t=g.rectangle(e);return t.x-=t.width/2,t.width*=2,t.y-=t.height,t.height*=2,t},hexagon:function(e){var t=g.rectangle(e);return t.x-=t.width/2,t.width*=2,t},pentagon:function(e){var t=g.rectangle(e);return t.x-=t.width/6,t.width+=t.width/3,t.y-=t.height/4,t.height+=t.height/4,t},diamond:function(e){var t=g.rectangle(e);return t.x-=t.width/2,t.width+=t.width,t.y-=t.height/2,t.height+=t.height,t},trapezoidal:function(e){var t=g.rectangle(e);return t.x-=t.width/2,t.width+=t.width,t.y-=t.height/2,t.height+=t.height,t}};r.group=g;var y={"topleft.topleft":function(e,t){return{x:e.x-t.width,y:e.y-t.height}},"topleft.topright":function(e,t){return{x:e.x,y:e.y-t.height}},"top.top":function(e,t){return{x:e.x+e.width/2-t.width/2,y:e.y-t.height}},"topright.topleft":function(e,t){return{x:e.x+e.width-t.width,y:e.y-t.height}},"topright.topright":function(e,t){return{x:e.x+e.width,y:e.y-t.height}},topleft:function(e,t){return{x:e.x-t.width/2,y:e.y-t.height/2}},top:function(e,t){return{x:e.x-t.width/2+e.width/2,y:e.y-t.height/2}},topright:function(e,t){return{x:e.x-t.width/2+e.width,y:e.y-t.height/2}},"topleft.bottomleft":function(e,t){return{x:e.x-t.width,y:e.y}},"topleft.bottomright":function(e,t){return{x:e.x,y:e.y}},"top.bottom":function(e,t){return{x:e.x+e.width/2-t.width/2,y:e.y}},"topright.bottomleft":function(e,t){return{x:e.x-t.width+e.width,y:e.y}},"topright.bottomright":function(e,t){return{x:e.x+e.width,y:e.y}},"left.left":function(e,t){return{x:e.x-t.width,y:e.y+e.height/2-t.height/2}},left:function(e,t){return{x:e.x-t.width/2,y:e.y+e.height/2-t.height/2}},"left.right":function(e,t){return{x:e.x,y:e.y+e.height/2-t.height/2}},center:function(e,t){return{x:e.x+e.width/2-t.width/2,y:e.y+e.height/2-t.height/2}},"right.left":function(e,t){return{x:e.x+e.width-t.width,y:e.y+e.height/2-t.height/2}},right:function(e,t){return{x:e.x+e.width-t.width/2,y:e.y+e.height/2-t.height/2}},"right.right":function(e,t){return{x:e.x+e.width,y:e.y+e.height/2-t.height/2}},"bottomleft.topleft":function(e,t){return{x:e.x-t.width,y:e.y+e.height-t.height}},"bottomleft.topright":function(e,t){return{x:e.x,y:e.y+e.height-t.height}},"bottom.top":function(e,t){return{x:e.x+e.width/2-t.width/2,y:e.y+e.height-t.height}},"bottomright.topleft":function(e,t){return{x:e.x+e.width-t.width,y:e.y+e.height-t.height}},"bottomright.topright":function(e,t){return{x:e.x+e.width,y:e.y+e.height-t.height}},bottomleft:function(e,t){return{x:e.x-t.width/2,y:e.y+e.height-t.height/2}},bottom:function(e,t){return{x:e.x+e.width/2-t.width/2,y:e.y+e.height-t.height/2}},bottomright:function(e,t){return{x:e.x+e.width-t.width/2,y:e.y+e.height-t.height/2}},"bottomleft.bottomleft":function(e,t){return{x:e.x-t.width,y:e.y+e.height}},"bottomleft.bottomright":function(e,t){return{x:e.x,y:e.y+e.height}},"bottom.bottom":function(e,t){return{x:e.x+e.width/2-t.width/2,y:e.y+e.height}},"bottomright.bottomleft":function(e,t){return{x:e.x+e.width-t.width,y:e.y+e.height}},"bottomright.bottomright":function(e,t){return{x:e.x+e.width,y:e.y+e.height}},get:function(e,t,n){if(!t)throw"refRect can not be null";n||(n={width:0,height:0});var r=y[e];if(r)return r(t,n);throw"Can not resolve '"+e+"' position"}};r.position=y;var b={preventDefault:function(e){if($i.KEEP_DEFAULT_FUNCTION(e))return;e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1},insertAfter:function(e,t){return t?t.parentNode.insertBefore(e,t.nextSibling):e.parentNode.insertBefore(e,e.parentNode.firstChild),e},forEach:function(e,t,n){if(!b.isVisible(e))return;var r=e.childNodes.length;for(var i=0;i<r;i++)b.forEach(e.childNodes[i],t,n);n?t.call(n,e):t(e)},setVisible:function(e,t){e.style.display=t?"block":"none"},isVisible:function(e){return"style"in e&&e.style.display!=="none"},release:function(e){var t=e.childNodes.length;for(var n=0;n<t;n++)b.release(e.childNodes[n]);t>0&&b.clear(e),e._pool&&e._pool.release(e)},clear:function(e){while(e.firstChild)e.removeChild(e.firstChild)},setZoom:function(e,t){var n=e.style;if(n.setProperty)if(h.isFirefox)n.setProperty("-moz-transform","scale("+t+")",null),n.setProperty("-moz-transform-origin","0 0",null);else if(h.isOpera)n.setProperty("-o-transform","scale("+t+")",null),n.setProperty("-o-transform-origin","0 0",null);else if(h.isChrome||h.isSafari){n.setProperty("-webkit-transform","scale("+t+")",null),n.setProperty("-webkit-transform-origin","0 0",null);var r=null;e._webkitInvaildateDiv?r=e._webkitInvaildateDiv:(r=l.createElement("div"),e._webkitInvaildateDiv=r),!r.parentNode||r.parentNode!=e?e.appendChild(r):e.removeChild(r)}else h.isIE?(n.setProperty("-ms-transform","scale("+t+")",null),n.setProperty("-ms-transform-origin","0 0",null)):(n.setProperty("transform","scale("+t+")",null),n.setProperty("transform-origin","0 0",null))},setRotate:function(e,t){var n=e.style;if(n.setProperty)if(h.isFirefox)n.setProperty("-moz-transform","scale("+t+")",null),n.setProperty("-moz-transform-origin","0 0",null);else if(h.isOpera)n.setProperty("-o-transform","scale("+t+")",null),n.setProperty("-o-transform-origin","0 0",null);else if(h.isChrome||h.isSafari){n.setProperty("-webkit-transform","scale("+t+")",null),n.setProperty("-webkit-transform-origin","0 0",null);var r=null;e._webkitInvaildateDiv?r=e._webkitInvaildateDiv:(r=l.createElement("div"),e._webkitInvaildateDiv=r),!r.parentNode||r.parentNode!=e?e.appendChild(r):e.removeChild(r)}else h.isIE?(n.setProperty("-ms-transform","scale("+t+")",null),n.setProperty("-ms-transform-origin","0 0",null)):(n.setProperty("transform","scale("+t+")",null),n.setProperty("transform-origin","0 0",null))},setCSSStyle:function(e,t,n){e.style.setProperty(t,n,null)},removeCSSStyle:function(e,t){e.style.removeProperty(t)},getCSSStyle:function(e,t){return e.style.getPropertyValue(t)},setBorderRaidus:function(e,t){h.isFirefox?e.style.MozBorderRadius=t:e.style.borderRadius=t},createSelect:function(e,t){var n=l.createElement("select"),r,i,s;if(Array.isArray(e))for(r=0;r<e.length;r++)i=e[r],s=l.createElement("option"),s.innerHTML=i,s.setAttribute("value",i),i===t&&s.setAttribute("selected","true"),n.appendChild(s);else for(r=0;r<e.values.length;r++)i=e.values[r],s=l.createElement("option"),s.innerHTML=e.map[i],s.setAttribute("value",i),i===t&&s.setAttribute("selected","true"),n.appendChild(s);return n},createImg:function(e){var t=l.createElement("img");return t.style.position="absolute",typeof e=="string"&&t.setAttribute("src",e),t},createView:function(e,t){var n=l.createElement("div");return n.style.position=$i.VIEW_POSITION,n.style.fontSize=$i.VIEW_FONT_SIZE,n.style.fontFamily=$i.VIEW_FONT_FAMILY,n.style.cursor="default",n.style.outline="none",n.style.textAlign="left",n.style.msTouchAction="none",n.style.touchAction="none",n.tabIndex=0,t||(n.onmousedown=b.preventDefault),n.style.setProperty&&(n.style.setProperty("-khtml-user-select","none",null),n.style.setProperty("-webkit-user-select","none",null),n.style.setProperty("-moz-user-select","none",null),n.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),e&&(n.style.overflow=e),n},createDiv:function(){var e=l.createElement("div");return e.style.position="absolute",e.style.msTouchAction="none",e.style.touchAction="none",e},createCanvas:function(e,t){e=e||0,t=t||0;if(a){var n=require("canvas");return new n(e,t)}var r=l.createElement("canvas");return r.style.position="absolute",r.style.msTouchAction="none",r.style.touchAction="none",r.width=e,r.height=t,r},setCanvas:function(e,t,n,r,i){arguments.length===2&&(n=t.y,r=t.width,i=t.height,t=t.x),e.style.left=t+"px",e.style.top=n+"px",e.setAttribute("width",r),e.setAttribute("height",i),e._viewRect={x:t,y:n,width:r,height:i};var s=e.getContext("2d");return s.shadowBlur!==0&&(s.shadowOffsetX=0,s.shadowOffsetY=0,s.shadowBlur=0,s.shadowColor="rgba(0,0,0,0.0)"),s.clearRect(0,0,r,i),s.translate(-t,-n),s},setImg:function(e,t,n){e.setAttribute("src",t),e.style.left=n.x+"px",e.style.top=n.y+"px",e.style.width=n.width+"px",e.style.height=n.height+"px",e._viewRect=r.clone(n)},setDiv:function(e,t,n,i,s){i=r.num(i)?i:0,e.style.left=t.x-i+"px",e.style.top=t.y-i+"px",e.style.width=t.width+"px",e.style.height=t.height+"px",e._viewRect=r.clone(t),n?e.style.backgroundColor=n:e.style.backgroundColor="",i>0?e.style.border=i+"px "+s+" solid":e.style.border=""},changeTypeForMS:function(t){var n=t;if(t.indexOf("MSPointer")===0||t.indexOf("pointer")===0){var r;t.indexOf("MSPointer")===0?(r=t.substring(9,10).toLowerCase(),r+=t.substring(10)):r=t.substring(7,8),e.MSPointerEvent?n="MSPointer"+r.substring(0,1).toUpperCase()+r.substring(1):e.PointerEvent&&(n="pointer"+r)}return n},addEventListener:function(e,t,n,r){e=this.changeTypeForMS(e);var i="_"+e+"_";if(r[i])return;var s=function(e){s.instance[s.method](e)};s.method=t,s.instance=r,r[i]=s,n.addEventListener(e,s,!1)},removeEventListener:function(e,t,n){e=this.changeTypeForMS(e);var r="_"+e+"_",i=n[r];i&&(t.removeEventListener(e,i,!1),delete n[r])},isValidEvent:function(e,t){if(!t)return!1;if(t.target===e)if(h.isFirefox){if(e.clientHeight<e.scrollHeight&&t.layerX<25)return!1;if(e.clientWidth<e.scrollWidth&&t.layerY<25)return!1}else if(t.offsetX>e.clientWidth||t.offsetY>e.clientHeight)return!1;return!0},getLogicalPoint:function(e,t,n,r){n=n?n:1;var i,s=e.getBoundingClientRect();if(h.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var o=t.changedTouches[0],u=h.isAndroid?0:kr.scrollLeft(),a=h.isAndroid?0:kr.scrollTop();i={x:(o.clientX+e.scrollLeft-s.left-u)/n,y:(o.clientY+e.scrollTop-s.top-a)/n}}else{if(!b.isValidEvent(e,t))return null;i={x:(t.clientX-s.left+e.scrollLeft)/n,y:(t.clientY-s.top+e.scrollTop)/n}}return i},handle_mousedown:function(t,n){b.target&&b.handle_mouseup(n),e.addEventListener("mousemove",b.handle_mousemove,!1),e.addEventListener("mouseup",b.handle_mouseup,!1),b.target=t},handle_mousemove:function(e){b.target.handle_mousemove&&b.target.handle_mousemove(e),b.target.handleMouseMove&&b.target.handleMouseMove(e)},handle_mouseup:function(t){b.target.handle_mouseup&&b.target.handle_mouseup(t),b.target.handleMouseUp&&b.target.handleMouseUp(t),e.removeEventListener("mousemove",b.handle_mousemove,!1),e.removeEventListener("mouseup",b.handle_mouseup,!1),delete b.target},getClientPoint:function(e){return{x:e.clientX,y:e.clientY}},windowWidth:function(){return typeof e.innerWidth=="number"?e.innerWidth:l.documentElement&&l.documentElement.clientWidth?l.documentElement.clientWidth:l.body&&l.body.clientWidth?l.body.clientWidth:0},windowHeight:function(){return typeof e.innerHeight=="number"?e.innerHeight:l.documentElement&&l.documentElement.clientHeight?l.documentElement.clientHeight:l.body&&l.body.clientHeight?l.body.clientHeight:0}};r.html=b;var w={cache:{},g:b.createCanvas().getContext("2d"),getTextSize:function(e,t){w.g.font=e?e:$i.FONT;var n=w.cache[w.g.font];n||(n=w.g.measureText("e").width*2+4,w.cache[w.g.font]=n),t=t||"",t=String(t);var r=t.split("\n"),i=r.length,s=0,o;for(var u=i-1;u>=0;u--)o=w.g.measureText(r[u]).width,o>s&&(s=o);return{width:s+4,height:n*i}},getSubStringInLength:function(e,t,n){var r=this,i=function(e,t,n,s,o){if(e>=t)return s.substring(0,e+1);var u=Math.floor((e+t)/2),a=s.substring(0,u+1),f=r.getTextSize(n,a).width;if(f>o)return i(e,u-1,n,s,o);var l=u+1,c=s.substring(0,l+1),h=r.getTextSize(n,c).width;return h>o?a:i(l,t,n,s,o)},s=this.getTextSize(e,t).width;return s>n?i(0,t.length-1,e,t,n):t},getCollapseTextInLength:function(e,t,n){var r=this.getTextSize(e,t).width;if(r>n){var i=0,s="",o=t,u=r;while(u>n){var a=this.getSubStringInLength(e,o,n);s=s+a+"\n",i+=a.length,o=t.substring(i),u=this.getTextSize(e,o).width}return s+o}return t},drawText:function(e,n,r,i,s,o){n=n||"",n=String(n),i||(i=$i.FONT);var u="center";o&&(u=o),e.font=i,e.fillStyle=s,e.textAlign=u,e.textBaseline="middle";var a=n.split("\n"),f=a.length,l=0,c,p;r?r.width===t?(c=r.x,p=r.y):(l=r.height/f,u=="left"?c=r.x:u=="center"&&(c=r.x+r.width/2),p=r.y+l/2):(c=0,p=0),h.isOpera&&(p-=2);for(var d=0;d<f;d++)u=="right"&&(e.textAlign="left",c=r.x+r.width-w.getTextSize(i,a[d]).width),e.fillText(a[d],c,p),p+=l},drawArc:function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y;Math.abs(i)>2*Math.PI&&(i=2*Math.PI),h=Math.ceil(Math.abs(i)/(Math.PI/4)),a=i/h,f=-a,l=-r;if(h>0){p=t+Math.cos(r)*s,d=n+Math.sin(-r)*o,u?e.lineTo(p,d):e.moveTo(p,d);for(var b=0;b<h;b++)l+=f,c=l-f/2,v=t+Math.cos(l)*s,m=n+Math.sin(l)*o,g=t+Math.cos(c)*(s/Math.cos(f/2)),y=n+Math.sin(c)*(o/Math.cos(f/2)),e.quadraticCurveTo(g,y,v,m)}},dashedLine:function(e,t,n,r,i,s,o){var u=s-r,a=o-i,f=Math.sqrt(u*u+a*a);if(f==0)return;u/=f,a/=f;var l=f,c=-n.offset,h=n.drawing,p=n.patternIndex;while(c<l)c+=t[p],c>=l&&(n.offset=t[p]-(c-l),n.patternIndex=p,n.drawing=h,c=l),h?e.lineTo(r+c*u,i+c*a):e.moveTo(r+c*u,i+c*a),h=!h,p=(p+1)%t.length},drawLinePoints:function(e,t,n,r,i){var s=0,o,u,a,f,l,c=0,h,p=t.size();n&&n.length>0?h=new Sr(e,n[0],n.length>1?n[1]:n[0]):h=e;if(r)for(c=0,l=r.size();c<l;c++){o=r.get(c);if("moveto"===o&&s<p)u=t.get(s++),h.moveTo(u.x,u.y);else if("lineto"===o&&s<p)u=t.get(s++),h.lineTo(u.x,u.y);else if("cubicto"===o&&s<p-2)u=t.get(s++),a=t.get(s++),f=t.get(s++),h.bezierCurveTo(u.x,u.y,a.x,a.y,f.x,f.y);else{if(!("quadto"===o&&s<p-1))throw"Can not resolve segment '"+o+"'";u=t.get(s++),a=t.get(s++),h.quadraticCurveTo(u.x,u.y,a.x,a.y)}}else this._drawLine(t,h);i&&h.closePath()},_drawLine:function(e,t){var n=0,r,i,s,o,u,a=e.size();r=e.get(0),t.moveTo(r.x,r.y);for(n=1;n<a;n++)u=e.get(n),u.size?(o=u.size(),o===2?(r=u.get(0),i=u.get(1),t.quadraticCurveTo(r.x,r.y,i.x,i.y)):o===3&&(r=u.get(0),i=u.get(1),s=u.get(2),t.bezierCurveTo(r.x,r.y,i.x,i.y,s.x,s.y))):t.lineTo(u.x,u.y)},drawRoundRect:function(e,t,n,r,i,s,o,u,a){arguments.length===6&&(o=s,u=s,a=s);var f=t+r,l=n+i,c=r<i?r*2:i*2;s=s<c?s:c,o=o<c?o:c,u=u<c?u:c,a=a<c?a:c;var h=a*.292893218813453,p=a*.585786437626905;e.moveTo(f,l-a),e.quadraticCurveTo(f,l-p,f-h,l-h),e.quadraticCurveTo(f-p,l,f-a,l),h=u*.292893218813453,p=u*.585786437626905,e.lineTo(t+u,l),e.quadraticCurveTo(t+p,l,t+h,l-h),e.quadraticCurveTo(t,l-p,t,l-u),h=s*.292893218813453,p=s*.585786437626905,e.lineTo(t,n+s),e.quadraticCurveTo(t,n+p,t+h,n+h),e.quadraticCurveTo(t+p,n,t+s,n),h=o*.292893218813453,p=o*.585786437626905,e.lineTo(f-o,n),e.quadraticCurveTo(f-p,n,f-h,n+h),e.quadraticCurveTo(f,n+p,f,n+o),e.lineTo(f,l-a)},drawVector:function(e,t,n,r,i,s,o){var u;arguments.length===4?(i=r.y,s=r.width,o=r.height,r=r.x):arguments.length===5&&t==="roundrect"&&(u={},u.topLeft=i,u.topRight=i,u.bottomLeft=i,u.bottomRight=i,i=r.y,s=r.width,o=r.height,r=r.x);var a=w["_"+t];a&&(e.beginPath(),n&&n.length>0&&(e=new Sr(e,n[0],n.length>1?n[1]:n[0])),arguments.length===5&&t==="roundrect"?a(e,{x:r,y:i,width:s,height:o},u):a(e,r,i,s,o))},_rectangle:function(e,t,n,r,i){e.rect(t,n,r,i)},_circle:function(e,t,n,r,i){var s=t+r/2,o=n+i/2,u=Math.min(r,i)/2;e instanceof Sr?w.drawArc(e,s,o,0,Math.PI*2,u,u,!1):e.arc(s,o,u,0,Math.PI*2,!0)},_oval:function(e,t,n,r,i){if(e instanceof Sr)w.drawArc(e,t+r/2,n+i/2,0,Math.PI*2,r/2,i/2,!1);else{var s=.5522848,o=r/2*s,u=i/2*s,a=t+r,f=n+i,l=t+r/2,c=n+i/2;e.moveTo(t,c),e.bezierCurveTo(t,c-u,l-o,n,l,n),e.bezierCurveTo(l+o,n,a,c-u,a,c),e.bezierCurveTo(a,c+u,l+o,f,l,f),e.bezierCurveTo(l-o,f,t,c+u,t,c)}},_roundrect:function(e,t,n,r,i){if(arguments.length===3){var s=n;n=t.y,r=t.width,i=t.height,t=t.x,s.topLeft?w.drawRoundRect(e,t,n,r,i,s.topLeft):w.drawRoundRect(e,t,n,r,i,Math.min(Math.min(r,i)/4,10))}else w.drawRoundRect(e,t,n,r,i,Math.min(Math.min(r,i)/4,10))},_star:function(e,t,n,r,i){var s=r*2,o=i*2,u=t+r/2,a=n+i/2;e.moveTo(u-s/4,a-o/12),e.lineTo(t+r*.306,n+i*.579),e.lineTo(u-s/6,a+o/4),e.lineTo(t+r/2,n+i*.733),e.lineTo(u+s/6,a+o/4),e.lineTo(t+r*.693,n+i*.579),e.lineTo(u+s/4,a-o/12),e.lineTo(t+r*.611,n+i*.332),e.lineTo(u+0,a-o/4),e.lineTo(t+r*.388,n+i*.332),e.closePath()},_triangle:function(e,t,n,r,i){e.moveTo(t+r/2,n),e.lineTo(t+r,n+i),e.lineTo(t,n+i),e.closePath()},_hexagon:function(e,t,n,r,i){e.moveTo(t,n+i/2),e.lineTo(t+r/4,n+i),e.lineTo(t+r*3/4,+n+i),e.lineTo(t+r,n+i/2),e.lineTo(t+r*3/4,n),e.lineTo(t+r/4,n),e.closePath()},_pentagon:function(e,t,n,r,i){var s=r*2,o=i*2,u=t+r/2,a=n+i/2;e.moveTo(u-s/4,a-o/12),e.lineTo(u-s/6,a+o/4),e.lineTo(u+s/6,a+o/4),e.lineTo(u+s/4,a-o/12),e.lineTo(u+0,a-o/4),e.closePath()},_trapezoidal:function(e,t,n,r,i){e.moveTo(t+r/4,n),e.lineTo(t,n+i),e.lineTo(t+r,n+i),e.lineTo(t+r*3/4,n),e.closePath()},_diamond:function(e,t,n,r,i){e.moveTo(t+r/2,n),e.lineTo(t,n+i/2),e.lineTo(t+r/2,n+i),e.lineTo(t+r,n+i/2),e.closePath()},fill:function(e,t,n,r,i,s,o,u){var a=E[n];a?arguments.length===5?e.fillStyle=a(e,t,r,i.x,i.y,i.width,i.height):e.fillStyle=a(e,t,r,i,s,o,u):e.fillStyle=t},createRadialGradient:function(e,t,n,r,i,s,o,u,a){var f=e.createRadialGradient(r+s*u,i+o*a,Math.min(s,o)/24,r+s/2,i+o/2,Math.max(s,o)/2);return f.addColorStop(0,n),f.addColorStop(1,t),f},drawPath:function(e,t,i,s,o,u,a,f){var l=e._element,c=e.getBodyRect();s&&m.addPadding(c,l,i+".padding",1);var h=r.clone(c),p=l.getStyle(i+".outline.width");p>0&&m.grow(h,p/2,p/2);var d=e.setShadow(e,t,h);l.getAngle()!=0&&(l instanceof ns||(c=l.getOriginalRect()),n.Util.rotateCanvas(d,c,l.getAngle()));var v=l.getStyle(i+".fill"),g;if(v){e._innerColor&&!xr.hasDefault(e._element)?g=e._innerColor:g=l.getStyle(i+".fill.color");var y=l.getStyle(i+".gradient");y?w.fill(d,g,y,l.getStyle(i+".gradient.color"),c):d.fillStyle=g}var b=l.getStyle(i+".shape"),E=l.getStyle("group.shape.roundrect.radius");return v&&(d.beginPath(),u?w.drawLinePoints(d,u,null,a,f):b==="roundrect"&&i==="group"?w.drawVector(d,b,null,c,E):w.drawVector(d,b,null,c),d.fill()),p>0&&(d.lineWidth=p,d.lineCap=l.getStyle(i+".cap"),d.lineJoin=l.getStyle(i+".join"),d.strokeStyle=l.getStyle(i+".outline.color"),d.beginPath(),u?w.drawLinePoints(d,u,o,a,f):b==="roundrect"&&i==="group"?w.drawVector(d,b,o,c,E):w.drawVector(d,b,o,c),d.stroke()),h},draw3DRect:function(e,t,n,r,i,s,o){if(n===0)return;arguments.length<=4&&(o=r.height,s=r.width,i=r.y,r=r.x);var u=n>0;n=Math.abs(n);var a,f;e.lineWidth=1,e.lineCap="square";if(n===1)a=w.brighter(t),f=w.darker(t),e.strokeStyle=u?a:f,e.beginPath(),e.moveTo(r,i),e.lineTo(r,i+o),e.moveTo(r,i),e.lineTo(r+s,i),e.closePath(),e.stroke(),e.strokeStyle=u?f:a,e.beginPath(),e.moveTo(r,i+o),e.lineTo(r+s,i+o),e.moveTo(r+s,i),e.lineTo(r+s,i+o),e.closePath(),e.stroke();else{var l=n*2,c=50/l;for(var h=0;h<l;h++)a=w.brighter(t,50-h*c),f=w.darker(t,50-h*c),r+=.5,i+=.5,s-=1,o-=1,e.strokeStyle=u?a:f,e.beginPath(),e.moveTo(r,i),e.lineTo(r,i+o),e.moveTo(r,i),e.lineTo(r+s,i),e.closePath(),e.stroke(),e.strokeStyle=u?f:a,e.beginPath(),e.moveTo(r,i+o),e.lineTo(r+s,i+o),e.moveTo(r+s,i),e.lineTo(r+s,i+o),e.closePath(),e.stroke()}},brighter:function(e,t){return t||(t=50),w.adjustBrightness2(e,t)},darker:function(e,t){return t||(t=50),w.adjustBrightness2(e,-t)},adjustBrightness2:function(e,t){var n,r,i;if(t===0)return e;var s=Hi(e);return t<0?(t=(100+t)/100,n=Math.ceil(s.r*t),r=Math.ceil(s.g*t),i=Math.ceil(s.b*t)):(t/=100,n=s.r,r=s.g,i=s.b,n+=(255-n)*t,r+=(255-r)*t,i+=(255-i)*t,n=Math.min(Math.ceil(n),255),r=Math.min(Math.ceil(r),255),i=Math.min(Math.ceil(i),255)),"rgba("+n+","+r+","+i+",1)"},getColorArray:function(e){return Pi.clearRect(0,0,1,1),Pi.fillStyle=e,Pi.fillRect(0,0,1,1),Pi.getImageData(0,0,1,1).data},hit:function(e,t,n,r){if(!e)return!1;var i=e._viewRect;if(!i)return!1;t-=i.x,n-=i.y;if(t<0||n<0||t>=i.width||n>=i.height)return!1;try{var s=e.getContext("2d").getImageData(t,n,1,1),o=s.data;for(var u=0,a=o.length;u<a;u+=4)if(o[u+3]!==0)return!0}catch(f){return!0}return!1},intersects:function(e,t){
if(!e)return!1;t=m.intersection(t,e._viewRect);if(!t)return!1;t.x-=e._viewRect.x,t.y-=e._viewRect.y;try{var n=e.getContext("2d").getImageData(t.x,t.y,t.width,t.height),r=n.data;for(var i=0,s=r.length;i<s;i+=4)if(r[i+3]!==0)return!0}catch(o){}return!1},strokeRect:function(e,t,r,i){if(!t)return;e.beginPath(),e.strokeStyle=r?r:n.Util.randomColor(),e.lineWidth=i?i:2,e.strokeRect(t.x,t.y,t.width,t.height),e.stroke()}};r.g=w;var E={"linear.southwest":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r,i+o,r+s,i);return u.addColorStop(0,n),u.addColorStop(1,t),u},"linear.southeast":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r+s,i+o,r,i);return u.addColorStop(0,n),u.addColorStop(1,t),u},"linear.northwest":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r+s,i+o,r,i);return u.addColorStop(0,t),u.addColorStop(1,n),u},"linear.northeast":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r+s,i,r,i+o);return u.addColorStop(0,n),u.addColorStop(1,t),u},"linear.north":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r,i,r,i+o);return u.addColorStop(0,n),u.addColorStop(1,t),u},"linear.south":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r,i,r,i+o);return u.addColorStop(0,t),u.addColorStop(1,n),u},"linear.west":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r,i,r+s,i);return u.addColorStop(0,n),u.addColorStop(1,t),u},"linear.east":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r,i,r+s,i);return u.addColorStop(0,t),u.addColorStop(1,n),u},"radial.center":function(e,t,n,r,i,s,o){return w.createRadialGradient(e,t,n,r,i,s,o,.5,.5)},"radial.southwest":function(e,t,n,r,i,s,o){return w.createRadialGradient(e,t,n,r,i,s,o,.25,.75)},"radial.southeast":function(e,t,n,r,i,s,o){return w.createRadialGradient(e,t,n,r,i,s,o,.75,.75)},"radial.northwest":function(e,t,n,r,i,s,o){return w.createRadialGradient(e,t,n,r,i,s,o,.25,.25)},"radial.northeast":function(e,t,n,r,i,s,o){return w.createRadialGradient(e,t,n,r,i,s,o,.75,.25)},"radial.north":function(e,t,n,r,i,s,o){return w.createRadialGradient(e,t,n,r,i,s,o,.5,.25)},"radial.south":function(e,t,n,r,i,s,o){return w.createRadialGradient(e,t,n,r,i,s,o,.5,.75)},"radial.west":function(e,t,n,r,i,s,o){return w.createRadialGradient(e,t,n,r,i,s,o,.25,.5)},"radial.east":function(e,t,n,r,i,s,o){return w.createRadialGradient(e,t,n,r,i,s,o,.75,.5)},"spread.horizontal":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r,i,r+s,i);return u.addColorStop(0,t),u.addColorStop(.5,n),u.addColorStop(1,t),u},"spread.vertical":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r,i,r,i+o);return u.addColorStop(0,t),u.addColorStop(.5,n),u.addColorStop(1,t),u},"spread.diagonal":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r+s,i,r,i+o);return u.addColorStop(0,t),u.addColorStop(.5,n),u.addColorStop(1,t),u},"spread.antidiagonal":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r,i,r+s,i+o);return u.addColorStop(0,t),u.addColorStop(.5,n),u.addColorStop(1,t),u},"spread.north":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r,i-o/4,r,i+o+o/4);return u.addColorStop(0,t),u.addColorStop(1/3,n),u.addColorStop(2/3,t),u.addColorStop(1,n),u},"spread.south":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r,i-o/4,r,i+o+o/4);return u.addColorStop(0,n),u.addColorStop(1/3,t),u.addColorStop(2/3,n),u.addColorStop(1,t),u},"spread.west":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r-s/4,i,r+s+s/4,i);return u.addColorStop(0,t),u.addColorStop(1/3,n),u.addColorStop(2/3,t),u.addColorStop(1,n),u},"spread.east":function(e,t,n,r,i,s,o){var u=e.createLinearGradient(r-s/4,i,r+s+s/4,i);return u.addColorStop(0,n),u.addColorStop(1/3,t),u.addColorStop(2/3,n),u.addColorStop(1,t),u}};n.Util={getVersion:function(){return"5.6.8"},registerImage:function(e,t,n,i,s){r.registerImage(e,t,n,i,s)},registerImageByUrl:function(e,t,r,i){if(t&&e&&e.indexOf(".json")>0){var s,o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState===4&&o.status===200){var e=JSON.parse(o.responseText);n.Util.registerImage(t,e),r&&r.invalidateElementUIs(),i&&i()}},o.open("GET",e,!0),o.send()}else{var u=new c;u.src=e,u.onload=function(){n.Util.registerImage(t,u,u.width,u.height),u.onload=null,r&&r.invalidateElementUIs(),i&&i()}}},getRegisteredImageNames:function(){return r.getRegisteredImageNames()},unregisterImage:function(e){r.unregisterImage(e)},getImageAsset:function(e){return r.getImageAsset(e)},validateLicense:function(e){r.validateLicense(e)},getLicense:function(){return o},isPermissionGIS:function(){return Er()},moveElements:function(e,t,r,i,s,o){if(t===0&&r===0)return;if(!e||e.isEmpty())return;var u=n.animate.AnimateManager,a,f;u.endAnimate(),e=xr.filterMovingElements(e),i&&(a=new Oi,f=new Oi),e.forEach(function(e){e instanceof es&&(i?(a.add(e),f.add({x:e.getX()+t,y:e.getY()+r})):e.translate(t,r))}),i?u.start(new n.animate.AnimateLocation(a,f,s)):s&&s()},isTypeOf:function(e,t){if(e===t)return!0;var n=e.superClass;while(n){if(n===t.prototype)return!0;n=n.constructor.superClass}return!1},setFocus:function(e){if(l.activeElement===e)return;var t,n,r=l.documentElement,i=l.body,s;r&&(h.isIE||h.isOpera||r.scrollLeft||r.scrollTop)?(t=r.scrollLeft,n=r.scrollTop,s=r):i&&(t=i.scrollLeft,n=i.scrollTop,s=i),e.focus(),s&&(s.scrollLeft=t,s.scrollTop=n)},isOpera:h.isOpera,isIE:h.isIE,isFirefox:h.isFirefox,isChrome:h.isChrome,isSafari:h.isSafari,isIPhone:h.isIPhone,isIPod:h.isIPod,isIPad:h.isIPad,isAndroid:h.isAndroid,isWebOS:h.isWebOS,isTouchable:h.isTouchable,ext:function(e,t,n){r.ext(e,t,n)},getValue:function(e,t,n){return r.getValue(e,t,n)},setValue:function(e,t,n){r.setValue(e,t,n)},grow:function(e,t,n){m.grow(e,t,n)},containsPoint:function(e,t,n){return m.containsPoint.apply(null,arguments)},intersects:function(e,t){return m.intersects(e,t)},getRect:function(e){return m.getRect(e)},unionRect:function(e,t){return m.unionRect(e,t)},createDiv:function(){return b.createDiv()},createCanvas:function(){return b.createCanvas()},setCanvas:function(e,t,n,r,i){return b.setCanvas.apply(null,arguments)},drawVector:function(e,t,n,r,i,s,o){w.drawVector.apply(null,arguments)},fill:function(e,t,n,r,i,s,o,u){w.fill.apply(null,arguments)},getClass:function(e){return r.getClass(e)},getAllClassNames:function(){var e=[],t;for(t in r.classCache)e.push(t);return e},newInstance:function(e){return r.newInstance.apply(null,arguments)},isDeserializing:function(){return r.isDeserializing},addEventListener:function(e,t,n,r){b.addEventListener(e,t,n,r)},removeEventListener:function(e,t,n){b.removeEventListener(e,t,n)},drawArrow:function(e,t,n,r,i,s,o,u,a,f,l,c,h){Mi.drawArrow.apply(null,arguments)},calculatePointAngleAlongLine:function(e,t,n,r,i){return m.calculatePointInfoAlongLineBySegments(e,t,n,r,i)},getSubNetwork:function(e){return xr.getSubNetwork(e)},transformPoint:function(e,t,n,r){return m.transformPoint(e,t,n,r)},getToolTipDiv:function(){return Ar.getToolTipDiv()},showToolTip:function(e,t){Ar.showToolTip(e,t)},hideToolTip:function(){Ar.hideToolTip()},resetToolTip:function(){Ar.resetToolTip()},setCSSStyle:function(e,t,n){b.setCSSStyle(e,t,n)},removeCSSStyle:function(e,t){b.removeCSSStyle(e,t)},getCSSStyle:function(e,t){return b.getCSSStyle(e,t)},toDegrees:function(e){return m.toDegrees(e)},toRadians:function(e){return m.toDegrees(e)},getRadiansBetweenLines:function(e,t){return m.getRadiansBetweenLines(e,t)},getElementsBounds:function(e,t){var r=null;return e.forEach(function(e){if(e.getRect){var i,s;t&&(s=t.getElementUI(e),s&&(i=s.getViewRect())),i||(i=e.getRect()),r?r=n.Util.unionRect(r,i):r=i}}),r},getPointIndex:function(e,t,n){n||(n=10);if(e)for(var r=e.size();r--;r>=0)if(m.getDistance(e.get(r),t)<=n)return r;return-1},registerVectorShape:function(e,t){r.g["_"+e]=t},rotateCanvas:function(e,t,n){e.translate(t.x+t.width/2,t.y+t.height/2),e.rotate(n*Math.PI/180),e.translate(-(t.x+t.width/2),-(t.y+t.height/2))},registerShape:function(e,t){li(e,t)},registerDraw:function(e,t){ai(e,t)},getFilterColor:function(e,t){return Bi(e,t)},registerGifImage:function(e,t){},parseVectorData:function(e){return _r(e)},getSharedLinks:function(e,t){var n=e.getLinks(),r=t.getLinks();if(n&&n.size()!=0&&r&&r.size()!=0){var i=n.size()>r.size()?n:r;return i.toList(function(n){return n.getFromNode()==e&&n.getToNode()==t||n.getFromNode()==t&&n.getToNode()==e})}return null},isSharedLinks:function(e,t){var n=!1,r=e.getLinks(),i=t.getLinks();if(r&&r.size()!=0&&i&&i.size()!=0){var s=r.size()>i.size()?r:i;s.forEach(function(r){return r.getFromNode()==e&&r.getToNode()==t||r.getFromNode()==t&&r.getToNode()==e?(n=!0,!1):!0})}return n},playAnimate:function(e){return di(e)},pauseAnimate:function(e){e.pause()},resumeAnimate:function(e){e.resume()},stopAnimate:function(e,t){vi(e,t)},pauseAllAnimates:function(){gi()},resumeAllAnimates:function(){yi()},stopAllAnimates:function(e){mi(e)},randomColor:function(){return"#"+("00000"+(this.random()*16777216<<0).toString(16)).substr(-6)},random:function(){return Math.random()},getHSVColor:function(e,n,r){var i,s,o,u,a,f,l,c;e&&n===t&&r===t&&(n=e.s,r=e.v,e=e.h),u=Math.floor(e*6),a=e*6-u,f=r*(1-n),l=r*(1-a*n),c=r*(1-(1-a)*n);switch(u%6){case 0:i=r,s=c,o=f;break;case 1:i=l,s=r,o=f;break;case 2:i=f,s=r,o=c;break;case 3:i=f,s=l,o=r;break;case 4:i=c,s=f,o=r;break;case 5:i=r,s=f,o=l}var h="#"+toHex(i*255)+toHex(s*255)+toHex(o*255);return h},toHex:function(e){var t=parseInt(e).toString(16);return t.length==1&&(t="0"+t),t},makeHighRes:function(t){var n=t.getContext("2d"),r=e.devicePixelRatio||1,i=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1,s=r/i;if(r!==i){var o=t.width,u=t.height;t.width=Math.round(o*s),t.height=Math.round(u*s),t.style.width=o+"px",t.style.height=u+"px",n.scale(s,s)}},newFunction:function(){var e=arguments,t=e.length;return t===1?r.newInstance("Function",e[0]):t===2?r.newInstance("Function",e[0],e[1]):t===3?r.newInstance("Function",e[0],e[1],e[2]):t===4?r.newInstance("Function",e[0],e[1],e[2],e[3]):t===5?r.newInstance("Function",e[0],e[1],e[2],e[3],e[4]):t===6?r.newInstance("Function",e[0],e[1],e[2],e[3],e[4],e[5]):t===7?r.newInstance("Function",e[0],e[1],e[2],e[3],e[4],e[5],e[6]):t===8?r.newInstance("Function",e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):null}},r.ext("twaver.Util",Object,{});var S,x=0xdeadbeefcafe,T=(x&16777215)==15715070;T&&f.appName=="Microsoft Internet Explorer"?(N.prototype.am=L,S=30):T&&f.appName!="Netscape"?(N.prototype.am=k,S=26):(N.prototype.am=A,S=28),N.prototype.DB=S,N.prototype.DM=(1<<S)-1,N.prototype.DV=1<<S;var O=52;N.prototype.FV=Math.pow(2,O),N.prototype.F1=O-S,N.prototype.F2=2*S-O;var M="0123456789abcdefghijklmnopqrstuvwxyz",_=new Array,D,P;D="0".charCodeAt(0);for(P=0;P<=9;++P)_[D++]=P;D="a".charCodeAt(0);for(P=10;P<36;++P)_[D++]=P;D="A".charCodeAt(0);for(P=10;P<36;++P)_[D++]=P;rt.prototype.convert=it,rt.prototype.revert=st,rt.prototype.reduce=ot,rt.prototype.mulTo=ut,rt.prototype.sqrTo=at,lt.prototype.convert=ct,lt.prototype.revert=ht,lt.prototype.reduce=pt,lt.prototype.mulTo=vt,lt.prototype.sqrTo=dt,N.prototype.copyTo=j,N.prototype.fromInt=F,N.prototype.fromString=q,N.prototype.clamp=R,N.prototype.dlShiftTo=J,N.prototype.drShiftTo=K,N.prototype.lShiftTo=Q,N.prototype.rShiftTo=G,N.prototype.subTo=Y,N.prototype.multiplyTo=Z,N.prototype.squareTo=et,N.prototype.divRemTo=tt,N.prototype.invDigit=ft,N.prototype.isEven=mt,N.prototype.exp=gt,N.prototype.toString=U,N.prototype.negate=z,N.prototype.abs=W,N.prototype.compareTo=X,N.prototype.bitLength=$,N.prototype.mod=nt,N.prototype.modPowInt=yt,N.ZERO=I(0),N.ONE=I(1),ln.prototype.convert=cn,ln.prototype.revert=cn,ln.prototype.mulTo=hn,ln.prototype.sqrTo=pn,gn.prototype.convert=yn,gn.prototype.revert=bn,gn.prototype.reduce=wn,gn.prototype.mulTo=Sn,gn.prototype.sqrTo=En;var kn=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Ln=(1<<26)/kn[kn.length-1];N.prototype.chunkSize=xt,N.prototype.toRadix=Nt,N.prototype.fromRadix=Ct,N.prototype.fromNumber=kt,N.prototype.bitwiseTo=_t,N.prototype.changeBit=Kt,N.prototype.addTo=Zt,N.prototype.dMultiply=an,N.prototype.dAddOffset=fn,N.prototype.multiplyLowerTo=vn,N.prototype.multiplyUpperTo=mn,N.prototype.modInt=Nn,N.prototype.millerRabin=On,N.prototype.clone=bt,N.prototype.intValue=wt,N.prototype.byteValue=Et,N.prototype.shortValue=St,N.prototype.signum=Tt,N.prototype.toByteArray=Lt,N.prototype.equals=At,N.prototype.min=Ot,N.prototype.max=Mt,N.prototype.and=Pt,N.prototype.or=Bt,N.prototype.xor=Ft,N.prototype.andNot=qt,N.prototype.not=Rt,N.prototype.shiftLeft=Ut,N.prototype.shiftRight=zt,N.prototype.getLowestSetBit=Xt,N.prototype.bitCount=$t,N.prototype.testBit=Jt,N.prototype.setBit=Qt,N.prototype.clearBit=Gt,N.prototype.flipBit=Yt,N.prototype.add=en,N.prototype.subtract=tn,N.prototype.multiply=nn,N.prototype.divide=sn,N.prototype.remainder=on,N.prototype.divideAndRemainder=un,N.prototype.modPow=xn,N.prototype.modInverse=Cn,N.prototype.pow=dn,N.prototype.gcd=Tn,N.prototype.isProbablePrime=An,N.prototype.square=rn,Mn.prototype.init=_n,Mn.prototype.next=Dn;var Hn=256,Bn,jn,Fn;if(jn==null){jn=new Array,Fn=0;var Rn;if(f.appName=="Netscape"&&f.appVersion<"5"&&e.crypto){var Un=e.crypto.random(32);for(Rn=0;Rn<Un.length;++Rn)jn[Fn++]=Un.charCodeAt(Rn)&255}while(Fn<Hn)Rn=Math.floor(65536*n.Util.random()),jn[Fn++]=Rn>>>8,jn[Fn++]=Rn&255;Fn=0,qn()}Xn.prototype.nextBytes=Wn;var Vn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$n="=";er.prototype.doPublic=nr,er.prototype.setPublic=tr,er.prototype.encrypt=rr,er.prototype.doPrivate=ur,er.prototype.setPrivate=sr,er.prototype.setPrivateEx=or,er.prototype.decrypt=ar;var fr=function(){lr.v(o)},lr={},cr="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",hr="10001",s="61a921483dfa8f24e26204ace4d990b965d11e5bef5d8a5e768ebc5853a6bdd94b02369a3165207460fb91001d3fd83fbe69c6e51b8e40c8ae8a4e30a7c539dca98b44858bdc0b76f25af6803d4d13dacd9fa1a28f66cf561fa36309d4239a2cf50fe20ef0e99e01fc8701090f0685a524f411e00ca91f877d3b49d2d0052f9",pr="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047",dr="9360ab3d6b678727748ea004e85120f1823ec94e6116dc5fcd7b1c9ea231d38e5d7d2d23c00607912e1645835756b71290c6c3cc2bc656e93d9a4f6b0d55619f",vr="3e61c2259d15b26693c8bac2eac4e0a44e1c6aa0adae2af2578aea54e796293a5fee9759293c98aab65b5d27063e43fe514e9f6b68fd581f54ab52f868bc6ad5",mr="4dac2913d9c35a6be4f63647dfd8c23006a0e89fb273c5f987e656931490861b0612aef3a48489006ef5b5f51ed6c8edb3f7cdc191609af59a4df5854a25b1a9",gr="acd9837a1472711ff2b63ba0de667fa4a4a56a8b0f4cbb0a555f73d1bc529e9ecf865b709fd8235c3db05bcf1539de1e594d3a8275fe0784a9f5241d8895b328";lr.cross=function(e){if(e){var t="";for(var n=0;n<e.length;)n+1<e.length?(t+=e[n+1],t+=e[n]):t+=e[n],n+=2;return t}return null},lr.reverse=function(e){if(e){var t="";for(var n=e.length;n>0;n--)t+=e[n-1];return t}return null},lr.v=function(e){if(e){var t=lr;t.start=null,t.beginDate=null,t.end=null,t.endDate=null,t.gis=null,t["3D"]=null,t["3d"]=null,t.l=null,t.__li__=null;if(e.indexOf("signature=")>0){var n=e.split("signature="),r=n[0],i=n[1],s=new er;s.setPublic(cr,hr);var o=i,u=o.length,a=256,f=0,l="",c="";while(f<u)l=o.substr(f,a),c+=s.decrypt(l),f+=a;if(c===r)return t.i(e),!0}}return!1},lr.i=function(e){var n=lr;n.__li__=e;var r=e.split("\n"),i,s,o,u,a;for(i=r.length-1;i>=0;i--)s=r[i],a=s.split("="),o=a[0],u=a[1],n[o]=u;n.start!=t&&(n.beginDate=new Date(Date.parse(n.start.replace(/-/g,"/")))),n.end!=t&&(n.endDate=new Date(Date.parse(n.end.replace(/-/g,"/"))));var f=n.gis;f!=t&&(f=parseInt(f)),f&&(n._isPermissionGIS=!0);var l=n["3D"]||n["3d"];l!=t&&(l=parseInt(l)),l&&(n._isPermission3D=!0),n["3D"]&&(n._isPermission3D=!0),n.l!=t&&(n.version=n.l)};var yr=function(e){return e.__li__!==t&&!e._isPermission3D},br=function(e){if(!yr(e))return!0;var t=new Date;return e.beginDate!=null&&e.beginDate.getTime()-t.getTime()>=0||e.endDate!=null&&e.endDate.getTime()-t.getTime()<=0},wr=function(e){return e.type===2?!0:!1},Er=function(){return br(lr)?!1:lr._isPermissionGIS};lr.$z=function(e){var t=new er;t.setPublic(cr,hr);var n=e,r=n.length,i=256,s=0,o="",u="";while(s<r)o=n.substr(s,i),u+=t.decrypt(o),s+=i;return u},lr.twm=function(e){var n=lr,r=n.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),i=this.type,s=this.markText,o=n.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341");e[o]=n.__li__;if(i==="3"&&!br(lr)&&s===t)return;e.__liLabel==t&&(e.__liLabel=l.createElement("div")),n.startDate===t&&(n.startDate=new Date);var u=(new Date).getTime()-n.startDate.getTime();if(u<3e5)return;var a=br(n)&&u>3e5,f=s;a?f=n.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):i!="2"||f!==t&&f!=""?i=="1"&&!s&&(f=r):f=n.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc");if(f===t)return;var c=e,h=c.__liLabel;h.innerHTML=f;if(c._rootCanvas)h.type=i,h.mark=s,h.expired=a,c._xyz=h;else{var p=0,d=0;h.style.position="absolute";var v=c.getView().style;s!=t&&s!=null&&s!=""||i=="2"?(p=10-c.getView().scrollLeft,d=10-c.getView().scrollTop):(p=v.width.replace("px","")/2-50-c.getView().scrollLeft,d=v.height.replace("px","")/2-c.getView().scrollTop),h.style.right=p+"px",h.style.bottom=d+"px",h.style.fontSize="120%",a&&(c.getView().style.opacity=.1,h.style.color="red",h.style.fontSize="150%"),c.getView().appendChild(h)}},r.validateLicense(o);var Sr=function(e,t,n){this.g=e,this.onLength=t,this.offLength=n,this.isLine=!0,this.overflow=0,this.dashLength=t+n,this.pen={x:0,y:0}};r.ext(Sr,Object,{_curveaccuracy:6,moveTo:function(e,t){this.pen={x:e,y:t},this.g.moveTo(e,t),this.start||(this.start={x:e,y:t})},lineTo:function(e,t){var n=e-this.pen.x,r=t-this.pen.y,i=Math.atan2(r,n),s=Math.cos(i),o=Math.sin(i),u=this.lineLength(this.pen.x,this.pen.y,e,t);if(this.overflow){if(this.overflow>u){this.isLine?this._lineTo(e,t):this.moveTo(e,t),this.overflow-=u;return}this.isLine?this._lineTo(this.pen.x+s*this.overflow,this.pen.y+o*this.overflow):this.moveTo(this.pen.x+s*this.overflow,this.pen.y+o*this.overflow),u-=this.overflow,this.overflow=0,this.isLine=!this.isLine;if(!u)return}var a=Math.floor(u/this.dashLength);if(a){var f=s*this.onLength,l=o*this.onLength,c=s*this.offLength,h=o*this.offLength;for(var p=0;p<a;p++)this.isLine?(this._lineTo(this.pen.x+f,this.pen.y+l),this.moveTo(this.pen.x+c,this.pen.y+h)):(this.moveTo(this.pen.x+c,this.pen.y+h),this._lineTo(this.pen.x+f,this.pen.y+l));u-=this.dashLength*a}this.isLine?u>this.onLength?(this._lineTo(this.pen.x+s*this.onLength,this.pen.y+o*this.onLength),this.moveTo(e,t),this.overflow=this.offLength-(u-this.onLength),this.isLine=!1):(this._lineTo(e,t),u==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-u,this.moveTo(e,t))):u>this.offLength?(this.moveTo(this.pen.x+s*this.offLength,this.pen.y+o*this.offLength),this._lineTo(e,t),this.overflow=this.onLength-(u-this.offLength),this.isLine=!0):(this.moveTo(e,t),u==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-u)},quadraticCurveTo:function(e,t,n,r){var i=this.pen.x,s=this.pen.y,o=this.curveLength(i,s,e,t,n,r),u=0,a=0,f;if(this.overflow){if(this.overflow>o){this.isLine?this._curveTo(e,t,n,r):this.moveTo(n,r),this.overflow-=o;return}u=this.overflow/o,f=this.curveSliceUpTo(i,s,e,t,n,r,u),this.isLine?this._curveTo(f[2],f[3],f[4],f[5]):this.moveTo(f[4],f[5]),this.overflow=0,this.isLine=!this.isLine;if(!o)return}var l=o-o*u,c=Math.floor(l/this.dashLength),h=this.onLength/o,p=this.offLength/o;if(c)for(var d=0;d<c;d++)this.isLine?(a=u+h,f=this.curveSlice(i,s,e,t,n,r,u,a),this._curveTo(f[2],f[3],f[4],f[5]),u=a,a=u+p,f=this.curveSlice(i,s,e,t,n,r,u,a),this.moveTo(f[4],f[5])):(a=u+p,f=this.curveSlice(i,s,e,t,n,r,u,a),this.moveTo(f[4],f[5]),u=a,a=u+h,f=this.curveSlice(i,s,e,t,n,r,u,a),this._curveTo(f[2],f[3],f[4],f[5])),u=a;l=o-o*u,this.isLine?l>this.onLength?(a=u+h,f=this.curveSlice(i,s,e,t,n,r,u,a),this._curveTo(f[2],f[3],f[4],f[5]),this.moveTo(n,r),this.overflow=this.offLength-(l-this.onLength),this.isLine=!1):(f=this.curveSliceFrom(i,s,e,t,n,r,u),this._curveTo(f[2],f[3],f[4],f[5]),o==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-l,this.moveTo(n,r))):l>this.offLength?(a=u+p,f=this.curveSlice(i,s,e,t,n,r,u,a),this.moveTo(f[4],f[5]),f=this.curveSliceFrom(i,s,e,t,n,r,a),this._curveTo(f[2],f[3],f[4],f[5]),this.overflow=this.onLength-(l-this.offLength),this.isLine=!0):(this.moveTo(n,r),l==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-l)},bezierCurveTo:function(e,t,n,r,i,s){this.pen={x:i,y:s};var o=[this.onLength,this.offLength];this.g.setLineDash&&this.g.setLineDash(o),this.g.lineDash=o,this.g.bezierCurveTo(e,t,n,r,i,s)},rect:function(e,t,n,r){this.pen={x:e,y:t},this.moveTo(e,t),this.lineTo(e,t+r),this.lineTo(e+n,t+r),this.lineTo(e+n,t),this.lineTo(e,t)},closePath:function(){this.lineTo(this.start.x,this.start.y)},lineLength:function(e,t,n,r){var i=n-e,s=r-t;return Math.sqrt(i*i+s*s)},curveLength:function(e,t,n,r,i,s,o){var u=0,a=e,f=t,l,c,h,p,d,v,m,g=o>0?o:this._curveaccuracy;for(var y=1;y<=g;y++)h=y/g,p=1-h,d=p*p,v=2*h*p,m=h*h,l=d*e+v*n+m*i,c=d*t+v*r+m*s,u+=this.lineLength(a,f,l,c),a=l,f=c;return u},curveSlice:function(e,t,n,r,i,s,o,u){if(o==0)return this.curveSliceUpTo(e,t,n,r,i,s,u);if(u==1)return this.curveSliceFrom(e,t,n,r,i,s,o);var a=this.curveSliceUpTo(e,t,n,r,i,s,u);return a.push(o/u),this.curveSliceFrom.apply(this,a)},curveSliceUpTo:function(e,t,n,r,i,s,o){if(o!=1){var u=n+(i-n)*o,a=r+(s-r)*o;n=e+(n-e)*o,r=t+(r-t)*o,i=n+(u-n)*o,s=r+(a-r)*o}return[e,t,n,r,i,s]},curveSliceFrom:function(e,t,n,r,i,s,o){if(o!=1){var u=e+(n-e)*o,a=t+(r-t)*o;n+=(i-n)*o,r+=(s-r)*o,e=u+(n-u)*o,t=a+(r-a)*o}return[e,t,n,r,i,s]},_lineTo:function(e,t){if(e==this.pen.x&&t==this.pen.y)return;this.pen={x:e,y:t},this.g.lineTo(e,t)},_curveTo:function(e,t,n,r){if(e==n&&t==r&&n==this.pen.x&&r==this.pen.y)return;this.pen={x:n,y:r},this.g.quadraticCurveTo(e,t,n,r)}}),r.DashedLine=Sr;var xr={DEFAULTS:{"default":1,"default.vector":1,"vector.default":1},VECTORS:{vector:1,"default.vector":1,"vector.default":1},hasDefault:function(e){if(e instanceof es){var t=e.getStyle("body.type");return xr.DEFAULTS[t]===1}return!0},hasVector:function(e){if(e instanceof es){var t=e.getStyle("body.type");return xr.VECTORS[t]===1}return!1},hasAgentLinks:function(e){var t=e.getChildrenSize();for(var n=0;n<t;n++){var r=e.getChildAt(n);if(r instanceof es&&xr.hasAgentLinks(r))return!0}return e.hasAgentLinks()},getParents:function(e,t,n){n||(n=!0);var r=new Oi,i=e._parent;while(i!=null&&i!==t)r.add(i,0),i=i._parent;return n&&i!=null&&i===t&&r.add(i,0),r},getSubNetwork:function(e){if(!e)return null;if(e instanceof n.Link){var t=e._fromAgent,r=e._toAgent;if(!t||!r)return null;var i=xr.getSubNetwork(t),s=xr.getSubNetwork(r);return i===s?i:null}var o=e._parent;if(!o)return null;while(o instanceof n.Link&&!o.ISubNetwork)o=o._parent;return o.ISubNetwork?o:xr.getSubNetwork(o)},figureSameSubNetworkAgent:function(e){if(!e)return null;var t=e._parent;while(t instanceof ns){if(!(t._parent instanceof ns))return t.isExpanded()?e:t;t.isExpanded()||(e=t),t=t._parent}return e},figureSpanSubNetworkAgent:function(e,t){if(!e||!t)return null;var n=xr.getSubNetwork(e),r=xr.getSubNetwork(t);if(n!=r){while(r!=null&&n!=r)r=xr.getSubNetwork(r);if(n===r)return e;var i=new Oi;i.add(e,0);var s=e._parent;while(s instanceof es){if(!!t.isDescendantOf(s))break;i.add(s,0),s=s._parent}var o=i.size();for(var u=0;u<o;u++){var a=i.get(u);if(a instanceof ns&&!a.isExpanded())return a;if(a.ISubNetwork)return a}return e}return e},figureFromAgent:function(e){if(e.isLooped())return e.getFromNode();var t=xr.figureSameSubNetworkAgent(e.getFromNode()),n=xr.figureSameSubNetworkAgent(e.getToNode());return t===n?e.getFromNode():xr.figureSpanSubNetworkAgent(t,n)},figureToAgent:function(e){if(e.isLooped())return e.getToNode();var t=xr.figureSameSubNetworkAgent(e.getFromNode()),n=xr.figureSameSubNetworkAgent(e.getToNode());return t===n?e.getToNode():xr.figureSpanSubNetworkAgent(n,t)},getBundleLinks:function(e,t){if(!e||!t)return null;var n,r,i,s;if(e===t){s=e.getLoopedLinks();if(!s)return null;s=new Oi(s)}else{var o=e.getAgentLinks(),u=t.getAgentLinks();if(!o||!u)return null;r=o.size();for(n=0;n<r;n++)i=o.get(n),u.contains(i)&&(s||(s=new Oi),s.add(i))}if(s!=null)for(n=0;n<s.size();n++)i=s.get(n),i.getStyle("link.bundle.enable")||(i._setBundleLinks(null),s.removeAt(n),n--);return s},resetBundleLinks:function(e,t){var r=xr.getBundleLinks(e,t);if(!r||r.size()===0)return;var i=null;if(r.size()===1){i=r.get(0),i._setBundleLinks(null);return}var s,o,u=new Oi;for(s=0;s<r.size();s++)i=r.get(s),o=i.getStyle("link.bundle.id"),u.indexOf(o)<0&&u.add(o);u.sort();var a,f=new Oi,l;for(l=0;l<u.size();l++){o=u.get(l);var c=new Oi;for(s=0;s<r.size();s++)i=r.get(s),o===i.getStyle("link.bundle.id")&&c.add(i);a=new n.BundleLinks(c,f),f.add(a)}for(l=0;l<f.size();l++){a=f.get(l);for(s=0;s<a.getLinks().size();s++)i=a.getLinks().get(s),i._setBundleLinks(a)}},moveElements:function(e,t,n,r){var i=xr.filterMovingElements(e,r),s=i.size();for(var o=0;o<s;o++)i.get(o).translate(t,n)},filterMovingElements:function(e,t){var r=new Oi,i=e.size();for(var s=0;s<i;s++){var o=e.get(s);if(!(o instanceof es))continue;if(t&&!t(o))continue;var u=!0,a=r.toArray();for(var f=0;f<a.length;f++){var l=a[f];u&&l instanceof n.Follower&&o instanceof n.Follower&&o.isLoopedHostOn(l)?u=!1:l instanceof n.Follower&&l.isHostOn(o)?r.remove(l):u&&o instanceof n.Follower&&l instanceof es&&o.isHostOn(l)?u=!1:xr.isDescendantOfGroup(l,o)?r.remove(l):u&&xr.isDescendantOfGroup(o,l)&&(u=!1)}u&&r.add(o)}return r},isDescendantOfGroup:function(e,t){if(!!e&&t instanceof ns){if(!t.hasChildren())return!1;e=e._parent;while(e instanceof ns){if(e===t)return!0;e=e._parent}return!1}return!1}};r.element=xr;var Tr={between:function(e,t,n){return n>=e&&n<=t?!0:n>=t&&n<=e?!0:!1},considerEast:function(e,t,n){return t?Tr.between(t.x,n.x,e.x)?n.x>t.x:Math.abs(t.x-e.x)>Math.abs(n.x-e.x):!0},considerWest:function(e,t,n){return t?Tr.between(t.x,n.x,e.x)?n.x<t.x:Math.abs(t.x-e.x)>Math.abs(n.x-e.x):!0},considerNorth:function(e,t,n){return t?Tr.between(t.y,n.y,e.y)?n.y<t.y:Math.abs(t.y-e.y)>Math.abs(n.y-e.y):!0},considerSouth:function(e,t,n){return t?Tr.between(t.y,n.y,e.y)?n.y>t.y:Math.abs(t.y-e.y)>Math.abs(n.y-e.y):!0},getHorizontalPoint:function(e,t,n){return Tr.between(t.x,n.x,e.x)?{x:e.x,y:t.y}:Math.abs(e.x-t.x)<Math.abs(e.x-n.x)?{x:t.x,y:t.y}:{x:n.x,y:n.y}},getVerticalPoint:function(e,t,n){return Tr.between(t.y,n.y,e.y)?{x:t.x,y:e.y}:Math.abs(e.y-t.y)<Math.abs(e.y-n.y)?{x:t.x,y:t.y}:{x:n.x,y:n.y}},getPoint:function(e,t,n,r,i){var s=Math.abs(r.x-n.x)>Math.abs(r.y-n.y);if("south"===i)return s&&Tr.considerSouth(t,e,n)?Tr.getHorizontalPoint(t,n,r):null;if("north"===i)return s&&Tr.considerNorth(t,e,n)?Tr.getHorizontalPoint(t,n,r):null;if("west"===i)return!s&&Tr.considerWest(t,e,n)?Tr.getVerticalPoint(t,n,r):null;if("east"===i)return!s&&Tr.considerEast(t,e,n)?Tr.getVerticalPoint(t,n,r):null;if("nearby"===i){var o;return s?o=Tr.getHorizontalPoint(t,n,r):o=Tr.getVerticalPoint(t,n,r),!e||m.getDistance(e,t)>m.getDistance(o,t)?o:null}return null},getBusPoint:function(e,t,n){var r,i=e.size();if(i>0){var s=e.get(0);for(var o=1;o<i;o++){var u=e.get(o),a=Tr.getPoint(r,t,s,u,n);a&&(r=a),s=u}r||(r={x:s.x,y:s.y})}return r}};r.bus=Tr;var Nr={createFromPoint:function(e,t){var i=e._element;if(!i.getFromAgent())return{x:0,y:0};var s=i.getStyle("link.from.position"),o=i.getStyle("link.from.xoffset"),u=i.getStyle("link.from.yoffset"),a,f=i.getStyle("link.from.percent");if(f&&f instanceof Array&&f.length===2&&f[0]<=1&&f[0]>=0&&f[1]<=1&&f[1]>=0){var l=i.getFromAgent(),c=l.getSize(),h=l.getRect().x+c.width*f[0],p=l.getRect().y+c.height*f[1];return{x:h,y:p}}if(e._network._edgeDetect){var l=i.getFromAgent(),d=i.getToAgent(),v=l.getImage(),g=r.images[v],y=l.getCenterLocation(),b=d.getCenterLocation(),w=this._getPointAngleDegree(b.x,b.y,y.x,y.y),E={x:0,y:0};if(g){var S=g._image;if(S&&si(S)||S&&n.Util.getImageAsset(v)._cache)return si(S)?g._edgeData||(g._edgeData=g._createEdgeData(S,l._width,l._height)):typeof S=="object"&&(g._edgeData||(g._edgeData=g._createEdgeData(n.Util.getImageAsset(v)._cache,l.getWidth(),l.getHeight()))),E.x=g._edgeData[w].x+l.getRect().x,E.y=g._edgeData[w].y+l.getRect().y,E}}if(!r.isCalculatingBus){r.isCalculatingBus=!0;if(i.getFromAgent()instanceof n.Bus){var x=i.getFromAgent();if(xr.hasVector(x)){var T=t?t._getElementZoomRect(e,x.getRect()):x.getRect(),N=x.getStyle("vector.shape");if(N==="oval")a=m.getEllipsePoint(T,Nr.createToPoint(e));else if(N==="circle")a=m.getEllipsePoint(m.getCircleRect(T),Nr.createToPoint(e));else if(N==="rectangle"||N==="roundrect"){var C=new Oi;C.add({x:x.x,y:x.y}),C.add({x:x.x+x.width,y:x.y}),C.add({x:x.x+x.width,y:x.y+x.height}),C.add({x:x.x,y:x.y+x.height}),C.add({x:x.x,y:x.y}),C=t?t._getShapeNodeZoomPoints(e,C):C,a=Tr.getBusPoint(C,Nr.createToPoint(e),x.getStyle("bus.style"))}}else{var C=t?t._getShapeNodeZoomPoints(e,x.getPoints()):x.getPoints();a=Tr.getBusPoint(C,Nr.createToPoint(e),x.getStyle("bus.style"))}}r.isCalculatingBus=!1}return a?(a.x+=o,a.y+=u):a=e._network.getPosition(s,i.getFromAgent(),null,o,u,!0),a},createToPoint:function(e,t){var i=e._element;if(!i.getToAgent())return{x:0,y:0};var s=i.getStyle("link.to.position"),o=i.getStyle("link.to.xoffset"),u=i.getStyle("link.to.yoffset"),a,f=i.getStyle("link.to.percent");if(f&&f instanceof Array&&f.length===2&&f[0]<=1&&f[0]>=0&&f[1]<=1&&f[1]>=0){var l=i.getToAgent(),c=l.getSize(),h=l.getRect().x+c.width*f[0],p=l.getRect().y+c.height*f[1];return{x:h,y:p}}if(e._network._edgeDetect){var d=i.getFromAgent(),l=i.getToAgent(),v=l.getImage(),g=r.images[v],y=d.getLocation(),b=l.getCenterLocation(),w=this._getPointAngleDegree(y.x,y.y,b.x,b.y),E={x:0,y:0};if(g){var S=g._image;if(S&&si(S)||S&&n.Util.getImageAsset(v)._cache)return si(S)?g._edgeData||(g._edgeData=g._createEdgeData(S,l.getWidth(),l.getHeight())):typeof S=="object"&&(g._edgeData||(g._edgeData=g._createEdgeData(n.Util.getImageAsset(v)._cache,l.getWidth(),l.getHeight()))),E.x=g._edgeData[w].x+l.getRect().x,E.y=g._edgeData[w].y+l.getRect().y,E}}if(!r.isCalculatingBus){r.isCalculatingBus=!0;if(i.getToAgent()instanceof n.Bus){var x=i.getToAgent();if(xr.hasVector(x)){var T=t?t._getElementZoomRect(e,x.getRect()):x.getRect(),N=x.getStyle("vector.shape");if(N==="oval")a=m.getEllipsePoint(T,Nr.createFromPoint(e));else if(N==="circle")a=m.getEllipsePoint(m.getCircleRect(T),Nr.createFromPoint(e));else if(N==="rectangle"||N==="roundrect"){var C=new Oi;C.add({x:x.x,y:x.y}),C.add({x:x.x+x.width,y:x.y}),C.add({x:x.x+x.width,y:x.y+x.height}),C.add({x:x.x,y:x.y+x.height}),C.add({x:x.x,y:x.y}),C=t?t._getShapeNodeZoomPoints(e,C):C,a=Tr.getBusPoint(C,Nr.createFromPoint(e),x.getStyle("bus.style"))}}else{var C=t?t._getShapeNodeZoomPoints(e,x.getPoints()):x.getPoints();a=Tr.getBusPoint(C,Nr.createFromPoint(e),x.getStyle("bus.style"))}}r.isCalculatingBus=!1}return a?(a.x+=o,a.y+=u):a=e._network.getPosition(s,i.getToAgent(),null,o,u,!0),a},fillLoopedPoints:function(e,t,n){var r,i=Nr.getBundleGap(e,!0),s=i,o=e.getStyle("link.looped.type"),u=e.getStyle("link.looped.direction");if(u==="north")return o==="arc"?Nr.drawArc
(t.x+t.width/2,t.y,0,Math.PI,i,i,!1,n):(r={x:t.x+t.width/2,y:t.y},n.add({x:r.x+s,y:r.y}),n.add({x:r.x+s,y:r.y-i}),n.add({x:r.x-s,y:r.y-i}),n.add({x:r.x-s,y:r.y})),{x:t.x+t.width/2,y:t.y-i};if(u==="northeast")return o==="arc"?Nr.drawArc(t.x+t.width,t.y,Math.PI*1.5,Math.PI*1.5,i,i,!1,n):(r={x:t.x+t.width,y:t.y},n.add({x:r.x,y:r.y+s}),n.add({x:r.x+s,y:r.y+s}),n.add({x:r.x+s,y:r.y-i}),n.add({x:r.x-s,y:r.y-i}),n.add({x:r.x-s,y:r.y})),{x:t.x+t.width+i*.707,y:t.y-i*.707};if(u==="east")return o==="arc"?Nr.drawArc(t.x+t.width,t.y+t.height/2,Math.PI*1.5,Math.PI,i,i,!1,n):(r={x:t.x+t.width,y:t.y+t.height/2},n.add({x:r.x,y:r.y-s}),n.add({x:r.x+i,y:r.y-s}),n.add({x:r.x+i,y:r.y+s}),n.add({x:r.x,y:r.y+s})),{x:t.x+t.width+i,y:t.y+t.height/2};if(u==="southeast")return o==="arc"?Nr.drawArc(t.x+t.width,t.y+t.height,Math.PI,Math.PI*1.5,i,i,!1,n):(r={x:t.x+t.width,y:t.y+t.height},n.add({x:r.x,y:r.y-s}),n.add({x:r.x+s,y:r.y-s}),n.add({x:r.x+s,y:r.y+i}),n.add({x:r.x-s,y:r.y+i}),n.add({x:r.x-s,y:r.y})),{x:t.x+t.width+i*.707,y:t.y+t.height+i*.707};if(u==="south")return o==="arc"?Nr.drawArc(t.x+t.width/2,t.y+t.height,Math.PI,Math.PI,i,i,!1,n):(r={x:t.x+t.width/2,y:t.y+t.height},n.add({x:r.x-s,y:r.y}),n.add({x:r.x-s,y:r.y+i}),n.add({x:r.x+s,y:r.y+i}),n.add({x:r.x+s,y:r.y})),{x:t.x+t.width/2,y:t.y+t.height+i};if(u==="southwest")return o==="arc"?Nr.drawArc(t.x,t.y+t.height,Math.PI*.5,Math.PI*1.5,i,i,!1,n):(r={x:t.x,y:t.y+t.height},n.add({x:r.x,y:r.y-s}),n.add({x:r.x-s,y:r.y-s}),n.add({x:r.x-s,y:r.y+i}),n.add({x:r.x+s,y:r.y+i}),n.add({x:r.x+s,y:r.y})),{x:t.x-i*.707,y:t.y+t.height+i*.707};if(u==="west")return o==="arc"?Nr.drawArc(t.x,t.y+t.height/2,Math.PI*.5,Math.PI,i,i,!1,n):(r={x:t.x,y:t.y+t.height/2},n.add({x:r.x,y:r.y-s}),n.add({x:r.x-i,y:r.y-s}),n.add({x:r.x-i,y:r.y+s}),n.add({x:r.x,y:r.y+s})),{x:t.x-i,y:t.y+t.height/2};if(u==="northwest")return o==="arc"?Nr.drawArc(t.x,t.y,0,Math.PI*1.5,i,i,!1,n):(r={x:t.x,y:t.y},n.add({x:r.x,y:r.y+s}),n.add({x:r.x-s,y:r.y+s}),n.add({x:r.x-s,y:r.y-i}),n.add({x:r.x+s,y:r.y-i}),n.add({x:r.x+s,y:r.y})),{x:t.x-i*.707,y:t.y-i*.707};throw"Can not resolve link looped direction '"+u+"'"},drawArc:function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y;Math.abs(r)>2*Math.PI&&(r=2*Math.PI),h=Math.ceil(Math.abs(r)/(Math.PI/4)),a=r/h,f=-a,l=-n;if(h>0){p=e+Math.cos(n)*i,d=t+Math.sin(-n)*s,u.add({x:p,y:d});for(var b=0;b<h;b++){l+=f,c=l-f/2,v=e+Math.cos(l)*i,m=t+Math.sin(l)*s,g=e+Math.cos(c)*(i/Math.cos(f/2)),y=t+Math.sin(c)*(s/Math.cos(f/2));var w=new Oi;w.add({x:g,y:y}),w.add({x:v,y:m}),u.add(w)}}},fillBundlePoints:function(e,n,r,i,s,o){var u=e._element.getBundleCount(),a=e._element.getBundleIndex(),f=e.getStyle("link.bundle.expanded"),l;if(n!=="parallel"&&(l=Nr.getBundleGap(e,!1))===0)return s.add(r),s.add(i),m.getCenterPoint(r,i);l===t&&(l=Nr.getBundleGap(e,!1));var c=Nr.getBundleOffset(e),h=m.getDistance(r,i);if(o){var p=o.getSizeZoom();c*=p,l*=p}(n==="arc"||n==="triangle")&&s.add({x:0,y:0}),n==="arc"&&s.add({x:0,y:l}),s.add({x:c,y:l}),s.add({x:h-c,y:l}),n==="arc"&&s.add({x:h,y:l}),(n==="arc"||n==="triangle")&&s.add({x:h,y:0});var d=Math.atan2(i.y-r.y,i.x-r.x),v=m.createMatrix(d,0,0);for(var g=0,y=s.size();g<y;g++){var b=s.get(g);b=v.transform(b),b.x+=r.x,b.y+=r.y,s.set(g,b)}if(n==="arc"){var w=m.getCenterPoint(s.get(2),s.get(3)),E=new Oi;return E.add(s.get(1)),E.add(s.get(2)),s.set(1,E),E=new Oi,E.add(s.get(4)),E.add(s.get(5)),s.set(4,E),s.removeAt(5),s.removeAt(2),w}return Nr.calculateCenterPoint(s)},calculateCenterPoint:function(e){var t=e.size();if(e==null||t<1)return{x:0,y:0};if(t%2===0){var n=t/2,r=e.get(n-1),i=e.get(n);return{x:(r.x+i.x)/2,y:(r.y+i.y)/2}}return e.get((t-1)/2)},getBundleOffset:function(e){var t=m.getDistance(e.getFromPoint(),e.getToPoint()),n=e.getStyle("link.bundle.offset");return t>n*2?n:t/2},getBundleGap:function(e,t){var n=e._element;if(!n.getBundleLinks())return t?n.getStyle("link.looped.gap"):0;var r=t?"link.looped.gap":"link.bundle.gap",i=null,s=0,o=0,u=n.getBundleLinks().getSiblings(),a=0,f=n.getStyle("link.bundle.independent"),l=n.getStyle("link.bundle.group.gap");for(var c=0,h=u.size();c<h;c++){var p=u.get(c);if(f&&p!==n.getBundleLinks())continue;for(var d=0,v=p.getLinks().size();d<v;d++){var m=p.getLinks().get(d);if(f!==m.getStyle("link.bundle.independent"))continue;if(e._network.isVisible(m)){if(i==null)i=m,a=m.getStyle(r);else{var g=m.getStyle(r);o+=a/2+g/2,a=g}m===n&&(s=o+l/2)}}o+=l}if(t)return o-s+a;var y=s-o/2;return i!=null&&n.getFromAgent()!==i.getFromAgent()&&(y=-y),y},isTargetPriority:function(e,t,n){if(e){if(t.height<n.height)return t.height+n.height<Math.max(t.y+t.height,n.y+n.height)-Math.min(t.y,n.y)+t.height/2}else if(t.width<n.width)return t.width+n.width<Math.max(t.x+t.width,n.x+n.width)-Math.min(t.x,n.x)+t.width/2;return!0},calculateOrthogonalAndFlexionalLinkPoints:function(e,t,n,r){var i=Nr.isHorizontal(e,t,n,r),s=new Oi;if(Nr.isFlexionalTypeLink(e))Nr.flexional(i,t,n,s,r.getStyle("link.extend"));else{Nr.orthogonal(e,t,n,s,i,r);var o=Nr.isSplitByPercent(e,r),u=o?Nr.calculateSplitValueByPercent(e,i,t,n,r.getStyle("link.split.percent")):r.getStyle("link.split.value");u===0&&(i=!i)}var a;s.size()===0?Nr.isTargetPriority(i,t,n)?(a={x:n.x+n.width/2,y:n.y+n.height/2},s.add(Nr.rectanglePerimeter(t,!0,a)),s.add(Nr.rectanglePerimeter(n,!1,s.get(s.size()-1)))):(a={x:t.x+t.width/2,y:t.y+t.height/2},a=Nr.rectanglePerimeter(n,!1,a),s.add(Nr.rectanglePerimeter(t,!0,a)),s.add(a)):(a=s.get(0),s.add(Nr.rectanglePerimeter(t,!0,a),0),s.add(Nr.rectanglePerimeter(n,!1,s.get(s.size()-1))));var f=s.size();if(f<2)return s;var l=s.get(0);for(var c=1;c<f-1;c++){var h=s.get(c);h.x===l.x&&h.y===l.y&&(s.remove(h),f--,c--),l=h}return s},isHorizontal:function(e,t,n,r){if(e){if(e==="flexional.horizontal"||e==="orthogonal.horizontal"||e==="orthogonal.H.V"||e==="extend.left"||e==="extend.right")return!0;if(e==="flexional.vertical"||e==="orthogonal.vertical"||e==="orthogonal.V.H"||e==="extend.top"||e==="extend.bottom")return!1}var i=Nr.calculateXGap(t,n),s=Nr.calculateYGap(t,n);return i>=s},flexional:function(e,t,n,r,i){e?Nr.flexionalHorizontal(t,n,r,i):Nr.flexionalVertical(t,n,r,i)},isSplitByPercent:function(e,t){return t.getStyle("link.split.by.percent")},isExtendTypeLink:function(e){return e&&(e==="extend.top"||e==="extend.left"||e==="extend.bottom"||e==="extend.right")},isFlexionalTypeLink:function(e){return e&&(e==="flexional"||e==="flexional.horizontal"||e==="flexional.vertical")},calculateControlPoint:function(e,t,n,r,i){if(e==="orthogonal.H.V"||e==="orthogonal.V.H")return{x:r.x+r.width/2,y:r.y+r.height/2};var s;if(Nr.isExtendTypeLink(e)){var o=Math.min(n.y,r.y),u=Math.min(n.x,r.x),a=Math.max(n.y+n.height,r.y+r.height),f=Math.max(n.x+n.width,r.x+r.width);s=i.getStyle("link.extend");if(e==="extend.top")return{x:(u+f)/2,y:o-s};if(e==="extend.left")return{x:u-s,y:(o+a)/2};if(e==="extend.bottom")return{x:(u+f)/2,y:a+s};if(e==="extend.right")return{x:f+s,y:(o+a)/2}}var l=Nr.isSplitByPercent(e,i);s=l?Nr.calculateSplitValueByPercent(e,t,n,r,i.getStyle("link.split.percent")):i.getStyle("link.split.value");if(s===Number.NEGATIVE_INFINITY||s===Number.POSITIVE_INFINITY)return{x:r.x+r.width/2,y:r.y+r.height/2};if(s===0)return{x:n.x+n.width/2,y:n.y+n.height/2};if(t){var c=n.x+n.x+n.width<r.x+r.x+r.width;return{x:Nr.calculateSplitLocation(c,s,n.x,n.width),y:n.y+n.height/2}}var h=n.y+n.y+n.height<r.y+r.y+r.height;return{x:n.x+n.width/2,y:Nr.calculateSplitLocation(h,s,n.y,n.height)}},calculateGap:function(e,t,n,r){var i=Math.max(t,r)-Math.min(e,n);return i-(t-e+r-n)},calculateXGap:function(e,t){var n=Math.max(e.x+e.width,t.x+t.width)-Math.min(e.x,t.x);return n-e.width-t.width},calculateYGap:function(e,t){var n=Math.max(e.y+e.height,t.y+t.height)-Math.min(e.y,t.y);return n-e.height-t.height},calculateSplitValueByPercent:function(e,t,n,r,i){var s=Nr.calculateSplitGapByPercent(i,t,n,r);return s*i},calculateSplitGapByPercent:function(e,t,n,r,i){return t?Nr._calculateSplitGapByPercent(e,n.x,n.x+n.width,r.x,r.x+r.width):Nr._calculateSplitGapByPercent(e,n.y,n.y+n.height,r.y,r.y+r.height)},_calculateSplitGapByPercent:function(e,t,n,r,i){var s=Nr.calculateGap(t,n,r,i),o=t+n<r+i;if(s>0){if(e===1)return s+(i-r)/2;if(e>=0&&e<1)return s;if(e<0)return o?r-t:n-i}return o&&e>0||!o&&e<0?Math.abs(n-i):Math.abs(t-r)},calculateSplitPercentByControlPoint:function(e,t,n,r){return t?Nr.calculateSplitPercent(e.x,n.x,n.x+n.width,r.x,r.x+r.width):Nr.calculateSplitPercent(e.y,n.y,n.y+n.height,r.y,r.y+r.height)},calculateSplitPercent:function(e,t,n,r,i){if(e>=t&&e<=n)return 0;var s=Nr.calculateGap(t,n,r,i);if(s>0&&e>=r&&e<=i)return 1;var o=t+n<r+i;if(s>0){if(e>Math.min(n,i)&&e<Math.max(t,r))return Math.abs(e-(o?n:t))/s;if(o){if(e<t)return(e-t)/(r-t)}else if(e>n)return(n-e)/(n-i)}return e>n?(o?e-n:n-e)/Math.abs(n-i):(o?e-t:t-e)/Math.abs(t-r)},calculateSplitLocation:function(e,t,n,r){return e===t>0?n+r+Math.abs(t):n-Math.abs(t)},calculateAngle:function(e,t){if(e!==0&&t!==0)return Math.atan2(e,t);if(e===0){if(t>0)return 0;if(t<0)return Math.PI}return e>0?Math.PI/2:-Math.PI/2},drawCorner:function(e,t){var n=e.size();if(n<3)return;var r=t.getStyle("link.corner");if(r==="none")return;var i=t.getStyle("link.xradius"),s=t.getStyle("link.yradius"),o,u,a=e.get(0),f=e.get(1),l,c;for(var h=2;h<n;h++){var p=e.get(h),d=f.x-a.x,v=f.y-a.y,m=p.x-f.x,g=p.y-f.y,y=v===0;if(d===0&&g===0||v===0&&m===0){y?(o=Math.min(h===2?Math.abs(d):Math.abs(d)/2,i),u=Math.min(h===n-1?Math.abs(g):Math.abs(g)/2,s),l={x:f.x-(d>0?o:-o),y:f.y},c={x:f.x,y:f.y+(g>0?u:-u)}):(o=Math.min(h===n-1?Math.abs(m):Math.abs(m)/2,i),u=Math.min(h===2?Math.abs(v):Math.abs(v)/2,s),l={x:f.x,y:f.y-(v>0?u:-u)},c={x:f.x+(m>0?o:-o),y:f.y}),e.remove(f),h--,n--;if(l.x!==a.x||l.y!==a.y)e.add(l,h),h++,n++;if(r==="bevel")e.add(c,h),h++,n++;else if(r==="round"){var b=new Oi;b.add(f),b.add(c),e.add(b,h),h++,n++}}a=f,f=p}c&&c.x===f.x&&c.y===f.y&&e.remove(f)},orthogonal:function(e,t,n,r,i,s){var o=s.getStyle("link.control.point"),u=o==null;if(o){var a=m.unionRect(t,n);m.containsPoint(a,o)||(i=Nr.calculateIsHorizontalByControlPoint(o.x,o.y,a.y,a.x,a.y+a.height,a.x+a.width))}else o=Nr.calculateControlPoint(e,i,t,n,s);i?Nr.sideToSide(t,n,o,r,u):Nr.topToBottom(t,n,o,r,u)},calculateIsHorizontalByControlPoint:function(e,t,n,r,i,s){return t<n&&n-t>r-e&&n-t>e-s||t>i&&t-i>r-e&&t-i>e-s?!1:!0},contains:function(e,t,n){return t>=e.x&&t<=e.x+e.width&&n>=e.y&&n<=e.y+e.height},topToBottom:function(e,t,n,r,i){var s=Math.max(e.y,t.y),o=Math.min(e.y+e.height,t.y+t.height),u=n?n.y:o+(s-o)/2,a=e.x+e.width/2,f=t.x+t.width/2;!i&&n&&(n.x>=e.x&&n.x<=e.x+e.width&&(a=n.x),n.x>=t.x&&n.x<=t.x+t.width&&(f=n.x)),!Nr.contains(t,a,u)&&!Nr.contains(e,a,u)&&r.add({x:a,y:u}),!Nr.contains(t,f,u)&&!Nr.contains(e,f,u)&&r.add({x:f,y:u});if(r.size()===0)if(n)!Nr.contains(t,n.x,u)&&!Nr.contains(e,n.x,u)&&r.add({x:n.x,y:u});else{var l=Math.max(e.x,t.x),c=Math.min(e.x+e.width,t.x+t.width);r.add({x:l+(c-l)/2,y:u})}},sideToSide:function(e,t,n,r,i){var s=Math.max(e.x,t.x),o=Math.min(e.x+e.width,t.x+t.width),u=n?n.x:o+(s-o)/2,a=e.y+e.height/2,f=t.y+t.height/2;!i&&n&&(n.y>=e.y&&n.y<=e.y+e.height&&(a=n.y),n.y>=t.y&&n.y<=t.y+t.height&&(f=n.y)),!Nr.contains(t,u,a)&&!Nr.contains(e,u,a)&&r.add({x:u,y:a}),!Nr.contains(t,u,f)&&!Nr.contains(e,u,f)&&r.add({x:u,y:f});if(r.size()===0)if(n)!Nr.contains(t,u,n.y)&&!Nr.contains(e,u,n.y)&&r.add({x:u,y:n.y});else{var l=Math.max(e.y,t.y),c=Math.min(e.y+e.height,t.y+t.height);r.add({x:u,y:l+(c-l)/2})}},flexionalHorizontal:function(e,t,n,r){var i=t.x+t.width<e.x,s=e.x+e.width<t.x,o=i?e.x:e.x+e.width,u=e.y+e.height/2,a=s?t.x:t.x+t.width,f=t.y+t.height/2,l=r,c=i?-l:l,h={x:o+c,y:u};c=s?-l:l;var p={x:a+c,y:f};if(i===s){var d=i?Math.min(o,a)-r:Math.max(o,a)+r;n.add({x:d,y:u}),n.add({x:d,y:f})}else if(h.x<p.x===i){var v=u+(f-u)/2;n.add(h),n.add({x:h.x,y:v}),n.add({x:p.x,y:v}),n.add(p)}else n.add(h),n.add(p)},flexionalVertical:function(e,t,n,r){var i=t.y+t.height<e.y,s=e.y+e.height<t.y,o=e.x+e.width/2,u=i?e.y:e.y+e.height,a=t.x+t.width/2,f=s?t.y:t.y+t.height,l=r,c=i?-l:l,h={x:o,y:u+c};c=s?-l:l;var p={x:a,y:f+c};if(i===s){var d=i?Math.min(u,f)-r:Math.max(u,f)+r;n.add({x:o,y:d}),n.add({x:a,y:d})}else if(h.y<p.y===i){var v=o+(a-o)/2;n.add(h),n.add({x:v,y:h.y}),n.add({x:v,y:p.y}),n.add(p)}else n.add(h),n.add(p)},rectanglePerimeter:function(e,t,n){var r=e.x+e.width/2,i=e.y+e.height/2,s=n.x-r,o=n.y-i,u=Math.atan2(o,s),a={x:0,y:0},f=Math.PI,l=Math.PI/2,c=l-u,h=Math.atan2(e.height,e.width);return u<-f+h||u>f-h?(a.x=e.x,a.y=i-e.width*Math.tan(u)/2):u<-h?(a.y=e.y,a.x=r-e.height*Math.tan(c)/2):u<h?(a.x=e.x+e.width,a.y=i+e.width*Math.tan(u)/2):(a.y=e.y+e.height,a.x=r+e.height*Math.tan(c)/2),n.x>=e.x&&n.x<=e.x+e.width?a.x=n.x:n.y>=e.y&&n.y<=e.y+e.height&&(a.y=n.y),n.x<e.x?a.x=e.x:n.x>e.x+e.width&&(a.x=e.x+e.width),n.y<e.y?a.y=e.y:n.y>e.y+e.height&&(a.y=e.y+e.height),a},isSplitTypeLink:function(e){return e&&(e==="orthogonal"||e==="orthogonal.horizontal"||e==="orthogonal.vertical")},isOrthogonalOrFlexionalLink:function(e){if(e instanceof n.ShapeLink)return!1;if(e.isLooped())return!1;var t=e.getStyle("link.type");return Nr.isOrthogonalOrFlexionalType(t)},isOrthogonalLink:function(e){if(e instanceof n.ShapeLink)return!1;if(e.isLooped())return!1;var t=e.getStyle("link.type");return Nr.isOrthogonalType(t)},isOrthogonalOrFlexionalType:function(e){return e==="orthogonal"||e==="orthogonal.horizontal"||e==="orthogonal.H.V"||e==="orthogonal.vertical"||e==="orthogonal.V.H"||e==="extend.top"||e==="extend.left"||e==="extend.bottom"||e==="extend.right"||e==="flexional"||e==="flexional.horizontal"||e==="flexional.vertical"},isOrthogonalType:function(e){return e==="orthogonal"||e==="orthogonal.horizontal"||e==="orthogonal.H.V"||e==="orthogonal.vertical"||e==="orthogonal.V.H"||e==="extend.top"||e==="extend.left"||e==="extend.bottom"||e==="extend.right"},hasControlPoint:function(e){return e==="orthogonal"||e==="orthogonal.horizontal"||e==="orthogonal.vertical"||e==="extend.bottom"||e==="extend.left"||e==="extend.right"||e==="extend.top"},getControlPoint:function(e,t,n){if(!e)throw"link can't be null";var r=e.getStyle("link.type");if(!Nr.hasControlPoint(r))return null;var i=e.getStyle("link.control.point");if(i)return i;var s,o;t==null?(s=e.getFromAgent().getRect(),o=e.getToAgent().getRect()):(s=Nr.getLinkSourceBounds(t,n),o=Nr.getLinkTargetBounds(t,n));if(s==null||o==null)return null;var u=Nr.isHorizontal(r,s,o,e);return Nr.calculateControlPoint(e.getStyle("link.type"),u,s,o,e)},getSplitValueByControlPoint:function(e,t,n,r,i){if(t==="extend.top")return Math.min(n.y,r.y)-e.y;if(t==="extend.left")return Math.min(n.x,r.x)-e.x;if(t==="extend.bottom")return e.y-Math.max(n.y+n.height,r.y+r.height);if(t==="extend.right")return e.x-Math.max(n.x+n.width,r.x+r.width);var s;if(i){var o=n.x+n.x+n.width<r.x+r.x+r.width;return s=o?e.x-n.x+n.width:n.x-e.x,s>0?s:s>-n.width?0:s+n.width}var u=n.y+n.y+n.height<r.y+r.y+r.height;return s=u?e.y-n.y-n.height:n.y-e.y,s>0?s:s>-n.height?0:s+n.height},isHorizontalByControlPoint:function(e,t,n,r,i){var s=m.unionRect(n,r);return m.containsPoint(s,e)?Nr.isHorizontal(t,n,r,i):Nr.calculateIsHorizontalByControlPoint(e.x,e.y,s.y,s.x,s.y+s.height,s.x+s.width)},setParamsByControlPoint:function(e,t,n,r,i){var s=Nr.isHorizontalByControlPoint(e,r,t,n,i),o=i.getStyle("link.control.point");(o||r==="orthogonal"||r==="orthogonal.horizontal"||r==="orthogonal.vertical")&&i.setStyle("link.type",s?"orthogonal.horizontal":"orthogonal.vertical");if(o){i.setStyle("link.control.point",e);return}var u=Nr.getSplitValueByControlPoint(e,r,t,n,s);if(Nr.isExtendTypeLink(r)){i.setStyle("link.extend",u);return}var a=Nr.isSplitByPercent(r,i);if(!a){i.setStyle("link.split.value",u);return}if(u===0){i.setStyle("link.split.percent",0);return}i.setStyle("link.split.percent",Nr.calculateSplitPercentByControlPoint(e,s,t,n))},getLinkNodeBounds:function(e,t,n,r,i,s){if(s)var o=s.getLocationZoom(),u=s.getSizeZoom(e);if(e==null)return null;var a;if(!r){var f=e.getNetwork().getPosition(i,e,null,t,n);s?a={x:f.x*o,y:f.y*o,width:1,height:1}:a={x:f.x,y:f.y,width:1,height:1}}else s?(a=e.getZoomBodyRect(),a.x+=t,a.y+=n):(a=e.getBodyRect(),a.x+=t,a.y+=n);return a},getLinkSourceBounds:function(e,t){var n=e._element,r=e.getNetwork().getElementUI(n.getFromAgent());if(r==null)return null;var i=n.getStyle("link.from.position"),s=n.getStyle("link.from.xoffset"),o=n.getStyle("link.from.yoffset"),u=n.getStyle("link.from.at.edge");return Nr.getLinkNodeBounds(r,s,o,u,i,t)},getLinkTargetBounds:function(e,t){var n=e._element,r=e.getNetwork().getElementUI(n.getToAgent());if(r==null)return null;var i=n.getStyle("link.to.position"),s=n.getStyle("link.to.xoffset"),o=n.getStyle("link.to.yoffset"),u=n.getStyle("link.to.at.edge");return Nr.getLinkNodeBounds(r,s,o,u,i,t)},orthogonalAndFlexional:function(e,t,n){var r=Nr.getLinkSourceBounds(e,n);if(r==null)return null;var i=Nr.getLinkTargetBounds(e,n);if(i==null)return null;var s=Nr.calculateOrthogonalAndFlexionalLinkPoints(t,r,i,e._element);return Nr.offsetLink(e,s),e.setHotSpot(Nr.calculateCenterPoint(s)),t!=="flexional"&&Nr.drawCorner(s,e._element),s},offsetLink:function(e,t){var n=e._element,i=n.isBundleAgent();if(i)return;var s=Nr.getBundleGap(e,!1);if(s===0)return;var o,u,a=!1,f=!1,l=t.get(0),c=r.clone(l);for(var h=1,p=t.size();h<p;h++){var d=t.get(h),v=d.x-c.x,m=d.y-c.y;c=r.clone(d),u=Nr.calculateAngle(v,m);if(v===0)(u-o)%Math.PI===0&&(u-o)%(2*Math.PI)!==0&&(a=!a,a&&(m=-m)),(u-o)%Math.PI!==0&&(l.x+=m<0?s:-s),d.x+=m<0?s:-s;else if(m===0){(u-o)%Math.PI===0&&(u-o)%(2*Math.PI)!==0&&(f=!f,f&&(v=-v));if(!o||(u-o)%Math.PI!==0)l.y-=v<0?s:-s;d.y-=v<0?s:-s}o=u,l=d}},_getPointAngleDegree:function(e,t,n,r){var i=n-e,s=r-t,o=Math.atan2(s,i);return o=o/Math.PI*180,o=parseInt(o)+180,o%=360,o}};r.link=Nr;var Cr={findMoveToBottomDatas:function(e,t,n){for(var r=0;r<n.size();r++){var i=n.get(r);e.contains(i)&&t.add(i)}for(r=0;r<n.size();r++)i=n.get(r),Cr.findMoveToBottomDatas(e,t,i.getChildren())},findMoveToTopDatas:function(e,t,n){for(var r=0;r<n.size();r++){var i=n.get(n.size()-1-r);e.contains(i)&&t.add(i)}for(r=0;r<n.size();r++)i=n.get(r),Cr.findMoveToTopDatas(e,t,i.getChildren())},findMoveUpDatas:function(e,t,n){var r=!1;for(var i=0;i<n.size();i++){var s=n.get(i);e.contains(s)?r&&t.add(s):r=!0}for(i=0;i<n.size();i++)s=n.get(i),Cr.findMoveUpDatas(e,t,s.getChildren())},findMoveDownDatas:function(e,t,n){var r=!1;for(var i=0;i<n.size();i++){var s=n.get(n.size()-1-i);e.contains(s)?r&&t.add(s):r=!0}for(i=0;i<n.size();i++)s=n.get(i),Cr.findMoveDownDatas(e,t,s.getChildren())},doLayout:function(e,t){t=t||{},t.type=t.type||"round",t.animate=t.animate||!0,t.elements=t.elements||new n.List,t.repulsion=t.repulsion||1,t.expandGroup=t.expandGroup||!1;var r=new n.layout.AutoLayouter(e.getElementBox());r.getElements=function(){}}};r.box=Cr;var kr={scrollLeft:function(){return kr._filterResults(e.pageXOffset?e.pageXOffset:0,l.documentElement?l.documentElement.scrollLeft:0,l.body?l.body.scrollLeft:0)},scrollTop:function(){return kr._filterResults(e.pageYOffset?e.pageYOffset:0,l.documentElement?l.documentElement.scrollTop:0,l.body?l.body.scrollTop:0)},_filterResults:function(e,t,n){var r=e?e:0;return t&&(!r||r>t)&&(r=t),n&&(!r||r>n)?n:r},isSingleTouch:function(e){return e.touches&&e.touches.length==1},isMultiTouch:function(e){return e.touches&&e.touches.length>1},getDistance:function(e){if(!kr.isMultiTouch(e))return 0;var t=e.touches[0],n=e.touches[1];return Math.sqrt(Math.pow(t.clientX-n.clientX,2)+Math.pow(t.clientY-n.clientY,2))},getCenterLocation:function(e){if(!kr.isMultiTouch(e))return 0;var t=e.touches[0],n=e.touches[1];return{x:(t.clientX+n.clientX)/2,y:(t.clientY+n.clientY)/2}}};r.touch=kr;var Lr={_string:function(e,t,n,i){var s=n._stringPool.get();s.style.whiteSpace="nowrap",s.style.verticalAlign="middle",s.style.padding="0px 2px",r.setText(s,e,i),s.setAttribute("title",e),t.appendChild(s)},_boolean:function(e,t,n){var r=n._booleanPool.get();t._editInfo?(r._editInfo=t._editInfo,delete t._editInfo,r.disabled=!1):r.disabled=!0,r.keepDefault=!0,r.type="checkbox",r.style.margin="0px 2px",r.style.verticalAlign="middle",r.checked=e,t.appendChild(r),t.style.textAlign===""&&(t.style.textAlign="center")},_color:function(e,t,n){var r=n._colorPool.get();r.style.width="100%",r.style.height="100%",r.style.backgroundColor=e,r.setAttribute("title",e),t.appendChild(r)},_listPoints:function(e,t,n,i){var s=n._stringPool.get();s.style.whiteSpace="nowrap",s.style.verticalAlign="middle",s.style.padding="0px 2px";var o=e._as||e,u="";o.forEach(function(e,t){u+=t==o.length-1?"["+e.x+","+e.y+"]":"["+e.x+","+e.y+"],"}),e=u,r.setText(s,e,i),s.setAttribute("title",e),t.appendChild(s)},render:function(e,t,r,i,s){if(t==null)return;var o=Lr["_"+e];o?o(t,r,i,s):typeof t=="boolean"?Lr._boolean(t,r,i,s):t instanceof n.List?Lr._listPoints(t,r,i,s):Lr._string(t,r,i,s)}};r.render=Lr;var Ar={toolTipDiv:null,getToolTipDiv:function(){if(!Ar.toolTipDiv){Ar.toolTipDiv=l.createElement("div");var e=$i,t=Ar.toolTipDiv.style;t.position="absolute",t.color=e.TOOLTIP_COLOR,t.background=e.TOOLTIP_BACKGROUND,t.fontSize=e.TOOLTIP_FONT_SIZE,t.padding=e.TOOLTIP_PADDING,t.border=e.TOOLTIP_BORDER,t.borderRadius=e.TOOLTIP_BORDER_RADIUS,t.boxShadow=e.TOOLTIP_BOX_SHADOW,t.zIndex=e.TOOLTIP_ZINDEX,t.setProperty&&t.setProperty("-webkit-box-shadow",e.TOOLTIP_BOX_SHADOW,null)}return Ar.toolTipDiv},isToolTipVisible:function(){return Ar.getToolTipDiv().parentNode?!0:!1},hideToolTip:function(){Ar._clearTimeout(),Ar._clearDismiss();if(!Ar.isToolTipVisible())return;var e=Ar.getToolTipDiv();e.parentNode&&e.parentNode.removeChild(e)},showToolTip:function(e,t,n){if(!e||!t){Ar.hideToolTip();return}Ar.isToolTipVisible()||Ar._reshow_timeout?Ar._showToolTip(e,t,n):(Ar._clearTimeout(),Ar._show_timeout=setTimeout(function(){Ar._showToolTip(e,t,n)},$i.TOOLTIP_INITIAL_DELAY))},_showToolTip:function(e,t,n){var r,i,s;e.target?(r=e.clientX,i=e.clientY):(r=e.x,i=e.y),s=Ar.getToolTipDiv(),b.clear(s);if(t instanceof Element){var o=t.cloneNode(!0);s.appendChild(o)}else s.innerHTML=t;s.style.left=r+$i.TOOLTIP_XOFFSET+"px",s.style.top=i+$i.TOOLTIP_YOFFSET+"px",s.parentNode||l.body.appendChild(s),n&&n(s),Ar._clearDismiss(),Ar._dismiss_timeout=setTimeout(Ar.hideToolTip,$i.TOOLTIP_DISMISS_DELAY),Ar._clearReshow(),Ar._reshow_timeout=setTimeout(Ar._clearReshow,$i.TOOLTIP_RESHOW_DELAY)},_clearDismiss:function(){Ar._dismiss_timeout&&(clearTimeout(Ar._dismiss_timeout),Ar._dismiss_timeout=null)},_clearReshow:function(){Ar._reshow_timeout&&(clearTimeout(Ar._reshow_timeout),Ar._reshow_timeout=null)},_clearTimeout:function(){Ar._show_timeout&&(clearTimeout(Ar._show_timeout),Ar._show_timeout=null)},resetToolTip:function(){Ar.hideToolTip(),Ar.toolTipDiv=null}};r.popup=Ar;var Or={handleClicked:function(e,t,n){if(e.isSelectingElement())return;if(!h.isTouchable&&t.button!==0)return;if(n){var r=Mr(n);r&&r.onClick&&r.onClick(n,e),e.onClickElement(n,t),e.fireInteractionEvent({kind:"clickElement",event:t,element:n})}else e.onClickBackground(t),e.fireInteractionEvent({kind:"clickBackground",event:t})},handleDoubleClicked:function(e,t,i){if(!h.isTouchable&&t.button!==0)return;if(e.isEditingElement())return;if(i){var s=Mr(i);s&&s.onDoubleClick&&s.onDoubleClick(i,e),e.onDoubleClickElement(i,t),e.fireInteractionEvent({kind:"doubleClickElement",event:t,element:i})}else e.onDoubleClickBackground(t),e.fireInteractionEvent({kind:"doubleClickBackground",event:t});i?i instanceof n.Link&&e.isDoubleClickToLinkBundle()?i.ISubNetwork&&e.isDoubleClickToSubNetwork()&&!r.isCtrlDown(t)?(e.isDoubleClickToEmptySubNetwork()||i.getChildrenSize()>0)&&e.setCurrentSubNetwork(i,e.isSubNetworkAnimate(),function(){e.fireInteractionEvent({kind:"enterSubNetwork",event:t,element:i})}):i.reverseBundleExpanded()&&e.fireInteractionEvent({kind:"bundleLink",event:t,element:i}):i.ISubNetwork&&e.isDoubleClickToSubNetwork()?(e.isDoubleClickToEmptySubNetwork()||i.getChildrenSize()>0)&&e.setCurrentSubNetwork(i,e.isSubNetworkAnimate(),function(){e.fireInteractionEvent({kind:"enterSubNetwork",event:t,element:i})}):i instanceof ns&&e.isDoubleClickToGroupExpand()&&(i.reverseExpanded(),e.fireInteractionEvent({kind:"expandGroup",event:t,element:i})):e.isDoubleClickToUpSubNetwork()&&e.upSubNetwork(e.isSubNetworkAnimate(),function(){e.fireInteractionEvent({kind:"upSubNetwork",event:t})})},handleKeyDown:function(e,t){r.isCtrlDown(t)&&t.keyCode==65?(e.isKeyboardSelectEnabled()&&e.selectAll().size()>0&&e.fireInteractionEvent({kind:"selectAll"}),b.preventDefault(t)):t.keyCode==46?(e.isKeyboardRemoveEnabled()&&e.removeSelection()&&e.fireInteractionEvent({kind:"removeElement"}),b.preventDefault(t)):r.showVersion(t)},handleLongClicked:function(e,t,n){if(!h.isTouchable&&t.button!==0)return;if(n){var r=Mr(n);r&&r.onLongClick&&r.onLongClick(n,e),e.onLongClickElement(n,t),e.fireInteractionEvent({kind:"longClickElement",event:t,element:n})}else e.onLongClickBackground(t),e.fireInteractionEvent({kind:"longClickBackground",event:t})}},Mr=function(e){if(e&&e._image){if(typeof e._image=="object")return e._image;var t=r.getImageAsset(e._image);if(t)return t._image}return null};r.interaction=Or;var _r=function(e){return e.trim()[0].match(/[mlhvcsqta]/i)?Fr(e):Pr(e)},Dr={},Pr=function(e){var t=Dr[e];return t?t:(Dr[e]=t=[],e.trim().split(" ").forEach(function(e){e=e.split(","),e.length===2?t.push({x:parseFloat(e[0]),y:parseFloat(e[1])}):t.push(e[0])}),t)},Hr={},Br=/[mlhvcsqtaz][\d.,\-\s]*/gi,jr=/-?(\d)+(\.(\d)+)?/g,Fr=function(e){var t=Hr[e],n;return t?t:(n=e.trim().match(Br),Hr[e]=t=[],n&&n.forEach(function(e){var n=e[0],r=e.match(jr),i=r&&r.length,s;t.push(e={c:n});if(i){r.forEach(function(e,t){r[t]=parseFloat(e)});switch(n){case"M":case"m":case"L":case"l":for(s=0;s<i;s+=2)s!==0&&t.push(e={c:n==="M"||n==="L"?"L":"l"}),e.x=r[s],e.y=r[s+1];break;case"H":case"h":for(s=0;s<i;s++)s!==0&&t.push(e={c:n}),e.x=r[s];break;case"V":case"v":for(s=0;s<i;s++)s!==0&&t.push(e={c:n}),e.y=r[s];break;case"C":case"c":for(s=0;s<i;s+=6)s!==0&&t.push(e={c:n}),e.x1=r[s],e.y1=r[s+1],e.x2=r[s+2],e.y2=r[s+3],e.x=r[s+4],e.y=r[s+5];break;case"S":case"s":for(s=0;s<i;s+=4)s!==0&&t.push(e={c:n}),e.x2=r[s],e.y2=r[s+1],e.x=r[s+2],e.y=r[s+3];break;case"Q":case"q":for(s=0;s<i;s+=4)s!==0&&t.push(e={c:n}),e.x1=r[s],e.y1=r[s+1],e.x=r[s+2],e.y=r[s+3];break;case"T":case"t":for(s=0;s<i;s+=2)s!==0&&t.push(e={c:n}),e.x=r[s],e.y=r[s+1]}}}),t)},Ir=function(e,t){var n=e.transform&&qr(e.transform),r,i,s,o,u,a,f,l,c,h,p,v;return n&&n.length&&(r=d.identity(),n.forEach(function(e){var t=e[0];t==="matrix"?r.multiply(new d(e[1],e[2],e[3],e[4],e[5],e[6])):t==="translate"?r.translate(e[1]||0,e[2]||0):t==="scale"?r.scale(e[1]||1,e[2]||e[1]||1):t==="rotate"?r.rotate(e[1]||0,e[2]||0,e[3]||0):t==="skewX"?r.skew(e[1]||0,0):t==="skewY"&&r.skew(0,e[1]||0)})),e.type==="linear"?(o=e.x1||0,u=e.y1||0,a=e.x2||0,f=e.y2||0,r&&(i=r.transform(o,u),o=i.x,u=i.y,i=r.transform(a,f),a=i.x,f=i.y),s=t.createLinearGradient(o,u,a,f)):e.type==="radial"&&(l=e.fx||0,c=e.fy||0,h=e.cx||0,p=e.cy||0,v=e.r||0,e.fx==null&&(l=h),e.fy==null&&(c=p),r&&(i=r.transform(l,c),l=i.x,c=i.y,i=r.transform(h,p),h=i.x,p=i.y,v=Math.max(r._m11,r._m22)*v),s=t.createRadialGradient(l,c,0,h,p,v)),s&&e.stop&&e.stop.length&&e.stop.forEach(function(e){s.addColorStop(parseFloat(e.offset),Bi(e.color,t._color))}),s},qr=function(e){return e.replace(/[\s\r\t\n]+/gm," ").trim().replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/).map(function(e){return e.replace(")","").trim().split(/\s*\(\s*|\s+,?\s*|,\s*/).map(function(e,t){return t===0?e:parseFloat(e)})})},Rr=n.Util.drawImage=function(e,t,n,i,s,o,u){var a,f,l,c,h=1;typeof t!="object"&&(f=t,a=r.images[t],t=a&&a.getImage()),si(t)?e.drawImage(a?a.getImage(n,i.width,i.height):t,i.x,i.y,i.width,i.height):t&&typeof t=="object"&&(e._data=s,e._view=o,f?(l=i.width/(t.w&&Zr(s,t,t,"w")||s.getWidth()),c=i.height/(t.h&&Zr(s,t,t,"h")||s.getHeight()),o&&(o.getSizeZoom?h=o.getSizeZoom()*o.getGraphicsZoom():h=o.getZoom()),!a._cache||Math.max(l*h,c*h)>1?Ur(e,t,n,i,s,o,u):e.drawImage(n?a.getImage(n,i.width,i.height):a._cache,i.x,i.y,i.width,i.height)):Ur(e,t,n,i,s,o,u),e._data=null,e._view=null)},Ur=function(e,t,n,r,i,s,o){var u=i&&i.getStyle("image.state"),a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;m=e._vector,x=e._color,g=e._fill,y=e._pattern,b=e._lineWidth,w=e._alpha,E=e._sx,S=e._sy,p=t;if(Zr(i,p,p,"visible",s)===!1)return;e._color=n,a=Zr(i,p,p,"v",s),f=a&&a.length,N=p.w&&Zr(i,p,p,"w")||i.getWidth(),C=p.h&&Zr(i,p,p,"h")||i.getHeight(),d=r.width/N,v=r.height/C,o===!0?(e._fill=null,e._pattern=null,e._lineWidth=null,e._alpha=null):(e._sx=d,e._sy=v),e.save(),e.translate(r.x+r.width/2,r.y+r.height/2),(d!==1||v!==1)&&e.scale(d,v),p.origin&&e.translate((p.origin.x-.5)*N,(p.origin.y-.5)*C),e._vector=p,p.clip&&(e.beginPath(),p.clip===!0?e.rect(-(p.origin?p.origin.x:.5)*N,-(p.origin?p.origin.y:.5)*C,N,C):p.clip.length?p.clip.forEach(function(t){e.drawShape(t)}):e.drawShape(p.clip),e.clip()),Jr(i,p,p,e,s);for(l=0,f=a.length;l<f;l++)h=a[l],e._shapeData=h,s&&(s._shapeDataIndex=l,h.animate&&ci(h,p,i,s)),T=Zr(i,p,h,"state",s),Zr(i,p,h,"visible",s)!==!1&&(!T||(Array.isArray(T)?T.indexOf(u)>=0:T===u))&&(c=Wr[h.shape],c&&(e.save(),h.shape==="vector"||h.shape==="g"?c(e,h,i,s):Jr(i,p,h,e,s,function(){c(e,h,i,s)}),e.restore())),s&&(s._shapeDataIndex=null),e._shapeData=null;e.restore(),e._vector=m,e._shapeData=null,e._color=x,e._fill=g,e._pattern=y,e._lineWidth=b,e._alpha=w,e._sx=E,e._sy=S},zr=function(t,n,i,s,o){var u,a,f,l,c,h,p,d,v,m=t._vector,g=m.origin,y=m.w&&Zr(s,m,m,"w")||s.getWidth(),b=m.h&&Zr(s,m,m,"h")||s.getHeight();typeof n=="string"?(v=r.images[n],v&&(f=v.getWidth(),l=v.getHeight())):(f=n.w&&Zr(s,n,n,"w"),l=n.h&&Zr(s,n,n,"h"));if(!f||!l||!i)return;c=i.w/f*t._sx,h=i.h/l*t._sy,u=i.x-y/2*(t._sx-1),a=i.y-b/2*(t._sy-1),g&&(u-=(g.x-.5)*y*(t._sx-1),a-=(g.y-.5)*b*(t._sy-1));if(t._sx!==1||t._sy!==1)t.scale(1/t._sx,1/t._sy),u+=((g?g.x:.5)*y+i.x)*(t._sx-1),a+=((g?g.x:.5)*b+i.y)*(t._sy-1);i={x:0,y:0,width:f,height:l};for(p=0;p<c;p++)for(d=0;d<h;d++)i.x=p*f+u,i.y=d*l+a,Rr(t,n,null,i,s,o,!0)},Wr={line:function(e,t,n,r){var i=Zr(n,e._vector,t,"p1",r),s=Zr(n,e._vector,t,"p2",r),o,u,a,f;i?(o=ei(i.length?i[0]:i.x,e),u=ti(i.length?i[1]:i.y,e)):(o=Zr(n,e._vector,t,"x1",r,!0),u=Zr(n,e._vector,t,"y1",r,!1)),s?(a=ei(s.length?s[0]:s.x,e),f=ti(s.length?s[1]:s.y,e)):(a=Zr(n,e._vector,t,"x2",r,!0),f=Zr(n,e._vector,t,"y2",r,!1)),e.moveTo(o,u),e.lineTo(a,f)},rect:function(e,t,n,r){var i=Zr(n,e._vector,t,"rect",r),s=Zr(n,e._vector,t,"r",r),o,u,a,f;i?(Array.isArray(i)?(o=i[0],u=i[1],a=i[2],f=i[3]):(o=i.x,u=i.y,a=i.w,f=i.h),o=ei(o,e),u=ti(u,e),a=ei(a,e),f=ti(f,e)):(o=Zr(n,e._vector,t,"x",r,!0),u=Zr(n,e._vector,t,"y",r,!1),a=Zr(n,e._vector,t,"w",r,!0),f=Zr(n,e._vector,t,"h",r,!1)),e.drawRoundRect(o,u,a,f,s);if(e._gradientFunc||e._pattern)e._rect={x:o,y:u,w:a,h:f}},circle:function(e,t,n,r){var i=Zr(n,e._vector,t,"cx",r,!0),s=Zr(n,e._vector,t,"cy",r,!1),o=e._vector.w&&Zr(n,e._vector,e._vector,"w")||n.getWidth(),u=e._vector.h&&Zr(n,e._vector,e._vector,"h")||n.getHeight(),a=ni(Zr(n,e._vector,t,"r",r),Math.min(o,u),t,e._vector),f=Zr(n,e._vector,t,"startAngle",r),l=Zr(n,e._vector,t,"endAngle",r),c=Zr(n,e._vector,t,"anticlockwise",r),h=Zr(n,e._vector,t,"close",r);f==null&&(f=0),l==null&&(l=360),c==null&&(c=!1),h&&e.moveTo(i,s),e.arc(i,s,a,f/180*Math.PI,l/180*Math.PI,c),h&&e.closePath();if(e._gradientFunc||e._pattern)e._rect={x:i-a,y:s-a,w:a*2,h:a*2}},ellipse:function(e,t,n,r){var i=Zr(n,e._vector,t,"cx",r,!0),s=Zr(n,e._vector,t,"cy",r,!1),o=Zr(n,e._vector,t,"rx",r,!0),u=Zr(n,e._vector,t,"ry",r,!1),a=Zr(n,e._vector,t,"startAngle",r),f=Zr(n,e._vector,t,"endAngle",r),l=Zr(n,e._vector,t,"anticlockwise",r),c=Zr(n,e._vector,t,"close",r);a==null&&(a=0),f==null&&(f=360),l==null&&(l=!1),c&&e.moveTo(i,s),e.ellipse(i,s,o,u,0,a/180*Math.PI,f/180*Math.PI,l),c&&e.closePath();if(e._gradientFunc||e._pattern)e._rect={x:i-o,y:s-u,w:o*2,h:u*2}},path:function(e,t,n,r){var i=Zr(n,e._vector,t,"data",r);e.drawPath(i)},text:function(e,t,n,r){var i=Zr(n,e._vector,t,"text",r),s=Zr(n,e._vector,t,"x",r,!0),o=Zr(n,e._vector,t,"y",r,!1),u=Zr(n,e._vector,t,"w",r,!0);if(i==null)return;i=String(i);var a=i.split("\n"),f=e.measureText("e").width*2,l=Xr(e,i,u);o-=(l.h/f-1)/2*f,a.forEach(function(t){if(u){var n=t.split(" "),r=n.length,i="",a,l,c,h,p;for(c=0;c<r;c++){a=n[c]+(c===r-1?"":" "),l=i+a,h=e.measureText(l).width;if(h<u)i=l;else if(h==u)e.fillText(i,s,o),i="",o+=f;else{for(p=0;p<a.length;p++){l=i+a.substr(0,p+1);if(e.measureText(l).width>u){e.fillText(l.substring(0,l.length-1),s,o),i=a.substring(p,a.length),o+=f;break}}while(i.length>0&&e.measureText(i).width>u)for(p=0;p<i.length;p++){l=i.substr(0,p+1);if(e.measureText(l).width>u){e.fillText(i.substr(0,p),s,o),i=i.substring(p,i.length),o+=f;break}}}}e.fillText(i,s,o)}else e.fillText(t,s,o);o+=f})},draw:function(e,t,r,i){var s=t.draw,o,u;typeof s=="string"&&((o=s.match(Gr))?(u="with(data) { "+
o[1]+" }",s=n.Util.newFunction("g","data","view",u)):s=oi[s]),typeof s=="function"&&s.call(e._vector,e,r,i)},vector:function(e,t,n,i){var s=e._vector,o=Zr(n,s,t,"name",i),u=Zr(n,s,t,"x",i,!0),a=Zr(n,s,t,"y",i,!1),f=Zr(n,s,t,"w",i),l=Zr(n,s,t,"h",i),c,h,p,d,v,m,g,y,b,w,E,S,x;typeof o=="string"?(y=r.images[o],g=y&&y._image):g=o;if(g)if(si(g))f!=null&&l!=null?e.drawImage(g,u,a,ei(f,e),ti(l,e)):e.drawImage(g,u,a);else{b=Zr(n,g,g,"v",i),w=b&&b.length,E=g.w&&Zr(n,g,g,"w"),S=g.h&&Zr(n,g,g,"h"),f!=null&&l!=null?(f=ei(f,e),l=ti(l,e)):(f=E,l=S),e.save(),d=e._lineWidth,v=e._fill,m=e._alpha,Jr(n,g,g,e,i),Jr(n,s,t,e,i),e.translate(u,a),e.scale(f/E,l/S),g.origin&&e.translate((g.origin.x-.5)*E,(g.origin.y-.5)*S),g.clip&&(e.beginPath(),g.clip===!0?e.rect(-(g.origin?g.origin.x:.5)*E,-(g.origin?g.origin.y:.5)*S,E,S):g.clip.length?g.clip.forEach(function(t){e.drawShape(t)}):e.drawShape(g.clip),e.clip()),x=e._shapeData,e._vector=g;for(c=0;c<w;c++)h=b[c],e._shapeData=h,i&&(i._shapeDataIndex.length?i._shapeDataIndex.push(c):i._shapeDataIndex=[i._shapeDataIndex,c],h.animate&&ci(h,s,n,i)),Zr(n,g,h,"visible",i)!==!1&&(p=Wr[h.shape],p&&(e.save(),h.shape==="vector"||h.shape==="g"?p(e,h,n,i):Jr(n,g,h,e,i,function(){p(e,h,n,i)}),e.restore())),i&&i._shapeDataIndex.pop();e._vector=s,e._shapeData=x,e._lineWidth=d,e._fill=v,e._alpha=m,e.restore()}},g:function(e,t,n,r){var i=Zr(n,e._vector,t,"v",r),s,o,u,a,f;i&&i.length&&(e.save(),o=e._lineWidth,u=e._fill,a=e._alpha,f=e._shapeData,Jr(n,e._vector,t,e,r),i.forEach(function(t){Zr(n,e._vector,t,"visible",r)!==!1&&(s=Wr[t.shape],s&&(e.save(),e._shapeData=t,t.shape==="vector"||t.shape==="g"?s(e,t,n,r):Jr(n,e._vector,t,e,r,function(){s(e,t,n,r)}),e.restore()))}),e._lineWidth=o,e._fill=u,e._alpha=a,e._shapeData=f,e.restore())}};Wr.image=Wr.vector;var Vr=Object.keys(Wr),$r={M:function(e,t){return e.moveTo(t.x,t.y),e._path_start=t,e._rect&&ii(e._rect,t.x,t.y),t},m:function(e,t,n){return n&&(t={x:n.x+t.x,y:n.y+t.y}),e.moveTo(t.x,t.y),e._path_start=t,e._rect&&ii(e._rect,t.x,t.y),t},Z:function(e){return e.closePath(),e._path_start},z:function(e){return e.closePath(),e._path_start},L:function(e,t){return e.lineTo(t.x,t.y),e._rect&&ii(e._rect,t.x,t.y),t},l:function(e,t,n){var r={x:n.x+t.x,y:n.y+t.y};return e.lineTo(r.x,r.y),e._rect&&ii(e._rect,r.x,r.y),r},H:function(e,t,n){var r={x:t.x,y:n.y};return e.lineTo(r.x,r.y),e._rect&&ii(e._rect,r.x,r.y),r},h:function(e,t,n){var r={x:n.x+t.x,y:n.y};return e.lineTo(r.x,r.y),e._rect&&ii(e._rect,r.x,r.y),r},V:function(e,t,n){var r={x:n.x,y:t.y};return e.lineTo(r.x,r.y),e._rect&&ii(e._rect,r.x,r.y),r},v:function(e,t,n){var r={x:n.x,y:n.y+t.y};return e.lineTo(r.x,r.y),e._rect&&ii(e._rect,r.x,r.y),r},Q:function(e,t){return e._preQ_x=t.x1,e._preQ_y=t.y1,e.quadraticCurveTo(t.x1,t.y1,t.x,t.y),e._rect&&(ii(e._rect,t.x1,t.y1),ii(e._rect,t.x,t.y)),t},q:function(e,t,n){var r={x:n.x+t.x,y:n.y+t.y},i=e._preQ_x=n.x+t.x1,s=e._preQ_y=n.y+t.y1;return e.quadraticCurveTo(i,s,r.x,r.y),e._rect&&(ii(e._rect,i,s),ii(e._rect,r.x,r.y)),r},T:function(e,t,n){var r=e._preQ_x=2*n.x-e._preQ_x,i=e._preQ_y=2*n.y-e._preQ_y;return e.quadraticCurveTo(r,i,t.x,t.y),e._rect&&(ii(e._rect,r,i),ii(e._rect,t.x,t.y)),t},t:function(e,t,n){var r={x:n.x+t.x,y:n.y+t.y},i=e._preQ_x=2*n.x-e._preQ_x,s=e._preQ_y=2*n.y-e._preQ_y;return e.quadraticCurveTo(i,s,r.x,r.y),e._rect&&(ii(e._rect,i,s),ii(e._rect,r.x,r.y)),r},C:function(e,t){return e._preC_x=t.x2,e._preC_y=t.y2,e.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y),e._rect&&(ii(e._rect,t.x1,t.y1),ii(e._rect,t.x2,t.y2),ii(e._rect,t.x,t.y)),t},c:function(e,t,n){var r={x:n.x+t.x,y:n.y+t.y},i=n.x+t.x1,s=n.y+t.y1,o=e._preC_x=n.x+t.x2,u=e._preC_y=n.y+t.y2;return e.bezierCurveTo(i,s,o,u,r.x,r.y),e._rect&&(ii(e._rect,i,s),ii(e._rect,o,u),ii(e._rect,r.x,r.y)),r},S:function(e,t,n){var r=2*n.x-e._preC_x,i=2*n.y-e._preC_y;return e._preC_x=t.x2,e._preC_y=t.y2,e.bezierCurveTo(r,i,t.x2,t.y2,t.x,t.y),e._rect&&(ii(e._rect,r,i),ii(e._rect,t.x2,t.y2),ii(e._rect,t.x,t.y)),t},s:function(e,t,n){var r={x:n.x+t.x,y:n.y+t.y},i=2*n.x-e._preC_x,s=2*n.y-e._preC_y,o=e._preC_x=n.x+t.x2,u=e._preC_y=n.y+t.y2;return e.bezierCurveTo(i,s,o,u,r.x,r.y),e._rect&&(ii(e._rect,i,s),ii(e._rect,o,u),ii(e._rect,r.x,r.y)),r}},Jr=function(e,t,n,r,i,s){var o=Zr(e,t,n,"line",i),u=Zr(e,t,n,"fill",i),a=Zr(e,t,n,"fillRule",i)||"nonzero",f=Zr(e,t,n,"gradient",i),l=Zr(e,t,n,"gradientColor",i),c=Zr(e,t,n,"pattern",i),h=Zr(e,t,n,"font",i),p=Zr(e,t,n,"textAlign",i)||"center",d=Zr(e,t,n,"textBaseline",i)||"middle",v=Zr(e,t,n,"translate",i),m=Zr(e,t,n,"rotate",i),g=Zr(e,t,n,"rotateOrigin",i),y=Zr(e,t,n,"scale",i),b=Zr(e,t,n,"transform",i),w=Zr(e,t,n,"alpha",i),S=r._lineWidth,x=r._fill,T=r._pattern,N=r._alpha,C=r._gradientFunc,k,L,A,O,M,_,D,P,H,B,j,F,I;o?(k=o.color,L=o.width,A=o.cap,O=o.join,M=o.miterLimit,_=o.dash,D=o.dashOffset):(k=Zr(e,t,n,"lineColor",i),L=Zr(e,t,n,"lineWidth",i),A=Zr(e,t,n,"lineCap",i),O=Zr(e,t,n,"lineJoin",i),M=Zr(e,t,n,"miterLimit",i),_=Zr(e,t,n,"lineDash",i),D=Zr(e,t,n,"lineDashOffset",i)),k!=null&&(r.strokeStyle=Bi(k,r._color)),L!=null&&(r.lineWidth=r._lineWidth=i&&i.getSizeZoom&&!i.zoomManager.sizeChange?L/i.getSizeZoom():L),A!=null&&(r.lineCap=A),O!=null&&(r.lineJoin=O),M!=null&&(r.miterLimit=M),_!=null&&(r.lineDash=_,r.setLineDash(_)),D!=null&&(r.lineDashOffset=D),c?r._pattern=c:(u&&(r.fillStyle=r._fill=Bi(u,r._color)),f&&(typeof f=="string"?H=E[f]:(H=E[f.type],f.color&&(l=f.color),H||(f=Ir(f,r))),r._gradientFunc=H)),h!=null&&(r.font=h),p!=null&&(r.textAlign=p),d!=null&&(r.textBaseline=d),Kr(e,t,n,r,i);if(b!=null)typeof b=="string"&&(b=qr(b)),b.length&&b.forEach(function(e){var t=e[0];t==="matrix"?r.transform(e[1],e[2],e[3],e[4],e[5],e[6]):t==="translate"?r.translate(e[1]||0,e[2]||0):t==="scale"?r.scale(e[1]||1,e[2]||e[1]||1):t==="rotate"?e.length>2?(r.translate(e[2],e[3]),r.rotate(e[1]),r.translate(-e[2],-e[3])):r.rotate(e[1]):t==="skewX"?r.transform(1,0,Math.tan(e[1]*Math.PI/180),1,0,0):t==="skewY"&&r.transform(1,Math.tan(e[1]*Math.PI/180),0,1,0,0)});else{v!=null&&(Array.isArray(v)?(F=v[0],I=v[1]):typeof v=="object"?(F=v.x,I=v.y):(F=v,I=0),F=ei(F,r),I=ti(I,r),(F!==0||I!==0)&&r.translate(F,I));if(m!=null&&m%360!==0){var q,R;g&&(Array.isArray(g)?(q=g[0],R=g[1]):typeof g=="object"?(q=g.x,R=g.y):q=R=g,q=ei(q,r),R=ti(R,r),(q!==0||R!==0)&&r.translate(q,R)),r.rotate(m*Math.PI/180),g&&(q!==0||R!==0)&&r.translate(-q,-R)}y!=null&&(Array.isArray(y)?(B=y[0],j=y[1]):typeof y=="object"?(B=y.x,j=y.y):B=j=y,(B!==1||j!==1)&&r.scale(B,j))}w!=null&&(r.globalAlpha=r._alpha=N!=null?N*w:w),s&&(r.beginPath(),s(),P=r._rect||n.rect,r._pattern?(r._lineWidth>0&&r.stroke(),r.clip(),zr(r,r._pattern,P,e,i)):(H&&P&&(f=H(r,Bi(u||"#000000",r._color),Bi(l||"#FFFFFF",r._color),P.x,P.y,P.w,P.h)),f&&(r.fillStyle=r._fill=f),r._fill&&r.fill(a),r._lineWidth>0&&r.stroke()),r._lineWidth=S,r._fill=x,r._pattern=T,r._alpha=N,r._gradientFunc=C,r._rect=null)},Kr=function(e,t,n,r,i){var s=Zr(e,t,n,"shadow",i),o,u,a,f;s?(o=s.offsetX,u=s.offsetY,a=s.blur,f=s.color):(o=Zr(e,t,n,"shadowOffsetX",i),u=Zr(e,t,n,"shadowOffsetY",i),a=Zr(e,t,n,"shadowBlur",i),f=Zr(e,t,n,"shadowColor",i)),o!=null&&(r.shadowOffsetX=o),u!=null&&(r.shadowOffsetY=u),a!=null&&(r.shadowBlur=a),f!=null&&(r.shadowColor=f)},Qr=/<%=([\s\S]+?)%>/,Gr=/<%([\s\S]+?)%>/,Yr=new RegExp([Qr.source,Gr.source].join("|")),Zr=function(e,r,i,s,o,u,a){var f=i[s],l=typeof f,c,h,p,d,v;l==="string"&&(c=f.match(Yr))?(h="with(data) { "+(c[1]?"return "+c[1]:c[2])+" }",p=n.Util.newFunction("data","view",h),f=p.call(r,e,o)):l==="function"&&(f=f.call(r,e,o)),u===!0?(d=r.w&&Zr(e,r,r,"w")||e.getWidth(),(i.rel===!0||i.rel===t&&r.rel)&&f<=1&&f>=-1?f*=d:typeof f=="string"&&(f=parseInt(f)/100*d),f=f||0):u===!1&&(v=r.h&&Zr(e,r,r,"h")||e.getHeight(),(i.rel===!0||i.rel===t&&r.rel)&&f<=1&&f>=-1?f*=v:typeof f=="string"&&(f=parseInt(f)/100*v),f=f||0);if(a!==!1&&o&&e&&i.animate&&e._animates){var m=e._animates,g=o._shapeDataIndex,y;if(g.length)for(var b=0;b<g.length;b++)y=g[b],m=m[y];else y=g;var w=m[y],E=w[s];if(E)if(Array.isArray(E))for(var b=E.length-1;b>=0;b--){var S=E[b];if(S.stopped||S.time>0)if(S.started)return xi(S,f)}else if(E.started)return xi(E,f)}return f},ei=function(e,n){if(!e)return 0;var r=n._vector.w&&Zr(n._data,n._vector,n._vector,"w")||n._data.getWidth();return(n._shapeData&&n._shapeData.rel===!0||(!n._shapeData||n._shapeData.rel===t)&&n._vector.rel)&&e<=1&&e>=-1?e*r:typeof e=="string"?parseInt(e)/100*r:e},ti=function(e,n){if(!e)return 0;var r=n._vector.h&&Zr(n._data,n._vector,n._vector,"h")||n._data.getHeight();return(n._shapeData&&n._shapeData.rel===!0||(!n._shapeData||n._shapeData.rel===t)&&n._vector.rel)&&e<=1&&e>=-1?e*r:typeof e=="string"?parseInt(e)/100*r:e},ni=function(e,n,r,i){return e?(r.rel===!0||r.rel===t&&i.rel)&&e<=1&&e>=-1?e*n:typeof e=="string"?parseInt(e)/100*n:e:0},ri=(e.CanvasRenderingContext2D||u.Context2d).prototype;ri.drawShape=function(e){var t=this,n=t._vector,r=t._shapeData,i=t._data,s=t._view,o=Wr[e.shape];o&&(t.save(),t._shapeData=e,e.shape==="vector"||e.shape==="g"?o(t,e,i,s):Jr(i,n,e,t,s,function(){o(t,e,i,s)}),t._shapeData=r,t.restore())},ri.drawPath=function(e){var t=this,n,r,i,s,o,u,a,f,l,c,h,p;typeof e=="string"&&(e=_r(e)),l=e?e.length:0;if(l<=1)return;if(t._gradientFunc||t._pattern)t._rect=c={x:0,y:0,w:0,h:0};n=e&&e[0]&&e[0].c,n||(r=e&&e[0]&&e[0].x!=null,i=e[l-1]==="z"||e[l-1]==="Z",i&&l--);if(n){for(s=0;s<l;s++)u=e[s],a=$r[u.c],a&&(o=a(t,u,o));t._path_start=null,t._preC_x=null,t._preC_y=null,t._preQ_x=null,t._preQ_y=null}else if(r){f=e[0],h=ei(f.x,t),p=ti(f.y,t),t.moveTo(h,p),c&&ii(c,h,p);for(s=1;s<l;s++)f=e[s],h=ei(f.x,t),p=ti(f.y,t),t.lineTo(h,p),c&&ii(c,h,p);i&&t.closePath()}else{h=ei(e[0],t),p=ti(e[1],t),t.moveTo(h,p),c&&ii(c,h,p);for(s=2;s<l;s+=2)h=ei(e[s],t),p=ti(e[s+1],t),t.lineTo(h,p),c&&ii(c,h,p);i&&t.closePath()}return e};var ii=function(e,t,n){var r=Math.min(e.x,t),i=Math.max(e.x+e.w,t),s=Math.min(e.y,n),o=Math.max(e.y+e.h,n);e.x=r,e.y=s,e.w=i-r,e.h=o-s};ri._fillPath=function(e,t){var n=this;n.beginPath(),n.fillStyle=e,n.drawPath(t),n.fill()},ri._fillRect=function(e,t,n,r,i){var s=this;s.beginPath(),s.fillStyle=e,s.rect(t,n,r,i),s.fill()},ri.ellipse||(ri.ellipse=function(e,t,n,r){var i=this,s=.5522848,o=n*s,u=r*s,a=e+n,f=t+r,l=e-n,c=t-r;i.moveTo(l,t),i.bezierCurveTo(l,t-u,e-o,c,e,c),i.bezierCurveTo(e+o,c,a,t-u,a,t),i.bezierCurveTo(a,t+u,e+o,f,e,f),i.bezierCurveTo(e-o,f,l,t+u,l,t)}),ri.drawRoundRect=function(e,t,n,r,i){var s=this;if(!i){s.rect(e,t,n,r);return}var o,u,a,f;if(Array.isArray(i))if(i.length===1)o=u=a=f=i[0];else if(i.length===2)o=u=i[0],a=f=i[1];else{if(i.length!==4){s.rect(e,t,n,r);return}o=i[0],u=i[1],a=i[2],f=i[3]}else o=u=a=f=i;var l=e+n,c=t+r,h=n<r?n*2:r*2;o=o<h?o:h,u=u<h?u:h,a=a<h?a:h,f=f<h?f:h;var p=f*.292893218813453,d=f*.585786437626905;s.moveTo(l,c-f),s.quadraticCurveTo(l,c-d,l-p,c-p),s.quadraticCurveTo(l-d,c,l-f,c),p=a*.292893218813453,d=a*.585786437626905,s.lineTo(e+a,c),s.quadraticCurveTo(e+d,c,e+p,c-p),s.quadraticCurveTo(e,c-d,e,c-a),p=o*.292893218813453,d=o*.585786437626905,s.lineTo(e,t+o),s.quadraticCurveTo(e,t+d,e+p,t+p),s.quadraticCurveTo(e+d,t,e+o,t),p=u*.292893218813453,d=u*.585786437626905,s.lineTo(l-u,t),s.quadraticCurveTo(l-d,t,l-p,t+p),s.quadraticCurveTo(l,t+d,l,t+u),s.lineTo(l,c-f)};var si=function(e){return u?e instanceof u||e instanceof c:e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement},oi={},ui=function(e){return oi[e]},ai=function(e,t){typeof t=="function"&&(oi[e]=t)},fi=function(e){return Wr[e]},li=function(e,t){typeof t=="function"&&Vr.indexOf(e)<0&&(Wr[e]=t)};(function(){var t=["webkit","moz"];for(var n=0;n<t.length&&!e.requestAnimationFrame;++n){var r=t[n];e.requestAnimationFrame=e[r+"RequestAnimationFrame"],e.cancelAnimationFrame=e[r+"CancelAnimationFrame"]||e[r+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(e.navigator.userAgent)||!e.requestAnimationFrame||!e.cancelAnimationFrame){var i=0;e.requestAnimationFrame=function(e){var t=Date.now(),n=Math.max(i+16,t);return setTimeout(function(){e(i=n)},n-t)},e.cancelAnimationFrame=clearTimeout}})();var pi=n.Animate=function(e){var t=this;t.type=e.type==null?"number":e.type,t.delay=e.delay==null?0:e.delay,t.dur=e.dur==null?1e3:e.dur,t.interval=e.interval==null?0:e.interval,t.finish=e.finish==null?t.delay+t.dur+t.interval:e.finish,e.finish==null?t.finish=t.delay+t.dur+t.interval:(t.finish=e.finish,t.interval=t.finish-t.delay-t.dur),t.repeat=e.repeat==null?1:e.repeat,t.reverse=e.reverse==null?!0:e.reverse,t.easing=e.easing==null?"easeNone":e.easing,t.onUpdate=e.onUpdate,t.onDone=e.onDone,t.onStop=e.onStop,t.onPlay=e.onPlay,t.attr=e.attr,t.source=e.source,t.filter=e.filter,t.from=e.from,t.to=e.to,t.start=null,t.time=0,t.total=0,t.count=0,t.started=!1,t.stopped=!1,t.paused=!1,t.pausedTime=null,t.pausedTotal=0,t._speed=1,t._oldSpeed=null,t._speedTotal=0,t._speedTime=null,t._percent=0,t._percentSet=null,t._percentDiff=0,t.id=Ni++};r.ext("twaver.Animate",Object,{play:function(){return di(this)},stop:function(e){return vi(this,e)},pause:function(){this.stopped||(this.paused=!0)},resume:function(){this.paused&&(this.paused=!1,Ci=!0)},isPaused:function(){return this.paused},percent:function(e){return e==null?this._percentSet||this._percent:(this._percentSet=e<0?0:e>100?100:e,this.paused&&(Ci=!0),this.started||(this.play(),this.pause()),this)},speed:function(e){return e==null?this._speed:(e=e<0?1:e,e!==this.speed&&(this.stopped||(this._oldSpeed=this._speed),this._speed=e),this)},clone:function(){return new pi(this)},chain:function(e){var t=this,n;return t.next=e,e.pre=t,t.onDone?(n=t.onDone,t.onDone=function(){n.call(t),e.play()}):t.onDone=function(){e.play()},t}});var Ti={},Ni=1,Ci=!1;(function ru(e){n.animateLoopId=requestAnimationFrame(ru),Ci&&(Ci=!1,bi(e))})(0);var ki={easeNone:function(e,t,n,r){return n*e/r+t},easeIn:function(e,t,n,r){return n*(e/=r)*e+t},easeOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeBoth:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},easeInStrong:function(e,t,n,r){return n*(e/=r)*e*e*e+t},easeOutStrong:function(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t},easeBothStrong:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t},elasticIn:function(e,t,n,r,i,s){var o;return e===0?t:(e/=r)===1?t+n:(s||(s=r*.3),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t)},elasticOut:function(e,t,n,r,i,s){var o;return e===0?t:(e/=r)===1?t+n:(s||(s=r*.3),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t)},elasticBoth:function(e,t,n,r,i,s){var o;return e===0?t:(e/=r/2)===2?t+n:(s||(s=r*.3*1.5),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),e<1?-0.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t:i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)*.5+n+t)},backIn:function(e,n,r,i,s){return s===t&&(s=1.70158),e===i&&(e-=.001),r*(e/=i)*e*((s+1)*e-s)+n},backOut:function(e,t,n,r,i){return typeof i=="undefined"&&(i=1.70158),n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},backBoth:function(e,t,n,r,i){return typeof i=="undefined"&&(i=5.70158),(e/=r/2)<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t},bounceIn:function(e,t,n,r){return n-ki.bounceOut(r-e,0,n,r)+t},bounceOut:function(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},bounceBoth:function(e,t,n,r){return e<r/2?ki.bounceIn(e*2,0,n,r)*.5+t:ki.bounceOut(e*2-r,0,n,r)*.5+n*.5+t}},Li={draw:function(e,t){var n=t.getCurrentSubNetwork()==null?t.getElementBox():t.getCurrentSubNetwork(),r=n.getStyle("background.type");r=="none",r=="image"?this.drawImage(e,n,t):r=="vector"?this.drawVector(e,n,t):r=="image.vector"?(this.drawImage(e,n,t),this.drawVector(e,n,t)):r=="vector.image"&&(this.drawVector(e,n,t),this.drawImage(e,n,t))},drawImage:function(e,t,n){var i=t.getStyle("background.image"),s=r.getImageAsset(i),o=n.getGraphicsZoom?n.getGraphicsZoom():n.getZoom();if(s==null)return;var u=t.getStyle("background.image.scope"),a=n.getScopeRect(u),f=n._dragToPan?0:-a.x/o,l=n._dragToPan?0:-a.y/o;if(u=="rootcanvas"||u=="viewport")a.x=f,a.y=l;u=="rootcanvas"&&(a.width=Math.max(s.getWidth(),a.width/o),a.height=Math.max(s.getHeight(),a.height/o)),t.getStyle("background.image.stretch")=="none"&&(a.width=s.getWidth(),a.height=s.getHeight());var c=t.getStyle("background.image.padding");c&&m.grow(a,c,c);if(t.getStyle("background.image.stretch")=="tile"){if(si(s.getImage()))for(var h=0;h<a.width;h+=s.getWidth())for(var p=0;p<a.height;p+=s.getHeight())e.drawImage(s.getImage(),h,p)}else(t.getStyle("background.image.stretch")=="fill"||t.getStyle("background.image.stretch")=="none")&&Rr(e,s.getImage(),null,a,t,n)},drawVector:function(e,t,n){var r=t.getStyle("background.vector.scope"),i=n.getScopeRect(r),s=n.getGraphicsZoom?n.getGraphicsZoom():n.getZoom(),o=n._dragToPan?0:-i.x/s,u=n._dragToPan?0:-i.y/s;if(r=="rootcanvas"||r=="viewport")i.x=o,i.y=u;r=="rootcanvas"&&(i.width=i.width/s,i.height=i.height/s);var a=t.getStyle("background.outline.width"),f=t.getStyle("background.outline.color"),l=t.getStyle("background.vector.fill"),c=t.getStyle("background.vector.fill.color"),h=t.getStyle("background.vector.padding"),p=t.getStyle("background.vector.shape"),d=t.getStyle("background.vector.pattern");h&&m.grow(i,h,h);var v=t.getStyle("background.vector.gradient");l&&(v?w.fill(e,c,v,t.getStyle("background.vector.gradient.color"),i):e.fillStyle=c,w.drawVector(e,p,d,i),e.fill()),a>0&&(e.lineWidth=a,e.strokeStyle=t.getStyle("background.outline.color"),w.drawVector(e,p,d,i),e.stroke())}},Ai=n.UndoManager=function(e){var t=this;t._list=[],t._cursor=-1,t._suspended=!1,t._dispatcher=new n.EventDispatcher,t._box=e,t._enabled=!1,t._limit=100};Ai._IGNORE_PROPERTIES={alarmState:1,propagateSeverity:1,enablePropagation:1,children:1,fromAgent:1,toAgent:1,bundleLinks:1},r.ext("twaver.UndoManager",Object,{setEnabled:function(e){var t=this,n=t._box;t._enabled!=e&&(e?(n.addDataBoxChangeListener(t._handleDataBoxChange,t,!0),n.addDataPropertyChangeListener(t._handleDataPropertyChange,t,!0)):(n.removeDataBoxChangeListener(t._handleDataBoxChange,t),n.removeDataPropertyChangeListener(t._handleDataPropertyChange,t))),t._enabled=e},isEnabled:function(){return this._enabled},undo:function(){var e=this,t=e._list,n,r,i;if(!e.canUndo())return;n=t[e._cursor--],e._suspended=!0;if(n.length)for(i=n.length,r=i-1;r>=0;r--)n[r].undo();else n.undo();e._suspended=!1,e._fire({kind:"undo",action:n})},redo:function(){var e=this,t=e._list,n;if(!e.canRedo())return;n=t[++e._cursor],e._suspended=!0,n.length?n.forEach(function(e){e.redo()}):n.redo(),e._suspended=!1,e._fire({kind:"redo",action:n})},canUndo:function(){return this._cursor>=0},canRedo:function(){return this._cursor<this._list.length-1},_add:function(e){var t=this,n=t._batch,r=t._list;n?n.push(e):(t._cursor!==r.length-1&&r.splice(t._cursor+1,r.length),t._limit!==0&&r.length===t._limit&&r.splice(0,1),r.push(e),t._cursor=r.length-1,t._fire({kind:"add",action:e}))},_handleDataBoxChange:function(e){if(this._suspended)return;var t=this,n=t._box,r=e.kind,i=e.data;r==="add"?t._add({undo:function(){var e=this;e.parent=i.getParent(),e.host=i.getHost&&i.getHost(),i.getFromNode&&(e.fromNode=i.getFromNode(),e.toNode=i.getToNode()),n.remove(i)},redo:function(){var e=this;e.parent&&i.setParent(e.parent),i.getHost&&e.host&&i.setHost(e.host),i.getFromNode&&(e.fromNode&&i.setFromNode(e.fromNode),e.toNode&&i.setToNode(e.toNode)),n.add(i)}}):r==="remove"&&t._add({undo:function(){n.add(i)},redo:function(){n.remove(i)}})},_handleDataPropertyChange:function(e){if(this._suspended)return;var t=this,n=e.property,i=n.substr(0,2),s=e.source,o=e.oldValue,u=e.newValue;i==="C:"?(n=n.substr(2),t._add({undo:function(){s.setClient(n,o)},redo:function(){s.setClient(n,u)}})):i==="S:"?(n=n.substr(2),t._add({undo:function(){s.setStyle(n,o)},redo:function(){s.setStyle(n,u)}})):Ai._IGNORE_PROPERTIES[n]||t._add({undo:function(){s[r.setter(n)](o)},redo:function(){s[r.setter(n)](u)}})},size:function(){return this._list.length},getCursor:function(){return this._cursor},_fire:function(e){this._dispatcher.fire(e)},on:function(e,t,n){this._dispatcher.add(e,t,n)},off:function(e,t){this._dispatcher.remove(e,t)},isSuspended:function(){return this._suspended},setSuspended:function(e){this._suspended=e},getLimit:function(){return this._limit},setLimit:function(e){var t=this,n=t._list,r,i;return e<0&&(e=0),e!==t._limit&&(r=n.length-e,e>0&&r>0&&(i=t._cursor+1,t._cursor-=r,t._cursor<-1&&(t._cursor=-1),i>0&&n.splice(0,i),r-=i,r>0&&n.splice(n.length-r,r)),t._limit=e,t._fire({kind:"change"})),t},clear:function(){var e=this;return e._list=[],e._cursor=-1,e._fire({kind:"clear"}),e},batch:function(e,t){var n=this;return n.startBatch(),e.call(t),n.endBatch(),n},startBatch:function(){var e=this;return e._batch||(e._batch=[]),e},endBatch:function(){var e=this,t;return e._batch&&(t=e._batch,e._batch=null,t.length&&e._add(t)),e}}),n.Pool=function(e,t){typeof e=="string"?this.func=function(){return l.createElement(e)}:this.func=e,this.tagName=e,t!=null&&(this.redundancy=t)},r.ext("twaver.Pool",Object,{redundancy:2,currentIndex:-1,get:function(){this.currentIndex++;if(this.currentIndex===this.size()){var e=this.func();return e._pool=this,e.style.margin="0px",e.style.padding="0px",this.list||(this.list=new Oi),this.list.add(e),e}return this.list.get(this.currentIndex)},release:function(e){this.list&&this.list.remove(e)>=0&&(delete e._selectData,delete e._expandData,delete e._checkData,delete e._editInfo,delete e.keepDefault,e.style.margin="0px",e.style.padding="0px",e.style.backgroundColor="",e.removeAttribute("title"),this.tagName==="img"&&e.removeAttribute&&(e.removeAttribute("width"),e.removeAttribute("height"),e.removeAttribute("src")),this.list.add(e),this.currentIndex--)},reset:function(){this.currentIndex=-1},clear:function(){if(this.list)while(this.redundancy+this.currentIndex<this.list.size()-1)delete this.list.removeAt(this.list.size()-1)._pool},size:function(){return this.list?this.list.size():0}});var Oi=function(){this._as=[];if(arguments.length===1){var e=arguments[0];e instanceof Oi&&(e=e._as);if(e instanceof Array){var t=e.length;for(var n=0;n<t;n++)this._as.push(e[n])}else e===!1?(this._duplicatable=!1,this._map={}):e!=null&&this._as.push(e)}else if(arguments.length>1){t=arguments.length;for(n=0;n<t;n++)this._as.push(arguments[n])}};n.List=Oi,r.ext("twaver.List",Object,{_duplicatable:!0,size:function(){return this._as.length},isEmpty:function(){return this._as.length===0},add:function(e,n){if(!this._duplicatable){if(this._map[e._id])return;this._map[e._id]=!0}return n===t?this._as.push(e):this._as.splice(n,0,e)},addAll:function(e){e instanceof Oi&&(e=e._as);if(e instanceof Array){var t=e.length;for(var n=0;n<t;n++)this.add(e[n])}else this.add(e)},get:function(e){return this._as[e]},remove:function(e){if(!this._duplicatable&&!this._map[e&&e._id])return-1;var t=this._as.indexOf(e);return t>=0&&t<this._as.length&&this.removeAt(t),t},removeAt:function(e){var t=this._as.splice(e,1)[0];return!this._duplicatable&&t&&delete this._map[t._id],t},set:function(e,t){var n=this._as[e];if(n===t)return t;if(!this._duplicatable){if(this._map[t._id])throw"duplicate item:"+t;delete this._map[n._id],this._map[t._id]=!0}return this._as[e]=t,n},clear:function(){return this._duplicatable||(this._map={}),this._as.splice(0,this._as.length)},contains:function(e){return this._duplicatable?this.indexOf(e)>=0:!!this._map[e&&e._id]},indexOf:function(e){return this._as.indexOf(e)},forEach:function(e,t){var n=this._as.length;for(var r=0;r<n;r++){var i=this._as[r];t?e.call(t,i):e(i)}},forEachReverse:function(e,t){var n=this._as.length;for(var r=n-1;r>=0;r--){var i=this._as[r];t?e.call(t,i):e(i)}},toArray:function(e,t){if(e){var n=[],r=this._as.length;for(var i=0;i<r;i++){var s=this._as[i];t?e.call(t,s)&&n.push(s):e(s)&&n.push(s)}return n}return this._as.concat()},toList:function(e,t){if(e){var n=new Oi,r=this._as.length;for(var i=0;i<r;i++){var s=this._as[i];t?e.call(t,s)&&n.add(s):e(s)&&n.add(s)}return n}return new Oi(this)},sort:function(e){return e?this._as.sort(e):this._as.sort(),this},toString:function(){return this._as.toString()}});var Mi={shapeMap:{},init:function(){Mi.register("arrow.standard",Mi.createStandardArrow()),Mi.register("arrow.delta",Mi.createDeltaArrow()),Mi.register("arrow.diamond",Mi.createDiamondArrow()),Mi.register("arrow.short",Mi.createShortArrow()),Mi.register("arrow.slant",Mi.createSlantArrow()),Mi.register("arrow.doubledelta",Mi.createDoubleDeltaArrow()),Mi.register("arrow.tee",Mi.createTeeArrow()),Mi.register("arrow.box",Mi.createBoxArrow()),Mi.register("arrow.dot",Mi.createDotArrow()),Mi.register("arrow.tail",Mi.createTailArrow())},createStandardArrow:function(){var e=new Oi;return e.add({x:-1,y:-5/9}),e.add({x:-0.75,y:0}),e.add({x:-1,y:5/9}),e.add({x:0,y:0}),e.add({x:-1,y:-5/9}),{points:e}},createDeltaArrow:function(){var e=new Oi;return e.add({x:-1,y:-5/9}),e.add({x:-1,y:5/9}),e.add({x:0,y:0}),e.add({x:-1,y:-5/9}),{points:e}},createDoubleDeltaArrow:function(){var e=new Oi;return e.add({x:-1,y:-5/9}),e.add({x:-1,y:5/9}),e.add({x:-0.5,y:0}),e.add({x:-0.5,y:-5/9}),e.add({x:0,y:0}),e.add({x:-0.5,y:5/9}),e.add({x:-0.5,y:0}),e.add({x:-1,y:-5/9}),{points:e}},createTeeArrow:function(){var e=new Oi;return e.add({x:-1/9,y:-5/9}),e.add({x:-1/9,y:5/9}),e.add({x:0,y:5/9}),e.add({x:0,y:-5/9}),e.add({x:-1/9,y:-5/9}),{points:e}},createBoxArrow:function(){var e=new Oi;return e.add({x:-10/9,y:-5/9}),e.add({x:-10/9,y:5/9}),e.add({x:0,y:5/9}),e.add({x:0,y:-5/9}),e.add({x:-10/9,y:-5/9}),{points:e}},createDotArrow:function(){var e={},t=new n.List;return t.add({x:-0.5,y:0}),e.points=t,e.draw=function(e,t){if(!e||!t||!t.points||t.points.size()<=0)return;var n=t.points._as,r=n[0],i=Math.min(t.width,t.height)/2;e.save(),e.beginPath(),e.arc(r.x,r.y,i,0,Math.PI*2,!1),e.closePath(),e.restore()},e},createTailArrow:function(){var e={},t=new n.List,r=30;for(var i=-r/2;i<r/2;i++)t.add({x:-i/9,y:0});return e.points=t,e.draw=function(e,t){if(!e||!t||!t.points||t.points.size()<=0)return;var n=t.points._as,r=t.shadow,i=t.shadowColor,s=t.shadowXOffset,o=t.shadowYOffset,u=t.shadowBlur,i=t.shadowColor,a=n.length-4,f=Math.min(t.width,t.height)/2;for(var l=0;l<a;l++){var c=l/a,h=n[l],p=f*.4;e.save(),e.restore(),e.beginPath(),e.globalAlpha=c*c,r&&(e.shadowOffsetX=s,e.shadowOffsetY=o,e.shadowBlur=u,e.shadowColor=i),e.arc(h.x,h.y,p,0,Math.PI*2,!1),e.closePath(),e.fill()}return},e},createDiamondArrow:function(){var e=new Oi;return e.add({x:-7/12,y:5/9}),e.add({x:-14/12,y:0}),e.add({x:-7/12,y:-5/9}),e.add({x:0,y:0}),e.add({x:-7/12,y:5/9}),{points:e}},createShortArrow:function(){var e=new Oi;return e.add({x:-8/12,y:6/9}),e.add({x:-5/12,y:0}),e.add({x:-8/12,y:-6/9}),e.add({x:0,y:0}),e.add({x:-8/12,y:6/9}),{points:e}},createSlantArrow:function(){var e=new Oi;return e.add({x:-1,y:-5/9}),e.add({x:-6.5/12,y:0}),e.add({x:-0.75,y:4/9}),e.add({x:0,y:0}),e.add({x:-1,y:-5/9}),{points:e}},register:function(e,t){Mi.shapeMap[e]=t},getShape:function(e){if(e)return Mi.shapeMap[e];throw"shape type can't be null"},getArrowRect:function(e,t,n,r,i,s,o,u,a){var f=Mi.getShape(r);if(!f||!f.points||f.points&&f.points.size()<=0)return;if(o>0&&o<1){var l;e.getLineLength?l=e.getLineLength():l=e._element.getLineLength(),o*=l}else e.getLineLength&&(o+=Mi.calculateArrowXOffsetAtEdge(t,e,n,a));var c=m.calculatePointInfoAlongLine(t,n,o,u),h=c.point,p=c.angle,v=f.points._as,g,y=v.length,b=new Oi,w,E;E=new d(i,0,0,s,h.x,h.y);for(g=0;g<y;g++)b.add(E.transform(v[g]));E=m.createMatrix(p+Math.PI,h.x,h.y);for(g=0;g<y;g++)w=b.get(g),w instanceof Oi&&(w=w._as),w instanceof Array?(w[0]=E.transform(w[0]),w[1]=E.transform(w[1])):b.set(g,E.transform(w));return m.getLineRect(b)},drawArrow:function(e,t,n,r,i,s,o,u,a,f,l,c,h){a=a||0,f=f||0,l=l||0;var p=h._element.getStyle("arrow.from.shadow"),d=h._element.getStyle("arrow.from.shadow.color"),v=h._element.getStyle("arrow.from.shadow.xoffset"),g=h._element.getStyle("arrow.from.shadow.yoffset"),y=h._element.getStyle("arrow.from.shadow.blur"),b=l>=0&&c;if(!o&&!b)return;var w=Mi.getShape(s);if(!w||!w.points||w.points&&w.points.size()<=0)return;var E=m.calculatePointInfoAlongLine(r,i,a,f),S=E.point,x=E.angle;o&&(e.fillStyle=u),e.beginPath(),b&&(e.lineWidth=l,e.strokeStyle=c),Mi._drawArrow(e,w,x,S,t,n,c,d,p,v,g,y),p&&(e.shadowOffsetX=v,e.shadowOffsetY=g,e.shadowBlur=y,e.shadowColor=d),o&&e.fill(),b&&e.stroke()},_drawArrow:function(e,t,r,i,s,o,u,a,f,l,c,h){if(!t.draw){var p=t.points._as,v,g=p.length,y=new Oi,b,w;w=new d(s,0,0,o,i.x,i.y);for(v=0;v<g;v++)y.add(w.transform(p[v]));y=y._as,w=m.createMatrix(r+Math.PI,i.x,i.y);var E=y[0];E=w.transform(E),e.moveTo(E.x,E.y);for(v=1;v<g;v++)b=y[v],b instanceof Oi&&(b=b._as),b instanceof Array?(b[0]=w.transform(b[0]),b[1]=w.transform(b[1]),e.quadraticCurveTo(b[0].x,b[0].y,b[1].x,b[1].y)):(b=w.transform(b),e.lineTo(b.x,b.y))}else{var p=new n.List;for(var v=0;v<t.points._as.length;v++)p.add(t.points.get(v));p.add({x:-1,y:-0.5}),p.add({x:-1,y:.5}),p.add({x:0,y:.5}),p.add({x:0,y:-0.5}),p=p._as;var v,g=p.length,y=new Oi,b,w;w=new d(s,0,0,o,i.x,i.y);for(var v=0;v<g;v++)y.add(w.transform(p[v]));y=y._as,w=m.createMatrix(r+Math.PI,i.x,i.y);var S=new Oi;for(var v=0;v<g;v++)S.add(w.transform(y[v]));t.draw&&t.draw(e,{points:S,width:s,height:o,shadowColor:a,shadow:f,shadowXOffset:l,shadowYOffset:c,shadowBlur:h})}},drawLinkArrow:function(e,t,n,r){if(n.size()<2)return;var i=e._element.isBundleAgent?e._element.isBundleAgent():!1;e._element.getStyle(i?"arrow.agent.from":"arrow.from")&&Mi._drawFromArrow(e,t,n,r),e._element.getStyle(i?"arrow.agent.to":"arrow.to")&&Mi._drawToArrow(e,t,n,r)},_drawFromArrow:function(e,t,n,r){var i=e._element,s=i.isBundleAgent?i.isBundleAgent():!1,o=i.getStyle(s?"arrow.agent.from.fill":"arrow.from.fill"),u=i.getStyle(s?"arrow.agent.from.outline.width":"arrow.from.outline.width"),a=i.getStyle(s?"arrow.agent.from.shadow.color":"arrow.from.shadow.color");if(o||u>=0){var f=i.getStyle(s?"arrow.agent.from.width":"arrow.from.width"),l=i.getStyle(s?"arrow.agent.from.height":"arrow.from.height"),c=i.getStyle(s?"arrow.agent.from.xoffset":"arrow.from.xoffset");if(c>0&&c<1){var h;e.getLineLength?h=e.getLineLength():h=e._element.getLineLength(),c*=h}else e.getLineLength&&(c+=Mi.calculateArrowXOffsetAtEdge(n,e,!0,r));var p=i.getStyle(s?"arrow.agent.from.yoffset":"arrow.from.yoffset"),d=i.getStyle(s?"arrow.agent.from.shape":"arrow.from.shape");Mi.drawArrow(t,f,l,n,!0,d,o,i.getStyle(s?"arrow.agent.from.color":"arrow.from.color"),c,p,u,i.getStyle(s?"arrow.agent.from.outline.color":"arrow.from.outline.color"),e)}},_drawToArrow:function(e,t,n,r){var i=e._element,s=i.isBundleAgent?i.isBundleAgent():!1,o=i.getStyle(s?"arrow.agent.to.fill":"arrow.to.fill"),u=i.getStyle(s?"arrow.agent.to.outline.width":"arrow.to.outline.width");if(o||u>=0){var a=i.getStyle(s?"arrow.agent.to.width":"arrow.to.width"),f=i.getStyle(s?"arrow.agent.to.height":"arrow.to.height"),l=i.getStyle(s?"arrow.agent.to.xoffset":"arrow.to.xoffset");if(l>0&&l<1){var c;e.getLineLength?c=e.getLineLength():c=e._element.getLineLength(),l*=c}else e.getLineLength&&(l+=Mi.calculateArrowXOffsetAtEdge(n,e,!1,r));var h=i.getStyle(s?"arrow.agent.to.yoffset":"arrow.to.yoffset"),p=i.getStyle(s?"arrow.agent.to.shape":"arrow.to.shape");Mi.drawArrow(t,a,f,n,!1,p,o,i.getStyle(s?"arrow.agent.to.color":"arrow.to.color"),l,h,u,i.getStyle(s?"arrow.agent.to.outline.color":"arrow.to.outline.color"),e)}},calculateArrowXOffsetAtEdge:function(e,t,n,r){if(e==null||e.size()<2)return 0;var i=t._element,s=n?i.getStyle("arrow.from.at.edge"):i.getStyle("arrow.to.at.edge");if(!s)return 0;var o=n?t._network.getElementUI(i.getFromAgent()):t._network.getElementUI(i.getToAgent());if(!o)return 0;if(r)var u=o.getZoomBodyRect();else var u=o._bodyRect;if(u==null)return 0;var a=m._getPoint(e.get(n?0:e.size()-1)),f=0,l=t.getLineLength();while(Mi._containsByInt(u,Math.floor(a.x),Math.floor(a.y),!1)&&f<l)a=m.calculatePointInfoAlongLine(e,n,f++).point;return f},_containsByInt:function(e,n,r,i){return i=i===t?!0:i,i?n>=Math.floor(e.x)&&n<=Math.floor(e.x+e.width)&&r>=Math.floor(e.y)&&r<=Math.floor(e.y+e.height):n>Math.floor(e.x)&&n<Math.floor(e.x+e.width)&&r>Math.floor(e.y)&&r<Math.floor(e.y+e.height)}};Mi.init(),r.arrow=Mi,n.EventDispatcher=function(){this._f=0},r.ext("twaver.EventDispatcher",null,{contains:function(e,t){if(this._ls)for(var n=0,r=this._ls.size(),i;n<r;n++){i=this._ls.get(n);if(e===i.l&&t===i.s)return!0}return!1},add:function(e,t,n){var r={l:e,s:t,a:n};this._ls||(this._ls=new Oi),this._f?(this._addPendings||(this._addPendings=new Oi),this._addPendings.add(r)):r.a?this._ls.add(r,0):this._ls.add(r)},remove:function(e,t){this._ls&&(
this._f?(this._removePendings||(this._removePendings=new Oi),this._removePendings.add({l:e,s:t})):this._remove(e,t))},_remove:function(e,t){for(var n=0,r=this._ls.size(),i;n<r;n++){i=this._ls.get(n);if(i.l===e&&i.s===t){this._ls.removeAt(n);return}}},fire:function(e){if(this._ls){var t,n=this._ls.size(),r;this._f++;for(t=0;t<n;t++)r=this._ls.get(t),r.s?r.l.call(r.s,e):r.l(e);this._f--;if(!this._f){if(this._removePendings){n=this._removePendings.size();for(t=0;t<n;t++)r=this._removePendings.get(t),this._remove(r.l,r.s);delete this._removePendings}if(this._addPendings){n=this._addPendings.size();for(t=0;t<n;t++)r=this._addPendings.get(t),r.a?this._ls.add(r,0):this._ls.add(r);delete this._addPendings}}}}}),n.ImageAsset=function(e,t,n,r,i){this._name=e,this._width=n,this._height=r,this._svg=i,this._edgeData,typeof t=="string"?this._src=t:typeof t=="function"?this._func=t:si(t)?this._image=t:typeof t=="object"&&(this._image=t,this._width=t.w||t.width,this._height=t.h||t.height,t.cache!==!1&&Ui(t)&&(qi(e,t),this._cache=Xi(t)))},r.ext("twaver.ImageAsset",Object,{getName:function(){return this._name},getSrc:function(){return this._src},isSvg:function(){return this._svg},getImage:function(e,t,n){if(!e||!this._image)return this._image;this._map||(this._map={});var r;this._svg&&arguments.length===3?r=e+","+t+","+n:r=e;var i=this._map[r];return i?i:(i=ji(this._cache||this._image,Hi(e),this._svg?t||this.getWidth():this.getWidth(),this._svg?n||this.getHeight():this.getHeight()),this._map[r]=i,i)},getWidth:function(){return this._width},getHeight:function(){return this._height},getFunction:function(){return this._func},_createEdgeData:function(e,t,n){var r=300,i=r/t;n<t&&(i=r/n);var s=Math.floor(t*i),o=Math.floor(n*i);this.tempCanvas||(this.tempCanvas=l.createElement("canvas"),this.ctx=this.tempCanvas.getContext("2d")),this.tempCanvas.width=s,this.tempCanvas.height=o,this.ctx.clearRect(0,0,s,o),this.ctx.drawImage(e,0,0,s,o);var u=this.ctx.getImageData(0,0,s,o),a=!0,f=[];for(var c=0,t=s,n=o;c<n;c++)for(var h=0;h<t;h++){var p=(c*t+h)*4,d=this._isTransparentPoint(u.data,p),v=a!=d||!d&&(h==0||h==t-1);if(v){var m=d?1:0;f.push({x:h-m,y:c})}a=d}a=!0;for(var h=0,t=s,n=o;h<t;h++)for(var c=0;c<n;c++){var p=(c*t+h)*4,d=this._isTransparentPoint(u.data,p),v=a!=d||!d&&(c==0||c==n-1);if(v){var m=d?1:0;f.push({x:h,y:c-m})}a=d}var g=t/2,y=n/2,b=[];for(var w=0;w<360;w++)b.push({x:g,y:y,dist:0});for(var w=0,E=f.length;w<E;w++){var S=f[w],x=this._getPointAngleDegree(S.x,S.y,g,y),T=this._getPointDist(S.x,S.y,g,y);b[x].dist<T&&(b[x]={x:S.x,y:S.y,dist:T})}for(var w=0,E=b.length;w<E;w++){var v=b[w];v.x=v.x/i,v.y=v.y/i,delete v.dist}return b},_isTransparentPoint:function(e,t){return e[t]+e[t+1]+e[t+2]+e[t+3]==0},_getPointAngleDegree:function(e,t,n,r){var i=n-e,s=r-t,o=Math.atan2(s,i);return o=o/Math.PI*180,o=parseInt(o)+180,o%=360,o},_getPointDist:function(e,t,n,r){var i=n-e,s=r-t;return Math.sqrt(i*i+s*s)}});var _i={},Di=b.createCanvas();Di.width=1,Di.height=1;var Pi=Di.getContext("2d"),Hi=function(e){e=e||"black";var t=_i[e],n;return t||(Pi.clearRect(0,0,1,1),Pi.fillStyle=e,Pi.fillRect(0,0,1,1),n=Pi.getImageData(0,0,1,1).data,t=_i[e]={r:n[0],g:n[1],b:n[2],a:n[3]}),t},Bi=function(e,t){if(!t)return e;t=Hi(t),e=Hi(e);if($i.PIXEL_FILTER_FUNCTION){var n=$i.PIXEL_FILTER_FUNCTION(e,t);return"rgba("+n.r+","+n.g+","+n.b+","+e.a+")"}return null},ji=function(e,t,n,r){var i=b.createCanvas(n,r),s=i.getContext("2d");s.drawImage(e,0,0,n,r);try{var o=s.getImageData(0,0,n,r),u=o.data;for(var a=0,f=u.length;a<f;a+=4){var l={r:u[a+0],g:u[a+1],b:u[a+2]},c=$i.PIXEL_FILTER_FUNCTION(l,t);u[a+0]=c.r,u[a+1]=c.g,u[a+2]=c.b}s.putImageData(o,0,0)}catch(h){return e}return i},Fi={},Ii=function(e,t){if(e){var n=typeof e;n==="string"&&(e.match(Yr)||r.images[e]||(Fi[e]||(Fi[e]=[])).push(t))}},qi=function(e,t){t.pattern&&Ii(t.pattern,e),t.v&&t.v.forEach(function(t){t.pattern&&Ii(t.pattern,e)})},Ri=function(e){var t=Fi[e];t&&(t.forEach(function(e){var t=r.images[e];t._cache=Xi(t._image)}),delete Fi[e])},Ui=function(e){return!e.w||!e.h?!1:zi(e)},zi=function(e){return!Object.keys(e).some(function(t){if(/^on/.test(t))return!1;var n=e[t],i=Wi(n);return!i&&t==="v"&&(i=n.some(function(e){if(e.shape==="draw")return!0;if(e.shape==="vector"){var t=r.images[e.name];if(t&&!t._cache)return!0}var n=Object.keys(e).some(function(t){return t==="state"||t==="animate"?!0:Wi(e[t])});return n?!0:e.shape==="g"&&e.v&&e.v.length?!zi(e):!1})),i})},Wi=function(e){var t=typeof e;return t==="string"&&e.match(Yr)||t==="function"},Xi=function(e){var t=b.createCanvas(e.w,e.h),n=t.getContext("2d");return Ur(n,e,null,{x:0,y:0,width:e.w,height:e.h}),t},Vi=n.imageUtil={IMAGE_LOAD_COMPLETED:"IMAGE_LOAD_COMPLETED",_dispatcher:new n.EventDispatcher,addEventListener:function(e,t,n){Vi._dispatcher.add(e,t,n)},removeEventListener:function(e,t){Vi._dispatcher.remove(e,t)},images:{},registerImageByUrl:function(e,t,n){t=t||Vi.getImageType(e),n=n||Vi.getImageName(e);if(Vi.images[n])return;Vi.images[n]=e;var i=new c;i.src=e,i.onload=function(){r.registerImage(n,i,i.width,i.height,t===!0),i.onload=null,delete Vi.images[n];var s={type:Vi.IMAGE_LOAD_COMPLETED,url:e,svg:t,name:n};Vi._dispatcher.fire(s)}},getImageName:function(e){if(typeof e!="string")return null;var t=e.lastIndexOf("/"),n=e;return t>=0&&(n=e.substring(t+1)),t=n.lastIndexOf("."),t>=0&&(n=n.substring(0,t)),n},getImageType:function(e){if(typeof e!="string")return null;var t=e.lastIndexOf("/"),n=e;return t>=0&&(n=e.substring(t+1)),t=n.lastIndexOf("."),t>=0&&(n=n.substring(t+1)),n}},$i={COLORS:["#6495ED","#FFFF00","#00FFFF","#FF0000","#7FFF00","#E0A580","#5FC0CB","#FA00F0","#A1BC50","#FFD700","#4169E1","#E5A5F5","#1E90FF","#696969","#FF6347","#00BFEF","#FFD700","#80E090","#5F9EA0","#A000FF","#7FAF00","#228BA2","#FF00FF","#7FFFD4","#800000","#0000CD","#20B2AA","#D2691E","#6495BD","#DC143C","#F0A8AF","#008B8B","#800080","#B8860B","#4B0082","#00FF00","#FFA500","#FF4500","#FFFF00","#9ACD32","#00008B","#FF1493","#ADFF2F","#4682B4","#00C0B1"],CALL_LATER_DELAY:17,SCROLL_BAR_WIDTH:17,SELECT_COLOR:"#C2CFF1",FOCUS_ON_CLICK:!0,VIEW_POSITION:"absolute",VIEW_FONT_SIZE:"12px",VIEW_FONT_FAMILY:"arial, tahoma, helvetica, sans-serif",TOOLTIP_BACKGROUND:"lightyellow",TOOLTIP_FONT_SIZE:"12px",TOOLTIP_COLOR:"black",TOOLTIP_PADDING:"4px 8px",TOOLTIP_BORDER:"1px solid gray",TOOLTIP_BORDER_RADIUS:"6px",TOOLTIP_XOFFSET:12,TOOLTIP_YOFFSET:12,TOOLTIP_BOX_SHADOW:"0px 0px 3px #AAA",TOOLTIP_ZINDEX:1e5,TOOLTIP_INITIAL_DELAY:750,TOOLTIP_RESHOW_DELAY:500,TOOLTIP_DISMISS_DELAY:4e3,ZOOM_MAX:5,ZOOM_MIN:.1,ZOOM_INCREMENT:1.3,ZOOM_ANIMATE:!0,COLUMN_INNER_TEXT:!0,COLUMN_WIDTH:80,COLUMN_HORIZONTAL_ALIGN:"",COLUMN_PROPERTY_TYPE:"accessor",COLUMN_VALUE_TYPE:"string",COLUMN_EDITABLE:!1,COLUMN_SORTABLE:!0,COLUMN_VISIBLE:!0,COLUMN_RESIZABLE:!0,COLUMN_MOVABLE:!0,COLUMN_RENDER_CELL:null,COLUMN_RENDER_HEADER:null,COLUMN_RENDER_EDITOR:null,PROPERTY_INNER_TEXT:!0,PROPERTY_HORIZONTAL_ALIGN:"",PROPERTY_PROPERTY_TYPE:"accessor",PROPERTY_VALUE_TYPE:"string",PROPERTY_EDITABLE:!1,PROPERTY_CATEGORY_NAME:null,PROPERTY_RENDER_NAME:null,PROPERTY_RENDER_VALUE:null,PROPERTY_RENDER_EDITOR:null,TAB_WIDTH:100,TAB_CLOSABLE:!1,TAB_RESIZABLE:!0,TAB_MOVABLE:!0,TAB_DISABLED:!1,TAB_VISIBLE:!0,ACCORDION_EXPAND_ICON:"expand_icon",ACCORDION_COLLAPSE_ICON:"collapse_icon",ACCORDION_TITLE_HEIGHT:20,ACCORDION_TITLE_BACKGROUND:"#EBEBEB",ACCORDION_BORDER_BOTTOM_COLOR:"lightgray",ACCORDION_ICON_POSITION:"left",TITLEPANE_TITLE_HEIGHT:20,TITLEPANE_TITLE_BACKGROUND:"#DDD",TITLEPANE_TITLE_HORIZONTAL_ALIGN:"left",BORDERPANE_HGAP:0,BORDERPANE_VGAP:0,CHARTPANE_TITLE_HEIGHT:20,CHARTPANE_TITLE_HORIZONTAL_ALIGN:"center",CHARTPANE_LEGEND_ORIENTATION:"bottom",CHARTPANE_LEGEND_WIDTH:80,LEGENDPANE_ICON_WIDTH:10,LEGENDPANE_ICON_HEIGHT:10,LEGENDPANE_ICON_RADIUS:0,LEGENDPANE_ROW_HEIGHT:20,LEGENDPANE_ORIENTATION:"horizontal",LEGENDPANE_HIDDEN_COLOR:"#BABBBC",LEGENDPANE_SELECT_BACKGROUND_COLOR:"#00007D",LEGENDPANE_SELECT_FOREGROUND_COLOR:"#FFFFFF",CHART_TOOLTIP_ENABLED:!0,CHART_SELECT_TOLERANCE:0,CHART_XGAP:6,CHART_YGAP:6,CHART_XZOOM_ENABLED:!0,CHART_YZOOM_ENABLED:!0,CHART_XTRANSLATE_ENABLED:!0,CHART_YTRANSLATE_ENABLED:!0,CHART_DOUBLE_CLICK_TO_RESET:!0,CHART_VALUE_VISIBLE:!0,CHART_VALUE_FONT:null,CHART_BACKGROUND_VISIBLE:!1,CHART_BACKGROUND_FILL:!0,CHART_BACKGROUND_FILL_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_OUTLINE_WIDTH:1,CHART_BACKGROUND_OUTLINE_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_GRADIENT:"linear.north",CHART_BACKGROUND_GRADIENT_COLOR:"#FFFFFF",PIECHART_TYPE:"oval",PIECHART_START_ANGLE:0,PIECHART_SELECT_OFFSET:5,PIECHART_SHADOW_OFFSET:1,PIECHART_SHADOW_COLOR:"#C2CFF1",PIECHART_LINE_RATE:.5,PIECHART_DONUT_RATE:.5,PIECHART_VALUE_POSITION:.5,BARCHART_TYPE:"default",BARCHART_UPPER_LIMIT:null,BARCHART_LOWER_LIMIT:0,BARCHART_XAXIS_LINE_COLOR:"#808080",BARCHART_XAXIS_LINE_WIDTH:1,BARCHART_XAXIS_TEXT_COLOR:"#000000",BARCHART_XAXIS_TEXT_FONT:null,BARCHART_YAXIS_LINE_COLOR:"#808080",BARCHART_YAXIS_LINE_WIDTH:1,BARCHART_YAXIS_TEXT_COLOR:"#000000",BARCHART_YAXIS_TEXT_FONT:null,BARCHART_XSCALE_TEXT_FONT:null,BARCHART_XSCALE_TEXT_COLOR:"#000000",BARCHART_XSCALE_TEXT_ORIENTATION:"horizontal",BARCHART_YSCALE_TEXT_VISIBLE:!0,BARCHART_YSCALE_TEXT_COLOR:"#000000",BARCHART_YSCALE_TEXT_FONT:null,BARCHART_YSCALE_LINE_COLOR:"#808080",BARCHART_YSCALE_LINE_WIDTH:.3,BARCHART_YSCALE_VALUE_GAP:0,BARCHART_YSCALE_PIXEL_GAP:20,BARCHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_INTERRUPTABLE:!0,LINECHART_UPPER_LIMIT:null,LINECHART_LOWER_LIMIT:null,LINECHART_XAXIS_LINE_COLOR:"#808080",LINECHART_XAXIS_LINE_WIDTH:1,LINECHART_XAXIS_TEXT_COLOR:"#000000",LINECHART_XAXIS_TEXT_FONT:null,LINECHART_YAXIS_LINE_COLOR:"#808080",LINECHART_YAXIS_LINE_WIDTH:1,LINECHART_YAXIS_TEXT_COLOR:"#000000",LINECHART_YAXIS_TEXT_FONT:null,LINECHART_XSCALE_TEXT_FONT:null,LINECHART_XSCALE_TEXT_COLOR:"#000000",LINECHART_XSCALE_TEXT_ORIENTATION:"horizontal",LINECHART_XSCALE_LINE_COLOR:"#808080",LINECHART_XSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_TEXT_VISIBLE:!0,LINECHART_YSCALE_TEXT_COLOR:"#000000",LINECHART_YSCALE_TEXT_FONT:null,LINECHART_YSCALE_LINE_COLOR:"#808080",LINECHART_YSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_VALUE_GAP:0,LINECHART_YSCALE_PIXEL_GAP:20,LINECHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_VALUESPANCOUNT:1,BUBBLECHART_UPPER_LIMIT:null,BUBBLECHART_LOWER_LIMIT:null,BUBBLECHART_XAXIS_UPPER_LIMIT:null,BUBBLECHART_XAXIS_LOWER_LIMIT:null,BUBBLECHART_XAXIS_LINE_COLOR:"#808080",BUBBLECHART_XAXIS_LINE_WIDTH:1,BUBBLECHART_XAXIS_TEXT_COLOR:"#000000",BUBBLECHART_XAXIS_TEXT_FONT:null,BUBBLECHART_YAXIS_LINE_COLOR:"#808080",BUBBLECHART_YAXIS_LINE_WIDTH:1,BUBBLECHART_YAXIS_TEXT_COLOR:"#000000",BUBBLECHART_YAXIS_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_COLOR:"#000000",BUBBLECHART_XSCALE_TEXT_ORIENTATION:"horizontal",BUBBLECHART_XSCALE_LINE_COLOR:"#808080",BUBBLECHART_XSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_TEXT_VISIBLE:!0,BUBBLECHART_YSCALE_TEXT_COLOR:"#000000",BUBBLECHART_YSCALE_TEXT_FONT:null,BUBBLECHART_YSCALE_LINE_COLOR:"#808080",BUBBLECHART_YSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_VALUE_GAP:0,BUBBLECHART_YSCALE_PIXEL_GAP:20,BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE:!1,BUBBLECHART_SELECT_SHADOW_COLOR:"#000000",BUBBLECHART_SELECT_SHADOW_OFFSET:3,RADARCHART_AXIS_TEXT_FONT:null,RADARCHART_AXIS_TEXT_COLOR:"#000000",RADARCHART_AXIS_TEXT_VISIBLE:!0,RADARCHART_SCALE_TEXT_FONT:null,RADARCHART_SCALE_TEXT_COLOR:"#000000",RADARCHART_SCALE_TEXT_VISIBLE:!0,RADARCHART_AXIS_VISIBLE:!0,RADARCHART_AXIS_LINE_COLOR:"#808080",RADARCHART_AXIS_LINE_WIDTH:3,RADARCHART_AXIS_START_ANGLE:0,RADARCHART_RING_VISIBLE:!0,RADARCHART_RING_TYPE:"line",RADARCHART_RING_LINE_COLOR:"#808080",RADARCHART_RING_LINE_WIDTH:1,RADARCHART_SCALE_COUNT:5,RADARCHART_SCALE_MAXVALUE:1,RADARCHART_SCALE_MINVALUE:0,RADARCHART_ANCHOR_VISIBLE:!0,RADARCHART_AREA_FILL:!0,RADARCHART_AREA_FILL_ALPHA:.2,RADARCHART_AREA_SELECT_FILL_ALPHA:.5,DIALCHART_UPPER_LIMIT:100,DIALCHART_LOWER_LIMIT:0,DIALCHART_START_ANGLE:0,DIALCHART_END_ANGLE:360,DIALCHART_INNER_RADIUS:.8,DIALCHART_COLOR_RANGE_FILL_COLOR:"#808080",DIALCHART_OUTLINE_WIDTH:0,DIALCHART_OUTLINE_COLOR:"#808080",DIALCHART_SCALE_INSIDE:!0,DIALCHART_MAJOR_SCALE_COUNT:11,DIALCHART_MAJOR_SCALE_LINE_WIDTH:2,DIALCHART_MAJOR_SCALE_LINE_LENGTH:8,DIALCHART_MAJOR_SCALE_LINE_COLOR:"#000000",DIALCHART_MINOR_SCALE_COUNT:4,DIALCHART_MINOR_SCALE_LINE_WIDTH:1,DIALCHART_MINOR_SCALE_LINE_LENGTH:4,DIALCHART_MINOR_SCALE_LINE_COLOR:"#000000",DIALCHART_SCALE_TEXT_VISIBLE:!0,DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_TEXT_FONT:null,DIALCHART_SCALE_TEXT_COLOR:"#000000",DIALCHART_PIVOT_RADIUS:10,DIALCHART_PIVOT_FILL:!0,DIALCHART_PIVOT_FILL_COLOR:"#808080",DIALCHART_PIVOT_OUTLINE_WIDTH:0,DIALCHART_PIVOT_OUTLINE_COLOR:"#808080",DIALCHART_VALUE_POSITION:.5,DIALCHART_INNER_DARKER_RADIUS:10,DIALCHART_OUTER_BRIGHTER_RADIUS:10,DIALCHART_SELECT_SHADOW_COLOR:"#000000",DIALCHART_SELECT_SHADOW_OFFSET:3,TABPANE_TAB_GAP:1,TABPANE_TAB_RADIUS:0,TABPANE_TAB_HEIGHT:24,TABPANE_TAB_ORIENTATION:"top",TABPANE_RESIZE_TOLERANCE:3,TABPANE_TAB_BACKGROUND:"#EBEBEB",TABPANE_DISABLED_COLOR:"#BABBBC",TABPANE_SELECT_BACKGROUND:"white",TABPANE_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABPANE_INSERT_BACKGROUND:"orange",TABPANE_HORIZONTAL_ALIGN:"center",TABPANE_CLOSE_ICON:"close_icon",TABPANE_SELECT_NEXT_ON_CLOSE:!0,TABPANE_SELECT_NEXT_ON_INVISIBLE:!0,LISTBASE_INNER_TEXT:!0,LIST_ROW_HEIGHT:19,LIST_INDENT:2,LIST_ROW_LINE_WIDTH:0,LIST_ROW_LINE_COLOR:"#DDD",LIST_MAKE_VISIBLE_ON_SELECTED:!0,LIST_KEYBOARD_REMOVE_ENABLED:!0,LIST_KEYBOARD_SELECT_ENABLED:!0,TREE_ROW_HEIGHT:19,TREE_INDENT:16,TREE_ROW_LINE_WIDTH:0,TREE_ROW_LINE_COLOR:"#DDD",TREE_MAKE_VISIBLE_ON_SELECTED:!0,TREE_KEYBOARD_REMOVE_ENABLED:!0,TREE_KEYBOARD_SELECT_ENABLED:!0,TREE_EXPAND_ICON:"expand_icon",TREE_COLLAPSE_ICON:"collapse_icon",TREE_LINE_TYPE:"none",TREE_LINE_THICKNESS:2,TREE_LINE_COLOR:"#000000",TREE_LINE_ALPHA:1,TREE_LINE_DASH:[4,2],TABLE_ROW_HEIGHT:19,TABLE_ROW_LINE_WIDTH:1,TABLE_ROW_LINE_COLOR:"#DDD",TABLE_COLUMN_LINE_WIDTH:1,TABLE_COLUMN_LINE_COLOR:"#DDD",TABLE_MAKE_VISIBLE_ON_SELECTED:!0,TABLE_KEYBOARD_REMOVE_ENABLED:!0,TABLE_KEYBOARD_SELECT_ENABLED:!0,TABLE_EDITABLE:!1,TABLEHEADER_HEIGHT:24,TABLEHEADER_RESIZE_TOLERANCE:3,TABLEHEADER_BACKGROUND:"#EBEBEB",TABLEHEADER_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABLEHEADER_INSERT_BACKGROUND:"orange",TABLEHEADER_COLUMN_LINE_COLOR:"#DDD",TABLEHEADER_SORT_DESC_ICON:"sort_desc",TABLEHEADER_SORT_ASC_ICON:"sort_asc",TABLEHEADER_SORT_ICON_POSITION:"98% 50%",TREETABLE_ROW_HEIGHT:19,TREETABLE_INDENT:16,TREETABLE_ROW_LINE_WIDTH:1,TREETABLE_ROW_LINE_COLOR:"#DDD",TREETABLE_COLUMN_LINE_WIDTH:1,TREETABLE_COLUMN_LINE_COLOR:"#DDD",TREETABLE_MAKE_VISIBLE_ON_SELECTED:!0,TREETABLE_KEYBOARD_REMOVE_ENABLED:!0,TREETABLE_KEYBOARD_SELECT_ENABLED:!0,TREETABLE_EXPAND_ICON:"expand_icon",TREETABLE_COLLAPSE_ICON:"collapse_icon",TREETABLE_EDITABLE:!1,PROPERTYSHEET_AUTO_ADJUSTABLE:!0,PROPERTYSHEET_INDENT:16,PROPERTYSHEET_ROW_HEIGHT:19,PROPERTYSHEET_ROW_LINE_WIDTH:1,PROPERTYSHEET_COLUMN_LINE_WIDTH:1,PROPERTYSHEET_BORDER_COLOR:"#EBEBEB",PROPERTYSHEET_EXPAND_ICON:"expand_icon",PROPERTYSHEET_COLLAPSE_ICON:"collapse_icon",PROPERTYSHEET_PROPERTY_NAME_WIDTH:100,PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN:"",PROPERTYSHEET_SUM_WIDTH:200,PROPERTYSHEET_RESIZE_TOLERANCE:3,PROPERTYSHEET_EDITABLE:!1,PROPERTYSHEET_CATEGORIZABLE:!0,PROPERTYSHEET_EXPAND_CATEGORY:!0,POPUPMENU_SUBNENU_ENABLE_ICON:"submenu_enable_icon",POPUPMENU_SUBNENU_DISABLE_ICON:"submenu_disable_icon",POPUPMENU_CHECKBOX_SELECTED_ICON:"checkbox_selected_icon",POPUPMENU_CHECKBOX_UNSELECTED_ICON:"checkbox_unselected_icon",POPUPMENU_RADIOBUTTON_SELECTED_ICON:"radiobutton_selected_icon",POPUPMENU_RADIOBUTTON_UNSELECTED_ICON:"radiobutton_unselected_icon",SPLITPANE_ORIENTATION:"horizontal",SPLITPANE_POSITION:.5,SPLITPANE_DIVIDER_WIDTH:6,SPLITPANE_DIVIDER_BACKGROUND:"#CCCCFF",SPLITPANE_DIVIDER_OPACITY:.5,SPLITPANE_MASK_BACKGROUND:"",SPLITPANE_UP_EXPAND_ICON:"up_expand_icon",SPLITPANE_DOWN_EXPAND_ICON:"down_expand_icon",SPLITPANE_LEFT_EXPAND_ICON:"left_expand_icon",SPLITPANE_RIGHT_EXPAND_ICON:"right_expand_icon",NODE_WIDTH:50,NODE_HEIGHT:50,IMAGE_NODE:"node_image",IMAGE_GROUP:"group_image",IMAGE_SUBNETWORK:"subnetwork_image",ICON_DATABOX:"databox_icon",ICON_DATA:"data_icon",ICON_NODE:"node_icon",ICON_LINK:"link_icon",ICON_GROUP:"group_icon",ICON_SUBNETWORK:"subnetwork_icon",ICON_GRID:"grid_icon",ICON_BUS:"bus_icon",ICON_SHAPENODE:"shapenode_icon",ICON_SHAPELINK:"shapelink_icon",ICON_LINKSUBNETWORK:"linksubnetwork_icon",ICON_SHAPESUBNETWORK:"shapesubnetwork_icon",LAYER_DEFAULT_ID:"default",LAYER_DEFAULT_NAME:"default",ATTACHMENT_POINTER_LENGTH:10,ATTACHMENT_POINTER_WIDTH:8,ATTACHMENT_CORNER_RADIUS:5,ATTACHMENT_CONTENT_WIDTH:30,ATTACHMENT_CONTENT_HEIGHT:20,ATTACHMENT_POSITION:"topright.topright",ATTACHMENT_XOFFSET:0,ATTACHMENT_YOFFSET:0,ATTACHMENT_PADDING:0,ATTACHMENT_PADDING_LEFT:0,ATTACHMENT_PADDING_RIGHT:0,ATTACHMENT_PADDING_TOP:0,ATTACHMENT_PADDING_BOTTOM:0,ATTACHMENT_DIRECTION:"right",ATTACHMENT_FILL:!1,ATTACHMENT_FILL_COLOR:"#000000",ATTACHMENT_GRADIENT:null,ATTACHMENT_GRADIENT_COLOR:"#FFFFFF",ATTACHMENT_OUTLINE_WIDTH:-1,ATTACHMENT_OUTLINE_COLOR:"#000000",ATTACHMENT_CAP:"butt",ATTACHMENT_JOIN:"miter",ATTACHMENT_SHADOWABLE:!0,NETWORK_TOOLTIP_ENABLED:!0,NETWORK_SELECT_MODE:"mix",NETWORK_MAKE_VISIBLE_ON_SELECTED:!0,NETWORK_NO_AGENT_LINK_VISIBLE:!1,NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE:!1,NETWORK_SUBNETWORK_ANIMATE:!0,NETWORK_SENDTOTOP_ON_SELECTED:!0,NETWORK_KEYBOARD_REMOVE_ENABLED:!0,NETWORK_KEYBOARD_SELECT_ENABLED:!0,NETWORK_RECT_SELECT_ENABLED:!0,NETWORK_DOUBLECLICK_TO_SUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_UPSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_LINKBUNDLE:!0,NETWORK_DOUBLECLICK_TO_GROUPEXPAND:!0,NETWORK_SELECT_OUTLINE_COLOR:"#2877A8",NETWORK_SELECT_OUTLINE_WIDTH:1,NETWORK_SELECT_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_OUTLINE_COLOR:"#2877A8",NETWORK_LAZYMOVE_OUTLINE_WIDTH:1,NETWORK_LAZYMOVE_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_FILL:!0,NETWORK_LAZYMOVE_ANIMATE:!0,NETWORK_RESIZE_POINT_SIZE:3,NETWORK_RESIZE_POINT_FILL_COLOR:"#FFFFFF",NETWORK_RESIZE_POINT_OUTLINE_COLOR:"#000000",NETWORK_RESIZE_POINT_OUTLINE_WIDTH:1,NETWORK_RESIZE_LINE_COLOR:"#000000",NETWORK_RESIZE_LINE_WIDTH:1,NETWORK_RESIZE_ANIMATE:!0,NETWORK_EDIT_POINT_SIZE:3,NETWORK_EDIT_POINT_FILL_COLOR:"#FFFF00",NETWORK_EDIT_POINT_OUTLINE_COLOR:"#000000",NETWORK_EDIT_POINT_OUTLINE_WIDTH:1,NETWORK_EDIT_LINE_COLOR:"rgba(184,211,240,0.7)",NETWORK_EDIT_LINE_WIDTH:2,NETWORK_ROTATE_POINT_SIZE:5,NETWORK_ROTATE_POINT_FILL_COLOR:"#FFFF00",NETWORK_ROTATE_POINT_OFFSET:15,NETWORK_ROTATE_POINT_OUTLINE_WIDTH:1,NETWORK_ROTATE_POINT_OUTLINE_COLOR:"rgba(0,0,0,1)",NETWORK_ROTATE_SCALE_FILL_COLOR:"rgb(227,166,103)",NETWORK_ROTATE_SCALE_FONT_COLOR:"#FFFFFF",NETWORK_ROTATE_SCALE_WIDTH:30,NETWORK_ROTATE_SCALE_HEIGHT:20,NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION:!0,NETWORK_LINK_FLOW_STEPPING:3,NETWORK_LINK_FLOW_COLOR:"#FF0000",NETWORK_LINK_FLOW_INTERVAL:600,NETWORK_SELECTION_TOLERANCE:2,NETWORK_TRANSPARENT_SELECTION_ENABLE:!1,SHOW_ALARM_IN_ATTACHMENT_DIV:!0,SHOW_LABEL_IN_ATTACHMENT_DIV:!1,SHOW_LABEL2_IN_ATTACHMENT_DIV:!1,SHOW_ICON_IN_ATTACHMENT_DIV:!1,SHOW_EDIT_IN_ATTACHMENT_DIV:!1,OVERVIEW_FILL_COLOR:"rgba(184,211,240,0.4)",OVERVIEW_OUTLINE_COLOR:"#B8D3F0",OVERVIEW_OUTLINE_WIDTH:1,OVERVIEW_SELECT_COLOR:"#0000FF",OVERVIEW_SELECT_WIDTH:1,OVERVIEW_PADDING:1,OVERVIEW_ANIMATE:!0,OVERVIEW_MAX_PACKING_WIDTH:-1,OVERVIEW_MAX_PACKING_HEIGHT:-1,TOUCH_MOVE_THRESHOLD:5,TOUCH_RECT_SELECT_THRESHOLD:20,TOUCH_ZOOM_THRESHOLD:30,LINK_BUNDLE_AGENT_FUNCTION:null,IS_LINK_ADJUSTED_TO_BOTTOM:!1,GROUP_EXPAND_ALIGN:"center",ELEMENTUI_FUNCTION:function(e,t){var n=t.getElementUIClass();return n?new n(e,t):null},CANVASUI_FUNCTION:function(e,t){var n=t.getCanvasUIClass();return n?new n(e,t):null},VECTORUI_FUNCTION:function(e,t){var n=t.getVectorUIClass();return n?new n(e,t):null},KEEP_DEFAULT_FUNCTION:function(e){return e.target.keepDefault||e.target.getAttribute("keepDefault")?!0:e.target.parentNode&&(e.target.parentNode.keepDefault||e.target.parentNode.getAttribute("keepDefault"))?!0:e.shiftKey?!0:!1},SORT_FUNCTION:function(e,n){if(e===n)return 0;if(e==null&&n!=null)return 1;if(e!=null&&n==null)return-1;if(e==null&&n==null)return 0;var r=typeof e,i=typeof n,s;return r==="string"&&i==="string"&&(s=e.localeCompare(n)),r==="number"&&i==="number"&&(s=e-n),s===t&&(s=(""+e).localeCompare(""+n)),s>0?1:s<0?-1:0},CENTER_LOCATION:!1,PIXEL_FILTER_FUNCTION:function(e,t){if(!t)return e;var n=e.r*.3+e.g*.59+e.b*.11;return{r:Math.floor(t.r*n/255),g:Math.floor(t.g*n/255),b:Math.floor(t.b*n/255)}}};(function(){var t=$i;if(e.OverrideTWaverDefaults)for(var n in OverrideTWaverDefaults)t[n]=OverrideTWaverDefaults[n];t.VIEW_FONT_SIZE&&t.VIEW_FONT_FAMILY?t.FONT=t.VIEW_FONT_SIZE+" "+t.VIEW_FONT_FAMILY:t.FONT=l.createElement("canvas").getContext("2d").font,t.CHART_VALUE_FONT||(t.CHART_VALUE_FONT="10px "+t.VIEW_FONT_FAMILY),t.BARCHART_XSCALE_TEXT_FONT||(t.BARCHART_XSCALE_TEXT_FONT="10px "+t.VIEW_FONT_FAMILY),t.BARCHART_YSCALE_TEXT_FONT||(t.BARCHART_YSCALE_TEXT_FONT="10px "+t.VIEW_FONT_FAMILY),t.BARCHART_XAXIS_TEXT_FONT||(t.BARCHART_XAXIS_TEXT_FONT="12px "+t.VIEW_FONT_FAMILY),t.BARCHART_YAXIS_TEXT_FONT||(t.BARCHART_YAXIS_TEXT_FONT="12px "+t.VIEW_FONT_FAMILY),t.LINECHART_XSCALE_TEXT_FONT||(t.LINECHART_XSCALE_TEXT_FONT="10px "+t.VIEW_FONT_FAMILY),t.LINECHART_YSCALE_TEXT_FONT||(t.LINECHART_YSCALE_TEXT_FONT="10px "+t.VIEW_FONT_FAMILY),t.LINECHART_XAXIS_TEXT_FONT||(t.LINECHART_XAXIS_TEXT_FONT="12px "+t.VIEW_FONT_FAMILY),t.LINECHART_YAXIS_TEXT_FONT||(t.LINECHART_YAXIS_TEXT_FONT="12px "+t.VIEW_FONT_FAMILY),t.BUBBLECHART_XAXIS_TEXT_FONT||(t.BUBBLECHART_XAXIS_TEXT_FONT="12px "+t.VIEW_FONT_FAMILY),t.BUBBLECHART_YAXIS_TEXT_FONT||(t.BUBBLECHART_YAXIS_TEXT_FONT="12px "+t.VIEW_FONT_FAMILY),t.BUBBLECHART_XSCALE_TEXT_FONT||(t.BUBBLECHART_XSCALE_TEXT_FONT="10px "+t.VIEW_FONT_FAMILY),t.BUBBLECHART_YSCALE_TEXT_FONT||(t.BUBBLECHART_YSCALE_TEXT_FONT="10px "+t.VIEW_FONT_FAMILY),t.RADARCHART_AXIS_TEXT_FONT||(t.RADARCHART_AXIS_TEXT_FONT="12px "+t.VIEW_FONT_FAMILY),t.RADARCHART_SCALE_TEXT_FONT||(t.RADARCHART_SCALE_TEXT_FONT="10px "+t.VIEW_FONT_FAMILY),t.DIALCHART_SCALE_TEXT_FONT||(t.DIALCHART_SCALE_TEXT_FONT="10px "+t.VIEW_FONT_FAMILY)})(),n.Defaults=$i,r.ext("twaver.Defaults",Object,{}),n.Colors={orange:"#EC6C00",orange_light:"#EF8200",orange_dark:"#EA5404",gray_light:"#666666",gray_dark:"#242424",green_light:"#57AB9A",green_dark:"#238475",blue_light:"#61B6D8",blue_dark:"#0089C1"},n.SerializationSettings=function(){var e=n.SerializationSettings;this.isDataBoxSerializable=e.isDataBoxSerializable,this.isLayerBoxSerializable=e.isLayerBoxSerializable,this.isStyleSerializable=e.isStyleSerializable,this.isClientSerializable=e.isClientSerializable,this.isImageSerializable=e.isImageSerializable,this._pm=r.clone(e._pm),this._sm=r.clone(e._sm),this._cm=r.clone(e._cm)},function(){var e=n.SerializationSettings;e.isDataBoxSerializable=!0,e.isLayerBoxSerializable=!0,e.isStyleSerializable=!0,e.isClientSerializable=!0,e.isImageSerializable=!0,e._pm={},e._sm={},e._cm={},e.setPropertyType=function(t,n){e._pm[t]=n},e.getPropertyType=function(t){return e._pm[t]},e.setStyleType=function(t,n){e._sm[t]=n},e.getStyleType=function(t){return e._sm[t]},e.setClientType=function(t,n){e._cm[t]=n},e.getClientType=function(t){return e._cm[t]}}(),r.ext("twaver.SerializationSettings",Object,{setPropertyType:function(e,t){this._pm[e]=t},getPropertyType:function(e){return this._pm[e]},setStyleType:function(e,t){this._sm[e]=t},getStyleType:function(e){return this._sm[e]},setClientType:function(e,t){this._cm[e]=t},getClientType:function(e){return this._cm[e]}}),n.Styles={_m:{},setStyle:function(e,t){t==null?delete n.Styles._m[e]:n.Styles._m[e]=t},getStyle:function(e){return n.Styles._m[e]},getStyleProperties:function(){return r.keys(n.Styles._m)}},function(){var e=function(e,t){n.SerializationSettings.setPropertyType(e,t)};e("name","cdata"),e("name2","cdata"),e("icon","string"),e("toolTip","cdata"),e("parent","data"),e("layerId","string"),e("alarmState","alarmstate"),e("image","string"),e("imageUrl","string"),e("location","point"),e("width","number"),e("height","number"),e("expanded","boolean"),e("host","data"),e("fromNode","data"),e("toNode","data"),e("points","list.point"),e("segments","list.string"),e("angle","number"),e("visible","boolean"),e=function(e,t,r){r==null&&(t!=null?r=typeof t:r="string"),n.Styles.setStyle(e,t),n.SerializationSettings.setStyleType(e,r)},e("chart.color",null),e("chart.value",0),e("chart.values",null,"list.number"),e("chart.value.color","#000000"),e("chart.value.font",null),e("chart.line.width",2),e("chart.marker.size",6),e("chart.marker.shape","circle"),e("chart.bubble.shape","circle"),e("chart.names",null,"list.string"),e("chart.xaxis.values",null,"list.number"),e("chart.yaxis.values",null,"list.number"),e("dialchart.rear.extension",0),e("dialchart.base.width",5),e("dialchart.top.width",0),e("dialchart.radius",.8),e("inner.color",null),e("outer.shape","rectangle"),e("outer.color",null),e("outer.width",2),e("outer.padding",1),e("outer.padding.left",0),e("outer.padding.right",0),e("outer.padding.top",0),e("outer.padding.bottom",0),e("outer.cap","butt"),e("outer.join","miter"),e("outer.style","border"),e("shadow.color",null),e("shadow.xoffset",3),e("shadow.yoffset",3),e("shadow.blur",6),e("select.style","shadow"),e("select.color","rgba(0, 0, 0, 0.7)"),e("select.shape","rectangle"),e("select.width",2),e("select.padding",2),e("select.padding.left",0),e("select.padding.right",0),e("select.padding.top",0),e("select.padding.bottom",0),e("select.cap","butt"),e("select.join","miter"),e("whole.alpha",1),e("body.type","default"),e("network.label",null,"cdata"),e("image.padding",0),e("image.padding.left",0),e("image.padding.right",0),e("image.padding.top",0),e("image.padding.bottom",0),e("image.state",null),e("vector.shape","rectangle"),e("vector.fill",!0),e("vector.fill.color","#CCCCFF"),e("vector.outline.width",-1),e("vector.outline.pattern",null,"array.number"),e("vector.outline.color","#5B5B5B"),e("vector.gradient","none"),e("vector.gradient.color","#FFFFFF"),e("vector.padding",0),e("vector.padding.left",0),e("vector.padding.right",0),e("vector.padding.top",0),e("vector.padding.bottom",0),e("vector.cap","butt"),e("vector.join","miter"),e("vector.deep",0),e("group.shape","rectangle"),e("group.fill",!0),e("group.fill.color","#CCCCFF"),e("group.outline.width",-1),e("group.outline.color","#5B5B5B"),e("group.gradient","none"),e("group.gradient.color","#FFFFFF"),e("group.padding",5),e("group.padding.left",0),e("group.padding.right",0),e("group.padding.top",0),e("group.padding.bottom",0),e("group.cap","butt"),e("group.join","miter"),e("group.deep",1),e("group.shape.roundrect.radius",-1),e("group.expend.image",null),e("group.expend.image.vector",!1),e("label.alpha",1),e("label.color","#000000"),e("label.font",null),e("label.position","bottom.bottom"),e("label.direction","below"),e("label.corner.radius",0),e("label.pointer.length",0),e("label.pointer.width",8),e("label.xoffset",0),e("label.yoffset",2),e("label.padding",0),e("label.padding.left",0),e("label.padding.right",0),e("label.padding.top",0),e("label.padding.bottom",0),e("label.fill",!1),e("label.fill.color","#C0C0C0"),e("label.gradient","none"),e("label.gradient.color","#FFFFFF"),e("label.outline.width",-1),e("label.outline.color","#000000"),e("label.cap","butt"),e("label.join","miter"),e("label.shadowable",!0),e("label.align","center"),e("label.rotate.angle",0),e("label.maxlength",0),e("link.label.rotatable",!1),e("label2.alpha",1),e("label2.color","#000000"),e("label2.font",null),e("label2.position","top.top"),e("label2.direction","below"),e("label2.corner.radius",0),e("label2.pointer.length",0),e("label2.pointer.width",8),e("label2.xoffset",0),e("label2.yoffset",-2),e("label2.padding",0),e("label2.padding.left",0),e("label2.padding.right",0),e("label2.padding.top",0),e("label2.padding.bottom",0),e("label2.fill",!1),e("label2.fill.color","#C0C0C0"),e("label2.gradient","none"),e("label2.gradient.color","#FFFFFF"),e("label2.outline.width",-1),e("label2.outline.color","#000000"),e("label2.cap","butt"),e("label2.join","miter"),e("label2.shadowable",!0),e("label2.align","center"),e("label2.rotate.angle",0),e("label2.maxlength",0),e("link.label2.rotatable",!1),e("icons.names",null,"array.string"),e("icons.colors",null,"array.string"),e("icons.position",null,"array.string"),e("icons.orientation",null,"array.string"),e("icons.xoffset",[0],"array.number"),e("icons.yoffset",[0],"array.number"),e("icons.xgap",[1],"array.number"),e("icons.ygap",[1],"array.number"),e("alarm.alpha",1),e("alarm.color","#000000"),e("alarm.font",null),e("alarm.position","hotspot"),e("alarm.direction","aboveright"),e("alarm.corner.radius",5),e("alarm.pointer.length",10),e("alarm.pointer.width",8),e("alarm.xoffset",0),e("alarm.yoffset",0),e("alarm.padding",0),e("alarm.padding.left",0),e("alarm.padding.right",0),e("alarm.padding.top",0),e("alarm.padding.bottom",0),e("alarm.gradient","none"),e("alarm.gradient.color","#FFFFFF"),e("alarm.outline.width",-1),e("alarm.outline.color","#000000"),e("alarm.cap","butt"),e("alarm.join","miter"),e("alarm.shadowable",!0),e("link.color","#658DC1"),e("link.width",3),e("link.cap","butt"),e("link.join","miter"),e("link.type","arc"),e("link.pattern",null,"array.number"),e("link.extend",20),e("link.control.point",null,"point"),e("link.bundle.id",0),e("link.bundle.enable",!0),e("link.bundle.expanded",!0),e("link.bundle.independent",!1),e("link.bundle.offset",20),e("link.bundle.gap",12),e("link.bundle.group.gap",0),e("link.looped.gap",6),e("link.looped.direction","northwest"),e("link.looped.type","arc"),e("link.from.position","center"),e("link.from.xoffset",0),e("link.from.yoffset",0),e("link.from.percent",null),e("link.from.at.edge",!0),e("link.to.position","center"),e("link.to.xoffset",0),e("link.to.yoffset",0),e("link.to.percent",null),e("link.to.at.edge",!0),e("link.split.by.percent",!0),e("link.split.percent",.5),e("link.split.value",20),e("link.corner","round"),e("link.xradius",8),e("link.yradius",8),e("link.flow",!1),e("link.flow.converse",!1),e("link.flow.offset",0),e("link.handler.alpha",1),e("link.handler.color","#000000"),e("link.handler.font",null),e("link.handler.position","topleft.topleft"),e("link.handler.direction","below"),e("link.handler.corner.radius",0),e("link.handler.pointer.length",0),e("link.handler.pointer.width",8),e("link.handler.xoffset",0),e("link.handler.yoffset",0),e("link.handler.padding",0),e("link.handler.padding.left",0),e("link.handler.padding.right",0),e("link.handler.padding.top",0),e("link.handler.padding.bottom",0),e("link.handler.fill",!1),e("link.handler.fill.color","#C0C0C0"),e("link.handler.gradient","none"),e("link.handler.gradient.color","#FFFFFF"),e("link.handler.outline.width",-1),e("link.handler.outline.color","#000000"),e("link.handler.cap","butt"),e("link.handler.join","miter"),e("link.handler.shadowable",!0),e("link.agent",!1),e("link.agent.color","#658DC1"),e("link.agent.width",3),e("link.agent.cap","butt"),e("link.agent.join","miter"),e("link.agent.type","arc"),e("link.agent.pattern",null,"array.number"),e("link.agent.extend",20),e("link.agent.control.point",null,"point"),e("link.agent.from.position","center"),e("link.agent.from.xoffset",0),e("link.agent.from.yoffset",0),e("link.agent.from.percent",null),e("link.agent.from.at.edge",!0),e("link.agent.to.position","center"),e("link.agent.to.xoffset",0),e("link.agent.to.yoffset",0),e("link.agent.to.percent",null),e("link.agent.to.at.edge",!0),e("link.agent.split.by.percent",!0),e("link.agent.split.percent",.5),e("link.agent.split.value",20),e("link.agent.corner","round"),e("link.agent.xradius",8),e("link.agent.yradius",8),e("link.agent.flow",!1),e("link.agent.flow.converse",!1),e("link.agent.flow.offset",0),e("follower.row.index",0),e("follower.column.index",0),e("follower.row.span",1),e("follower.column.span",1),e("follower.padding",0),e("follower.padding.left",0),e("follower.padding.right",0),e("follower.padding.top",0),e("follower.padding.bottom",0),e("follower.fill.cell",!0),e("follower.cell.position","center"),e("glow.blur",20),e("grid.row.count",1),e("grid.column.count",1),e("grid.row.percents",null,"array.number"),e("grid.column.percents",null,"array.number"),e("grid.border",1),e("grid.border.left",0),e("grid.border.right",0),e("grid.border.top",0),e("grid.border.bottom",0),e("grid.padding",1),e("grid.padding.left",0),e("grid.padding.right",0),e("grid.padding.top",0),e("grid.padding.bottom",0),e("grid.fill",!0),e("grid.fill.color","#C0C0C0"),e("grid.deep",1),e("grid.cell.deep",-1),e("shapelink.type","lineto"),e("shapenode.closed",!1),e("shapenode.pattern",null,"array.number"),e("bus.style","nearby"),e("arrow.from",!1),e("arrow.from.fill",!0),e
("arrow.from.shape","arrow.standard"),e("arrow.from.color","#000000"),e("arrow.from.xoffset",0),e("arrow.from.yoffset",0),e("arrow.from.width",12),e("arrow.from.height",9),e("arrow.from.outline.color","#000000"),e("arrow.from.outline.width",-1),e("arrow.from.at.edge",!0),e("arrow.from.shadow",!1),e("arrow.from.shadow.color","#000000"),e("arrow.from.shadow.xoffset",0),e("arrow.from.shadow.yoffset",0),e("arrow.from.shadow.blur",16),e("arrow.to",!1),e("arrow.to.fill",!0),e("arrow.to.shape","arrow.standard"),e("arrow.to.color","#000000"),e("arrow.to.xoffset",0),e("arrow.to.yoffset",0),e("arrow.to.width",12),e("arrow.to.height",9),e("arrow.to.outline.color","#000000"),e("arrow.to.outline.width",-1),e("arrow.to.at.edge",!0),e("arrow.agent.from",!1),e("arrow.agent.from.fill",!0),e("arrow.agent.from.shape","arrow.standard"),e("arrow.agent.from.color","#000000"),e("arrow.agent.from.xoffset",0),e("arrow.agent.from.yoffset",0),e("arrow.agent.from.width",12),e("arrow.agent.from.height",9),e("arrow.agent.from.outline.color","#000000"),e("arrow.agent.from.outline.width",-1),e("arrow.agent.from.at.edge",!0),e("arrow.agent.from.shadow",!1),e("arrow.agent.from.shadow.color","#000000"),e("arrow.agent.from.shadow.xoffset",0),e("arrow.agent.from.shadow.yoffset",0),e("arrow.agent.from.shadow.blur",16),e("arrow.agent.to",!1),e("arrow.agent.to.fill",!0),e("arrow.agent.to.shape","arrow.standard"),e("arrow.agent.to.color","#000000"),e("arrow.agent.to.xoffset",0),e("arrow.agent.to.yoffset",0),e("arrow.agent.to.width",12),e("arrow.agent.to.height",9),e("arrow.agent.to.outline.color","#000000"),e("arrow.agent.to.outline.width",-1),e("arrow.agent.to.at.edge",!0),e("background.image",null),e("background.image.scope","viewport"),e("background.type","none"),e("background.outline.width",-1),e("background.outline.color",null),e("background.vector.padding",0),e("background.image.padding",0),e("background.image.stretch","fill"),e("background.vector.scope","viewport"),e("background.vector.fill",null),e("background.vector.fill.color",null),e("background.vector.gradient",!1),e("background.vector.gradient.color",null),e("background.vector.shape","rectangle"),e("background.outline.pattern",null,"array.number"),e("attachment.label.style","html"),e("attachment.label2.style","html"),e("attachment.alarm.style","html"),e("attachment.htmllabel.hyperlink",!1),e("attachment.htmllabel2.hyperlink",!1)}(),r.ext("twaver.Styles",Object,{}),n.PropertyChangeDispatcher=function(){this._dispatcher=new n.EventDispatcher},r.ext("twaver.PropertyChangeDispatcher",Object,{addPropertyChangeListener:function(e,t,n){this._dispatcher.add(e,t,n)},removePropertyChangeListener:function(e,t){this._dispatcher.remove(e,t)},firePropertyChange:function(e,t,n){if(t==n)return!1;var r={property:e,oldValue:t,newValue:n,source:this};return this._dispatcher.fire(r),this.onPropertyChanged(r),!0},onPropertyChanged:function(e){}}),n.animate.Animate=function(){},r.ext("twaver.animate.Animate",Object,{current:0,step:8,delay:4,finishFunction:null,shouldBeFinished:!1,getCurrentDelay:function(){return this.delay*this.current+1},action:function(e){}}),n.animate.AnimateProperty=function(e,t,n){this.objects=e,this.newValues=t,this.finishFunction=n,this.oldValues=new Oi;var r=this.objects.size();for(var i=0;i<r;i++){var s=this.objects.get(i);this.oldValues.add(this.getPropertyValue(s))}},r.ext("twaver.animate.AnimateProperty",n.animate.Animate,{action:function(e){var t=this.objects.size();for(var n=0;n<t;n++){var r=this.objects.get(n),i=this.oldValues.get(n),s=this.newValues.get(n);this.currentAction(r,i,s,e)}},getPropertyValue:function(e){},currentAction:function(e,t,n,r){}}),n.animate.AnimateBounds=function(e,t,n){this.node=e,this.newBounds=t,this.oldBounds=e.getRect(),this.finishFunction=n},r.ext("twaver.animate.AnimateBounds",n.animate.Animate,{shouldBeFinished:!0,action:function(e){var t=this.oldBounds,n=this.newBounds;this.node.setLocation(t.x+(n.x-t.x)*e,t.y+(n.y-t.y)*e),this.node.setSize(t.width+(n.width-t.width)*e,t.height+(n.height-t.height)*e)}}),n.animate.AnimateCenterLocation=function(e,t,r){n.animate.AnimateCenterLocation.superClass.constructor.call(this,e,t,r)},r.ext("twaver.animate.AnimateCenterLocation",n.animate.AnimateProperty,{getPropertyValue:function(e){return e.getCenterLocation()},currentAction:function(e,t,n,r){var i=t.x+(n.x-t.x)*r,s=t.y+(n.y-t.y)*r;e.setCenterLocation(i,s)}}),n.animate.AnimateLocation=function(e,t,r){n.animate.AnimateLocation.superClass.constructor.call(this,e,t,r)},r.ext("twaver.animate.AnimateLocation",n.animate.AnimateProperty,{getPropertyValue:function(e){return e.getLocation()},currentAction:function(e,t,n,r){var i=t.x+(n.x-t.x)*r,s=t.y+(n.y-t.y)*r;e.setLocation(i,s)}}),n.animate.AnimateScrollPosition=function(e,t,n){this.view=e,this.oldHorizontalOffset=e.scrollLeft,this.oldVerticalOffset=e.scrollTop,this.newHorizontalOffset=t,this.newVerticalOffset=n},r.ext("twaver.animate.AnimateScrollPosition",n.animate.Animate,{action:function(e){this.view.scrollLeft=this.oldHorizontalOffset+(this.newHorizontalOffset-this.oldHorizontalOffset)*e,this.view.scrollTop=this.oldVerticalOffset+(this.newVerticalOffset-this.oldVerticalOffset)*e}}),n.animate.AnimateZoom=function(e,t,n){this.view=e,this.oldZoom=e.getZoom(),this.newZoom=t,this.finishFunction=n},r.ext("twaver.animate.AnimateZoom",n.animate.Animate,{shouldBeFinished:!0,action:function(e){this.view.setZoom(this.oldZoom+(this.newZoom-this.oldZoom)*e,!1)}}),n.animate.AnimateXZoom=function(e,t,n){this.view=e,this.oldXZoom=e.getXZoom(),this.newXZoom=t,this.finishFunction=n},r.ext("twaver.animate.AnimateXZoom",n.animate.Animate,{shouldBeFinished:!0,action:function(e){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*e,!1)}}),n.animate.AnimateYZoom=function(e,t,n){this.view=e,this.oldYZoom=e.getYZoom(),this.newYZoom=t,this.finishFunction=n},r.ext("twaver.animate.AnimateYZoom",n.animate.Animate,{shouldBeFinished:!0,action:function(e){this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*e,!1)}}),n.animate.AnimateXYZoom=function(e,t,n,r){this.view=e,this.oldXZoom=e.getXZoom(),this.newXZoom=t,this.oldYZoom=e.getYZoom(),this.newYZoom=n,this.finishFunction=r},r.ext("twaver.animate.AnimateXYZoom",n.animate.Animate,{shouldBeFinished:!0,action:function(e){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*e,!1),this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*e,!1)}}),n.animate.AnimateSubNetwork=function(e,t,n){this.network=e,this.subNetwork=t,this.finishFunction=n},r.ext("twaver.animate.AnimateSubNetwork",n.animate.Animate,{shouldBeFinished:!0,action:function(e){e>.5?(this.network.getView().style.opacity=e*2-1,this.network._setCurrentSubNetwork(this.subNetwork)):this.network.getView().style.opacity=1-e*2}}),n.animate.AnimateManager={timer:null,animate:null,start:function(e,t){var i=n.animate.AnimateManager;e.current<0&&(e.current=0),t?r.callLater(i.startImpl,null,[e],t):i.startImpl(e)},startImpl:function(e){var t=n.animate.AnimateManager;t.animate&&t.endAnimate(),t.animate=e,t.timer=setTimeout(t.tick,e.getCurrentDelay())},tick:function(){var e=n.animate.AnimateManager,t=e.animate;if(!t)return;if(t.current<0){t.current++;return}t.current<t.step&&(t.current++,t.action(t.current/t.step),e.timer=setTimeout(e.tick,t.getCurrentDelay())),t.current>=t.step&&e.endAnimate()},endAnimate:function(){var e=n.animate.AnimateManager;if(e.animate){e.animate.shouldBeFinished&&e.animate.current<e.animate.step&&(e.animate.current=e.animate.step,e.animate.action(e.animate.current/e.animate.step));var t=e.animate.finishFunction;e.animate=null,e.timer&&(clearTimeout(e.timer),e.timer=null),t&&t()}else e.timer&&(clearTimeout(e.timer),e.timer=null)}},n.DataBox=function(e){n.DataBox.superClass.constructor.apply(this,arguments),arguments.length===1&&(this._name=e),this._dataList=new Oi,this._dataMap={},this._rootList=new Oi,this._rootMap={},this._clientMap={},this._dataBoxChangeDispatcher=new n.EventDispatcher,this._dataPropertyChangeDispatcher=new n.EventDispatcher,this._hierarchyChangeDispatcher=new n.EventDispatcher,this._selectionModel=new n.SelectionModel(this)},r.ext("twaver.DataBox",n.PropertyChangeDispatcher,{IClient:!0,__client:1,__new:1,_limit:-1,_name:"DataBox",_icon:$i.ICON_DATABOX,__accessor:["name","icon","toolTip"],getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(e){var t=this._limit;this._limit=e,this.firePropertyChange("limit",t,e),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(e){arguments.length===0&&(e=1);while(e>0&&this._dataList.size()>0){var t=this._dataList.get(0);this.remove(t),e--}},getSiblings:function(e){if(!this.contains(e))throw e+" dosen't belong to this dataBox";var t=e.getParent();return t?t.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(e){return e.getParent()?e.getParent().getChildren().indexOf(e):this._rootList.indexOf(e)},getDatas:function(){return this._dataList},getDataAt:function(e){return this._dataList.get(e)},toDatas:function(e,t){return this._dataList.toList(e,t)},forEach:function(e,t){this._dataList.forEach(e,t)},forEachReverse:function(e,t){this._dataList.forEachReverse(e,t)},forEachByDepthFirst:function(e,t,n){if(t)this._depthFirst(e,t,n);else{var r=this._rootList.size();for(var i=0;i<r;i++){var s=this._rootList.get(i);if(this._depthFirst(e,s,n)===!1)return}}},_depthFirst:function(e,t,n){var r=t.getChildrenSize();for(var i=0;i<r;i++){var s=t.getChildAt(i);if(this._depthFirst(e,s,n)===!1)return!1}if(n){if(e.call(n,t)===!1)return!1}else if(e(t)===!1)return!1},forEachByBreadthFirst:function(e,t,n){var r=new Oi;t?r.add(t):this._rootList.forEach(r.add,r);while(r.size()>0){t=r.removeAt(0),t.getChildren().forEach(r.add,r);if(n){if(e.call(n,t)===!1)return}else if(e(t)===!1)return}},add:function(e,t){if(!e)return;arguments.length===1&&(t=-1);var n=e.getId();if(this._dataMap.hasOwnProperty(n))throw"Data with ID '"+n+"' already exists";this._dataBoxChangeDispatcher.fire({kind:"preAdd",data:e}),this._dataMap[n]=e,this._dataList.add(e),e.getParent()||(this._rootMap[n]=e,t>=0?this._rootList.add(e,t):this._rootList.add(e)),e.addPropertyChangeListener(this.handleDataPropertyChange,this,!0),this._dataBoxChangeDispatcher.fire({kind:"add",data:e}),this._checkLimit()},addByDescendant:function(e){this.add(e),e.getChildren().size()>0&&e.getChildren().forEach(function(e){this.addByDescendant(e)},this)},remove:function(e){this.removeById(e.getId())},removeSelection:function(){this._selectionModel.toSelection().forEach(function(e){this.remove(e)},this)},removeById:function(e){var t=this.getDataById(e);if(!t)return;this._dataBoxChangeDispatcher.fire({kind:"preRemove",data:t}),t instanceof n.Link&&(t.setFromNode(null),t.setToNode(null)),t instanceof es&&t.getLinks()&&t.getLinks().toList().forEach(function(e){this.remove(e)},this),t instanceof es&&t.getFollowers()&&t.getFollowers().toList().forEach(function(e){e.setHost(null)}),t instanceof n.Follower&&t.getHost()&&t.setHost(null),t.toChildren().forEach(function(e){this.remove(e)},this),t.getParent()&&t.getParent().removeChild(t),this._dataList.remove(t),delete this._dataMap[e],this._rootMap[e]&&(delete this._rootMap[e],this._rootList.remove(t)),this._dataBoxChangeDispatcher.fire({kind:"remove",data:t}),t.removePropertyChangeListener(this.handleDataPropertyChange,this)},clear:function(){if(this._dataList.size()>0){this._dataList.forEach(function(e){e.removePropertyChangeListener(this.handleDataPropertyChange,this)},this);var e=this._dataList.toList();this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._dataBoxChangeDispatcher.fire({kind:"clear",datas:e})}},getDataById:function(e){return this._dataMap[e]},containsById:function(e){return this._dataMap.hasOwnProperty(e)},contains:function(e){return e?this._dataMap[e._id]===e:!1},moveTo:function(e,t){if(!this.contains(e))throw e+" dosen't belong to this dataBox";var n=this.getSiblings(e),r=n.indexOf(e);if(r===t||r<0)return;t>=0&&t<=n.size()&&(n.remove(e),t>n.size()&&t--,n.add(e,t),this._hierarchyChangeDispatcher.fire({data:e,oldIndex:r,newIndex:t}))},moveUp:function(e){var t=this.getSiblings(e);this.moveTo(e,t.indexOf(e)-1)},moveDown:function(e){var t=this.getSiblings(e);this.moveTo(e,t.indexOf(e)+1)},moveToTop:function(e){this.moveTo(e,0)},moveToBottom:function(e){var t=this.getSiblings(e);this.moveTo(e,t.size())},moveSelectionUp:function(e){e||(e=this._selectionModel);var t=new Oi;Cr.findMoveUpDatas(e,t,this._rootList),t.forEach(this.moveUp,this)},moveSelectionDown:function(e){e||(e=this._selectionModel);var t=new Oi;Cr.findMoveDownDatas(e,t,this._rootList),t.forEach(this.moveDown,this)},moveSelectionToTop:function(e){e||(e=this._selectionModel);var t=new Oi;Cr.findMoveToTopDatas(e,t,this._rootList),t.forEach(this.moveToTop,this)},moveSelectionToBottom:function(e){e||(e=this._selectionModel);var t=new Oi;Cr.findMoveToBottomDatas(e,t,this._rootList),t.forEach(this.moveToBottom,this)},handleDataPropertyChange:function(e){var t=e.source;if(e.property==="parent"){var n=t.getId();t.getParent()?this._rootMap[n]&&(delete this._rootMap[n],this._rootList.remove(t)):this._rootMap[n]||(this._rootMap[n]=t,this._rootList.add(t))}this.onDataPropertyChanged(t,e),this._dataPropertyChangeDispatcher.fire(e)},onDataPropertyChanged:function(e,t){},addDataBoxChangeListener:function(e,t,n){this._dataBoxChangeDispatcher.add(e,t,n)},removeDataBoxChangeListener:function(e,t){this._dataBoxChangeDispatcher.remove(e,t)},addDataPropertyChangeListener:function(e,t,n){this._dataPropertyChangeDispatcher.add(e,t,n)},removeDataPropertyChangeListener:function(e,t){this._dataPropertyChangeDispatcher.remove(e,t)},addHierarchyChangeListener:function(e,t,n){this._hierarchyChangeDispatcher.add(e,t,n)},removeHierarchyChangeListener:function(e,t){this._hierarchyChangeDispatcher.remove(e,t)},getRandomData:function(e){if(e){var t=new n.List;for(var r=0;r<this._dataList.size()-1;r++){var i=this._dataList.get(r);i instanceof e&&t.add(i)}if(t.size()==0)return null}var s=e?t.get(parseInt(n.Util.random()*t.size())):this._dataList.get(parseInt(n.Util.random()*this._dataList.size()));return s}}),n.ElementBox=function(e){n.ElementBox.superClass.constructor.apply(this,arguments),this._styleMap={},this._alarmBox=new n.AlarmBox(this),this._layerBox=new n.LayerBox(this),this._alarmStatePropagator=new n.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0),this._indexChangeDispatcher=new n.EventDispatcher,this._undoManager=new n.UndoManager(this)},n.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY={fromAgent:1,toAgent:1,expanded:1,parent:1,host:1},r.ext("twaver.ElementBox",n.DataBox,{IStyle:!0,__style:1,_name:"ElementBox",add:function(e,t){if(!e)return;if(!e.IElement)throw"Only IElement can be added into ElementBox";n.ElementBox.superClass.add.apply(this,arguments),this.adjustElementIndex(e)},onDataPropertyChanged:function(e,t){n.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[t.property]&&this.adjustElementIndex(e),n.ElementBox.superClass.onDataPropertyChanged.apply(this,arguments)},addIndexChangeListener:function(e,t,n){this._indexChangeDispatcher.add(e,t,n)},removeIndexChangeListener:function(e,t){this._indexChangeDispatcher.remove(e,t)},sendToTop:function(e){if(!this.contains(e))return;if(e!==this.getDatas().get(this.size()-1)){var t=this.getDatas().indexOf(e);this.getDatas().removeAt(t),this.getDatas().add(e),this._indexChangeDispatcher.fire({element:e,oldIndex:t,newIndex:this.size()-1})}e instanceof n.Link&&(e.getFromAgent()&&!e.getFromAgent().isAdjustedToBottom()&&this.sendToTop(e.getFromAgent()),e.getToAgent()&&!e.getToAgent().isAdjustedToBottom()&&this.sendToTop(e.getToAgent())),e instanceof es&&e.getFollowers()&&e.getFollowers().forEach(function(t){if(t.isRelatedTo(e))return;if(e instanceof n.Follower&&t.isLoopedHostOn(e))return;this.sendToTop(t)},this);if(e.ISubNetwork)return;if(e instanceof ns&&!e.isExpanded())return;e.getChildren().forEach(function(e){e instanceof n.Link||this.sendToTop(e)},this)},sendToBottom:function(e,t){if(e===t)return;if(!this.contains(e))return;if(t&&!this.contains(t))return;var r=this.getDatas().remove(e),i=0;t&&(i=this.getDatas().indexOf(t)),this.getDatas().add(e,i),r!=i&&(this._indexChangeDispatcher.fire({element:e,oldIndex:r,newIndex:i}),e.getParent()&&!e.getParent().ISubNetwork&&!(e.getParent()instanceof n.Link)&&this.sendToBottom(e.getParent(),e))},fireIndexChange:function(e,t,n){this._indexChangeDispatcher.fire({element:e,oldIndex:t,newIndex:n})},adjustElementIndex:function(e){if(!this.contains(e))return;e.isAdjustedToBottom()?(this.sendToBottom(e),e.getChildren().forEach(this.adjustElementIndex,this)):this.sendToTop(e)},forEachByLayer:function(e,t,n){var r=this.size(),i=this.getDatas();if(!t)this._layerBox.forEachByDepthFirst(function(t){for(var s=0;s<r;s++){var o=i.get(s);if(this._layerBox.getLayerByElement(o)===t)if(n){if(e.call(n,o)===!1)return}else if(e(o)===!1)return}},null,this);else for(var s=0;s<r;s++){var o=i.get(s);if(this._layerBox.getLayerByElement(o)===t)if(n){if(e.call(n,o)===!1)return}else if(e(o)===!1)return}},forEachByLayerReverse:function(e,t,n){var r=new Oi;this.forEachByLayer(function(e){r.add(e,0)},t),r.forEach(e,n)},getLayerBox:function(){return this._layerBox},getAlarmBox:function(){return this._alarmBox},getAlarmStatePropagator:function(){return this._alarmStatePropagator},startBatch:function(e,t){n._isInitializing=!0,n._bundleLinks={},n._links={},e.call(t);var r,i;for(var s in n._links)r=n._links[s],r._checkAgentNodeImpl();for(var s in n._bundleLinks)i=n._bundleLinks[s],xr.resetBundleLinks(i[0],i[1]);n._bundleLinks=null,n._links=null,n._isInitializing=!1},getUndoManager:function(){return this._undoManager}}),n.SelectionModel=function(e){n.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new Oi,this._selectionChangeDispatcher=new n.EventDispatcher,this._selectionMap={},this._setDataBox(e)},r.ext("twaver.SelectionModel",n.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(e){if(this._selectionMode===e)return;if(e!=="noneSelection"&&e!=="singleSelection"&&e!=="multipleSelection")return;this.clearSelection();var t=this._selectionMode;this._selectionMode=e,this.firePropertyChange("selectionMode",t,this._selectionMode)},getDataBox:function(){return this._dataBox},_setDataBox:function(e){if(!e)throw"dataBox can not be null";if(this._dataBox===e)return;this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var t=this._dataBox;this._dataBox=e,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",t,this._dataBox)},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(e){if(e.kind==="remove"){var t=e.data;this.contains(t)&&(this._selectionList.remove(t),delete this._selectionMap[t.getId()],this.fireSelectionChange("remove",new Oi(t)))}else e.kind==="clear"&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(e){if(this._filterFunction===e)return;this.clearSelection();var t=this._filterFunction;this._filterFunction=e,this.firePropertyChange("filterFunction",t,this._filterFunction)},fireSelectionChange:function(e,t,n){n&&(this._selectionList.forEach(function(e){n.contains(e)?n.remove(e):n.add(e)}),t=n.toList()),this._selectionChangeDispatcher.fire({kind:e,datas:new Oi(t)})},addSelectionChangeListener:function(e,t,n){this._selectionChangeDispatcher.add(e,t,n)},removeSelectionChangeListener:function(e,t){this._selectionChangeDispatcher.remove(e,t)},_filterList:function(e,t){var n=new Oi(e);for(var r=0;r<n.size();r++){var i=n.get(r);if(this._filterFunction&&!this._filterFunction(i)||t&&this.contains(i)||!t&&!this.contains(i)||!this._dataBox.contains(i))n.removeAt(r),r--}return n},appendSelection:function(e){if(this._selectionMode==="noneSelection")return;var t=this._filterList(e,!0);if(t.isEmpty())return;var n=null;this._selectionMode==="singleSelection"&&(n=new Oi(this._selectionList),this._selectionList.clear(),this._selectionMap={},t=new Oi(t.get(t.size()-1)));for(var r=0;r<t.size();r++){var i=t.get(r);this._selectionList.add(i),this._selectionMap[i.getId()]=i}this.fireSelectionChange("append",t,n)},removeSelection:function(e){var t=this._filterList(e);if(t.size()===0)return;for(var n=0;n<t.size();n++){var r=t.get(n);this._selectionList.remove(r),delete this._selectionMap[r.getId()]}this.fireSelectionChange("remove",t)},toSelection:function(e,t){return this._selectionList.toList(e,t)},getSelection:function(){return this._selectionList},setSelection:function(e){if(this._selectionMode==="noneSelection")return;if(this._selectionList.size()===0&&e==null)return;var t=new Oi(this._selectionList);this._selectionList.clear(),this._selectionMap={};var n=this._filterList(e,!0);this._selectionMode==="singleSelection"&&n.size()>1&&(n=new Oi(n.get(n.size()-1)));for(var r=0;r<n.size();r++){var i=n.get(r);this._selectionList.add(i),this._selectionMap[i.getId()]=i}this.fireSelectionChange("set",null,t)},clearSelection:function(){if(this._selectionList.size()>0){var e=this._selectionList.toList();this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",e)}},selectAll:function(){if(this._selectionMode==="noneSelection")return;var e=this._dataBox.toDatas(),t=0,n=null;if(this._filterFunction)for(t=0;t<e.size();t++)n=e.get(t),this._filterFunction(n)||(e.removeAt(t),t--);var r=new Oi(this._selectionList);this._selectionList.clear(),this._selectionMap={},this._selectionMode==="singleSelection"&&e.size()>1&&(e=new Oi(e.get(e.size()-1)));for(t=0;t<e.size();t++)n=e.get(t),this._selectionList.add(n),this._selectionMap[n.getId()]=n;this.fireSelectionChange("all",null,r)},size:function(){return this._selectionList.size()},contains:function(e){return e?this._selectionMap[e.getId()]!=null:!1},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(e){return e?this._selectionMode==="noneSelection"?!1:this._filterFunction&&!this._filterFunction(e)?!1:!0:!1}}),n.QuickFinder=function(e,t,n,i,s){this._map={};if(!e)throw"dataBox can not be null";if(!t)throw"propertyName can not be null";this._dataBox=e,this._propertyName=t,this._propertyType=n||"accessor",this._propertyType==="accessor"&&(this._getter=r.getter(t)),this._valueFunction=i||this.getValue,this._filterFunction=s||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},r.ext("twaver.QuickFinder",Object,{_NULL_:"twaver-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(e){e.kind==="add"?this._addData(e.data):e.kind==="remove"?this._removeData(e.data):e.kind==="clear"&&(this._map={})},handleDataPropertyChange:function(e){if(!this._filterFunction.call(this,e.source))return;if(this._propertyType!=="accessor"||this._propertyName!==e.property)if(this._propertyType!=="style"||!e.source.IStyle||"S:"+this._propertyName!==e.property)if(this._propertyType!=="client"||"C:"+this._propertyName!==e.property)return;var t=this._getMap(e.oldValue);t&&t.remove(e.source),this._addData(e.source)},_getMap:function(e){return e=e==null?this._NULL_:e,this._map[e]},find:function(e){var t=this._getMap(e);return t?t.toList():new Oi},findFirst:function(e){var t=this._getMap(e);return!t||t.isEmpty()?null:t.get(0)},_addData:function(e){if(!this._filterFunction.call(this,e))return;var t=this._valueFunction.call(this,e),n=this._getMap(t);n||(n=new Oi,t=t==null?this._NULL_:t,this._map[t]=n),n.add(e)},_removeData:function(e){if(!this._filterFunction.call(this,e))return;var t=this._valueFunction.call(this,e),n=this._getMap(t);n&&(n.remove(e),n.isEmpty()&&(t=t==null?this._NULL_:t,delete this._map[t]))},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(e){return this._propertyType==="style"&&!e.IStyle?!1:this._propertyType==="accessor"&&this._valueFunction===this.getValue&&!e[this._getter]?!1:!0},getValue:function(e){return this._propertyType==="accessor"?e[this._getter]():this._propertyType==="style"&&e.getStyle?e.getStyle(this._propertyName):this._propertyType==="client"&&e.getClient?e.getClient(this._propertyName):null}}),n.PropertyPropagator=function(e,t,n){if(!e)throw"dataBox can not be null";if(!t)throw"propertyName can not be null";this._dataBox=e,this._propertyName=t,this._propertyType=n||"accessor",this._propertyType==="accessor"&&(this._getter=r.getter(t),this._setter=r.setter(t)),this._enable=!1,this._isPropagating=!1},r.ext("twaver.PropertyPropagator",Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(e){if(this._enable===e)return;this._enable=e,this._enable?(this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this._dataBox.forEach(function(e){this.propagate(e)},this)):(this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this))},handleDataBoxChange:function(e){e.data&&this.propagate(e.data)},handleDataPropertyChange:function(e){if(this.isInterestedProperty(e))this.propagate(e.source);else if(e.property==="parent"){var t=e.oldValue;t&&this.propagate(t),this.propagate(e.source)}},isInterestedProperty:function(e){return this._propertyType==="accessor"&&this._propertyName===e.property?!0:this._propertyType==="style"&&e.IElement&&"S:"+this._propertyName===e.property?!0:this._propertyType==="client"&&"C:"+this._propertyName===e.property?!0:!1},propagate:function(e){if(!e||this._isPropagating)return;this._isPropagating=!0,this.propagateToTop(e),this._isPropagating=!1},propagateToTop:function(e){this.propagateToParent(null,e);while(e&&e.getParent())this.propagateToParent(e,e.getParent()),e=e.getParent()},propagateToParent:function(e,t){}}),n.AlarmStatePropagator=function(e){n.AlarmStatePropagator.superClass.constructor.call(this,e,"alarmState")},r.ext("twaver.AlarmStatePropagator",n.PropertyPropagator,{handleDataPropertyChange:function(e){e.property==="enablePropagation"?this.propagate(e.source):n.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,e)},propagateToParent:function(e,t){var r=null;t.getChildren().forEach(function(e){var t=e.getAlarmState().getHighestOverallAlarmSeverity();n.AlarmSeverity.compare(t,r)>0&&(r=t)}),t.getAlarmState().setPropagateSeverity(r)}}),n.AlarmSeverity=function(e,t,n,r,i){this.value=e,this.name=t,this.nickName=n,this.color=r,this.displayName=i},r.ext("twaver.AlarmSeverity",Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var e=n.AlarmSeverity;e.severities=new Oi,e._vm={},e._nm={},e._cp=function(e,t){if(e&&t){var n=e.value-t.value;return n>0?1:n<0?-1:0}return e&&!t?1:!e&&t?-1:0},e.forEach=function(t,n){e.severities.forEach(t,n)},e.getSortFunction=function(){return e._cp},e.setSortFunction=function(t){e._cp=t,e.severities.sort(t)},e.add=function(t,n,r,i,s){var o=new e(t,n,r,i,s);return e._vm[t]=o,e._nm[n]=o,e.severities.add(o),e.severities.sort(e._cp),o},e.remove=function(t){var n=e._nm[t];return n&&(delete e._nm[t],delete e._vm[n.value],e.severities.remove(n)),n},e.CRITICAL=e.add(500,"Critical","C","#FF0000"),e.MAJOR=e.add(400,"Major","M","#FFA000"),e.MINOR=e.add(300,"Minor","m","#FFFF00"),e.WARNING=e.add(200,"Warning","W","#00FFFF"),e.INDETERMINATE=e.add(100,"Indeterminate","N","#C800FF"),e.CLEARED=e.add(0,"Cleared","R","#00FF00"),e.isClearedAlarmSeverity=function(e){return e?e.value===0:!1},e.getByName=function(t){return e._nm[t]},e.getByValue=function(t){return e._vm[t]},e.clear=function(){e.severities.clear(),e._vm={},e._nm={}},e.compare=function(t,n){return e._cp(t,n)}}(),n.AlarmState=function(e){this._e=e,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},r.ext("twaver.AlarmState",Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var e=null;for(var t in this._am){t=n.AlarmSeverity.getByName(t);if(n.AlarmSeverity.isClearedAlarmSeverity(t))continue;if(this.getAcknowledgedAlarmCount(t)===0)continue;e?e=n.AlarmSeverity.compare(e,t)>0?e:t:e=t}this._haa=e},_c2:function(){var e=null;for(var t in this._nm){t=n.AlarmSeverity.getByName(t);if(n.AlarmSeverity.isClearedAlarmSeverity(t))continue;if(this.getNewAlarmCount(t)===0)continue;e?e=n.AlarmSeverity.compare(e,t)>0?e:t:e=t}this._hna=e},_c3:function(){if(!this._hna){this._hls=!1;return}for(var e in this._nm){e=n.AlarmSeverity.getByName(e);if(n.AlarmSeverity.isClearedAlarmSeverity(e))continue;if(this.getNewAlarmCount(e)===0)continue;if(n.AlarmSeverity.compare(this._hna,e)>0){this._hls=!0;return}}this._hls=!1},_c4:function(){var e=this._haa,t=this._hna,r=this._ps;this._hoa=e,n.AlarmSeverity.compare(t,this._hoa)>0&&(this._hoa=t),n.AlarmSeverity.compare(r,this._hoa)>0&&(this._hoa=r)},_c5:function(){var e=this._haa,t=this._hna;this._hta=e,n.AlarmSeverity.compare(t,this._hta)>0&&(this._hta=t)},increaseAcknowledgedAlarm:function(e,t){t==null&&(t=1);if(t===0)return;var n=this._am[e.name];n==null&&(n=0),n+=t,this._am[e.name]=n,this._f()},increaseNewAlarm:function(e,t){t==null&&(t=1);if(t===0)return;var n=this._nm[e.name];n==null&&(n=0),n+=t,this._nm[e.name]=n,this._f()},decreaseAcknowledgedAlarm:function(e,t){t==null&&(t=1);if(t===0)return;var n=this._am[e.name];n==null&&(n=0),n-=t;if(n<0)throw"Alarm count can not be negative";this._am[e.name]=n,this._f()},decreaseNewAlarm:function(e,t){t==null&&(t=1);if(t===0)return;var n=this._nm[e.name];n==null&&(n=0),n-=t;if(n<0)throw"Alarm count can not be negative";this._nm[e.name]=n,this._f()},acknowledgeAlarm:function(e){this.decreaseNewAlarm(e,1),this.increaseAcknowledgedAlarm(e,1)},acknowledgeAllAlarms:function(e){if(e){var t=this.getNewAlarmCount(e);this.decreaseNewAlarm(e,t),this.increaseAcknowledgedAlarm(e,t)}else for(var r in this._nm)this.acknowledgeAllAlarms(n.AlarmSeverity.getByName(r))},_c6:function(){this._aac=0;for(var e in this._am)e=n.AlarmSeverity.getByName(e),this._aac+=this.getAcknowledgedAlarmCount(e)},getAcknowledgedAlarmCount:function(e){if(e){var t=this._am[e.name];return t==null?0:t}return this._aac},getAlarmCount:function(e){return this.getAcknowledgedAlarmCount(e)+this.getNewAlarmCount(e)},_c7:function(){this._nac=0;for(var e in this._nm)e=n.AlarmSeverity.getByName(e),this._nac+=this.getNewAlarmCount(e)},getNewAlarmCount:function(e){if(e){var t=this._nm[e.name];return t==null?0:t}return this._nac},setNewAlarmCount:function(e,t){this._nm[e.name]=t,this._f()},removeAllNewAlarms:function(e){e?delete this._nm[e]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(e,t){this._am[e.name]=t,this._f()},removeAllAcknowledgedAlarms:function(e){e?delete this._am[e.name]:this._am={},this._f()},isEmpty:function(){return this._hoa==null},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(e){this._ep||(e=null);if(this._ps===e)return;var t=this._ps;this._ps=e,this._f(),this._e.firePropertyChange("propagateSeverity",t,e)},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(e){
var t=this._ep;this._ep=e,this._e.firePropertyChange("enablePropagation",t,e)&&(e||this.setPropagateSeverity(null))}}),n.AlarmBox=function(e){if(!e)throw"elementBox can not be null.";n.AlarmBox.superClass.constructor.call(this),this._elementBox=e,this._alarmElementMapping=new n.AlarmElementMapping(this,e),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},r.ext("twaver.AlarmBox",n.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(e){var t=this._removeAlarmWhenAlarmIsCleared;this._removeAlarmWhenAlarmIsCleared=e,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",t,e),e&&this.toDatas(function(e){return e.isCleared()}).forEach(this.remove,this)},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(e){if(!e)throw"alarmElementMapping can not be null";if(this._alarmElementMapping===e)return;var t=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=e,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",t,e)},handleElementBoxChange:function(e){e.kind==="add"?this.handleElementAdded(e.data):e.kind==="remove"?(this.handleElementRemoved(e.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(e.data)):e.kind==="clear"&&(e.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(e){e.kind==="add"?this._increaseAlarmState(e.data):e.kind==="remove"?this._decreaseAlarmState(e.data):e.kind==="clear"&&e.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(e){var t=e.source;t.isCleared()||(e.property==="alarmSeverity"?this.handleAlarmSeverityChange(t,e):e.property==="acked"&&this.handleAckedChange(t,e)),e.property==="cleared"&&(t.isCleared()?(this._decreaseAlarmState(t,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(t)):this._increaseAlarmState(t,!0))},handleAckedChange:function(e,t){if(!e.getAlarmSeverity())return;var n=this.getCorrespondingElements(e);if(n)for(var r=0;r<n.size();r++){var i=n.get(r);t.oldValue?i.getAlarmState().decreaseAcknowledgedAlarm(e.getAlarmSeverity()):i.getAlarmState().decreaseNewAlarm(e.getAlarmSeverity()),t.newValue?i.getAlarmState().increaseAcknowledgedAlarm(e.getAlarmSeverity()):i.getAlarmState().increaseNewAlarm(e.getAlarmSeverity())}},handleAlarmSeverityChange:function(e,t){var n=t.oldValue,r=t.newValue,i=this.getCorrespondingElements(e);if(i)for(var s=0;s<i.size();s++){var o=i.get(s);n&&(e.isAcked()?o.getAlarmState().decreaseAcknowledgedAlarm(n):o.getAlarmState().decreaseNewAlarm(n)),r&&(e.isAcked()?o.getAlarmState().increaseAcknowledgedAlarm(r):o.getAlarmState().increaseNewAlarm(r))}},getCorrespondingAlarms:function(e){return this._alarmElementMapping.getCorrespondingAlarms(e)},getCorrespondingElements:function(e){return this._alarmElementMapping.getCorrespondingElements(e)},handleElementAdded:function(e){var t=this.getCorrespondingAlarms(e);if(t)for(var n=0;n<t.size();n++){var r=t.get(n);if(r.isCleared())continue;var i=r.getAlarmSeverity();i&&(r.isAcked()?e.getAlarmState().increaseAcknowledgedAlarm(i):e.getAlarmState().increaseNewAlarm(i))}},_increaseAlarmState:function(e,t){if(e.isCleared()&&!t)return;var n=e.getAlarmSeverity();if(n){var r=this.getCorrespondingElements(e);if(r)for(var i=0;i<r.size();i++){var s=r.get(i);e.isAcked()?s.getAlarmState().increaseAcknowledgedAlarm(n):s.getAlarmState().increaseNewAlarm(n)}}},_decreaseAlarmState:function(e,t){if(e.isCleared()&&!t)return;var n=e.getAlarmSeverity();if(!n)return;var r=this.getCorrespondingElements(e);if(r)for(var i=0;i<r.size();i++){var s=r.get(i);e.isAcked()?s.getAlarmState().decreaseAcknowledgedAlarm(n):s.getAlarmState().decreaseNewAlarm(n)}},handleElementRemoved:function(e){var t=this.getCorrespondingAlarms(e);t&&t.forEach(function(t){!t.isCleared()&&t.getAlarmSeverity()&&(t.isAcked()?e.getAlarmState().decreaseAcknowledgedAlarm(t.getAlarmSeverity()):e.getAlarmState().decreaseNewAlarm(t.getAlarmSeverity()))})},removeAlarmsByElement:function(e){var t=this.getCorrespondingAlarms(e);t&&t.forEach(this.remove,this)},add:function(e,t){if(!e.IAlarm)throw"Only IAlarm can be added into AlarmBox";if(this._removeAlarmWhenAlarmIsCleared&&e.isCleared())return;n.AlarmBox.superClass.add.apply(this,arguments)}}),n.AlarmElementMapping=function(e,t){if(!t)throw"ElementBox can not be null";if(!e)throw"AlarmBox can not be null";this._elementBox=t,this._alarmBox=e,this._alarmsFinder=new n.QuickFinder(e,"elementId")},r.ext("twaver.AlarmElementMapping",Object,{getCorrespondingAlarms:function(e){return this._alarmsFinder.find(e.getId())},getCorrespondingElements:function(e){var t=this._elementBox.getDataById(e.getElementId());return new Oi(t)},dispose:function(){this._alarmsFinder.dispose(),delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),n.AlarmStateStatistics=function(e){n.AlarmStateStatistics.superClass.constructor.apply(this,arguments),this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.elementMap={},this.setElementBox(e)},r.ext("twaver.AlarmStateStatistics",n.PropertyChangeDispatcher,{getElementBox:function(){return this._elementBox},setElementBox:function(e){if(!e)throw"ElementBox can not be null";if(this._elementBox===e)return;var t=this._elementBox;t&&(t.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),t.removeDataBoxChangeListener(this.handleElementBoxChange,this),this.severtiyMap={},this.elementMap={}),this._elementBox=e,this.reset(),e.addDataPropertyChangeListener(this.handleElementPropertyChange,this),e.addDataBoxChangeListener(this.handleElementBoxChange,this),this.firePropertyChange("elementBox",t,e)},dispose:function(){this._elementBox.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),this._elementBox.removeDataBoxChangeListener(this.handleElementBoxChange,this),delete this._elementBox},handleElementPropertyChange:function(e){e.property==="alarmState"&&(this.increase(e.source),this.fireAlarmStateChange())},handleElementBoxChange:function(e){e.kind==="add"?(this.increase(e.data),this.fireAlarmStateChange()):e.kind==="remove"?(this.decrease(e.data),this.fireAlarmStateChange()):e.kind==="clear"&&(this.severtiyMap={},this.elementMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,n.AlarmSeverity.forEach(function(e){var t=this.getSumInfo(e);this.sumAcked+=t.ackedCount,this.sumNew+=t.newCount,this.sumTotal+=t.totalCount},this),this.firePropertyChange("alarmState",!1,!0)},getNewAlarmCount:function(e){if(!e)return this.sumNew;var t=this.getSumInfo(e);return t.newCount},getAcknowledgedAlarmCount:function(e){if(!e)return this.sumAcked;var t=this.getSumInfo(e);return t.ackedCount},getTotalAlarmCount:function(e){if(!e)return this.sumTotal;var t=this.getSumInfo(e);return t.totalCount},getSumInfo:function(e){var t=this.severtiyMap[e.name];return t||(t={},t.newCount=0,t.ackedCount=0,t.totalCount=0,this.severtiyMap[e.name]=t),t},decrease:function(e){var t=this.elementMap[e.getId()];t&&(delete this.elementMap[e.getId()],n.AlarmSeverity.forEach(function(e){var n=t[e.name],r=this.getSumInfo(e);r.newCount=r.newCount-n.newCount,r.ackedCount=r.ackedCount-n.ackedCount,r.totalCount=r.totalCount-n.totalCount},this))},increase:function(e){this.decrease(e);if(this._filterFunction&&!this._filterFunction(e))return;var t={};this.elementMap[e.getId()]=t,n.AlarmSeverity.forEach(function(n){var r={};r.newCount=e.getAlarmState().getNewAlarmCount(n),r.ackedCount=e.getAlarmState().getAcknowledgedAlarmCount(n),r.totalCount=e.getAlarmState().getAlarmCount(n),t[n.name]=r;var i=this.getSumInfo(n);i.newCount=i.newCount+r.newCount,i.ackedCount=i.ackedCount+r.ackedCount,i.totalCount=i.totalCount+r.totalCount},this)},reset:function(){this.severtiyMap={},this.elementMap={},this._elementBox.forEach(this.increase,this),this.fireAlarmStateChange()},setFilterFunction:function(e){var t=this._filterFunction;this._filterFunction=e,this.reset(),this.firePropertyChange("filterFunction",t,e)},getFilterFunction:function(){return _filterFunction}}),n.LayerBox=function(e){n.LayerBox.superClass.constructor.call(this),this._elementBox=e,this._defaultLayer=new n.Layer($i.LAYER_DEFAULT_ID,$i.LAYER_DEFAULT_NAME),this.add(this._defaultLayer)},r.ext("twaver.LayerBox",n.DataBox,{_name:"LayerBox",getElementBox:function(){return this._elementBox},getDefaultLayer:function(){return this._defaultLayer},add:function(e,t){if(!e.ILayer)throw"Only ILayer can be added into LayerBox";n.LayerBox.superClass.add.apply(this,arguments)},removeById:function(e){if(e===this._defaultLayer.getId())throw"Cannot remove default layer";n.LayerBox.superClass.removeById.call(this,e)},getLayerByElement:function(e){if(!e)return null;if(e._layerId===$i.LAYER_DEFAULT_ID)return this._defaultLayer;var t=this.getDataById(e.getLayerId());return t?t:this._defaultLayer},clear:function(){this.toDatas().forEach(function(e){e!=this._defaultLayer&&this.removeById(e.getId())},this)}}),n.BundleLinks=function(e,t){this._links=e,this._siblings=t;var r,i,s=n.Styles.getStyle("link.bundle.expanded");for(r=0;r<e.size();r++){i=e.get(r);var o=i.getStyle("link.bundle.expanded",!1);if(o!=null){s=o;break}}s==null&&(s=!0);if($i.LINK_BUNDLE_AGENT_FUNCTION){var u=$i.LINK_BUNDLE_AGENT_FUNCTION(e);u==null?u=e.get(0):u!=e.get(0)&&(e.remove(u),e.add(u,0))}for(r=0;r<e.size();r++)e.get(r).setStyle("link.bundle.expanded",s)},r.ext("twaver.BundleLinks",Object,{getLinks:function(){return this._links},getSiblings:function(){return this._siblings},forEachSiblingLink:function(e,t){this._siblings.forEach(function(n){n.getLinks().forEach(e,t)})}});var Ji={bitsToNum:function(e){return e.reduce(function(e,t){return e*2+t},0)},byteToBitArr:function(e){var t=[];for(var n=7;n>=0;n--)t.push(!!(e&1<<n));return t},lzwDecode:function(e,t){var n=0,r=function(e){var r=0;for(var i=0;i<e;i++)t.charCodeAt(n>>3)&1<<(n&7)&&(r|=1<<i),n++;return r},i=[],s=1<<e,o=s+1,u=e+1,a=[],f=function(){a=[],u=e+1;for(var t=0;t<s;t++)a[t]=[t];a[s]=[],a[o]=null},l,c;for(;;){c=l,l=r(u);if(l===s){f();continue}if(l===o)break;if(l<a.length)c!==s&&a.push(a[c].concat(a[l][0]));else{if(l!==a.length)throw new Error("Invalid LZW code.");a.push(a[c].concat(a[c][0]))}i.push.apply(i,a[l]),a.length===1<<u&&u<12&&u++}return i}},Ki=function(e){this.data=e,this.len=this.data.length,this.pos=0};r.ext(Ki,Object,{readByte:function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return this.data.charCodeAt(this.pos++)&255},readBytes:function(e){var t=[];for(var n=0;n<e;n++)t.push(this.readByte());return t},read:function(e){var t="";for(var n=0;n<e;n++)t+=String.fromCharCode(this.readByte());return t},readUnsigned:function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}});var Qi=function(e){var t,n=e,r=null,i=null,s=null,o=0,u=null,a=null,f=null,c=!0,h=!0;this.frames=[],this.size={};var p=this,d=null,v=l.createElement("canvas");this.loaded=!1;var m=function(){r=null,i=null,u=s,s=null,a=null};this.doParse=function(){Gi(n,x)};var g=function(e){t=e,p.size.width=t.width,p.size.height=t.height},y=function(e){b(),m(),r=e.transparencyGiven?e.transparencyIndex:null,i=e.delayTime,s=e.disposalMethod},b=function(){if(!a)return;p.frames.push({data:a.getImageData(0,0,t.width,t.height),delay:i})},w=function(e){a||(a=v.getContext("2d"));var n=p.frames.length,i=e.lctFlag?e.lct:t.gct;n>0&&(u===3?a.putImageData(p.frames[o].data,0,0):o=n-1,u===2&&(f||a.clearRect(f.leftPos,f.topPos,f.width,f.height)));var s=a.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach(function(e,t){e!==r&&(s.data[t*4+0]=i[e][0],s.data[t*4+1]=i[e][1],s.data[t*4+2]=i[e][2],s.data[t*4+3]=255)}),a.putImageData(s,e.leftPos,e.topPos),f=e},E=function(){},S=function(e){return function(t){e(t)}},x={hdr:S(g),gce:S(y),com:S(E),app:{NETSCAPE:S(E)},img:S(w),eof:function(e){b(),p.loaded=!0}}},Gi=function(e,t){t||(t={});var n=function(t){var n=[];for(var r=0;r<t;r++)n.push(e.readBytes(3));return n},r=function(){var t,n;n="";do t=e.readByte(),n+=e.read(t);while(t!==0);return n},i=function(){var r={};r.sig=e.read(3),r.ver=e.read(3);if(r.sig!=="GIF")throw new Error("Not a GIF file.");r.width=e.readUnsigned(),r.height=e.readUnsigned();var i=Ji.byteToBitArr(e.readByte());r.gctFlag=i.shift(),r.colorRes=Ji.bitsToNum(i.splice(0,3)),r.sorted=i.shift(),r.gctSize=Ji.bitsToNum(i.splice(0,3)),r.bgColor=e.readByte(),r.pixelAspectRatio=e.readByte(),r.gctFlag&&(r.gct=n(1<<r.gctSize+1)),t.hdr&&t.hdr(r)},s=function(n){var i=function(n){var r=e.readByte(),i=Ji.byteToBitArr(e.readByte());n.reserved=i.splice(0,3),n.disposalMethod=Ji.bitsToNum(i.splice(0,3)),n.userInput=i.shift(),n.transparencyGiven=i.shift(),n.delayTime=e.readUnsigned(),n.transparencyIndex=e.readByte(),n.terminator=e.readByte(),t.gce&&t.gce(n)},s=function(e){e.comment=r(),t.com&&t.com(e)},o=function(n){var i=e.readByte();n.ptHeader=e.readBytes(12),n.ptData=r(),t.pte&&t.pte(n)},u=function(n){var i=function(n){var r=e.readByte();n.unknown=e.readByte(),n.iterations=e.readUnsigned(),n.terminator=e.readByte(),t.app&&t.app.NETSCAPE&&t.app.NETSCAPE(n)},s=function(e){e.appData=r(),t.app&&t.app[e.identifier]&&t.app[e.identifier](e)},o=e.readByte();n.identifier=e.read(8),n.authCode=e.read(3);switch(n.identifier){case"NETSCAPE":i(n);break;default:s(n)}},a=function(e){e.data=r(),t.unknown&&t.unknown(e)};n.label=e.readByte();switch(n.label){case 249:n.extType="gce",i(n);break;case 254:n.extType="com",s(n);break;case 1:n.extType="pte",o(n);break;case 255:n.extType="app",u(n);break;default:n.extType="unknown",a(n)}},o=function(i){var s=function(e,t){var n=new Array(e.length),r=e.length/t,i=function(r,i){var s=e.slice(i*t,(i+1)*t);n.splice.apply(n,[r*t,t].concat(s))},s=[0,4,2,1],o=[8,8,4,2],u=0;for(var a=0;a<4;a++)for(var f=s[a];f<r;f+=o[a])i(f,u),u++;return n};i.leftPos=e.readUnsigned(),i.topPos=e.readUnsigned(),i.width=e.readUnsigned(),i.height=e.readUnsigned();var o=Ji.byteToBitArr(e.readByte());i.lctFlag=o.shift(),i.interlaced=o.shift(),i.sorted=o.shift(),i.reserved=o.splice(0,2),i.lctSize=Ji.bitsToNum(o.splice(0,3)),i.lctFlag&&(i.lct=n(1<<i.lctSize+1)),i.lzwMinCodeSize=e.readByte();var u=r();i.pixels=Ji.lzwDecode(i.lzwMinCodeSize,u),i.interlaced&&(i.pixels=s(i.pixels,i.width)),t.img&&t.img(i)},u=function(){var n={};n.sentinel=e.readByte();switch(String.fromCharCode(n.sentinel)){case"!":n.type="ext",s(n);break;case",":n.type="img",o(n);break;case";":n.type="eof",t.eof&&t.eof(n);break;default:throw new Error("Unknown block: 0x"+n.sentinel.toString(16))}n.type!=="eof"&&setTimeout(u,0)},a=function(){i(),setTimeout(u,0)};a()},Yi=function(e,t,n){var r=l.createElement("canvas");return Zi(r,t.width,t.height),r.getContext("2d").clearRect(0,0,t.width,t.height),r.getContext("2d").putImageData(e[n].data,0,0),r},Zi=function(e,t,n){e.width=t,e.height=n,e.style.width=t+"px",e.style.height=n+"px"};n.Data=function(e){n.Data.superClass.constructor.apply(this,arguments),this._childList=new Oi,this._childMap={},this._clientMap={};if(e===t||e===null)this._id=r.id();else if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")this._id=e;else{for(var i in e)if(i==="clients")for(var s in e.clients)this._clientMap[s]=e.clients[s];else if(i==="styles")for(var o in e.styles)this._styleMap[o]=e.styles[o];else e[i]!=null&&(i==="id"?this._id=e[i]:this[r.setter(i)]&&this[r.setter(i)](e[i]));this._id==null&&(this._id=r.id())}},r.ext("twaver.Data",n.PropertyChangeDispatcher,{IData:!0,IClient:!0,__client:1,__new:1,_parent:null,__accessor:["name","name2","icon","toolTip"],_icon:$i.ICON_DATA,_dragBoundsFunc:null,getId:function(){return this._id},getChildren:function(){return this._childList},getChildrenSize:function(){return this._childList.size()},toChildren:function(e,t){return this._childList.toList(e,t)},addChild:function(e,n){n===t&&(n=this._childList.size());if(!e||e===this)return!1;if(this._childMap[e.getId()])return!1;if(this.isDescendantOf(e))return!1;e.getParent()&&e.getParent().removeChild(e);if(n<0||n>this._childList.size())n=this._childList.size();return this._childList.add(e,n),this._childMap[e._id]=e,e.setParent(this),this.firePropertyChange("children",null,e),this.onChildAdded(e,n),!0},onChildAdded:function(e,t){},removeChild:function(e){if(!e)return!1;if(!this._childMap[e._id])return!1;var t=this._childList.remove(e);return delete this._childMap[e._id],this.firePropertyChange("children",e,null),e.setParent(null),this.onChildRemoved(e,t),!0},onChildRemoved:function(e,t){},getChildAt:function(e){return this._childList.get(e)},clearChildren:function(){if(this._childList.size()===0)return!1;var e=this._childList.toArray(),t=e.length;for(var n=0;n<t;n++)this.removeChild(e[n]);return this.onChildrenCleared(e),!0},onChildrenCleared:function(e){},getParent:function(){return this._parent},setParent:function(e){if(this._isUpdatingParent||this._parent===e||this===e)return;if(e&&e.isDescendantOf(this))return;var t=this._parent;this._parent=e,this._isUpdatingParent=!0,t&&t.removeChild(this),e&&e.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",t,e),this.onParentChanged(t,e)},onParentChanged:function(e,t){},hasChildren:function(){return this._childList.size()>0},isRelatedTo:function(e){return e?this.isDescendantOf(e)||e.isDescendantOf(this):!1},isParentOf:function(e){return e?this._childMap[e._id]!=null:!1},isDescendantOf:function(e){if(!e)return!1;if(!e.hasChildren())return!1;var t=this._parent;while(t){if(e===t)return!0;t=t.getParent()}return!1},getDragBoundsFunc:function(){return this._dragBoundsFunc},setDragBoundsFunc:function(e){this._dragBoundsFunc=e},toString:function(){return this.getName()?this.getName():this._id}}),n.Alarm=function(e,t,r,i,s){n.Alarm.superClass.constructor.call(this,e),this._elementId=t,this._alarmSeverity=r,this._acked=i||!1,this._cleared=s||!1},r.ext("twaver.Alarm",n.Data,{IAlarm:!0,getElementId:function(){return this._elementId},__accessor:["acked","cleared","alarmSeverity"]}),n.Layer=function(e){n.Layer.superClass.constructor.call(this,e)},r.ext("twaver.Layer",n.Data,{ILayer:!0,__accessor:["visible","movable","editable","rotatable"],_visible:!0,_movable:!0,_editable:!0,_rotatable:!0,_name:"Default"}),n.Element=function(e){this._styleMap=this._styleMap||{},this._alarmState=new n.AlarmState(this),n.Element.superClass.constructor.call(this,e)},r.ext("twaver.Element",n.Data,{IElement:!0,IStyle:!0,__accessor:["layerId"],__bool:["visible","movable"],__style:1,_layerId:$i.LAYER_DEFAULT_ID,_visible:!0,_movable:!0,getAlarmState:function(){return this._alarmState},isAdjustedToBottom:function(){return!1},getElementUIClass:function(){return null},getCanvasUIClass:function(){return null},getVectorUIClass:function(){return null},s:function(e,n){return n===t?this.getStyle(e):(this.setStyle(e,n),this)},c:function(e,n){return n===t?this.getClient(e):(this.setClient(e,n),this)}}),n.Dummy=function(e){n.Dummy.superClass.constructor.call(this,e)},r.ext("twaver.Dummy",n.Element,{IDummy:!0});var es=function(e){this._location={x:0,y:0},es.superClass.constructor.call(this,e)};n.Node=es,es.IS_INTERESTED_NODE_PROPERTY={location:1,width:1,height:1,expanded:1},r.ext("twaver.Node",n.Element,{_icon:$i.ICON_NODE,_image:$i.IMAGE_NODE,_imageUrl:null,_angle:0,getLoopedLinks:function(){return this._loopedLinks},getLinks:function(){return this._links},getAgentLinks:function(){return this._agentLinks},getFollowers:function(){return this._followers},_addFollower:function(e){this._followers||(this._followers=new Oi),this._followers.add(e)},_removeFollower:function(e){this._followers.remove(e),this._followers.isEmpty()&&delete this._followers},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(e){this._links||(this._links=new Oi(!1)),this._fromLinks||(this._fromLinks=new Oi(!1)),this._links.add(e),this._toLinks&&this._toLinks.contains(e)&&(this._loopedLinks||(this._loopedLinks=new Oi(!1)),this._loopedLinks.add(e)),this._fromLinks.add(e)},_addToLink:function(e){this._links||(this._links=new Oi(!1)),this._toLinks||(this._toLinks=new Oi(!1)),this._links.add(e),this._fromLinks&&this._fromLinks.contains(e)&&(this._loopedLinks||(this._loopedLinks=new Oi(!1)),this._loopedLinks.add(e)),this._toLinks.add(e)},_removeFromLink:function(e){this._links&&this._links.remove(e),this._fromLinks&&this._fromLinks.remove(e),this._loopedLinks&&this._loopedLinks.remove(e)},_removeToLink:function(e){this._links&&this._links.remove(e),this._toLinks&&this._toLinks.remove(e),this._loopedLinks&&this._loopedLinks.remove(e)},hasAgentLinks:function(){return this._agentLinks!=null&&!this._agentLinks.isEmpty()},getFromAgentLinks:function(){return this._fromAgentLinks},getToAgentLinks:function(){return this._toAgentLinks},_addFromAgentLink:function(e){this._fromAgentLinks||(this._fromAgentLinks=new Oi(!1)),this._agentLinks||(this._agentLinks=new Oi(!1)),this._fromAgentLinks.add(e),this._agentLinks.add(e)},_addToAgentLink:function(e){this._toAgentLinks||(this._toAgentLinks=new Oi(!1)),this._agentLinks||(this._agentLinks=new Oi(!1)),this._toAgentLinks.add(e),this._agentLinks.add(e)},_removeFromAgentLink:function(e){this._fromAgentLinks&&this._fromAgentLinks.remove(e),this._agentLinks&&this._agentLinks.remove(e)},_removeToAgentLink:function(e){this._toAgentLinks&&this._toAgentLinks.remove(e),this._agentLinks&&this._agentLinks.remove(e)},getImage:function(){return this._image},setImage:function(e){var t=this._image,n=this.getWidth(),r=this.getHeight();this._image=e,this.firePropertyChange("image",t,e),this.firePropertyChange("width",n,this.getWidth()),this.firePropertyChange("height",r,this.getHeight())},getImageUrl:function(){return this._imageUrl},setImageUrl:function(e){if(this._imageUrl!=e){var t=this._imageUrl;this._imageUrl=e,Vi.images[e]||n.imageUtil.registerImageByUrl(e,n.imageUtil.getImageType(e)==="svg",e),this.setImage(e),this.firePropertyChange("imageUrl",t,e)}},getX:function(){return this._location.x},getY:function(){return this._location.y},setX:function(e){this.setLocation(e,this._location.y)},setY:function(e){this.setLocation(this._location.x,e)},getLocation:function(){return this._location},setLocation:function(e,t){var n;arguments.length===2?n={x:arguments[0],y:arguments[1]}:n=arguments[0];if(!r.num(n.x)||!r.num(n.y))return;if(n.x===this._location.x&&n.y===this._location.y)return;this._dragBoundsFunc&&(n=this._dragBoundsFunc(n));var i=this._location;this._location=n,this.firePropertyChange("location",i,n)},getCenterLocation:function(){return $i.CENTER_LOCATION?this._location:{x:this.getX()+this.getWidth()/2,y:this.getY()+this.getHeight()/2}},setCenterLocation:function(e,t){var n;arguments.length===2?n={x:arguments[0],y:arguments[1]}:n=r.clone(arguments[0]);if(!r.num(n.x)||!r.num(n.y))return;$i.CENTER_LOCATION||(n.x-=this.getWidth()/2,n.y-=this.getHeight()/2),this.setLocation(n)},translate:function(e,t){this.setLocation(this.getX()+e,this.getY()+t)},getWidth:function(){if(r.num(this._width)&&this._width>=0)return this._width;if(typeof this._image!="object"){var e=r.getImageAsset(this._image);if(e){var t=e.getWidth();return r.num(t)&&t>=0?t:(e=e._image,Zr(this,e,e,"w"))}}else if(this._image)return this._image.w;return $i.NODE_WIDTH},setWidth:function(e){var t=this._width;this._width=e,this.firePropertyChange("width",t,e)},getHeight:function(){if(r.num(this._height)&&this._height>=0)return this._height;if(typeof this._image!="object"){var e=r.getImageAsset(this._image);if(e){var t=e.getHeight();return r.num(t)&&t>=0?t:(e=e._image,Zr(this,e,e,"h"))}}else if(this._image)return this._image.h;return $i.NODE_HEIGHT},setHeight:function(e){var t=this._height;this._height=e,this.firePropertyChange("height",t,e)},setSize:function(){arguments.length===2?(this.setWidth(arguments[0]),this.setHeight(arguments[1])):(this.setWidth(arguments[0].width),this.setHeight(arguments[0].height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getRect:function(){var e=this.getOriginalRect();if(this._angle===0)return e;var t=m.createMatrix(this._angle*Math.PI/180,e.x+e.width/2,e.y+e.height/2),n=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];for(var r=0,i=n.length;r<i;r++)n[r]=t.transform(n[r]);var s=m.getRect(n);return s},getOriginalRect:function(){var e=this,t=e.getWidth(),n=e.getHeight();return $i.CENTER_LOCATION?{x:e._location.x-t/2,y:e._location.y-n/2,width:t,height:n}:{x:e.getX(),y:e.getY(),width:t,height:n}},getAngle:function(){return this._angle},setAngle:function(e){var t=this._angle;this._angle=e%360,this.firePropertyChange("angle",t,this._angle)},onParentChanged:function(e,t){es.superClass.onParentChanged.call(this,e,t),this._checkLinkAgent()},_checkLinkAgent:function(){if(n._isInitializing){if(this._links){var e=this._links.size();for(var t=0;t<e;t++)this._links.get(t)._checkAgentNode()}}else n.ElementBox.prototype.startBatch(function(){if(this._links){var e=this._links.size();for(var t=0;t<e;t++)this._links.get(t)._checkAgentNode()}},this)},onPropertyChanged:function(e){es.superClass.onPropertyChanged.call(this,e);if(this._followers){var t=this._followers.toList(),n=t.size();for(var r=0;r<n;r++)t.get(r).handleHostPropertyChange(e)}this.getParent()instanceof ns&&es.IS_INTERESTED_NODE_PROPERTY[e.property]&&this.getParent().updateLocationFromChildren()},getElementUIClass:function(){return n.network.NodeUI},getCanvasUIClass:function(){return n.canvas.NodeUI},getVectorUIClass:function(){return n.vector.NodeUI}});var ts=function(e){ts.superClass.constructor.call(this,e)};n.HTMLNode=ts,r.ext("twaver.HTMLNode",n.Node,{getElementUIClass:function(){return n.network.HTMLNodeUI},getCanvasUIClass:function(){return n.canvas.HTMLNodeUI},getVectorUIClass:function(){return n.vector.HTMLNodeUI}}),n.Link=function(e,t,r){n.Link.superClass.constructor.call(this,e instanceof es?null:e),e instanceof es&&(r=t,t=e),t&&this.setFromNode(t),r&&this.setToNode(r)},n.Link.IS_INTERESTED_BUNDLE_STYLE={"link.bundle.enable":1,"link.bundle.id":1,"link.bundle.independent":1},r.ext("twaver.Link",n.Element,{_fromNode:null,_toNode:null,_fromAgent:null,_toAgent:null,_icon:$i.ICON_LINK,getFromNode:function(){return this._fromNode},getToNode:function(){return this._toNode},getFromAgent:function(){return this._fromAgent},getToAgent:function(){return this._toAgent},setFromNode:function(e){if(this._fromNode===e)return;var t=this._fromNode;this._fromNode=e,t&&t._removeFromLink(this),this._fromNode&&this._fromNode._addFromLink(this),this._checkAgentNode(),this.firePropertyChange("fromNode",t,e)},setToNode:function(e){if(this._toNode===e)return;var t=this._toNode;this._toNode=e,t&&t._removeToLink(this),this._toNode&&this._toNode._addToLink(this),this._checkAgentNode(),this.firePropertyChange("toNode",t,e)},isLooped:function(){return this._fromNode===this._toNode&&this._fromNode!=null&&this._toNode!=null},_checkAgentNode:function(){n._isInitializing?n._links[this._id]||(n._links[this._id]=this):this._checkAgentNodeImpl()},_checkAgentNodeImpl:function(){var e=xr.figureFromAgent(this),t,r=this,i;this._fromAgent!=e&&(t=this._fromAgent,this._fromAgent&&this._fromAgent._removeFromAgentLink(this),this._fromAgent=e,this._fromAgent&&this._fromAgent._addFromAgentLink(this),this.firePropertyChange("fromAgent",t,this._fromAgent),n._isInitializing?(t&&this._toAgent&&(i=t._id+":"+this._toAgent._id,n._bundleLinks[i]||(n._bundleLinks[i]=[t,this._toAgent])),this._fromAgent&&this._toAgent&&(i=this._fromAgent._id+":"+this._toAgent._id,n._bundleLinks[i]||(n._bundleLinks[i]=[this._fromAgent,this._toAgent]))):(xr.resetBundleLinks(t,r._toAgent),xr.resetBundleLinks(r._fromAgent,r._toAgent)));var s=xr.figureToAgent(this);this._toAgent!=s&&(t=this._toAgent,this._toAgent&&this._toAgent._removeToAgentLink(this),this._toAgent=s,this._toAgent&&this._toAgent._addToAgentLink(this),this.firePropertyChange("toAgent",t,this._toAgent),n._isInitializing?(t&&this._fromAgent&&(i=t._id+":"+this._fromAgent._id,n._bundleLinks[i]||(n._bundleLinks[i]=[t,this._fromAgent])),this._toAgent&&this._fromAgent&&(i=this._toAgent._id+":"+this._fromAgent._id,n._bundleLinks[i]||(n._bundleLinks[i]=[this._toAgent,this._fromAgent]))):(xr.resetBundleLinks(t,r._fromAgent),xr.resetBundleLinks(r._toAgent,r._fromAgent)))},_setBundleLinks:function(e){this._bundleLinks=e,this.firePropertyChange("bundleLinks",!0,!1)},getBundleLinks:function(){return this._bundleLinks},getBundleCount:function(){return this._bundleLinks?this._bundleLinks.getLinks().size():1},getBundleIndex:function(){return this._bundleLinks?this._bundleLinks.getLinks().indexOf(this):0},reverseBundleExpanded:function(){if(this._bundleLinks&&this._bundleLinks.getLinks().size()>0){var e,t,n=this._bundleLinks.getLinks(),r=!this.getStyle("link.bundle.expanded");for(e=0;e<n.size();e++)t=n.get(e),t.setStyle("link.bundle.expanded",r);var i=this._bundleLinks.getSiblings();for(e=0;e<i.size();e++){var s=i.get(e);if(s!=this._bundleLinks){n=s.getLinks();for(var o=0;o<n.size();o++)t=n.get(o),t.firePropertyChange("bundleLinks",null,s)}}return!0}return!1},isBundleAgent:function(){return this._bundleLinks!=null&&this._bundleLinks.getLinks().size()>1&&this===this._bundleLinks.getLinks().get(0)&&!this.getStyle("link.bundle.expanded")},onStyleChanged:function(e,t,r){n.Link.superClass.onStyleChanged.call(this,e,t,r),n.Link.IS_INTERESTED_BUNDLE_STYLE[e]&&xr.resetBundleLinks(this._toAgent,this._fromAgent)},getElementUIClass:function(){return n.network.LinkUI},getCanvasUIClass:function(){return n.canvas.LinkUI},getVectorUIClass:function(){return n.vector.LinkUI},isAdjustedToBottom:function(){return $i.IS_LINK_ADJUSTED_TO_BOTTOM}}),n.HTMLLink=function(e,t,r){n.HTMLLink.superClass.constructor.call(this,e,t,r)},n.Util.ext("twaver.HTMLLink",n.Link,{getElementUIClass:function(){return n.network.HTMLLinkUI},getCanvasUIClass:function(){return n.canvas.HTMLLinkUI},getVectorUIClass:function(){return n.vector.HTMLLinkUI}}),n.Follower=function(e){this._isUpdatingFollower=!1,this._isUpdatingLocation=!1,n.Follower.superClass.constructor.call(this,e)},n.Follower.IS_INTERESTED_HOST_GRID_PROPERTY={location:1,width:1,height:1,"S:grid.row.count":1,"S:grid.column.count":1,"S:grid.row.percents":1,"S:grid.column.percents":1,"S:grid.border":1,"S:grid.border.left":1,"S:grid.border.right":1,"S:grid.border.top":1,"S:grid.border.bottom":1,"S:grid.padding":1,"S:grid.padding.left":1,"S:grid.padding.right":1,"S:grid.padding.top":1,"S:grid.padding.bottom":1},n.Follower.IS_INTERESTED_FOLLOWER_STYLE={"follower.row.index":1,"follower.column.index":1,"follower.row.span":1,"follower.column.span":1,"follower.padding":1,"follower.padding.left":1,"follower.padding.right":1,"follower.padding.top":1,"follower.padding.bottom":1},r.ext("twaver.Follower",es,{_host:null,getHost:function(){return this._host},setHost:function(e){if(this===e||this._host===e)return;var t=this._host;t&&t._removeFollower(this),this._host=e,this._host&&this._host._addFollower(this),this.firePropertyChange("host",t,e),this.onHostChanged(t,e)},onStyleChanged:function(e,t,r){n.Follower.superClass.onStyleChanged.call(this,e,t,r),n.Follower.IS_INTERESTED_FOLLOWER_STYLE[e]&&this.updateFollower(null)},setLocation:function(){if(this._isUpdatingLocation)return;this._isUpdatingLocation=!0,n.Follower.superClass.setLocation.apply(this,arguments),this._isUpdatingLocation=!1},onHostChanged:function(e,t){this.updateFollower(null)},handleHostPropertyChange:function(e){this.updateFollower(e)},updateFollower:function(e){if(this._isUpdatingFollower||r.isDeserializing)return;this._isUpdatingFollower=!0,this.updateFollowerImpl(e),this._isUpdatingFollower=!1},updateFollowerImpl:function(e){var t=this.getHost();if(t instanceof n.Grid){if(!e||n.Follower.IS_INTERESTED_HOST_GRID_PROPERTY[e.property]){var r=this.getStyle("follower.row.index"),i=this.getStyle("follower.column.index"),s=t.getCellRect(r,i);if(!s)return;var o=this.getStyle("follower.row.span"),u=this.getStyle("follower.column.span");if(o!=1||u!=1){var a=t.getCellRect(r+o-1,i+u-1);a&&(s=m.unionRect(s,a))}m.addPadding(s,this,"follower.padding");if(this.getStyle("follower.fill.cell"))this.setLocation(s.x,s.y),this.setWidth(s.width),this.setHeight(s.height);else{var f=this.getStyle("follower.cell.position");s=y.get(f,s,this.getRect()),this.setLocation(s.x,s.y)}}}else if(e!=null&&e.property==="location"
){var l=e.oldValue,c=e.newValue,h=this.getLocation();this.setLocation(h.x+(c.x-l.x),h.y+(c.y-l.y))}},isHostOn:function(e){if(!e)return!1;var t={},r=this._host;while(r&&r!=this&&!t[r.getId()]){if(r===e)return!0;t[r.getId()]=r,r instanceof n.Follower?r=r.getHost():r=null}return!1},isLoopedHostOn:function(e){return this.isHostOn(e)&&e.isHostOn(this)}});var ns=function(e){this._isUpdatingLocationFromChildren=!1,this._isAdjusting=!1,this._expanded=!1,ns.superClass.constructor.call(this,e)};n.Group=ns,r.ext("twaver.Group",n.Follower,{_image:$i.IMAGE_GROUP,_icon:$i.ICON_GROUP,isAdjustedToBottom:function(){return this.isExpanded()&&xr.hasAgentLinks(this)},onChildAdded:function(e,t){ns.superClass.onChildAdded.apply(this,arguments),this.updateLocationFromChildren()},onChildRemoved:function(e,t){ns.superClass.onChildRemoved.apply(this,arguments),this.updateLocationFromChildren()},updateLocationFromChildren:function(){if(this._isAdjusting||r.isDeserializing)return;var e,t=0,n=this.getChildrenSize(),i;for(;t<n;t++)i=this.getChildAt(t),i instanceof es&&(e=m.unionRect(e,this.getChildRect(i)));e&&(this._isUpdatingLocationFromChildren=!0,$i.GROUP_EXPAND_ALIGN==="lefttop"?this.setLocation(e.x-this.getWidth()/2,e.y-this.getHeight()/2):this.setLocation(e.x+e.width/2-this.getWidth()/2,e.y+e.height/2-this.getHeight()/2),this._isUpdatingLocationFromChildren=!1)},getChildRect:function(e){var t;return e instanceof es&&(e instanceof ns?(e.isExpanded()&&e.getChildren().forEach(function(n){t=m.unionRect(t,e.getChildRect(n))}),t||(t=e.getRect())):t=e.getRect()),t},setLocation:function(){if(this._isAdjusting)return;var e;arguments.length===2?e={x:arguments[0],y:arguments[1]}:e=arguments[0];if(!r.isDeserializing&&!this._isUpdatingLocationFromChildren){this._isAdjusting=!0;var t=e.x-this.getX(),n=e.y-this.getY();xr.moveElements(this.getChildren(),t,n),this._isAdjusting=!1}ns.superClass.setLocation.call(this,e)},reverseExpanded:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._expanded},setExpanded:function(e){if(this._expanded===e)return;var t=this._expanded;this._expanded=e,this.firePropertyChange("expanded",t,this._expanded),this._checkLinkAgent()},_checkLinkAgent:function(){ns.superClass._checkLinkAgent.call(this);var e=this.getChildrenSize();for(var t=0;t<e;t++){var n=this.getChildAt(t);n instanceof es&&n._checkLinkAgent()}},getElementUIClass:function(){return n.network.GroupUI},getCanvasUIClass:function(){return n.canvas.GroupUI},getVectorUIClass:function(){return n.vector.GroupUI}}),n.SubNetwork=function(e){n.SubNetwork.superClass.constructor.call(this,e)},r.ext("twaver.SubNetwork",n.Follower,{ISubNetwork:!0,_image:$i.IMAGE_SUBNETWORK,_icon:$i.ICON_SUBNETWORK,_checkLinkAgent:function(){n.SubNetwork.superClass._checkLinkAgent.call(this);var e=this.getChildrenSize();for(var t=0;t<e;t++){var r=this.getChildAt(t);r instanceof es&&r._checkLinkAgent()}}}),n.Grid=function(e){n.Grid.superClass.constructor.call(this,e)},r.ext("twaver.Grid",n.Follower,{_icon:$i.ICON_GRID,_image:null,getCellObject:function(e,t){arguments.length===1&&(t=e.y,e=e.x);var n=this.getStyle("grid.row.count"),r=this.getStyle("grid.column.count");for(var i=0;i<n;i++)for(var s=0;s<r;s++){var o=this.getCellRect(i,s);if(m.containsPoint(o,e,t))return{rowIndex:i,columnIndex:s,rect:o}}return null},getCellRect:function(e,t){var n=this.getStyle("grid.row.count"),r=this.getStyle("grid.column.count");if(n<=0||r<=0)return null;if(e<0||e>=n)return null;if(t<0||t>=r)return null;var i=this.getRect();m.addPadding(i,this,"grid.border");var s=0,o=this.getStyle("grid.row.percents"),u=this.getStyle("grid.column.percents");if(o&&o.length===n){var a=0;for(s=0;s<e;s++)a+=i.height*o[s];i.y+=a,i.height=i.height*o[e]}else i.height=i.height/n,i.y+=i.height*e;if(u&&u.length===r){var f=0;for(s=0;s<t;s++)f+=i.width*u[s];i.x+=f,i.width=i.width*u[t]}else i.width=i.width/r,i.x+=i.width*t;return m.addPadding(i,this,"grid.padding"),i},getElementUIClass:function(){return n.network.GridUI},getCanvasUIClass:function(){return n.canvas.GridUI},getVectorUIClass:function(){return n.vector.GridUI}}),n.ShapeNode=function(e){this._isUpdatingShapeNode=!1,this._points=new Oi,n.ShapeNode.superClass.constructor.call(this,e)},r.ext("twaver.ShapeNode",n.Follower,{_icon:$i.ICON_SHAPENODE,__accessor:["segments"],getElementUIClass:function(){return n.network.ShapeNodeUI},getCanvasUIClass:function(){return n.canvas.ShapeNodeUI},getVectorUIClass:function(){return n.vector.ShapeNodeUI},getPoints:function(){return this._points},setPoints:function(e){e||(e=new Oi);var t=new Oi(this._points);this._points=e,this.firePointsChange(t,this._points)},getSegments:function(){return this._segments},setSegments:function(e){e||(e=new Oi);var t=new Oi(this._segments);this._segments=e,this._reCalculateLineLength(),this.firePropertyChange("segments",t,this._segments)},addPoint:function(e,t){var n=new Oi(this._points);this._points.add(e,t),this.firePointsChange(n,this._points)},setPoint:function(e,t){var n=new Oi(this._points);this._points.set(e,t),this.firePointsChange(n,this._points)},removePoint:function(e){var t=new Oi(this._points);this._points.remove(e),this.firePointsChange(t,this._points)},removeAt:function(e){var t=new Oi(this._points);this._points.removeAt(e),this.firePointsChange(t,this._points)},setWidth:function(e){e<1&&(e=1);if(!this._isUpdatingShapeNode&&!r.isDeserializing){this._isUpdatingShapeNode=!0;var t=new Oi(this._points);for(var i=0;i<this._points.size();i++){var s=this._points.get(i);s.x=(s.x-this.getX())*e/this.getWidth()+this.getX()}this.firePointsChange(t,this._points),this._isUpdatingShapeNode=!1}n.ShapeNode.superClass.setWidth.apply(this,arguments)},setHeight:function(e){e<1&&(e=1);if(!this._isUpdatingShapeNode&&!r.isDeserializing){this._isUpdatingShapeNode=!0;var t=new Oi(this._points);for(var i=0;i<this._points.size();i++){var s=this._points.get(i);s.y=(s.y-this.getY())*e/this.getHeight()+this.getY()}this.firePointsChange(t,this._points),this._isUpdatingShapeNode=!1}n.ShapeNode.superClass.setHeight.apply(this,arguments)},setLocation:function(){if(!this._isUpdatingShapeNode&&!r.isDeserializing){var e;arguments.length===2?e={x:arguments[0],y:arguments[1]}:e=arguments[0];if(!r.num(e.x)||!r.num(e.y))return;var t=e.x-this.getX(),i=e.y-this.getY();if(t===0&&i===0)return;this._isUpdatingShapeNode=!0;var s=new Oi(this._points);for(var o=0;o<this._points.size();o++){var u=this._points.get(o);u.x+=t,u.y+=i}this.firePointsChange(s,this._points),this._isUpdatingShapeNode=!1}n.ShapeNode.superClass.setLocation.apply(this,arguments)},firePointsChange:function(e,t){if(!this._isUpdatingShapeNode&&!r.isDeserializing){var n=m.getRect(t);n?(this._isUpdatingShapeNode=!0,$i.CENTER_LOCATION?this.setLocation(n.x+n.width/2,n.y+n.height/2):this.setLocation(n.x,n.y),this.setWidth(n.width),this.setHeight(n.height),this._isUpdatingShapeNode=!1):(this._isUpdatingShapeNode=!0,this.setWidth(0),this.setHeight(0),this._isUpdatingShapeNode=!1)}this._reCalculateLineLength(),this.firePropertyChange("points",e,t)},_reCalculateLineLength:function(){this._points!=null&&this._points.size()>0?this._lineLength=m.calculateLineLength(this._points,this._segments):this._lineLength=0},getLineLength:function(){return this._lineLength}}),n.Bus=function(e){this._styleMap={},this._styleMap["vector.fill"]=!1,this._styleMap["shapenode.closed"]=!1,n.Bus.superClass.constructor.call(this,e)},r.ext("twaver.Bus",n.ShapeNode,{_icon:$i.ICON_BUS,firePointsChange:function(e,t){var i=t.size();if(!r.isDeserializing&&i>=2){var s=t.get(0);for(var o=1;o<i;o++){var u=t.get(o);Math.abs(u.x-s.x)>Math.abs(u.y-s.y)?u.y=s.y:u.x=s.x,s=u}}n.Bus.superClass.firePointsChange.apply(this,arguments)}}),n.ShapeLink=function(e,t,r){this._points=new Oi,this._styleMap={},this._styleMap["link.bundle.enable"]=!1,n.ShapeLink.superClass.constructor.call(this,e,t,r)},r.ext("twaver.ShapeLink",n.Link,{_icon:$i.ICON_SHAPELINK,getElementUIClass:function(){return n.network.ShapeLinkUI},getCanvasUIClass:function(){return n.canvas.ShapeLinkUI},getVectorUIClass:function(){return n.vector.ShapeLinkUI},getPoints:function(){return this._points},setPoints:function(e){e||(e=new Oi);var t=new Oi(this._points);this._points=e,this.firePointsChange(t,this._points)},addPoint:function(e,t){var n=new Oi(this._points);this._points.add(e,t),this.firePointsChange(n,this._points)},setPoint:function(e,t){var n=new Oi(this._points);this._points.set(e,t),this.firePointsChange(n,this._points)},removePoint:function(e){var t=new Oi(this._points);this._points.remove(e),this.firePointsChange(t,this._points)},removeAt:function(e){var t=new Oi(this._points);this._points.removeAt(e),this.firePointsChange(t,this._points)},firePointsChange:function(e,t){this.firePropertyChange("points",e,t)}}),n.ShapeSubNetwork=function(e){n.ShapeSubNetwork.superClass.constructor.call(this,e)},r.ext("twaver.ShapeSubNetwork",n.ShapeNode,{ISubNetwork:!0,_icon:$i.ICON_SHAPESUBNETWORK,_checkLinkAgent:function(){n.ShapeSubNetwork.superClass._checkLinkAgent.call(this);var e=this.getChildrenSize();for(var t=0;t<e;t++){var r=this.getChildAt(t);r instanceof es&&r._checkLinkAgent()}}}),n.LinkSubNetwork=function(){n.LinkSubNetwork.superClass.constructor.apply(this,arguments)},r.ext("twaver.LinkSubNetwork",n.Link,{ISubNetwork:!0,_icon:$i.ICON_LINKSUBNETWORK}),n.ShapeLinkSubNetwork=function(){n.ShapeLinkSubNetwork.superClass.constructor.apply(this,arguments)},r.ext("twaver.ShapeLinkSubNetwork",n.ShapeLink,{ISubNetwork:!0,_icon:$i.ICON_LINKSUBNETWORK}),n.RotatableNode=function(e){n.RotatableNode.superClass.constructor.call(this,e)},r.ext("twaver.RotatableNode",n.Follower,{getWidth:function(){return this._angle==0?this._getOrignalWidth():this._getRotateRect().width},setWidth:function(e){},getHeight:function(){return this._angle==0?this._getOrignalHeight():this._getRotateRect().height},setHeight:function(e){},getElementUIClass:function(){return n.network.RotatableNodeUI},getCanvasUIClass:function(){return n.canvas.RotatableNodeUI},getVectorUIClass:function(){return n.vector.RotatableNodeUI},_getRotateRect:function(){var e=this._getOrignalWidth(),t=this._getOrignalHeight(),n=m.createMatrix(this._angle*Math.PI/180,e/2,t/2),r=[{x:0,y:0},{x:e,y:0},{x:e,y:t},{x:0,y:t}];for(var i=0,s=r.length;i<s;i++)r[i]=n.transform(r[i]);return m.getRect(r)},_getOrignalWidth:function(){return n.RotatableNode.superClass.getWidth.call(this)},_getOrignalHeight:function(){return n.RotatableNode.superClass.getHeight.call(this)}}),n.controls.ControlBase=function(){n.controls.ControlBase.superClass.constructor.apply(this,arguments),this._pools=new Oi},r.ext("twaver.controls.ControlBase",n.PropertyChangeDispatcher,{_autoAdjustBounds:!1,addPool:function(e){this._pools.contains(e)||this._pools.add(e)},removePool:function(e){this._pools.remove(e)},adjustBounds:function(e){var t=this._view.style;t.position="absolute",t.left=e.x+"px",t.top=e.y+"px",t.width=e.width+"px",t.height=e.height+"px",this._autoAdjustBounds===!0&&(t.left="0px",t.top="0px",t.right="0px",t.bottom="0px"),this.invalidate&&this.invalidate()},setAutoAdjustBounds:function(t){t===!0?b.addEventListener("resize","_handleResize",e,this):b.removeEventListener("resize",e,this),this._autoAdjustBounds=t},isAutoAdjustBounds:function(){return this._autoAdjustBounds},_handleResize:function(e){this.adjustBounds({x:0,y:0,width:l.documentElement.clientWidth,height:l.documentElement.clientHeight})},getView:function(){return this._view},invalidate:function(e){this._invalidate||(this._invalidate=!0,r.callLater(this.validate,this,null,e))},validate:function(){if(!this._invalidate)return;this._invalidate=!1,this._view.offsetWidth===0&&this._view.offsetHeight===0&&this._reinvalidateCount!==null?(this._reinvalidateCount===t&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):this.validateImpl()},validateImpl:function(){}}),n.controls.ViewBase=function(){n.controls.ViewBase.superClass.constructor.apply(this,arguments),this._interactionDispatcher=new n.EventDispatcher,this._viewDispatcher=new n.EventDispatcher},r.ext("twaver.controls.ViewBase",n.controls.ControlBase,{__bool:["focusOnClick"],_focusOnClick:$i.FOCUS_ON_CLICK,getSelectionModel:function(){return this._selectionModel?this._selectionModel:this._box.getSelectionModel()},isShareSelectionModel:function(){return this._selectionModel==null},setShareSelectionModel:function(e){var t=this._selectionModel==null;if(t===e)return;e?(this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.dispose(),this._selectionModel=null):(this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel=new n.SelectionModel(this._box),this._selectionModel.addSelectionChangeListener(this.handleSelectionChange,this)),this.onShareSelectionModelChanged(),this.firePropertyChange("shareSelectionModel",t,e)},onShareSelectionModelChanged:function(){},removeSelection:function(){if(this.getSelectionModel().size()===0)return null;var e=this.getSelectionModel().toSelection();return this._box._undoManager._enabled&&this._box._undoManager.startBatch(),e.forEach(function(e){this._box.remove(e)},this),this._box._undoManager._enabled&&this._box._undoManager.endBatch(),e},selectAll:function(){var e=new Oi;return this._box.forEach(function(t){this.isVisible(t)&&e.add(t)},this),this.getSelectionModel().setSelection(e),e},isSelected:function(e){return this.getSelectionModel().contains(e)},isSelectable:function(e){return this.getSelectionModel().isSelectable(e)},getLabel:function(e){return e.getName()},getToolTip:function(e){return e.getToolTip()},getIcon:function(e){return e.getIcon()},getSelectColor:function(e){return $i.SELECT_COLOR},addViewListener:function(e,t,n){this._viewDispatcher.add(e,t,n)},removeViewListener:function(e,t){this._viewDispatcher.remove(e,t)},fireViewEvent:function(e){this._viewDispatcher.fire(e)},addInteractionListener:function(e,t,n){this._interactionDispatcher.add(e,t,n)},removeInteractionListener:function(e,t){this._interactionDispatcher.remove(e,t)},fireInteractionEvent:function(e){this._interactionDispatcher.fire(e)},invalidate:function(e){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}),r.callLater(this.validate,this,null,e))},validate:function(){if(!this._invalidate)return;this._invalidate=!1,!a&&this._view.offsetWidth===0&&this._view.offsetHeight===0&&this._reinvalidateCount!==null?(this._reinvalidateCount===t&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):(this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),delete this._isValidating)}}),n.controls.View=function(){n.controls.View.superClass.constructor.apply(this,arguments)},r.ext("twaver.controls.View",n.controls.ViewBase,{_zoom:1,_maxZoom:$i.ZOOM_MAX,_minZoom:$i.ZOOM_MIN,getRootDiv:function(){return this._rootDiv},isValidEvent:function(e){return b.isValidEvent(this._view,e)},getAlarmFillColor:function(e){if(e.IElement){var t=e.getAlarmState().getHighestNewAlarmSeverity();if(t)return t.color}return null},getInnerColor:function(e){if(e.IElement){var t=e.getAlarmState().getHighestNativeAlarmSeverity();return t?t.color:e.getStyle("inner.color")}return null},getOuterColor:function(e){if(e.IElement){var t=e.getAlarmState().getPropagateSeverity();return t?t.color:e.getStyle("outer.color")}return null},zoomOverview:function(e){var t=Math.min(this._view.clientWidth/this._viewRect.width,this._view.clientHeight/this._viewRect.height);this.setZoom(t,e)},getLogicalPoint:function(e){return b.getLogicalPoint(this._view,e,this.getZoom(),this._rootDiv)},centerByLogicalPoint:function(e,t,r){r&&n.animate.AnimateManager.endAnimate();var i=this._view.scrollWidth-this._view.clientWidth,s=this._view.scrollHeight-this._view.clientHeight,o=(e-this._view.clientWidth/this._zoom/2)*this._zoom,u=(t-this._view.clientHeight/this._zoom/2)*this._zoom;o<0&&(o=0),u<0&&(u=0),o>i&&(o=i),u>s&&(u=s),r?n.animate.AnimateManager.start(new n.animate.AnimateScrollPosition(this._view,o,u)):(this._view.scrollLeft=o,this._view.scrollTop=u)},panByOffset:function(e,t){e*=this.getZoom(),t*=this.getZoom();var n=this._view.scrollLeft+e,r=this._view.scrollTop+t,i=this._view.scrollWidth-this._view.clientWidth,s=this._view.scrollHeight-this._view.clientHeight;n<0&&(n=0),n>i&&(n=i),r<0&&(r=0),r>s&&(r=s);var o={x:(n-this._view.scrollLeft)/this.getZoom(),y:(r-this._view.scrollTop)/this.getZoom()};return this._view.scrollLeft=n,this._view.scrollTop=r,o},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(e){if(e<0)return;var t=this._maxZoom;this._maxZoom=e,this.firePropertyChange("maxZoom",t,e),this.getZoom()>e&&this.setZoom(e)},getMinZoom:function(){return this._minZoom},setMinZoom:function(e){if(e<0)return;var t=this._minZoom;this._minZoom=e,this.firePropertyChange("minZoom",t,e),this.getZoom()<e&&this.setZoom(e,!1)},getZoom:function(){return this._zoom},onZoomChanged:function(e,t){},zoomIn:function(e){this.setZoom(this._zoom*$i.ZOOM_INCREMENT,e)},zoomOut:function(e){this.setZoom(this._zoom/$i.ZOOM_INCREMENT,e)},zoomReset:function(e){this.setZoom(1,e)},checkZoom:function(e){return e<this._minZoom&&(e=this._minZoom),e>this._maxZoom&&(e=this._maxZoom),e},setZoom:function(e,t){if(!r.num(e)||e<=0)return;e=this.checkZoom(e);if(e===this._zoom)return;t==null&&(t=$i.ZOOM_ANIMATE);if(t)n.animate.AnimateManager.start(new n.animate.AnimateZoom(this,e));else{var i=(this._view.scrollLeft+this._view.clientWidth/2)/this._zoom,s=(this._view.scrollTop+this._view.clientHeight/2)/this._zoom,o=this._zoom;this._zoom=e,b.setZoom(this._rootDiv,e),this.firePropertyChange("zoom",o,e),this.onZoomChanged(o,e),this.centerByLogicalPoint(i,s,!1)}},setTouchZoom:function(e){this.setZoom(e,!1)}}),function(){var e=function(e,t,r,i){var s=new c;s.src=i,n.Util.registerImage(e,s,t,r)};e("subnetwork_image",64,46,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1JJREFUeNrkWmtQk1cafr4vUQhEiNeBpkWwXitCqK1WaiU4tCMjlmCnrU4rmE4v2v1Rmf7q7M6is/uj7e4OurMz7fSyiXXVddsasBa0xQawoqiFFPBWJATkVpQSLPdLTt/zkTCgSHVNuISXeZLvnC8JeZ7zvu8578kBRs/UhB0EE6GZwIaBmbCToIEXWSjBcAfCI4GLoZ3QzIX+0RwgpYnUsPT0dGY2m5nDwYagqKiYGQwGlpiYeKsQJvoc1UQjriKYCYwjJiaG5eScYN09fXeF8qsVLDk5hbneT2gWJkpYyARBJQpCMYFNV6nYRx9/wtq7uv8vnD57jkVGRjL+WYRmgsYDg+U+U0ydoiJvNpPjagICA2E6moVlERH39Zkt9hboEuJxobSUN+2iKMR2dPdYxkSAQD+FhoJSxxiLAY9LNsgtBeS6+qYFBuC/piNYGr7MLV/yZksLXkx6FpfKynjTRiJEtbR32EdFgNmB01REeAdjSHFm9N8146Ev8fgTq9zqqr/evImN8XGoq6nhzd1Nv7amelwA9awZOsrQBjizsHLaNCxf8YSEhUseue0L/nT5IgICArAp5RWP5Jeis2fwxpbN0jX3gtobv1g8IkCYOkjFiDiNvI63gx5QQ7/tD1i9Ng5KZcCYJtl3095BdqaJf3NjVX2j3u0CLA4LUTkcDjNzxvfLr24jbIdDmpLH3q7X1yMlKb5/xpGJSTwxOm9ZLldW2+9LgIhF8/vJ05zr76/EO399H0siHh1vawykvf0mSi1Fw9220/1cQRDyCBklV67a7kmA5eFLTNzt/ZVK/Ond3VCHPjwu1xqWwlM4lvnFQLvKehVtra23kyMRKFfsOVdyMfd3BYheHrmV3J4nPPz57/9CcEgoxqsRMdBADbRFQaQ+4HJZCWqrrDhtzkG1zTr49UZC6qnzxfZhBVj75EqVo89RybN9/MZNWLvhuYldg5AaDTVVOPnNURTmmwfCQxTF2O8KCi23CbBO+xQVLSxt+szZSP3LP9DrcHhFGSrQX431CrI/34+6a1VOcUR9tjnfOESAxHVxvD5XPbtZjwWRj8HbzNHTjexDeylELM41hBhlyvpGagibdBv40tYUOGMmknf8ET19ffBGk4si8r76H0rPF0rhIJPJww4czrDLfXx9+bqeprsodHR1w1utF31YGZeAlqYbaGyo4yvbdIJe2KZPLuZbUNoNz2O6ei683dqbfsbxz/e5QiFMrlD4SSs+1aw5cHhJ8hvJlLOCMG/hYtRfq+YZ8C25r59CujHVz9+rQ8Bl3TTIcxeHo7npOp8BtHI/Ig7XBhzDpDDV7GA4eWvkhn37pc650esmRQg4Yx8u3nJrZaV00dbZjclkLt5yV0e1tRwPjtPix6PrA14+0rO2zlaBkHkLJgXpcloROqtAO/eAPC5AydkCPBkXPykE4FydlivnNTOpkVZCNXZXZwf8/JXevRBqa8UZ83EqoQU+8+2V0UODzxS5TibKgnx8fLAoQiOVk96KzH2foOJCKWSiYOvpc2yXkuAUuXwP3TaczMrA07oXoPBSL+Be/n1WJqbK5TT6LLWzpxcyaXXU22tRKnx1zNEbdL2uBo89tVZyEW9CXVUFDO/vAnHkW+pGe1vHe0O2xIJUARpBFHlhhKSt27AmYaPXjHz+14dhMnzY32Ast765JdZ1T+a6aO3sapih9K+Sy2S68pIizJwTBHXo/Akd7/XVVhz453sozMmmmBe5Jxhrm5qTht0Uddl8dbCB3ruVX6+O1yFhy2sTbsQvnj+D77MzYb1UMtDHHCz1al3D7mE3RW+1R8JC0klBfpwFwSFhWP/yqwijCmpckCsqRENVJYLnhsGXCprO9jbUU7ujvRUN1ZVEumzI6xljRsKuS7ZrtuH3De9gkQvn6URBHPhdMJQEWPVMAhZHrRgz8vYbjfgg7W2J9EhGGd5GDxlEfM+P5VbbyBunI9jjSxepyBO4N2wd3B+6aCkio7USRss6O9rw2d92oqF/IG1E7lZiedTH9/1zz124ctc/mt7V+YBoTXgoifAWQUcIdfVvSNmOiFVrRkWAr/Z+iJLTeZIjUNkedaq41OaOz73nEyKxK5drnGJIXrF+y+tYtnK1B0e+HSe+3I/SMyelNidvLvxhbE6IDLb4mGiDS4SlK1YjVrcZvgo/t5JvrK3GsYOfSs/95Jn+WH6B0Z3/477OCCU+rd1JIqTx68AZs6DVbcKCcI0bRr0DRfnfouD4kYH8RyMfeyQnz+JuD7vvQ1LPr39GSyIYXLlhzgMP4dE1cZIQ9+oRLb/cQNm5Avxw8gS6yPWd01gukdd/kfWtzRMh5pZTYi/p1vPZYoczNwwcapxPIoQ8vFASZY76IRJEMeR9P9fWSESvVfyE8rJiNNbVDJ6/eabf9R/TUSM8aG49Jqd/IUkliiIXImXwbHEvRqQtNOJ7/n3osEeJe0SAwbY9ebOGxOBnjGKcYtxJEAsnTfiRkPHBZwdtGEX7TYABAPgBTYK366ChAAAAAElFTkSuQmCC"),e("bus_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAINJREFUeNqkU0EOgCAMo2Y/1P8Y/6NvnBADwTnGzHYiGetKW8DMKVJLChbVAwCNCrrzp5/Zg/4MaH0JMBOEh08o6OtxtgvXvkFuV/vFBeGEm0WZo8GgF+QlIkI2OrZq5WLAFjuy4DvVWXHl2VodyElMjkxAJNFm4EjmFGAqLKLf+RZgAKkFNRwzv7gHAAAAAElFTkSuQmCC"),e("data_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMZJREFUeNqkU8ENwjAM9KEwWwaAKVA3iMQDtRtUTAEDdLZWMkkhIUljU4n7RInP9p3dgoiYBAzDgHAyfykA1rtzbr2bmpDDk5uBvu+ROO98pvs4FqRL10nCogokBS3UBaXCZg9JQ7JQY5qmZoK1trCQCuQJnoS9CsQZHKsNcOyWvS1ehdGqz8xyZ0BXEHG+PTdvj+uJkFsASsusdN5sQSKHGWgWfDxY1GcQfEIYIn4p+HuN+SqXRtL8+ZAOinwm5V+P8ZcAAwC0T1T5kpEqewAAAABJRU5ErkJggg=="),e("databox_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwMjI+N/BiIBUD0jMp8FpDm4cQ2DvYEiw8EL9/FqBqkBqUc3BGT7/0kbz/6HsXHhS/eewtWBXA7CYAMOX75PlCEgA9ANYYQaADbJVleRAShJ0Csw7+T5G2MaQCpgQReAuQAWqPhokAuYGCgEowZQwwBQuiYn/mGAEZaeYTkSlA6IBeCUCDMA2RBSsjZAgAEAOyp6/CYHWkwAAAAASUVORK5CYII="),e("grid_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFdJREFUeNpi/P//PwMlgImBQsACIhgZGUl2BtDljCguAHkFhIMb1xBkU9ULjCATQV4A2UAsWFsfAvcCzEn/YQBoEEE2VD1Y76gXhpcXyM0LjJRmZ4AAAwCoyOJjz29PsAAAAABJRU5ErkJggg=="),e("group_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOFJREFUeNqUUwsOwjAILa67i2fwEMbEnUej55mJO4Rn8DBtglAh6YfOSdJkBfregwEgottiHiAlQuZjh68TQRJzI5L07nSbC//zOrUAmkxAJXBP2VgxRjpDK818z06gZIwrfSACF0iVVZrLiab7ownOl7PTV0QESsRgWqoHt80oD0fpy/BVhuZfsOpkC8LYxAkBw4YedOdDhuRny1UyZEPE334NvbZ6kBYeJGFPKFgp4HsUAqtI9u1AYipJgfQ+GjtQlPvPMkGlBHrLdFjeBeHruE+hYAxSo6C3jb4zyh8BBgBVL19PZ27iaAAAAABJRU5ErkJggg=="),e("group_image",32,29,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABHNJREFUeNqsV1ts21QY/uy4zc1ZnZY2bdbSLMlKxUWkaBJMgJY9gARIax/2NokVofLARWjiBYRY2QMdCGlI440H1ok3btsQ0wAxNdvKpnYdyyYK7UZHVK1L2rRZLo3j2InDOaZD60psp+WXrDjO93/nO7/PfwkDAwu0Nh8jH30wZwc6/f43X9jVJ5gBn/zueJozgaNkUXLtMwLyLt4XDG4Vtj+/B8lMQRf7QLsb079PCpzJnaVnEsmIEeiZgD/Mu5yYT4uYiWd1sW1NTlCsWQGmzC00gOd5lFQVkqLoYiuViobVBNzf3BRaCfUaUyuV2AomXI1sNrmkRUeUZBRlBXJJRVFRdQUoZVXDclvbvUeImn6j3VmAqpjg5ra0xcL2nDwdwW1JQeP2HJLLki7frVQOo+OXwNnttv5fp65vKPSvvLhHmBgf77fV10XqWBaLZPGEgYC0KIFiOYfdBoY8OH72D8QS6ZoX3x1+CFarFZSnxS1gk9OBeUJ+00BAimAolnM6nQDDEDVAHVOpWQBD/Ow2GyhPoyDHWKjYkr+GVrv+GWBmE6BYIsChRYCz0Kt2AWR92GxWUJ7TFy7GWltb9l368ZteM77lcukE53A4tC91VAC7jggwVIANd3h+OHM+Qlj2ktvQv9U0EIAkSZibm7vbNUpcIxxPQsfQV2BhwDHrE2C320F5qPnaPCMkdVel9EdDQ8iLeex/5+27H4dYljnGnRo5B1EUMT1fwI2lUs0CHs9JOD9xGeNjY9i7u9dXkKTovZgvv/j8H+y2njX+3FxiHmKhgHiGhCir1CwgKxawsLgEynP06xO0aO2sxV+rhAopm9migrRUuwCJVDMS8nXXEE2ALMtIF2UskVJaqxWIgIqqrl8ATUGFkNDaLKu174RGjzYWykO9A17P+6pa2WEqhVnmDOfmnUgmk+gN2vBsZ33NAng1DxspIpTH1+H1Pdrz2OCHn34GpaQfFYe1Dm+9+nKY62jzpIcG3xU20gukXAZtzU0Rkoo+mo6/TMZxI6E/Dzz9sFdLXc7jad6pSIW+jQho2OSKjl2djOyiAwmdB8jrLMj6Ka3emQd+Gh2jeUvTp7/aTGBgwyv+cJNm5HLx2plQSmX9AkYuiuXqOUuorKoj1RZ/7fU34PcHMLj/PSwv5/4LMsgy7EtKuTz887kLyMoq7CERi/miroD5TB4Xr/wGrsPT8omqqlV3PjAwgIYGAd9/+xVmrledG46QjhiZjs0iSYtSehk3M6KugAUigGK5rqA/rAc89MEBOJy81qq7u4LVJyYL27eYSkV50hkXxCLmDCKQIhiK5do3e3VL59TUNdrZ0N3dddTgLMQ89zX5XKQtP+m14kGB1QVv4VVMrIwCRn9M6PkAGctN1fjnwk9ddjc2hcxgb6eWov/rWE7tVGS0ZyWjfEYRoxlkVoBAIhE2gYst5vKDpVJ51QR96PBhxONxfHzw4Oo+wFl2mBFAJ1W6+IgR0OGwD2/zda4Z32/99ScpTiU80fPIvT/1/y3AAMOmtJl1Hv9IAAAAAElFTkSuQmCC"),e("link_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHVJREFUeNqkkwEOgCAIRaEr6nlqdR49I4XTzcqUn39jE5xP1C+LCPkjCl0Kq2NC5fYgRXlMSCw0K6Xozhqaol3ckj+QVwGFNIsI5HPCCunSLZDhGUcQ0033IOb3riE1CLJty/bTVubUBqDyc+Pm01oY8NQpwAAbUwhLBQIWcAAAAABJRU5ErkJggg=="),e("linksubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAU5JREFUeNqUUi1Tw0AQ3cukEY0AwdlDM8XRD41ARAAi/RHoCmQ7/QNofkTQFQh8W9kOOtgiQIBImTnuXbs3udAvduZms5t9b/fdrUiHGW2z0cOdLsdJ71GU46yfUrgL/PWx8HLxsUTOI3EE98mp9ZdXie0K8HgydYXtVtN6znHsTQAwdy2DOcY/TMFytkqogqskLIf6qQhYL7q/PI8cOIoiiuO69bvIRf3o5M/YANVqIZ03GjSbz2m5/KGiKDxgp90irbUINzEz2BSQEMKSwJiEwfgONmlFR4AAhg2yV0talWNfAbfJN4s7KHcCCcBPgy7WhobdM7q9uXbd3TPyhvEOwL4/30kpRVJKwrYySZ7nWABlzpsthM49R5lzYUhAruERr/P7CdZNPJJVakUiuOgAw9jSXOyUX8f4ZkCHGzQvAGIw4v9M4E0CMEh/BRgAwM37IYxGnbkAAAAASUVORK5CYII="),e("node_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg=="),e("node_image",30,32,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAgCAYAAAAFQMh/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAO0SURBVHjavJZJaF1lGIaffzzn3pvbxAyYJulgNKJIF7WkuhEHFCy40LpRBLdFcFi4ciOCC9dmU910WbduBEEoRhFEarJw2UaLJXFImya5ubln+AcX5+YG3ZjCaT44cDb/+5zv/Ybzi7npo7Mhhi+886c5hFBaLUshX9dKq8tW2bPjExOHweXW+vpZ7/1lrZWanz52jK+//f5QwC8+8xSrN2/Oa2OM10pJgKwoWd/cRQpRKyzEyMRIk9QatFIYY7xOEou1BoD1zS6ff/kTqbW1grtZyVsvz3N8cgRrDUli0dZabB+kpGSkYdHWUGfOSkT6prLH04m1GFOBBaAkKBkQsU5wACpBYyyJtfSt1hVYVGDZf68rpNjXs1b3rU72rZaAlhFJRMj6wJUm+1bv1diYqrmEFCgJQtaf8Z6gMaaqcbPRpJGmgxprCYhYK1iL/YwbaUqz0UTneUFeusG8uRARNYPLEAn95spLR54X6K+uLDI1NQ3A7e0ey3+UtBJDnfO004vc6WRMjg3zzeIPrK2toje3O6StLWII7GYFt7qOPNS7uTo9x25WEENgY2uLze0Oem9xhOBwwZM5j3WyVnDmPC54QnAoWWlrgBgj3nuc9+yWHq3rBe+Wlbb3nhjjPhiowM7TdQ7t6rW66xzOVeBBpw/AzlM4z3bpkTVnvF1W2t79B1xZXVI4x3bpUfcE7PC+/LfVUgic80giY6lhJDG1gmUESawY/QWhG0aLxBh2dnoMqcBrpyawNWdcuMCQCuzs9EiMoWG00GPDR2QrMVxdWqIsch5L1cCOukJowerKn/x9M6GVGMaGj0hx+uEHrypjzzwwN0cI4Z7et6SU/HbtGr4sftbNVvN9a5NP1m78elpK6a0x9wRalCUhBNUeai0Xhf5ASykXh4fbbxo9+nin2y2v3/i9B3jq29YRUA+dPN5ot1qmdOXS7dvldfHIiRky5wBJt9djfePONHA/4Or6KwJ/TYzet9pqNIBAqjVianSEtY1NgCeBd4FTQBuoq+AS6AC/AAvAj1OjIzAzPoqS8pyAFQHx/x4gzs7OxosXP4ufLizEkydORA5wrv+sKCnPzYyPooFHh5vppQiTB/n8PMt47523Of/qebIsY7fT4eOPPiRJkoMcnxVwCXhOH2kPXWi3WpMH7s48J5Ql1tpq3p3j6Pj44MJ4gJgUUlwQzz5xpgMMHbhFYyRNU55+/gWC93x35Qp5niHu7q60I9545aUeoO5qPkJAqupICOFuoQD+nwEAIKWd899qAZAAAAAASUVORK5CYII="),e("shapelink_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIJJREFUeNqkUwsOgCAIxeYN5Ty1Og+ekUarzRwQ5tsYDpTPExIzgwY86uWgtSTwIAF6KTvxg/sMliwwCy27mEVr2Xu7+TjaWm4JqxvKpW/iWowQprX2i8RXhS0xXv+WL0xiKIAVxKssa/0hEMuPiB4epNFxnh7lZG1jdCPdABGcAgwAc06H0rgwLSIAAAAASUVORK5CYII="),e("shapenode_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAI9JREFUeNq0UtsNgDAILI0jdZN2Ho3O027SnRA+MNb0QTWS8EPuLncAIKL5UvY5CEdC7h7pjrEtEABgqwucRCBFk7aAfo9uZJtwmXhQCLDyLJlrkSxaMuGgu8QZ8hVhYD8LVgZx9fMO1H9QKXbm+EJvBYwsuSYyFaEmUvyBUkQWCYUDfg5NV8/49xW6dQowAIJydCoPajIHAAAAAElFTkSuQmCC"),e("shapesubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATBJREFUeNpiDG5cw4ALbO/L+I/M9yyawYjMX1MXzMCCT/PXD69RxLgFREFiKIbADSjzlAfTjq6eYFtBmk+dPgNXaGZqAqZhYjA+igtAmmG2ImuG8UFyIFfAvIPTC+ia0Q2BeYehLpiRCeZfkO37d2/HqRmX4Yxc/CJwZ9+6fYeBEPjw4QOYNjczZfj//z8j3AuMjIjAvXnrNoomdTVVFDkonxEjEIEmgg1C1oAuhw5YQKEZGhHzH9kVbcuPoiiqirSGy5UUF8FtBwFwIK5esYQRaIMfyE/Y/A0yEGbopk2b/FACEeQ0mO1Ati+UvQndFciuAVkG5W5GMQDqV1+QAci2oxuAFC5+4MCBGQIzAEKBBbFimBxILc7MhOQiPzTxTcixwYhsOxLwRWJvxicHEGAAkPKxzyGuYWgAAAAASUVORK5CYII="),e("subnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNqkUjsOwjAMzavSBQYY4FDM7SGYOUARHICZQ5SBiUPBAAMLIJk8aFASkoDgSVFlu/68Z6NatCqF3Woqrj2ZreHabVMpnUs+H/eerz8c0+cV0amuTK6XG69bDEWsa5hM0KafU/DZeJRCmBwWsXRUUwEU0Y5tRFLfgHRMARYDeoPRSyy383Zee0nsgO5rcROBzo19FUlOoYG0Bp/0IAW7y4LHQT5GB/UL4F6ie3mX0yFLoTQUTByQxE8lQ51wMRHx1Chd4FtkReQUj3VFktj97ZSDNYkK9h6L/03hLsAAjRx4oMVjqkMAAAAASUVORK5CYII="),e=function(e,t,r,i){n.Util.registerImage(e,i,t,r)},e("expand_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw=="
),e("collapse_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7"),e("close_icon",11,11,"data:image/gif;base64,R0lGODlhCwALAIcAAHd3d319fUD/QIODg4iIiI6Ojq6urri4uNnZ2eHh4eTk5Ofn5/Dw8PT09Pj4+Pn5+fz8/P39/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAIALAAAAAALAAsAAAhdAAUIOECw4AGBAyUoXCjh4AEJDBA4mIiAQcMDERAUKOBgI4IIBCE0IECSZAMIBB8wYDCg5coHBBkkCECTZgIGMQ0AAKBgpwGcBxgsMLCgKFGcA1cqXXlQoMGCAgMCADs="),e("sort_desc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMDI4QYrnC0INxUnYLADs="),e("sort_asc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMlAWnwIrcDJwi2HsLADs="),e("submenu_enable_icon",8,8,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAA7SURBVHjafI9BDgAgDMKqH3c/ryd1iTqOpARARQUYJG0/AWboB2yoAgTG8jtvtXvMSUdVEdXIeN2cAwDPLmAjfDYS7AAAAABJRU5ErkJggg=="),e("submenu_disable_icon",8,8,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAABKSURBVHjafM9BDoAgDETRD1cTz0W9luDZxhUBCjpJkzZ9m0ESkrhLzW0fJ9JjpT4Zl+juBXmwoB0ACH/gOtNhX2B6AjDUtF3NdwAU6zx4LEQe5AAAAABJRU5ErkJggg=="),e("checkbox_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAflJREFUeNqkk09oE1EQxn+7btyIYBRCbayFtlhEtLeAin+KouDNo548eJHCQkFQC1K0Bw8VqT1EVIqo0IMUvejNg6AIIglSsdSCiA0WolaIOWi3+2fGw242CRFBHPjg8d7MfPO+mTEcxzkNDAF5/s1KwE0cxylWKhX1fV89r44gget6bVhd9bRcLqvjOEULyGezWTwvAMAwjIRCRAnD8I/0nZ05gLwZOTYeVBXQOIGgqgk+flrk3MUxVBWRyMeMw5oCG2eREFVBVZibf8+x4ydZLH9GVRISq5W5uXwhDKPSvnz9xolTZ/A29GNZFiJ1kjhBnVFVEw0a7MrQ8HlqbMZwXeYXlpL7ti/Usbz8Hd8PEBGmHzxk9kMVfI+BrWt4PHM/0abtC67r8vTZC4qlWY4c2s/Azh2MTxQwpIPduzZx99Z1bNtu1yBiFp6/fMXr4ht+/NzI+MQNBg/sxdccPbmAqcI1UqkUEresTQMR5ejhQbb19XJ25BJzC8Lbd3dIp22mCtPY9tokuDmB2VyBqtDb082VyxdYv26JXysrTF4dY0uuI3lvoKWCaOoMA1SF7q4u7t2eZObREw7u25MMTbPF8VGCqHNRB4IgQFXY3t/H6MhwLFirGYZBfeItoFSr1fKZTAbVaPbT6fRf19A0TarVKkDJ+N91/j0A8Y5o3Yt7KRAAAAAASUVORK5CYII="),e("checkbox_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAiUlEQVR42qXM3QYFIRiF4d3dJpIhI5FKJCOSSHe7f9gn4ztZo3Wwzt6HvTbHfhdCeD8Nvw27Ad57OI4xUsA5BwMpJQpYa2Eg50wBYwwMlFIocJ4nDFzXRQGtNQzUWilwHAcMtNYooJSCgd47BaSUMDDGoIAQAgbmnBTgnMPAWosCcP3fDdjZNvABvRhVEQglsV8AAAAASUVORK5CYII="),e("radiobutton_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAXFJREFUeNrUUz9rwkAUv0syBVxMm01L2lIdilOg4BcQ7eKcIV/AqZAxo1/B2a/QoSSTH6AQCoFMJUSig5C0EiPEv8G+Z604eJNTHxz37vf73Y977+7obrcjlwRHLoyLDYTThWmav6AgKDA9wrg6UF8wvO12O8RFt9s9bwACwvP8U6lUajWbzbYsy/eIR1Hk27b9GgSBlef5O7OEzWZzC5ufNU17gc01gEQcmCOGHGqYJaxWq1qj0WhzHFfwfZ84jrPHVVUliqIUkPM87wOg4KzBcrm8liTpbr1ek8FgQNI03eOz2Yzouk6QQw3zBFmWUewDxnQ6JUmSHHsDRz9qmD0A8ns8HgcortfrRxxzxJBDDfMEi8XC7ff7b4Zh3FSr1UKlUtnjlFI0mCOHGqZBHMd+GIbWZDIROp1OCxqH74HA9Q17vZ7luq4liqJ/uoee/oVyufxX/wPctwqpfKAieB9OsVj8xMVoNDpv8D8/048AAwDskrF8QGeJUgAAAABJRU5ErkJggg=="),e("radiobutton_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATVJREFUeNrUU71qhEAQ9q8S0mhip3C5kCpcFcgjiJfmal/BKr2lr2DtK1wR9BkCaYRUQTzUQtDE5sB/MTOJAQs3jVUGhp2Z75vPnV2XHseRWmMMtdJWC3DzxDTNnyLHbWC5A7+coA/wt77vT5hYlrUsAASKZdkHWZb3mqYdJEm6wXqWZYHneccwDN1hGF6II3Rddw3Nj7quP0HzDko8OsZYQww5RIGmaXaqqh4YhrnA3cwda4ghh3gGdV1fiaK4bdt28cAQQw5RoCxLGr/2lyGHOAKAn0mShDAnteSIIYcoUFWV7zjOM5DPuJPfxik+I4Yc4gh5ngdRFLlpmnKGYew3YFiH6zvZtu36vu/yPB/Me+j5W1AU5XstiuIW7vseQmmCMvg/XgVBeMckjuNlgf/5mL4EGAAhHbltcqEYDQAAAABJRU5ErkJggg=="),e("right_expand_icon",6,11,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjJGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjNGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE5MUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE5MkZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqPQWR4AAABJSURBVHjaYvT08vrPwMAgCsQM27ZufcMABUxQ+jWI8PL2FkGXwJBElkCRRJeAS2KTAEvikhDFJiGKzSi4f5iwCSLrwPA5QIABAAmgFhOOHdKvAAAAAElFTkSuQmCC"),e("left_expand_icon",6,11,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjZGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjdGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3RkFFMUVCNEZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3RkFFMUVCNUZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PmpWGHAAAABISURBVHjaYvz//z8DDHh5e4tAma+ZsAmCCCZsgiDAfOr0aQxBuA50QZgEhiBMQhSXBAM2SaZtW7e+wSYJ1oFNEu5BdEmAAAMAvV8Xc/cw3YgAAAAASUVORK5CYII="),e("up_expand_icon",11,6,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEZGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOTBGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE4REZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE4RUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnCNygcAAABGSURBVHjaYvz//z8DDHh5e4tAma+BWBTE2LZ16xuYPBMOhXAaSRyiGItCBmwaGD29vHApRAaiyM7ApxAuz0SEQrgGgAADALOxFSETkKKwAAAAAElFTkSuQmCC"),e("down_expand_icon",11,6,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0xpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOENGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEJGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtPgXX8AAAA7SURBVHjaYvH08vrPQCRgAmJRItWKMsEYhBSCTd62desbAhrA4iB1TDAGDg2iyPIwZ2DTIIomzgAQYAAmahUFv1Iq6AAAAABJRU5ErkJggg==")}(),p.__tree=function(e,t){e._rootVisible=!0,e._initTree=function(e){this._rootData=null,this._expandMap={},this._levelMap={}},e.validateModel=function(){this._rowDatas.clear(),this._levelMap={},this._dataRowMap={},this._currentLevel=0,this._rootData?this._rootVisible?this.isVisible(this._rootData)&&this._buildData(this._rootData):this._buildChildren(this._rootData):this._buildChildren(),delete this._currentLevel},e._buildData=function(e){this._dataRowMap[e.getId()]=this._rowDatas.size(),this._rowDatas.add(e),this._levelMap[e.getId()]=this._currentLevel,this.isExpanded(e)&&(this._currentLevel++,this._buildChildren(e),this._currentLevel--)},e._buildChildren=function(e){var t=e?e.getChildren():this._box.getRoots(),n=this.getCurrentSortFunction();n&&this.isChildrenSortable(e)?t.toList(this.isVisible,this).sort(n).forEach(function(e){this._buildData(e)},this):t.forEach(function(e){this.isVisible(e)&&this._buildData(e)},this)},e.getLevel=function(e){return this._levelMap[e.getId()]},e.getToggleImage=function(e){return e.getChildrenSize()>0?this.isExpanded(e)?this._expandIcon:this._collapseIcon:null},e.isCheckable=function(e){return this.isCheckMode()},e.isCheckMode=function(){return p.__tree._checkMap[this._checkMode]===1},e.isChildrenSortable=function(e){return!0},e.handleDataBoxChange=function(e){e.kind==="remove"?delete this._expandMap[e.data.getId()]:e.kind==="clear"&&(this._expandMap={}),this.invalidateModel()},e.isExpanded=function(e){return this._expandMap[e.getId()]===1},e.expand=function(e){if(this.isExpanded(e))return;var t=e.getParent();while(t!=null&&t!==this._rootData)this._expandMap[t.getId()]=1,t=t.getParent();this._expandMap[e.getId()]=1,this.invalidateModel()},e.collapse=function(e){if(!this.isExpanded(e))return;delete this._expandMap[e.getId()],this.invalidateModel()},e.expandAll=function(){this._box.forEach(function(e){this._expandMap[e.getId()]=1},this),this.invalidateModel()},e.collapseAll=function(){this._expandMap={},this.invalidateModel()},e._handleClick=function(e){this.isFocusOnClick()&&n.Util.setFocus(this._view);if(this._isValidating)return;var t;if(e.target._expandData&&!e.target.ableExpand)t=e.target._expandData,this.isExpanded(t)?(this.collapse(t),this.fireInteractionEvent({kind:"collapse",data:t})):(this.expand(t),this.fireInteractionEvent({kind:"expand",data:t}));else if(e.target._selectData||e.target.parentNode._selectData){this._handlePressSelection(e.target._selectData||e.target.parentNode._selectData,e);if(this.isCheckMode()){var r=this.getRowIndexAt(e);r>=0&&this.__handleClick(e)}}else this._treeColumn?(t=this.getDataAt(e),t&&(this.isCheckMode()?e.target._checkData||this.__handleClick(e):this._handlePressSelection(t,e))):this.isCheckMode()&&!e.target._checkData&&this.__handleClick(e);this._currentEditor&&!this._isCommitting&&(this._isCommitting=!0,this.commitEditValue(this._currentEditor._editInfo,this._currentEditor));if(this.updateCurrentEditor){var i=this;setTimeout(function(){i.updateCurrentEditor(e)},0)}},e.__handleClick=function(e){var t=this.getDataAt(e);if(!t)return;var n=this.getRowIndexByData(t);if(this._focusedRow!==n){var r=this._rowDatas.get(this._focusedRow);this._focusedRow=n,r&&this.invalidateData(r),this.invalidateData(t)}},e._handleDoubleClick=function(e){this.isFocusOnClick()&&n.Util.setFocus(this._view);if(this._isValidating)return;var t;e.target.ableExpand&&e.target._expandData&&(t=e.target._expandData,this.isExpanded(t)?(this.collapse(t),this.fireInteractionEvent({kind:"collapse",data:t})):(this.expand(t),this.fireInteractionEvent({kind:"expand",data:t})))},e.handleChange=function(e){if(this._isCommitting||this._isCanceling||this._isValidating)return;var t=e.target._checkData;if(t){var n=this.isSelected(t),i=this.getSelectionModel(),s;if(this._checkMode==="default")n?i.removeSelection(t):i.appendSelection(t);else if(this._checkMode==="children")s=new Oi(t),s.addAll(t.getChildren());else if(this._checkMode==="descendant")s=new Oi,r.fillDescendant(t,s);else if(this._checkMode==="descendantAncestor"){s=new Oi,r.fillDescendant(t,s);if(!n){var o=t.getParent();while(o)s.add(o),o=o.getParent()}}n?i.removeSelection(s):i.appendSelection(s)}e.target._editInfo&&this.commitEditValue&&(this._isCommitting=!0,this.commitEditValue(e.target._editInfo,e.target))},e.onLabelRendered=function(e,t,n,r,i,s){},e.onToggleImageRendered=function(e){},e._renderTree=function(e,t,n,i){var s=this._levelMap[t.getId()],o=this.getToggleImage(t),u=this.getLineType(),a=this._indent,f=this.__spanPool.get();f.style.display="inline-block",f.style.position="relative",f.style.verticalAlign="top",f.style.margin="0px 1px 0px 1px",f.style.width=(s+1)*a+"px",e.appendChild(f);var l=t,c=l.getParent(),h=0;if(u==="dotted"||u==="solid"){if(c==null){var p=this.getIcon(t);this._addLine(f,t,p,!0)}while(c!==null){var d=c.getChildren(),v=l===d.get(d.size()-1),p=this.getIcon(l);l.setClient("isLast",v),h==0&&this._addLine(f,t,p,v),h++,l=c,c=c.getParent()}}if(o){var m=this.__imagePool.get();m.setAttribute("src",r.getImageSrc(o)),m.style.verticalAlign="middle",m._expandData=t,m.style.position="absolute",m.style.right="0px";var g=this;m.onload=function(){m.style.top=g.getRowHeight()/2-m.height/2+"px"},f.appendChild(m),this.onToggleImageRendered(m)}var y=this.isCheckable(t),b=this.getUncheckableStyle()==="disabled";if(y||b){var w=this._addCheckBox(e,t,i);w.disabled=!y}var p=this.getIcon(t);if(p){var E=this.isCheckMode()||this._treeColumn?null:t;this._addIcon(e,t,p,E)}var S=this.getLabel(t);S&&(f=this.__textPool.get(),f.style.whiteSpace="nowrap",f.style.verticalAlign="middle",f.style.padding="1px 2px 1px 2px",r.setText(f,S,this._treeColumn?this._treeColumn.isInnerText():this._innerText),o&&(f._expandData=t,f.ableExpand=!0),!this.isCheckMode()&&!this._treeColumn?(f._selectData=t,f.style.backgroundColor=i?this.getSelectColor(t):""):this._focusedRow===n&&(f.style.backgroundColor=this.getSelectColor(t)),this.onLabelRendered(f,t,S,n,s,i),e.appendChild(f),e.title=this.getToolTip(t))}},p.__tree._checkMap={"default":1,children:1,descendant:1,descendantAncestor:1},n.Column=function(e){n.Column.superClass.constructor.call(this,e)},r.ext("twaver.Column",n.Data,{IColumn:!0,__property:1,__accessor:["width","horizontalAlign","valueType","propertyType","propertyName","editable","visible","sortable","resizable","movable","sortDirection","sortFunction","enumInfo"],__bool:["innerText"],_innerText:$i.COLUMN_INNER_TEXT,_width:$i.COLUMN_WIDTH,_horizontalAlign:$i.COLUMN_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:$i.COLUMN_PROPERTY_TYPE,_valueType:$i.COLUMN_VALUE_TYPE,_editable:$i.COLUMN_EDITABLE,_sortable:$i.COLUMN_SORTABLE,_visible:$i.COLUMN_VISIBLE,_resizable:$i.COLUMN_RESIZABLE,_movable:$i.COLUMN_MOVABLE,_sortDirection:"asc",_sortFunction:$i.SORT_FUNCTION,_enumInfo:null,renderCell:$i.COLUMN_RENDER_CELL,renderHeader:$i.COLUMN_RENDER_HEADER,renderEditor:$i.COLUMN_RENDER_EDITOR,setParent:function(e){throw"parent not supported"},getEnumInfo:function(){if(typeof this._enumInfo=="object")return this._enumInfo;if(typeof this._enumInfo=="function")return arguments.length===1?this._enumInfo(arguments[0]):this._enumInfo()}}),n.ColumnBox=function(e){n.ColumnBox.superClass.constructor.apply(this,arguments)},r.ext("twaver.ColumnBox",n.DataBox,{_name:"ColumnBox",add:function(e,t){if(!e.IColumn)throw"Only IColumn can be added into ColumnBox";n.ColumnBox.superClass.add.apply(this,arguments)}}),n.Property=function(e){n.Property.superClass.constructor.call(this,e)},r.ext("twaver.Property",n.Data,{IProperty:!0,__property:1,__accessor:["horizontalAlign","valueType","editable","propertyType","propertyName","categoryName","enumInfo"],__bool:["innerText"],_innerText:$i.PROPERTY_INNER_TEXT,_horizontalAlign:$i.PROPERTY_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:$i.PROPERTY_PROPERTY_TYPE,_valueType:$i.PROPERTY_VALUE_TYPE,_editable:$i.PROPERTY_EDITABLE,_categoryName:$i.PROPERTY_CATEGORY_NAME,_enumInfo:null,renderName:$i.PROPERTY_RENDER_NAME,renderValue:$i.PROPERTY_RENDER_VALUE,isVisible:null,renderEditor:$i.PROPERTY_RENDER_EDITOR,setParent:function(e){throw"parent not supported"},setPropertyName:function(e){var t=this._propertyName;this._propertyName=e,this.firePropertyChange("propertyName",t,e)},setPropertyType:function(e){var t=this._propertyType;this._propertyType=e,this.firePropertyChange("propertyType",t,e)},getEnumInfo:function(){if(typeof this._enumInfo=="object")return this._enumInfo;if(typeof this._enumInfo=="function")return arguments.length===1?this._enumInfo(arguments[0]):this._enumInfo()}}),n.PropertyBox=function(e){n.PropertyBox.superClass.constructor.apply(this,arguments)},r.ext("twaver.PropertyBox",n.DataBox,{_name:"PropertyBox",add:function(e,t){if(!e.IProperty)throw"Only IProperty can be added into PropertyBox";n.PropertyBox.superClass.add.apply(this,arguments)}}),n.Tab=function(e){n.Tab.superClass.constructor.call(this,e)},r.ext("twaver.Tab",n.Data,{ITab:!0,__accessor:["view","width","closable","resizable","movable","disabled","visible"],_icon:null,_width:$i.TAB_WIDTH,_closable:$i.TAB_CLOSABLE,_resizable:$i.TAB_RESIZABLE,_movable:$i.TAB_MOVABLE,_disabled:$i.TAB_DISABLED,_visible:$i.TAB_VISIBLE,setParent:function(e){throw"parent not supported"}}),n.TabBox=function(e){n.TabBox.superClass.constructor.apply(this,arguments),this.getSelectionModel().setSelectionMode("singleSelection")},r.ext("twaver.TabBox",n.DataBox,{_name:"TabBox",add:function(e,t){if(!e.ITab)throw"Only ITab can be added into TabBox";n.TabBox.superClass.add.apply(this,arguments)}}),n.controls.ListBase=function(e){n.controls.ListBase.superClass.constructor.apply(this,arguments),this._invalidate=!1,this._invalidateModel=!1,this._invalidateDisplay=!1,this._invalidateDatas=null,this._rowDatas=new Oi,this._startRowIndex=0,this._endRowIndex=0,this._renderMap={},this._dataRowMap={},this.__divPool=new n.Pool("div",20),this.__imagePool=new n.Pool("img",20),this.__canvasPool=new n.Pool("canvas",20),this.__spanPool=new n.Pool("span",20),this.__textPool=new n.Pool("span",20),this.__checkBoxPool=new n.Pool("input",20),this.__linePool=new n.Pool("canvas",20),this._pools.add(this.__divPool),this._pools.add(this.__linePool),this._pools.add(this.__imagePool),this._pools.add(this.__canvasPool),this._pools.add(this.__spanPool),this._pools.add(this.__textPool),this._pools.add(this.__checkBoxPool),this._view=b.createView("auto",!0),this._rootDiv=b.createDiv(),this._dataDiv=b.createDiv(),this._dataDiv.style.width="1px",this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(e?e:new n.DataBox);var t=this;t.handleChange&&t._view.addEventListener("change",function(e){t.handleChange(e)},!1),h.isTouchable?h.isMSTouchable?new n.controls.ListBaseMSTouchInteraction(this):(new n.controls.ListBaseTouchInteraction(this),new n.controls.ListBaseInteraction
(this)):new n.controls.ListBaseInteraction(this)},r.ext("twaver.controls.ListBase",n.controls.View,{__bool:["innerText"],_innerText:$i.LISTBASE_INNER_TEXT,getDataDiv:function(){return this._dataDiv},getStartRowIndex:function(){return this._startRowIndex},getEndRowIndex:function(){return this._endRowIndex},getRowDatas:function(){return this._rowDatas},getRowIndexByData:function(e){return this._dataRowMap[e.getId()]},getRowIndexById:function(e){return this._dataRowMap[e]},getRowSize:function(){return this._rowDatas.size()},getDataBox:function(){return this._box},setDataBox:function(e){if(!e)throw"DataBox can not be null";if(this._box===e)return;var t=this._box;t&&(t.removeDataBoxChangeListener(this.handleDataBoxChange,this),t.removeDataPropertyChangeListener(this.handlePropertyChange,this),t.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||t.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=e,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(e):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",t,this._box)},onPropertyChanged:function(e){e.property==="zoom"?this.invalidate():this.invalidateModel()},invalidateModel:function(){if(this._invalidateModel)return;this._invalidateModel=!0,this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate()},invalidateDisplay:function(){if(this._invalidateDisplay)return;this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate()},invalidateData:function(e){if(this._invalidateDisplay)return;this._invalidateDatas||(this._invalidateDatas={}),this._invalidateDatas[e.getId()]=e,this.invalidate()},validateImpl:function(){var e=this._view.scrollLeft,t=this._view.scrollTop;this._invalidateModel&&(this._invalidateModel=!1,this.validateModel()),this._invalidateDisplay&&(this._invalidateDisplay=!1,this._renderMap={},b.release(this._dataDiv),this._dataDiv.style.height=this.getRowSize()*this._rowHeight+"px");var n;if(this._invalidateDatas){for(n in this._invalidateDatas){var i=this._renderMap[n];i&&(b.release(i),this._dataDiv.removeChild(i),delete this._renderMap[n])}this._invalidateDatas=null}var s=this._view.scrollTop/this._zoom,o=this._view.clientHeight/this._zoom;this._startRowIndex=Math.floor(s/this._rowHeight)-2,this._endRowIndex=Math.ceil((s+o)/this._rowHeight)+2,this._startRowIndex<0&&(this._startRowIndex=0),this._endRowIndex>this._rowDatas.size()&&(this._endRowIndex=this._rowDatas.size());var u=this._rowHeight-this._rowLineWidth-2+"px",a=this._rowLineWidth+"px";for(var f=this._startRowIndex;f<this._endRowIndex;f++){var l=this._rowDatas.get(f);n=l.getId();var c=this._renderMap[n];if(!c){c=this.__divPool.get();var h=c.style;h.position="absolute",h.whiteSpace="nowrap",h.lineHeight=u,h.top=f*this._rowHeight+"px",h.borderStyle="solid",h.borderWidth="0px",h.borderBottomWidth=a,h.borderBottomColor=this._rowLineColor,h.opacity=l.getStyle?l.getStyle("whole.alpha"):1,this._dataDiv.appendChild(c),this._renderMap[n]=c;var p=this.isSelected(l);this.renderData(c,l,f,p),this.onDataRendered(c,l,f,p)}}this._dataDiv.style.width=this.calculateSumWidth()+"px",this._dataDiv.style.height==="0px"&&(this._dataDiv.style.height="1px"),r.keys(this._renderMap).forEach(function(e){var t=this.getRowIndexById(e);if(t<this._startRowIndex||t>=this._endRowIndex){var n=this._renderMap[e];b.release(n),this._dataDiv.removeChild(n),delete this._renderMap[e]}},this),this._pools.forEach(function(e){e.clear()}),this._view.scrollLeft!==e&&(this._view.scrollLeft=e),this._view.scrollTop!==t&&(this._view.scrollTop=t),this.adjustRowSize(),this.onValidated()},adjustRowSize:function(){var e,t,n=this._rowHeight-this._rowLineWidth+"px",r=Math.floor((this._view.scrollLeft+this._view.clientWidth)/this._zoom)+"px";for(e in this._renderMap)t=this._renderMap[e],t.style.height=n,t.style.width=r},onValidated:function(){},onDataRendered:function(e,t,n,r){},calculateSumWidth:function(){return 0},_addCheckBox:function(e,t,n){var r=this.__checkBoxPool.get();return r.keepDefault=!0,r.type="checkbox",r.style.margin="0px 2px",r.style.verticalAlign="middle",r._checkData=t,r.checked=n,r.disabled=!1,e.appendChild(r),r},_addIcon:function(e,t,n,i){var s=r.getImageAsset(n),o=this.getInnerColor(t),u=this.getOuterColor(t),a=this.getAlarmFillColor(t),f;if(s&&s.getImage()){var l=s.getWidth(),c=s.getHeight();f=this.__canvasPool.get(),f.style.verticalAlign="middle",f.setAttribute("width",l),f.setAttribute("height",c);var h=f.getContext("2d");h.clearRect(0,0,l,c);var p={x:0,y:0,width:l,height:c};Rr(h,n,o,p,t,this),u&&(h.lineWidth=2,h.strokeStyle=u,h.beginPath(),h.rect(0,0,l,c),h.closePath(),h.stroke()),a&&(h.fillStyle=w.createRadialGradient(h,a,"white",1,c-9,8,8,.75,.25),h.beginPath(),h.arc(5,c-5,4,0,Math.PI*2,!0),h.closePath(),h.fill())}else f=this.__imagePool.get(),f.style.verticalAlign="middle",f.setAttribute("src",r.getImageSrc(n));f.style.margin="0px 1px 0px 1px",f._selectData=i,e.appendChild(f)},_addLine:function(e,t,n,i){var s=this.__linePool.get(),o=r.getImageAsset(n),u=this,a=this.getToggleImage(t),f=this._levelMap[t.getId()],l=this._indent,c,h,p=l,d=l,v=0,m=this.isCheckable(t),g=this.getUncheckableStyle()==="disabled";v=2,o&&(p=o.getWidth(),d=o.getHeight()),c=(f+v-1)*l+p,h=this.getRowHeight(),e.style.width=(f+v-1)*l+p+"px",e.style.height=h+d+"px";var y=this.getLineType(),b=this.getLineColor(),w=this.getLineAlpha(),E=this.getLineThickness(),S=this.getLineDash(),x=r.getImageSrc(a);s.style.verticalAlign="top",s.style.margin="0px 0px 0px 0px",s.style.zIndex=-1,s.setAttribute("width",c),s.setAttribute("height",h);var T=s.getContext("2d");T.lineWidth=E,T.strokeStyle=b,T.globalAlpha=w,y==="dotted"&&T.setLineDash(S);var N=(f+v)*2;if(i){var C=t,k=C.getParent();T.clearRect(0,0,c,h);var L={x:0,y:0,width:c,height:h};k===null&&t.getChildrenSize()!==0&&this.isExpanded(t)&&(T.moveTo((f+v+1)*c/N,h/2+d/2),T.lineTo((f+v+1)*c/N,h),T.stroke());for(var A=f*2-1;A>=1;A-=2){if(C.getClient("isLast")){C=k,k=C.getParent();if((A+1)/2!=f)continue}else C=k,k=C.getParent();A==f*2-1?(T.moveTo((A+v)*c/N,0),T.lineTo((A+v)*c/N,h/2),T.stroke(),T.moveTo((A+v)*c/N,h/2),T.lineTo((A+v+1)*c/N,h/2),T.stroke(),t.getChildrenSize()!==0&&this.isExpanded(t)&&(T.moveTo((A+v+2)*c/N,h/2+d/2),T.lineTo((A+v+2)*c/N,h),T.stroke())):(T.moveTo((A+v)*c/N,0),T.lineTo((A+v)*c/N,h),T.stroke())}}else{var C=t,k=C.getParent();T.clearRect(0,0,c,h);var L={x:0,y:0,width:c,height:h};for(var A=f*2-1;A>=1;A-=2){if(C.getClient("isLast")){C=k,k=C.getParent();if((A+1)/2!=f)continue}else C=k,k=C.getParent();T.moveTo((A+v)*c/N,0),T.lineTo((A+v)*c/N,h),T.stroke(),A==f*2-1&&(T.moveTo((A+v)*c/N,h/2),T.lineTo((A+v+1)*c/N,h/2),T.stroke(),t.getChildrenSize()!==0&&this.isExpanded(t)&&(T.moveTo((A+v+2)*c/N,h/2+d/2),T.lineTo((A+v+2)*c/N,h),T.stroke()))}}return e.appendChild(s),s},isVisible:function(e){return this._box.contains(e)?this._visibleFunction?this._visibleFunction(e):!0:!1},handleDataBoxChange:function(e){this.invalidateModel()},handlePropertyChange:function(e){e.property==="parent"?this.invalidateModel():this.invalidateData(e.source)},handleHierarchyChange:function(e){this.invalidateModel()},handleSelectionChange:function(e){e.datas.forEach(function(e){this.invalidateData(e)},this),this.onSelectionChanged(e)},getRowIndexAt:function(e){var t=this.getLogicalPoint(e);if(!t)return-1;var n=parseInt(t.y/this._rowHeight);return n>=0&&n<this._rowDatas.size()?n:-1},getDataAt:function(e){var t=this.getRowIndexAt(e);return t>=0?this._rowDatas.get(t):null},getCurrentSortFunction:function(){return this._sortFunction},validateModel:function(){this._rowDatas.clear(),this._dataRowMap={},this._buildChildren(this._box.getRoots()),this._rowDatas=this._rowDatas.toList(this.isVisible,this);var e=this.getCurrentSortFunction();e&&this._rowDatas.sort(e);var t=this._rowDatas.size();for(var n=0;n<t;n++)this._dataRowMap[this._rowDatas.get(n).getId()]=n},_buildChildren:function(e){e.forEach(function(e){this._rowDatas.add(e),this._buildChildren(e.getChildren())},this)},_handlePressSelection:function(e,t){var n=this.getSelectionModel();if(r.isCtrlDown(t))n.contains(e)?n.removeSelection(e):n.appendSelection(e);else if(t.shiftKey&&n.getLastData()){var i=n.getLastData(),s=this.getRowIndexByData(i),o=this.getRowIndexByData(e),u=new Oi;u.add(this.getRowDatas().get(s));while(s!==o)s+=o>s?1:-1,u.add(this.getRowDatas().get(s));n.setSelection(u)}else(n.size()!==1||!n.contains(e))&&n.setSelection(e);this.fireInteractionEvent({kind:t.detail===2?"doubleClick":"click",data:e})},_handleClick:function(e){this.isFocusOnClick()&&n.Util.setFocus(this._view);var t=this.getDataAt(e);if(t){if(this.isCheckMode()&&!e.target._checkData){var r=this.getRowIndexByData(t);if(this._focusedRow!==r){var i=this._rowDatas.get(this._focusedRow);this._focusedRow=r,i&&this.invalidateData(i),this.invalidateData(t)}}this.isCheckMode()||this._handlePressSelection(t,e)}this._currentEditor&&this.commitEditValue(this._currentEditor._editInfo,this._currentEditor);if(this.updateCurrentEditor){var s=this;setTimeout(function(){s.updateCurrentEditor(e)},0)}},handleChange:function(e){if(this._isCanceling||this._isValidating)return;var t=e.target._checkData;if(t){var n=this.isSelected(t),r=this.getSelectionModel();n?r.removeSelection(t):r.appendSelection(t)}e.target._editInfo&&this.commitEditValue&&this.commitEditValue(e.target._editInfo,e.target)},scrollToData:function(e){if(!e)return;var t=this.getRowIndexById(e.getId());if(t<0)return;var n=t*this._rowHeight*this._zoom,r=n+this._rowHeight*this._zoom,i=this._view.scrollTop;this._view.scrollTop>n&&(i=n),this._view.scrollTop+this._view.clientHeight<r&&(i=r-this._view.clientHeight),this._view.scrollTop!=i&&(this._view.scrollTop=i,this.invalidate())},makeVisible:function(e){if(!this.isVisible(e))return;this.expand&&this.expand(e),r.callLater(this.scrollToData,this,[e],$i.CALL_LATER_DELAY*2)},onSelectionChanged:function(e){this._makeVisibleOnSelected&&(e.kind==="append"||e.kind==="set"||e.kind==="all")&&(this.expand&&this.getSelectionModel().getSelection().forEach(function(e){e.getParent()&&this.expand(e.getParent())},this),r.callLater(this.scrollToData,this,[this.getSelectionModel().getLastData()],$i.CALL_LATER_DELAY*2))},onShareSelectionModelChanged:function(){this.invalidateModel()}}),n.controls.TableBase=function(e){this._columnBox=new n.ColumnBox,this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this),n.controls.TableBase.superClass.constructor.apply(this,arguments),this._cellPool=new n.Pool("div",20),this._stringPool=new n.Pool("span",20),this._booleanPool=new n.Pool("input",20),this._colorPool=new n.Pool("div",20),this._pools.add(this._cellPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool)},r.ext("twaver.controls.TableBase",n.controls.ListBase,{getColumnBox:function(){return this._columnBox},handleColumnBoxChange:function(e){this.invalidateDisplay()},handleColumnPropertyChange:function(e){e.source!==this._sortColumn||e.property!=="sortDirection"&&e.property!=="sortFunction"&&e.property!=="sortable"?this.invalidateDisplay():this.invalidateModel()},handleColumnHierarchyChange:function(e){this.invalidateDisplay()},renderData:function(e,t,n,r){var i=this._columnBox.getRoots(),s=i.size(),o=0,u=this._rowHeight-this._rowLineWidth+"px",a;for(var f=0;f<s;f++){var l=i.get(f),c=l.getWidth();c<0&&(c=0);var h=Math.min(this._columnLineWidth,c);if(l.isVisible()){var p=this._cellPool.get();a=p.style,a.position="absolute",a.whiteSpace="nowrap",a.verticalAlign="middle",a.textAlign=l.getHorizontalAlign(),a.overflow="hidden",a.textOverflow="ellipsis",a.left=o+"px",a.width=c-h+"px",a.height=u,a.borderStyle="solid",a.borderWidth="0px",a.borderRightWidth=h+"px",a.borderRightColor=this._columnLineColor,f===0?(a.borderLeftWidth=h+"px",a.borderLeftColor=this._columnLineColor):a.borderLeftWidth="0px",e.appendChild(p);var d={data:t,value:this.getValue(t,l),div:p,view:this,column:l,rowIndex:n,selected:r};this.renderCell(d),this.onCellRendered(d),o+=c}}a=e.style,a.width=o+"px",a.height=u,a.backgroundColor=this.isCheckMode()&&this._focusedRow===n||!this.isCheckMode()&&r?this.getSelectColor(t):""},adjustRowSize:function(){},onCellRendered:function(e){},calculateSumWidth:function(){var e=this._columnBox.getRoots(),t=e.size(),n=0;for(var r=0;r<t;r++){var i=e.get(r),s=i.getWidth();s<0&&(s=0),n+=s}return n},getCurrentSortFunction:function(){var e=this._sortColumn;if(e){var t=e.getSortFunction();if(t){var n=this,r="asc"===e.getSortDirection()?1:-1;return function(i,s){var o=n.getValue(i,e),u=n.getValue(s,e);return t.call(n,o,u,i,s)*r}}}return this._sortFunction},renderCell:function(e){var t=e.column;if(t.renderCell){t.renderCell(e);return}var n=e.value,r=t.getEnumInfo(e.rowIndex);r&&!Array.isArray(r)&&(n=r.map[n]),e.view.isCellEditable(e.data,t)&&(e.enumInfo=r,e.div._editInfo=e),Lr.render(t.getValueType(),n,e.div,e.view,t.isInnerText())},getValue:function(e,t){return t.getValue(e,this)},setValue:function(e,t,n){t.setValue(e,n,this)},getColumnAt:function(e){var t=this.getLogicalPoint(e);if(!t)return null;var n=this._columnBox.getRoots();for(var r=0,i=n.size(),s=0;r<i;r++){var o=n.get(r),u=o.getWidth();u<0&&(u=0);if(t.x>s&&t.x<s+u)return o;s+=u}return null},isCellEditable:function(e,t){return this.isEditable()&&t.isEditable()},commitEditValue:function(e,t){if(this._isCanceling)return;var r;t.type==="checkbox"?r=t.checked:r=t.value;var i=e.column,s=i.getValueType();if(s==="int"&&typeof r=="string")r=parseInt(r);else if(s==="number"&&typeof r=="string")r=parseFloat(r);else if(s==="list.points"){var o=r.replace(/\]/g,"").replace(/\[/g,"").split(","),u=new n.List;for(var a=0;a<o.length;a+=2){if(a+1>=o.length)continue;u.add({x:parseInt(o[a]),y:parseInt(o[a+1])})}r=u}this.setValue(e.data,i,r);if(this._currentEditor){var f=this._currentEditor.parentNode,l=this._currentEditor;delete this._currentEditor,f&&f.removeChild(l),n.Util.setFocus(this._view)}delete this._isCommitting},cancelEditing:function(){if(this._currentEditor){this._isCanceling=!0;var e=this._currentEditor.parentNode,t=this._currentEditor;delete this._currentEditor,e&&e.removeChild(t),n.Util.setFocus(this._view),delete this._isCanceling}},renderEditor:function(e){},onEditorRendered:function(e){},getEditorValue:function(e){var t=e.column.getValueType(),n=e.value,r="";if(t==="list.points"){var i=n._as?n._as:n;i.forEach(function(e,t){r+=t==i.length-1?"["+e.x+","+e.y+"]":"["+e.x+","+e.y+"],"})}else r=n;return r},updateCurrentEditor:function(e){var t=e.target;if(t===this._currentEditor||t.parentNode===this._currentEditor)return;var r;while(t&&t!==this._view&&!(r=t._editInfo))t=t.parentNode;if(r&&t===r.div){var i=this.renderEditor&&this.renderEditor(r);i?(this._currentEditor=i.view,r.value!=null&&(this._currentEditor.value=this.getEditorValue(r))):r.enumInfo?this._currentEditor=b.createSelect(r.enumInfo,r.value):(this._currentEditor=l.createElement("input"),r.value!=null&&(this._currentEditor.value=this.getEditorValue(r)));var s=this;if(r.column&&r.column.renderEditor){var i=typeof r.column.renderEditor=="function"?r.column.renderEditor(s,r):r.column.renderEditor;i&&(s._currentEditor=i)}if(this._currentEditor){if(i&&i.onKeyDown){var o=i.onKeyDown;o&&Array.isArray(o)&&s._currentEditor.addEventListener("keydown",function(e){for(var t=0;t<o.length;t++)if(o[t].combKey){var n=null;switch(o[t].combKey){case"ctrlKey":n=e.ctrlKey;break;case"shiftKey":n=e.shiftKey;break;case"altKey":n=e.altKey}e.keyCode===o[t].keyCode&&n&&o[t].handlerEvent&&o[t].handlerEvent(e)}else e.keyCode===o[t].keyCode&&o[t].handlerEvent&&o[t].handlerEvent(e)})}else this._currentEditor.addEventListener("keydown",function(e){var t=e.target._editInfo.view;if(e.keyCode===13&&e.shiftKey)return;e.keyCode===13?t.commitEditValue(e.target._editInfo,e.target):e.keyCode===27&&t.cancelEditing()},!1);this._currentEditor.addEventListener("blur",function(e){var t=e.target._editInfo.view;if(t._isCanceling)return;t.commitEditValue(e.target._editInfo,e.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=r;if(!this._currentEditor.parentNode){var u=this._currentEditor.style;u.position="absolute",u.margin="0px",u.border="0px",u.padding="0px",u.left=r.div.style.left,u.top=r.div.parentNode.style.top,u.width=r.div.style.width,u.height=r.div.style.height,this._rootDiv.appendChild(this._currentEditor)}n.Util.setFocus(this._currentEditor)}}},onColumnSorted:function(e){},getCurrentEditor:function(){return this._currentEditor}}),n.controls.List=function(e){n.controls.List.superClass.constructor.apply(this,arguments)},r.ext("twaver.controls.List",n.controls.ListBase,{__accessor:["rowHeight","indent","rowLineWidth","rowLineColor","sortFunction","visibleFunction"],__bool:["makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_rowHeight:$i.LIST_ROW_HEIGHT,_indent:$i.LIST_INDENT,_rowLineWidth:$i.LIST_ROW_LINE_WIDTH,_rowLineColor:$i.LIST_ROW_LINE_COLOR,_makeVisibleOnSelected:$i.LIST_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:$i.LIST_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:$i.LIST_KEYBOARD_SELECT_ENABLED,isCheckMode:function(){return this._checkMode},setCheckMode:function(e){delete this._focusedRow;var t=this._checkMode;this._checkMode=e,this.firePropertyChange("checkMode",t,e)},isCheckable:function(e){return this._checkMode===!0},renderData:function(e,t,n,i){var s;this._indent>0&&(s=this.__spanPool.get(),s.style.width=this._indent+"px",s.style.display="inline-block",e.appendChild(s));var o=this.isCheckable(t);o&&this._addCheckBox(e,t,i);var u=this.getIcon(t);u&&this._addIcon(e,t,u);var a=this.getLabel(t);if(a){s=this.__textPool.get();var f=s.style;f.whiteSpace="nowrap",f.verticalAlign="middle",f.padding="1px 2px 1px 2px",f.display="inline-block",r.setText(s,a,this._innerText),this.onLabelRendered(s,t,a,n,i),e.appendChild(s)}this.isCheckMode()?e.style.backgroundColor=this._focusedRow===n?this.getSelectColor(t):"":e.style.backgroundColor=i?this.getSelectColor(t):""},onLabelRendered:function(e,t,n,r,i){}}),n.controls.ListBaseInteraction=function(e){this.listBase=e,this.view=e._view,this.clickTimer=0,this.doubleClickInterval=300;var t=this;this.view.addEventListener("scroll",function(e){t.handleScroll(e)},!1),this.view.addEventListener("mouseup",function(e){t.handleMouseUp(e)},!1),this.view.addEventListener("keydown",function(e){t.handleKeyDown(e)},!1)},r.ext("twaver.controls.ListBaseInteraction",Object,{handleMouseUp:function(e){var t=this.listBase,n=this;if(e.target===t._currentEditor||e.target.parentNode===t._currentEditor)return;n.clickTimer?(clearTimeout(n.clickTimer),n.clickTimer=0,t._handleDoubleClick(e)):(t._handleClick(e),n.clickTimer=setTimeout(function(){clearTimeout(n.clickTimer),n.clickTimer=0},300))},handleKeyDown:function(e){var t=this.listBase;if(t._currentEditor)return;if(r.isCtrlDown(e)&&e.keyCode==65)t.isKeyboardSelectEnabled()&&t.selectAll().size()>0&&t.fireInteractionEvent({kind:"selectAll"}),b.preventDefault(e);else if(e.keyCode==46)t.isKeyboardRemoveEnabled()&&t.removeSelection()&&t.fireInteractionEvent({kind:"removeElement"}),b.preventDefault(e);else if(!!t.isCheckMode()||e.keyCode!==38&&e.keyCode!==40&&e.keyCode!==37&&e.keyCode!==39)r.showVersion(e);else{var n=t.getSelectionModel().getLastData();if(n)if(e.keyCode===38||e.keyCode===40){var i=t.getRowDatas(),s=t.getRowIndexByData(n);s>=0&&(e.keyCode===38?s!==0&&(n=i.get(s-1),t.getSelectionModel().setSelection(n)):s!==i.size()-1&&(n=i.get(s+1),t.getSelectionModel().setSelection(n)))}else t.expand&&(e.keyCode===37||e.keyCode===39)&&n.hasChildren()&&(e.keyCode===37?t.collapse(n):t.expand(n));else t.getRowDatas().size()>0&&(n=t.getRowDatas().get(0),t.getSelectionModel().setSelection(n))}},handleScroll:function(e){this.listBase.invalidate()}}),n.controls.ListBaseTouchInteraction=function(e){this.listBase=e,this.view=e._view,b.addEventListener("touchstart","handleTouchstart",this.view,this)},r.ext("twaver.controls.ListBaseTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e),this.startPoint=this.lastPoint=this.listBase.getLogicalPoint(e),b.addEventListener("touchmove","handleTouchmove",this.view,this),b.addEventListener("touchend","handleTouchend",this.view,this),kr.isMultiTouch(e)&&(this.distance=kr.getDistance(e),this.zoom=this.listBase._zoom)},handleTouchmove:function(e){b.preventDefault(e);var t=this.listBase.getLogicalPoint(e);if(m.getDistance(this.startPoint,t)<20)return;this.moved||(this.moved=!0);if(kr.isSingleTouch(e)){if(this.lastPoint){var n=this.lastPoint.x-t.x,r=this.lastPoint.y-t.y,i=this.listBase.panByOffset(n,r);this.listBase.invalidate(),this.lastPoint.x-=n-i.x,this.lastPoint.y-=r-i.y}}else if(this.distance){var s=kr.getDistance(e)/this.distance;this.listBase.setZoom(this.zoom*s,!1)}},handleTouchend:function(e){b.preventDefault(e),!this.moved&&e.target!==this.listBase._currentEditor&&e.target.parentNode!==this.listBase._currentEditor&&this.listBase._handleClick(e),delete this.startPoint,delete this.lastPoint,delete this.moved,delete this.distance,delete this.zoom,b.removeEventListener("touchmove",this.view,this),b.removeEventListener("touchend",this.view,this)}}),n.controls.ListBaseMSTouchInteraction=function(e){n.controls.ListBaseMSTouchInteraction.superClass.constructor.apply(this,arguments),this._pointerMap={},this._pointerIdArray=[],b.addEventListener("MSPointerDown","handleTouchstart",this.view,this),b.addEventListener("MSPointerMove","handleTouchmove",this.view,this),b.addEventListener("MSPointerUp","handleTouchend",this.view,this),b.addEventListener("MSPointerCancel","handleTouchend",this.view,this),this.superHandleMouseDown=n.controls.ListBaseMSTouchInteraction.superClass.handleMouseDown},r.ext("twaver.controls.ListBaseMSTouchInteraction",n.controls.ListBaseInteraction,{handleMouseDown:function(e){},handleTouchstart:function(e){e.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[e.pointerId]&&this.listBase.getLogicalPoint(e)!=null&&(this._pointerIdArray.push(e.pointerId),this._pointerMap[e.pointerId]=e),this._pointerIdArray.length==1&&e.pointerType==e.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(e),this._pointerIdArray.length==1?(this._startTouchPoint=this.listBase.getLogicalPoint(e),this._startTouchTime=new Date):this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.listBase.getZoom())},handleTouchmove:function(e){if(this._startTouchPoint==null||this._pointerIdArray.length==0||!this._pointerMap[e.pointerId]||m.getDistance({x:this._pointerMap[e.pointerId].pageX,y:this._pointerMap[e.pointerId].pageY},{x:e.pageX,y:e.pageY})<=10)return;this._pointerMap[e.pointerId]=e;if(this._pointerIdArray.length==2){var t=this._getDistance()/this._distance;this.listBase.setZoom(this._zoom*t,!1)}else if(this._pointerIdArray.length==1&&e.pointerType!=e.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var n=this.listBase.getLogicalPoint(e);if(n==null)return;var r=this._startTouchPoint.x-n.x,i=this._startTouchPoint.y-n.y,s=this.listBase.panByOffset(r,i);this.listBase.invalidate(),this._startTouchPoint.x-=r-s.x,this._startTouchPoint.y-=i-s.y}},handleTouchend:function(e){if(this._startTouchPoint&&this._pointerIdArray.length==1&&e.pointerType!=e.MSPOINTER_TYPE_MOUSE){var t=this.listBase.getLogicalPoint(e);if(t){var n=new Date;n.getTime()-this._startTouchTime.getTime()<=500&&m.getDistance(this._startTouchPoint,t)<=20&&this.superHandleMouseDown(e)}}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return m.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),n.controls.Tree=function(e){this._interactionDispatcher=new n.EventDispatcher,this._initTree(e),n.controls.Tree.superClass.constructor.apply(this,arguments)},r.ext("twaver.controls.Tree",n.controls.ListBase,{__tree:1,__accessor:["rootData","sortFunction","visibleFunction","indent","rowHeight","rowLineWidth","rowLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_indent:$i.TREE_INDENT,_rowHeight:$i.TREE_ROW_HEIGHT,_rowLineWidth:$i.TREE_ROW_LINE_WIDTH,_rowLineColor:$i.TREE_ROW_LINE_COLOR,_makeVisibleOnSelected:$i.TREE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:$i.TREE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:$i.TREE_KEYBOARD_SELECT_ENABLED,_expandIcon:$i.TREE_EXPAND_ICON,_collapseIcon:$i.TREE_COLLAPSE_ICON,_uncheckableStyle:"none",_lineType:$i.TREE_LINE_TYPE,_lineColor:$i.TREE_LINE_COLOR,_lineThickness:$i.TREE_LINE_THICKNESS,_lineAlpha:$i.TREE_LINE_ALPHA,_lineDash:$i.TREE_LINE_DASH,getCheckMode:function(){return this._checkMode},setCheckMode:function(e){delete this._focusedRow;var t=this._checkMode;this._checkMode=e,this.firePropertyChange("checkMode",t,e)},renderData:function(e,t,n,r){this._renderTree(e,t,n,r)},getToolTip:function(e){return e.getToolTip()||e.getName()}}),n.controls.Table=function(e){this._checkColumn=new n.Column,this._checkColumn.setName("check"),this._checkColumn.setEditable(!0),this._checkColumn.setWidth(40),this._checkColumn.setHorizontalAlign("center"),this._checkColumn.renderCell=this.renderCheckCell;var t=this;this._checkColumn.getValue=function(e,n){return t.isSelected(e)},n.controls.Table.superClass.constructor.apply(this,arguments)},r.ext("twaver.controls.Table",n.controls.TableBase,{__accessor:["rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","sortFunction","visibleFunction","sortColumn"],__bool:["editable","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:$i.TABLE_EDITABLE,_rowHeight:$i.TABLE_ROW_HEIGHT,_rowLineWidth:$i.TABLE_ROW_LINE_WIDTH,_rowLineColor:$i.TABLE_ROW_LINE_COLOR,_columnLineWidth:$i.TABLE_COLUMN_LINE_WIDTH,_columnLineColor:$i.TABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:$i.TABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:$i.TABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:$i.TABLE_KEYBOARD_SELECT_ENABLED,getCheckColumn:function(){return this._checkColumn},isCheckMode:function(){return this._columnBox.contains(this._checkColumn)},setCheckMode:function(e){if(e===this.isCheckMode())return;delete this._focusedRow,e?this._columnBox.add(this._checkColumn,0):this._columnBox.remove(this._checkColumn),this.firePropertyChange("checkMode",!e,e)},renderCheckCell:function(e){var t=e.view._booleanPool.get();t.disabled=!1,t.type="checkbox",t.style.margin="0px 2px",t.style.verticalAlign="middle",t.checked=e.selected;var n=e.div;n.appendChild(t),n.style.textAlign===""&&(n.style.textAlign="center"),t._checkData=e.data}}),n.controls.TableHeader=function(e){n.controls.TableHeader.superClass.constructor.apply(this,arguments),this._invalidateScroll=!1,this._invalidateDisplay=!1,this._divPool=new n.Pool("div"),this._imagePool=new n.Pool("img"),this._textPool=new n.Pool("span"),this._resizePool=new n.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._imagePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this._table=e,this._tableView=e.getView(),this._columnBox=e.getColumnBox(),this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this);var t=this;e.getView().addEventListener("scroll",function(e){t.invalidateScroll()},!1),e.addPropertyChangeListener(function(e){t.invalidateDisplay()},this),this._view=b.createView("hidden"),this._view.tabIndex=-1,this._view.style.background=$i.TABLEHEADER_BACKGROUND,this._rootDiv=b.createDiv(),this._view.appendChild(this._rootDiv),this.invalidateDisplay(),h.isTouchable&&new n.controls.TableHeaderTouchInteraction(this),new n.controls.TableHeaderInteraction(this)},r.ext("twaver.controls.TableHeader",n.controls.ControlBase,{__accessor:["height","moveBackground","insertBackground","columnLineColor","resizeTolerance","sortDescIcon","sortAscIcon","sortIconPosition"],_height:$i.TABLEHEADER_HEIGHT,_moveBackground:$i.TABLEHEADER_MOVE_BACKGROUND,_insertBackground:$i.TABLEHEADER_INSERT_BACKGROUND,_columnLineColor:$i.TABLEHEADER_COLUMN_LINE_COLOR,_resizeTolerance:$i.TABLEHEADER_RESIZE_TOLERANCE,_sortDescIcon:$i.TABLEHEADER_SORT_DESC_ICON,_sortAscIcon:$i.TABLEHEADER_SORT_ASC_ICON,_sortIconPosition:$i.TABLEHEADER_SORT_ICON_POSITION,getRootDiv:function(){return this._rootDiv},handleColumnBoxChange:function(e){this.invalidateDisplay()},handleColumnPropertyChange:function(e){this.invalidateDisplay()},handleColumnHierarchyChange:function(e){this.invalidateDisplay()},onPropertyChanged:function(e){this.invalidateDisplay()},invalidateScroll:function(){if(this._invalidateScroll)return;this._invalidateScroll=!0,this.invalidate()},invalidateDisplay:function(){if(this._invalidateDisplay)return;this._invalidateDisplay=!0,this._invalidateScroll=!0,this.invalidate()},validate:function(){if(!this._invalidate)return;this._invalidate=!1,this._invalidateDisplay&&(this._invalidateDisplay=!1,this.validateDisplay()),this._invalidateScroll&&(this._invalidateScroll=!1,this._rootDiv.style.left=-this._tableView.scrollLeft+"px")},validateDisplay:function(){b.release(this._rootDiv);var e=this._table.getZoom(),t=this.getHeight()+"px",n=this.getHeight()-2+"px",r=this._table.getColumnBox().getRoots(),i=r.size(),s=0,o=this._table._columnLineWidth*e;for(var u=0;u<i;u++){var a=r.get(u);if(a.isVisible()){var f=a.getWidth()*e;f<0&&(f=0);var l=Math.min(o,f),c=this._divPool.get();c._column=a;var h=c.style;h.position="absolute",h.whiteSpace="nowrap",h.lineHeight=n,h.overflow="hidden",h.textOverflow="ellipsis",h.backgroundPosition=this._sortIconPosition?this._sortIconPosition:"",h.backgroundRepeat="no-repeat",h.backgroundImage="",h.textAlign=a.getHorizontalAlign(),h.borderStyle="solid",h.borderWidth="0px",h.borderRightWidth=l+"px",h.borderRightColor=this._columnLineColor,u===0?(h.borderLeftWidth=l+"px",h.borderLeftColor=this._columnLineColor):h.borderLeftWidth="0px",h.left=s+"px",h.width=f-l+"px",h.height=t,c._x=s,c._width=f-l,this._rootDiv.insertBefore(c,this._rootDiv.firstChild),this.renderColumn(c,a),this.onColumnRendered(c,a),s+=f,a.isResizable()&&(c=this._resizePool.get(),c._resizeColumn=a,h=c.style,h.position="absolute",h.backgroundColor="white",h.opacity=0,h.left=s-l-this._resizeTolerance+"px",h.width=l+this._resizeTolerance*2+"px",h.height=t,this._rootDiv.appendChild(c))}}this._pools.forEach(function(e){e.clear()}),this._rootDiv.style.width=s+"px",this._rootDiv.style.height=t},renderColumn:function(e,t){if(t.renderHeader)t.renderHeader(e);else{var n=this._textPool.get();n.style.whiteSpace="nowrap",n.style.verticalAlign="middle",n.style.padding="1px 2px 1px 2px",n.innerHTML=t.getName()?t.getName():t.getPropertyName(),n.setAttribute("title",n.innerHTML),e.appendChild(n);if(h.isOpera){var i=e.cloneNode(!1);i.style.left="0px",i.style.top="0px",i.style.opacity=0,e.appendChild(i)}}if(this._table.getSortColumn()===t&&t.isSortable()){var s=t.getSortDirection()==="asc"?this._sortAscIcon:this._sortDescIcon,o=r.getImageSrc(s);if(!this._sortIconPosition||this._sortIconPosition===""){var u=this._imagePool.get();u.setAttribute("src",o),u.style.verticalAlign="middle",e.appendChild(u)}else e.style.backgroundImage="url("+o+")"}},onColumnRendered:function(e,t){}}),n.controls.TableHeaderInteraction=function(e){this.header=e,this.table=e._table,this.view=e._view;var t=this;this.view.addEventListener("mousedown",function(e){t.handleMouseDown(e)},!1),this.view.addEventListener("mousemove",function(e){t.handleMouseMove(e)},!1)},r.ext("twaver.controls.TableHeaderInteraction",Object,{handleMouseDown:function(e){if(e.button!==0)return;if(this.movableDiv){this.handleMouseUp(e);return}this.resizeColumn=e.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(e)),this.changeCursor(e),this._startClient=b.getClientPoint(e),this.lastX=this.getX(e),this._startLogicalX=this.lastX,b.handle_mousedown(this,e)},changeCursor:function(e){var t="";if(e.target._resizeColumn)t="ew-resize";else{var n=this.getColumnAt(e);n&&(n.isMovable()||n.isSortable())&&(t="pointer"
)}this.view.style.cursor=t},handleMouseMove:function(e){if(this.lastX==null){this.changeCursor(e);return}if(b.target!==this)return;var t=this._startLogicalX+e.clientX-this._startClient.x;if(this.resizeColumn){if(this.stopX!=null){if(t<this.stopX)return;delete this.stopX}var n=this.resizeColumn.getWidth()+(t-this.lastX)/this.table.getZoom();n<10&&(n=10,this.stopX=t),this.resizeColumn.setWidth(n),this.lastX=t}else if(this.movableDiv){var r=t-this.lastX;if(!this.cloneDiv){if(Math.abs(r)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=b.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var i=this.cloneDiv._x+r;this.cloneDiv.style.left=i+"px",this.cloneDiv._x=i,this.lastX=t,this.columnInfo=this.getColumnInfoAt(e),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}},handleMouseUp:function(e){if(e.button!==0)return;var t;if(!this.resizeColumn)if(this.movableDiv&&this.columnInfo){t=this.movableDiv._column;var n=this.columnInfo.index;this.table.getColumnBox().moveTo(t,n)}else{t=this.getColumnAt(e);if(t&&t.isSortable()){var r=t.getSortDirection();this.table.getSortColumn()===t?(r==="desc"&&this.table.setSortColumn(null),t.setSortDirection(r==="asc"?"desc":"asc")):this.table.setSortColumn(t),this.table.onColumnSorted(this.table.getSortColumn())}}this.clear()},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX,delete this._startClient,delete this._startLogicalX},getColumnAt:function(e){e=e.target;var t;while(e&&e!==this.view&&!(t=e._column))e=e.parentNode;return t},getMovableDivAt:function(e){e=e.target;var t;while(e&&e!==this.view&&!(t=e._column))e=e.parentNode;return t&&t.isMovable()?e:null},getX:function(e){var t=b.getLogicalPoint(this.view,e);return t?t.x:null},getColumnInfoAt:function(e){var t=this._startLogicalX+e.clientX-this._startClient.x+this.table.getView().scrollLeft,n=this.table.getColumnBox().getRoots(),r=n.size(),i=this.table.getZoom(),s=0,o=!1;for(var u=0;u<r;u++){var a=n.get(u);a===this.movableDiv._column&&(o=!0);if(a.isVisible()){var f=a.getWidth()*i;if(f<=0)continue;if(t>=s&&t<=s+f){var l=t<s+f/2;o&&(a!==this.movableDiv._column||!l)&&u--;var c=l?Math.max(0,u):Math.min(u+1,r),h=l?s:s+f;return h=Math.max(0,h-1),{index:c,column:a,position:h+"px"}}s+=f}}return this.columnInfo}}),n.controls.TableHeaderTouchInteraction=function(e){this.header=e,this.table=e._table,this.view=e._view,b.addEventListener("touchstart","handleTouchstart",this.view,this)},r.ext("twaver.controls.TableHeaderTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e);if(this.movableDiv){this.handleTouchend(e);return}this.resizeColumn=e.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(e)),this.lastX=this.getX(e),b.addEventListener("touchmove","handleTouchmove",this.view,this),b.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(e){b.preventDefault(e);if(this.lastX==null)return;var t;if(this.resizeColumn){t=this.getX(e);if(this.stopX!=null){if(t<this.stopX)return;delete this.stopX}var n=this.resizeColumn.getWidth()+(t-this.lastX)/this.table.getZoom();n<0&&(n=0,this.stopX=t),this.resizeColumn.setWidth(n),this.lastX=t}else if(this.movableDiv){t=this.getX(e);var r=t-this.lastX;if(!this.cloneDiv){if(Math.abs(r)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=b.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var i=this.cloneDiv._x+r;this.cloneDiv.style.left=i+"px",this.cloneDiv._x=i,this.lastX=t,this.columnInfo=this.getColumnInfoAt(e),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}},handleTouchend:function(e){b.preventDefault(e);var t;if(!this.resizeColumn)if(this.movableDiv&&this.columnInfo){t=this.movableDiv._column;var n=this.columnInfo.index;this.table.getColumnBox().moveTo(t,n)}else{t=this.getColumnAt(e);if(t&&t.isSortable()){var r=t.getSortDirection();this.table.getSortColumn()===t?(r==="desc"&&this.table.setSortColumn(null),t.setSortDirection(r==="asc"?"desc":"asc")):this.table.setSortColumn(t)}}this.clear(),b.removeEventListener("touchmove",this.view,this),b.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX},getColumnAt:function(e){e=e.target;var t;while(e&&e!==this.view&&!(t=e._column))e=e.parentNode;return t},getMovableDivAt:function(e){e=e.target;var t;while(e&&e!==this.view&&!(t=e._column))e=e.parentNode;return t&&t.isMovable()?e:null},getX:function(e){var t=b.getLogicalPoint(this.view,e);return t?t.x:null},getColumnInfoAt:function(e){var t=this.getX(e)+this.table.getView().scrollLeft,n=this.table.getColumnBox().getRoots(),r=n.size(),i=this.table.getZoom(),s=0,o=!1;for(var u=0;u<r;u++){var a=n.get(u);a===this.movableDiv._column&&(o=!0);if(a.isVisible()){var f=a.getWidth()*i;if(f<=0)continue;if(t>=s&&t<=s+f){var l=t<s+f/2;o&&(a!==this.movableDiv._column||!l)&&u--;var c=l?Math.max(0,u):Math.min(u+1,r),h=l?s:s+f;return h=Math.max(0,h-1),{index:c,column:a,position:h+"px"}}s+=f}}return this.columnInfo}}),n.controls.TablePane=function(e,t){n.controls.TablePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._table=e,this._tableHeader=t?t:new n.controls.TableHeader(e),this._view=b.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._tableHeader.getView()),this._view.appendChild(this._table.getView());var r=this;this._tableHeader.addPropertyChangeListener(function(e){e.property==="height"&&r.invalidate()})},r.ext("twaver.controls.TablePane",n.controls.ControlBase,{onPropertyChanged:function(e){this.invalidate()},getTable:function(){return this._table},getTableHeader:function(){return this._tableHeader},validateImpl:function(){var e=this._view.offsetWidth,t=this._view.offsetHeight,n=this._tableHeader.getHeight();this._tableHeader.adjustBounds({x:0,y:0,width:e,height:n}),this._table.adjustBounds({x:0,y:n,width:e,height:Math.max(0,t-n)})}}),n.controls.TreeTable=function(e){this._treeColumn=new n.Column,this._treeColumn.setName("tree"),this._treeColumn.setWidth(120),this._treeColumn.renderCell=this.renderTreeCell,this._treeColumn.getValue=this.getTreeValue,this._treeColumn.setValue=this.setTreeValue,this._initTree(e),n.controls.TreeTable.superClass.constructor.apply(this,arguments),this._columnBox.add(this._treeColumn)},r.ext("twaver.controls.TreeTable",n.controls.TableBase,{__tree:1,__accessor:["sortFunction","visibleFunction","checkMode","rootData","sortColumn","indent","rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["editable","rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:$i.TREETABLE_EDITABLE,_indent:$i.TREETABLE_INDENT,_rowHeight:$i.TREETABLE_ROW_HEIGHT,_rowLineWidth:$i.TREETABLE_ROW_LINE_WIDTH,_rowLineColor:$i.TREETABLE_ROW_LINE_COLOR,_columnLineWidth:$i.TREETABLE_COLUMN_LINE_WIDTH,_columnLineColor:$i.TREETABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:$i.TREETABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:$i.TREETABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:$i.TREETABLE_KEYBOARD_SELECT_ENABLED,_expandIcon:$i.TREETABLE_EXPAND_ICON,_collapseIcon:$i.TREETABLE_COLLAPSE_ICON,_lineType:$i.TREE_LINE_TYPE,_lineColor:$i.TREE_LINE_COLOR,_lineThickness:$i.TREE_LINE_THICKNESS,_lineAlpha:$i.TREE_LINE_ALPHA,_lineDash:$i.TREE_LINE_DASH,getTreeColumn:function(){return this._treeColumn},renderTreeCell:function(e){e.view._renderTree(e.div,e.data,e.rowIndex,e.selected)},getTreeValue:function(e,t){return t.getLabel(e)},setTreeValue:function(e,t,n){e.setName(t)}}),n.controls.PropertySheet=function(e){n.controls.PropertySheet.superClass.constructor.apply(this,arguments),this._currentRowIndex=-1,this._currentEditor=null,this._currentData=null,this._invalidate=!1,this._resizeDiv=b.createDiv(),this._resizeDiv.style.backgroundColor="white",this._resizeDiv.style.opacity=0,this._resizeDiv.style.top="0px",this._categoryList=new Oi,this._categoryMap={},this._rowList=new Oi,this._propertyBox=new n.PropertyBox,this._propertyBox.addDataBoxChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addDataPropertyChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addHierarchyChangeListener(this.invalidatePropertyBox,this),this.__divPool=new n.Pool("div",2),this.__cellPool=new n.Pool("div",2),this.__imagePool=new n.Pool("img",2),this.__textPool=new n.Pool("span",2),this._stringPool=new n.Pool("span",2),this._booleanPool=new n.Pool("input",2),this._colorPool=new n.Pool("div",2),this._pools.add(this.__divPool),this._pools.add(this.__cellPool),this._pools.add(this.__imagePool),this._pools.add(this.__textPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool),this._view=b.createView("auto"),this._rootDiv=b.createDiv(),this._dataDiv=b.createDiv(),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(e?e:new n.DataBox);var t=this;this._view.addEventListener("change",function(e){t.handleChange(e)},!1),h.isTouchable?h.isMSTouchable?new n.controls.PropertySheetMSTouchInteraction(this):(new n.controls.PropertySheetTouchInteraction(this),new n.controls.PropertySheetInteraction(this)):new n.controls.PropertySheetInteraction(this)},r.ext("twaver.controls.PropertySheet",n.controls.View,{__accessor:["indent","rowHeight","sumWidth","propertyNameWidth","propertyNameHorizontalAlign","autoAdjustable","rowLineWidth","columnLineWidth","borderColor","categorizable","resizeTolerance","editable","selectColor","expandIcon","collapseIcon","sortFunction","visibleFunction"],_autoAdjustable:$i.PROPERTYSHEET_AUTO_ADJUSTABLE,_selectColor:$i.SELECT_COLOR,_categorizable:$i.PROPERTYSHEET_CATEGORIZABLE,_editable:$i.PROPERTYSHEET_EDITABLE,_propertyNameWidth:$i.PROPERTYSHEET_PROPERTY_NAME_WIDTH,_propertyNameHorizontalAlign:$i.PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN,_sumWidth:$i.PROPERTYSHEET_SUM_WIDTH,_indent:$i.PROPERTYSHEET_INDENT,_rowHeight:$i.PROPERTYSHEET_ROW_HEIGHT,_rowLineWidth:$i.PROPERTYSHEET_ROW_LINE_WIDTH,_columnLineWidth:$i.PROPERTYSHEET_COLUMN_LINE_WIDTH,_borderColor:$i.PROPERTYSHEET_BORDER_COLOR,_expandIcon:$i.PROPERTYSHEET_EXPAND_ICON,_collapseIcon:$i.PROPERTYSHEET_COLLAPSE_ICON,_resizeTolerance:$i.PROPERTYSHEET_RESIZE_TOLERANCE,getPropertyBox:function(){return this._propertyBox},getCurrentData:function(){return this._currentData},getDataDiv:function(){return this._dataDiv},getDataBox:function(){return this._box},setDataBox:function(e){if(!e)throw"DataBox can not be null";if(this._box===e)return;var t=this._box;t&&(t.removeDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel||t.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=e,this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel?this._selectionModel._setDataBox(e):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidate(),this.firePropertyChange("dataBox",t,this._box)},invalidatePropertyBox:function(){this._isValidating||this.invalidate()},onPropertyChanged:function(e){e.property!=="zoom"&&this.invalidate()},isVisible:function(e){return e.isVisible&&!e.isVisible(this._currentData,this)?!1:this._visibleFunction?this._visibleFunction(e):!0},handlePropertyChange:function(e){this._currentData===e.source&&this.invalidate()},handleSelectionChange:function(e){this._currentData!==this.getSelectionModel().getLastData()&&(this._currentRowIndex=-1,this.invalidate())},isExpanded:function(e){if(!e)return!0;var t=this._categoryMap[e];return t?t.isExpanded:$i.PROPERTYSHEET_EXPAND_CATEGORY},expand:function(e){if(!e)return;var t=this._categoryMap[e];if(!t||t.isExpanded)return;t.isExpanded=!0,this.invalidate()},expandAll:function(){for(var e in this._categoryMap){var t=this._categoryMap[e];t&&(t.isExpanded=!0)}this.invalidate()},collapse:function(e){if(!e)return;var t=this._categoryMap[e];if(!t||!t.isExpanded)return;t.isExpanded=!1,this.invalidate()},collapseAll:function(){for(var e in this._categoryMap){var t=this._categoryMap[e];t&&(t.isExpanded=!1)}this.invalidate()},getCategoryName:function(e){if(!this.isCategorizable())return"null";var t=e.getCategoryName();return t?t:"null"},validateModel:function(){this._rowList.clear(),this._categoryList.clear();var e={},t=new Oi,n=this._currentData?this._propertyBox.getRoots():new Oi,r,i,s,o,u;o=n.size();for(r=0;r<o;r++)u=n.get(r),this.isVisible(u)&&(t.add(u),s=this.getCategoryName(u),e[s]||(this._categoryList.add(s),e[s]={isExpanded:this.isExpanded(s),properties:new Oi}));this._sortFunction&&t.sort(this._sortFunction),this._categoryMap=e,o=t.size();for(r=0;r<this._categoryList.size();r++){s=this._categoryList.get(r),s!=="null"&&this._rowList.add(s);var a=e[s];if(a.isExpanded)for(i=0;i<o;i++)u=t.get(i),this.getCategoryName(u)===s&&(a.properties.add(u),this._rowList.add({view:this,data:this._currentData,property:u,value:this._currentData?this.getValue(this._currentData,u):null}))}},adjustWidth:function(){var e=this._view.offsetWidth,t=this._view.offsetHeight;if(e<=this._indent||t<=0)return;e-=this._indent;if(this._rowList.size()*this._rowHeight>t){e-=$i.SCROLL_BAR_WIDTH;if(e<=0)return}this._sumWidth===0||this._propertyNameWidth>this._sumWidth?this._propertyNameWidth=e/2:this._propertyNameWidth=e*(this._propertyNameWidth/this._sumWidth),this._sumWidth=e,this._view.style.overflowX="hidden",this._view.style.overflowY="auto"},validateDisplay:function(){var e=this._rowList.size(),t=this._borderColor,n=this._indent,i=this._rowHeight,s=this._propertyNameWidth,o=Math.max(0,this._sumWidth-s),u=this._rowLineWidth,a=this._columnLineWidth,f=i-u+"px",l=i-u-2+"px",c=n+"px",h=s-a+"px",p=o-a+"px",d=s+o+"px",v=u+"px",m=a+"px",g=s+"px",y=this._dataDiv,b=y.style;b.height=e*i+"px",b.width=n+s+o+"px";var w=this.__divPool.get();b=w.style,b.position="absolute",b.left="0px",b.top="0px",b.width=c,b.height=y.style.height,b.borderWidth="0px",b.backgroundColor=t,y.appendChild(w);for(var E=0;E<e;E++){var S=this._rowList.get(E),x=E*i+"px",T=this.__divPool.get();S.rowDiv=T,b=T.style,b.position="absolute",b.whiteSpace="nowrap",b.overflow="hidden",b.textOverflow="ellipsis",b.left=c,b.top=x,b.width=d,b.height=f,b.lineHeight=l,b.borderStyle="solid",b.borderWidth="0px",b.borderBottomWidth=v,b.borderBottomColor=t,y.appendChild(T);if(typeof S=="string"){b.backgroundColor=t,w=this.__divPool.get(),b=w.style,b.position="absolute",b.left="0px",b.top=x,b.width=c,b.height=f,b.lineHeight=l,b.borderWidth="0px",y.appendChild(w);var N=this.__imagePool.get(),C=this.isExpanded(S)?this._expandIcon:this._collapseIcon;N.setAttribute("src",r.getImageSrc(C)),b=N.style,b.verticalAlign="middle",N._expandData=S,w.appendChild(N),this.renderCategory(T,S),this.onCategoryRendered(T,S)}else{var k=S.property,L=this.__cellPool.get();S.nameRender=L,b=L.style,this._currentRowIndex===E&&(b.backgroundColor=this.getSelectColor()),b.position="absolute",b.verticalAlign="middle",b.textAlign=this._propertyNameHorizontalAlign,b.overflow="hidden",b.textOverflow="ellipsis",b.whiteSpace="nowrap",b.left="0px",b.top="0px",b.width=h,b.height=f,b.borderStyle="solid",b.borderWidth="0px",b.borderRightWidth=m,b.borderRightColor=t,T.appendChild(L),this.renderName(S),this.onNameRendered(S),L=this.__cellPool.get(),S.valueRender=L,b=L.style,b.position="absolute",b.verticalAlign="middle",b.textAlign=k.getHorizontalAlign(),b.whiteSpace="nowrap",b.overflow="hidden",b.textOverflow="ellipsis",b.left=g,b.top="0px",b.width=p,b.height=f,b.borderStyle="solid",b.borderWidth="0px",b.borderRightWidth=m,b.borderRightColor=t,T.appendChild(L),this.renderValue(S),this.onValueRendered(S)}}b=this._resizeDiv.style,b.left=n+s-a-this._resizeTolerance+"px",b.width=a+this._resizeTolerance*2+"px",b.height=y.style.height,y.appendChild(this._resizeDiv)},renderCategory:function(e,t){var n=this.__textPool.get(),r=n.style;r.fontWeight="bold",r.whiteSpace="nowrap",r.overflow="hidden",r.textOverflow="ellipsis",r.verticalAlign="middle",r.padding="1px 2px 1px 2px",n.innerHTML=t,n.setAttribute("title",t),e.appendChild(n)},onCategoryRendered:function(e,t){},renderName:function(e){if(e.property.renderName){e.property.renderName(e);return}var t=this.__textPool.get(),n=t.style;n.fontWeight="",n.whiteSpace="nowrap",n.verticalAlign="middle",n.padding="1px 2px 1px 2px";var r=e.property.getName();r||(r=e.property.getPropertyName()),t.innerHTML=r,t.setAttribute("title",r),e.nameRender.appendChild(t)},onNameRendered:function(e){},renderValue:function(e){var t=e.property;if(t.renderValue){t.renderValue(e);return}var n=e.value,r=t.getEnumInfo(this._currentData);r&&!Array.isArray(r)&&(n=r.map[n]),e.view.isCellEditable(e.data,t)&&(e.enumInfo=r,e.valueRender._editInfo=e),e.valueRender.innerHTML="",Lr.render(t.getValueType(),n,e.valueRender,e.view,t.isInnerText())},onValueRendered:function(e){},renderEditor:function(e){},onEditorRendered:function(e){},updateCurrentData:function(){this._currentData=this.getSelectionModel().getLastData()},validateImpl:function(){var e=this._view.scrollLeft,t=this._view.scrollTop;b.release(this._dataDiv),this.updateCurrentData(),this.validateModel(),this.isAutoAdjustable()&&this.adjustWidth(),this.validateDisplay(),this._pools.forEach(function(e){e.clear()}),this._view.scrollLeft!==e&&(this._view.scrollLeft=e),this._view.scrollTop!==t&&(this._view.scrollTop=t)},getValue:function(e,t){return e?t.getValue(e,this):null},setValue:function(e,t,n){if(!e)return;t.setValue(e,n,this)},isCellEditable:function(e,t){return e?this.isEditable()&&t.isEditable():!1},getRowIndexAt:function(e){var t=this.getLogicalPoint(e);if(!t)return-1;var n=parseInt(t.y/this._rowHeight);return n>=0&&n<this._rowList.size()?n:-1},handleChange:function(e){if(this._isCommitting||this._isCanceling||this._isValidating)return;e.target._editInfo&&this.commitEditValue&&this.commitEditValue(e.target._editInfo,e.target)},commitEditValue:function(e,t){var r;t.type==="checkbox"?r=t.checked:r=t.value;var i=e.property,s=i.getValueType();if(s==="int"&&typeof r=="string")r=parseInt(r);else if(s==="number"&&typeof r=="string")r=parseFloat(r);else if(s==="array.string")r=r.split(",");else if(s==="array.number"){r=r.split(",");for(var o=0,u=r.length;o<u;o++)r[o]=parseFloat(r[o])}else if(s==="list.points"){var a=r.replace(/\]/g,"").replace(/\[/g,"").split(","),f=new n.List;for(var o=0;o<a.length;o+=2){if(o+1>=a.length)continue;f.add({x:parseInt(a[o]),y:parseInt(a[o+1])})}r=f}t._rowInfo&&(t._rowInfo.value=r,this.renderValue(t._rowInfo)),this.setValue(e.data,i,r),n.Util.setFocus(this._view);if(this._currentEditor){var l=this._currentEditor.parentNode;l&&l.removeChild(this._currentEditor),delete this._currentEditor}delete this._isCommitting},cancelEditing:function(){if(this._currentEditor){var e=this._currentEditor.parentNode;e&&e.removeChild(this._currentEditor),delete this._currentEditor,delete this._isCanceling}},getEditorValue:function(e){var t=e.valueRender._editInfo,n=t.property.getValueType(),r=e.valueRender._editInfo.value,i="";if(n==="list.points"){var s=r._as?r._as:r;s.forEach(function(e,t){i+=t==s.length-1?"["+e.x+","+e.y+"]":"["+e.x+","+e.y+"],"})}else i=r;return i},updateCurrentRowIndex:function(e){var t=this._rowList.size();if(e<0||e>=t)e=-1;var r=this._currentRowIndex,i;e!==r&&(r>=0&&r<t&&(i=this._rowList.get(r),i.nameRender&&(i.nameRender.style.backgroundColor="")),this._currentRowIndex=e);if(e>=0){i=this._rowList.get(e);if(i.nameRender){i.nameRender.style.backgroundColor=this.getSelectColor();if(!this._currentEditor&&i.valueRender&&i.valueRender._editInfo){var s=i.valueRender._editInfo,o=this.renderEditor&&this.renderEditor(i);o?(this._currentEditor=o.view,s.value!=null&&(this._currentEditor.value=this.getEditorValue(i))):s.enumInfo?this._currentEditor=b.createSelect(s.enumInfo,s.value):(this._currentEditor=l.createElement("input"),s.value!=null&&(this._currentEditor.value=this.getEditorValue(i)));var u=this;if(i.property&&i.property.renderEditor){var o=typeof i.property.renderEditor=="function"?i.property.renderEditor(u,i):i.property.renderEditor;o&&(u._currentEditor=o)}if(this._currentEditor){if(o&&o.onKeyDown){var a=o.onKeyDown;a&&Array.isArray(a)&&u._currentEditor.addEventListener("keydown",function(e){for(var t=0;t<a.length;t++)if(a[t].combKey){var n=null;switch(a[t].combKey){case"ctrlKey":n=e.ctrlKey;break;case"shiftKey":n=e.shiftKey;break;case"altKey":n=e.altKey}e.keyCode===a[t].keyCode&&n&&a[t].handlerEvent&&a[t].handlerEvent(e)}else e.keyCode===a[t].keyCode&&a[t].handlerEvent&&a[t].handlerEvent(e)})}else this._currentEditor.addEventListener("keydown",function(e){var t=e.target._editInfo.view;if(e.keyCode===13&&e.shiftKey)return;if(e.keyCode===13){if(t._isCommitting)return;t._isCommitting=!0,t.commitEditValue(e.target._editInfo,e.target)}else e.keyCode===27&&(t._isCanceling=!0,t.cancelEditing())},!1);this._currentEditor.addEventListener("blur",function(e){var t=e.target._editInfo.view;if(t._isCommitting||t._isCanceling)return;t._isCommitting=!0,t.commitEditValue(e.target._editInfo,e.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._rowInfo=i,this._currentEditor._editInfo=s;if(!this._currentEditor.parentNode){var f=this._currentEditor.style;f.position="absolute",f.margin="0px",f.border="0px",f.padding="0px",f.left=this._indent+this._propertyNameWidth+"px",f.top=i.rowDiv.style.top,f.width=i.valueRender.style.width,f.height=i.valueRender.style.height,this._rootDiv.appendChild(this._currentEditor)}n.Util.setFocus(this._currentEditor),this.onEditorRendered&&this.onEditorRendered(i)}}}}}}),n.controls.PropertySheetInteraction=function(e){this.sheet=e,this.view=e._view,this.resizeDiv=e._resizeDiv;var t=this;this.view.addEventListener("mousedown",function(e){e.button===0&&t.handleMouseDown(e)},!1),this.view.addEventListener("mousemove",function(e){t.handleMouseMove(e)},!1)},r.ext("twaver.controls.PropertySheetInteraction",Object,{minGap:10,handleMouseDown:function(e){if(e.target===this.sheet._currentEditor||e.target.parentNode===this.sheet._currentEditor)return;this.sheet.isFocusOnClick()&&n.Util.setFocus(this.view);if(this.sheet._isValidating)return;if(e.target._expandData){var t=e.target._expandData;this.sheet.isExpanded(t)?this.sheet.collapse(t):this.sheet.expand(t)}else if(e.target===this.resizeDiv)this.lastX=this.getX(e),b.handle_mousedown(this,e);else{this.sheet._currentEditor&&!this.sheet._isCommitting&&(this.sheet._isCommitting=!0,this.sheet.commitEditValue(this.sheet._currentEditor._editInfo,this.sheet._currentEditor));var r=this.sheet.getRowIndexAt(e);this.sheet.updateCurrentRowIndex(r)}},handleMouseMove:function(e){if(this.lastX==null&&!b.target){this.changeCursor(e);return}if(b.target!==this||this.lastX==null)return;var t=this.getX(e);if(this.stopLeft!=null){if(t<this.stopLeft)return;delete this.stopLeft}if(this.stopRight!=null){if(t>this.stopRight)return;delete this.stopRight}var n=this.sheet.getPropertyNameWidth()+(t-this.lastX);n<this.minGap?(n=this.minGap,this.stopLeft=t):n>this.sheet.getSumWidth()-this.minGap&&(n=this.sheet.getSumWidth()-this.minGap,this.stopRight=t),this.sheet.setPropertyNameWidth(n),this.lastX=t},handleMouseUp:function(e){if(e.button!==0)return;this.view.style.cursor="default",delete this.stopLeft,delete this.stopRight,delete this.lastX},changeCursor:function(e){this.view.style.cursor=e.target===this.resizeDiv?"ew-resize":"default"},getX:function(e){return e.clientX/this.sheet.getZoom()}}),n.controls.PropertySheetTouchInteraction=function(e){this.sheet=e,this.view=e._view,this.resizeDiv=e._resizeDiv,b.addEventListener("touchstart","handleTouchstart",this.view,this)},r.ext("twaver.controls.PropertySheetTouchInteraction",Object,{minGap:10,handleTouchstart:function(e){b.preventDefault(e);if(e.target===this.sheet._currentEditor||e.target.parentNode===this.sheet._currentEditor)return;this.sheet.isFocusOnClick()&&n.Util.setFocus(this.view);if(this.sheet._isValidating)return;e.target===this.resizeDiv&&(this.lastX=this.getX(e)),this.lastPoint=this.sheet.getLogicalPoint(e),kr.isMultiTouch(e)&&(this.distance=kr.getDistance(e),this.zoom=this.sheet.getZoom()),b.addEventListener("touchmove","handleTouchmove",this.view,this),b.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(e){b.preventDefault(e),this.moved||(this.moved=!0);if(this.lastX==null){if(kr.isSingleTouch(e)){if(this.lastPoint){var t=this.sheet.getLogicalPoint(e),n=this.lastPoint.x-t.x,r=this.lastPoint.y-t.y,i=this.sheet.panByOffset(n,r);this.lastPoint.x-=n-i.x,this.lastPoint.y-=r-i.y}}else if(this.distance){var s=kr.getDistance(e)/this.distance;this.sheet.setZoom(this.zoom*s,!1)}return}var o=this.getX(e);if(this.stopLeft!=null){if(o<this.stopLeft)return;delete this.stopLeft}if(this.stopRight!=null){if(o>this.stopRight)return;delete this.stopRight}var u=this.sheet.getPropertyNameWidth()+(o-this.lastX);u<this.minGap?(u=this.minGap,this.stopLeft=o):u>this.sheet.getSumWidth()-this.minGap&&(u=this.sheet.getSumWidth()-this.minGap,this.stopRight=o),this.sheet.setPropertyNameWidth(u),this.lastX=o},handleTouchend:function(e){b.preventDefault(e);if(!this.moved)if(e.target._expandData){var t=e.target._expandData;this.sheet.isExpanded(t)?this.sheet.collapse(t):this.sheet.expand(t)}else if(e.target!==this.resizeDiv){var n=this.sheet.getRowIndexAt(e);this.sheet.updateCurrentRowIndex(n)}delete this.stopLeft,delete this.stopRight,delete this.lastX,delete this.lastPoint,delete this.distance,delete this.zoom,delete this.moved,b.removeEventListener("touchmove",this.view,this),b.removeEventListener("touchend",this.view,this)},getX:function(e){var t=e.changedTouches[0];return t.clientX}}),n.controls.PropertySheetMSTouchInteraction=function(e){this.sheet=e,this.view=e._view,this.resizeDiv=e._resizeDiv,this._pointerMap={},this._pointerIdArray=[],b.addEventListener("MSPointerDown","handleTouchstart",this.view,this),b.addEventListener("MSPointerMove","handleTouchmove",this.view,this),b.addEventListener("MSPointerUp","handleTouchend",this.view,this),b.addEventListener("MSPointerCancel","handleTouchend",this.view,this),this.superHandleMouseDown=n.controls.PropertySheetMSTouchInteraction.superClass.handleMouseDown},r.ext("twaver.controls.PropertySheetMSTouchInteraction",n.controls.PropertySheetInteraction,{handleMouseDown:function(e){},handleTouchstart:function(e){e.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[e.pointerId]&&this.sheet.getLogicalPoint(e)!=null&&(this._pointerIdArray.push(e.pointerId),this._pointerMap[e.pointerId]=e),this._pointerIdArray.length==1&&e.pointerType==e.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(e),this._pointerIdArray.length==1?(this._startTouchPoint=this.sheet.getLogicalPoint(e),this._startTouchTime=new Date):this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.sheet.getZoom())},handleTouchmove:function(e){if(this._pointerIdArray.length==0||!this._pointerMap[e.pointerId]||m.getDistance({x:this._pointerMap[e.pointerId].pageX,y:this._pointerMap[e.pointerId].pageY},{x:e.pageX,y:e.pageY})<=10)return;this._pointerMap[e.pointerId]=e;if(this._pointerIdArray.length==2){var t=this._getDistance()/this._distance;this.sheet.setZoom(this._zoom*t,!1)}else if(this._pointerIdArray.length==1&&e.pointerType!=e.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var n=this.sheet.getLogicalPoint(e);if(n==null)return;var r=this._startTouchPoint.x-n.x,i=this._startTouchPoint.y-n.y,s=this.sheet.panByOffset(r,i);this._startTouchPoint.x-=r-s.x,this._startTouchPoint.y-=i-s.y}},handleTouchend:function(e){if(this._pointerIdArray.length==1&&e.pointerType!=e.MSPOINTER_TYPE_MOUSE){var t=this.sheet.getLogicalPoint(e),n=new Date;n.getTime()-this._startTouchTime.getTime()<=500&&m.getDistance(this._startTouchPoint,t)<=20&&this.superHandleMouseDown(e)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return m.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),n.controls.SplitPane=function(e,t,r,i){n.controls.SplitPane.superClass.constructor.apply(this,arguments),this._view=b.createView("hidden",!0),this._view.tabIndex=-1,this._dividerDiv=b.createDiv(),this._dividerDiv.tabIndex=-1,this._isPercentPosition=!0,this._view.appendChild(this._dividerDiv),e&&this.setFirstView(e),t&&this.setNextView(t),r&&this.setOrientation(r),i>1&&(this._isPercentPosition=!1),i!=null&&this.setPosition(i,this._isPercentPosition),this.setDividerDraggable(!0),this.setExpandable(!1),this.invalidate(),h.isTouchable&&new n.controls.SplitPaneTouchInteraction(this),new n.controls.SplitPaneInteraction(this)},r.ext("twaver.controls.SplitPane",n.controls.ControlBase,{__accessor:["orientation","dividerWidth","dividerBackground","dividerOpacity","maskBackground","upExpandIcon","downExpandIcon","leftExpandIcon","rightExpandIcon"],__bool:["dividerDraggable","expandable"],_position:$i.SPLITPANE_POSITION,_orientation:$i.SPLITPANE_ORIENTATION,_dividerWidth:$i.SPLITPANE_DIVIDER_WIDTH,_dividerBackground:$i.SPLITPANE_DIVIDER_BACKGROUND,_dividerOpacity:$i.SPLITPANE_DIVIDER_OPACITY,_maskBackground:$i.SPLITPANE_MASK_BACKGROUND,_upExpandIcon:$i.SPLITPANE_UP_EXPAND_ICON,_downExpandIcon:$i.SPLITPANE_DOWN_EXPAND_ICON,_leftExpandIcon:$i.SPLITPANE_LEFT_EXPAND_ICON,_rightExpandIcon:$i.SPLITPANE_RIGHT_EXPAND_ICON,onPropertyChanged:function(e){this.invalidate()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(e,t){t&&e<0&&(e=0);if(e===this._position)return;var n=this._position;this._position=e,this.firePropertyChange("position",n,e),this.lastDividerLocation==null&&(this.lastDividerLocation=e)},setFirstView:function(e){if(this._firstView===e)return;var t=this._firstView;t&&(t.getView?this._view.removeChild(t.getView()):this._view.removeChild(t)),this._firstView=e,e&&(e.getView?this._view.insertBefore(e.getView(),this._dividerDiv):this._view.insertBefore(e,this._dividerDiv)),this.firePropertyChange("firstView",t,e)},getFirstView:function(){return this._firstView},setNextView:function(e){if(this._nextView===e)return;var t=this._nextView;t&&(t.getView?this._view.removeChild(t.getView()):this._view.removeChild(t)),this._nextView=e,e&&(e.getView?this._view.insertBefore(e.getView(),this._dividerDiv):this._view.insertBefore(e,this._dividerDiv)),this.firePropertyChange("nextView",t,e)},getNextView:function(){return this._nextView},validateImpl:function(){var e=this._position,t=this._view.offsetWidth,n=this._view.offsetHeight,i=this._dividerWidth,s,o;i>=8||i===0?this._coverDiv&&(this._dividerDiv.removeChild(this._coverDiv),delete this._coverDiv):this._coverDiv||(this._coverDiv=b.createDiv(),this._coverDiv.tabIndex=-1,this._dividerDiv.appendChild(this._coverDiv));if(this._orientation==="horizontal"){i>t&&(i=t);if(this._isPercentPosition)var u=(t-i)*e;else var u=e;var a=t-i-u+1;r.setViewBounds(this._firstView,{x:0,y:0,width:u,height:n}),r.setViewBounds(this._nextView,{x:u+i,y:0,width:a,height:n}),r.setViewBounds(this._dividerDiv,{x:u,y:0,width:i,height:n}),this._dividerDiv.position=u,this._coverDiv&&r.setViewBounds(this._coverDiv,{x:i/2-4,y:0,width:8,height:n}),this._expandable&&(this._expandCvs1||(s=r.html.createDiv(),s.tabIndex=-1,r.setViewBounds(s,{x:0,y:0,width:i,height:11}),this._expandCvs1=r.html.createImg(r.getImageSrc(this._leftExpandIcon
)),this._expandCvs1.style.left=i/2-3+"px",s.appendChild(this._expandCvs1),this._dividerDiv.appendChild(s)),this._expandCvs2||(s=r.html.createDiv(),s.tabIndex=-1,r.setViewBounds(s,{x:0,y:15,width:i,height:11}),this._expandCvs2=r.html.createImg(r.getImageSrc(this._rightExpandIcon)),this._expandCvs2.style.left=i/2-3+"px",s.appendChild(this._expandCvs2),this._dividerDiv.appendChild(s)))}else{i>n&&(i=n);if(this._isPercentPosition)var f=(n-i)*e;else var f=e;var l=n-i-f;r.setViewBounds(this._firstView,{x:0,y:0,width:t,height:f}),r.setViewBounds(this._nextView,{x:0,y:f+i,width:t,height:l}),r.setViewBounds(this._dividerDiv,{x:0,y:f,width:t,height:i}),this._dividerDiv.position=f,this._coverDiv&&r.setViewBounds(this._coverDiv,{x:0,y:i/2-4,width:t,height:8}),this._expandable&&(this._expandCvs1||(s=r.html.createDiv(),s.tabIndex=-1,r.setViewBounds(s,{x:0,y:0,width:11,height:i}),this._expandCvs1=r.html.createImg(r.getImageSrc(this._upExpandIcon)),this._expandCvs1.style.top=i/2-3+"px",s.appendChild(this._expandCvs1),this._dividerDiv.appendChild(s)),this._expandCvs2||(s=r.html.createDiv(),s.tabIndex=-1,r.setViewBounds(s,{x:15,y:0,width:11,height:i}),this._expandCvs2=r.html.createImg(r.getImageSrc(this._downExpandIcon)),this._expandCvs2.style.top=i/2-3+"px",s.appendChild(this._expandCvs2),this._dividerDiv.appendChild(s)))}var c=this._dividerDiv.style;c.background=this._dividerBackground}}),n.controls.SplitPaneInteraction=function(e){this.splitPane=e,this.view=e._view,this.dividerDiv=e._dividerDiv,this.isPercentPosition=e._isPercentPosition;var t=this;this.view.addEventListener("mousedown",function(e){e.button===0&&t.handleMouseDown(e)},!1),this.view.addEventListener("mousemove",function(e){t.handleMouseMove(e)},!1)},r.ext("twaver.controls.SplitPaneInteraction",Object,{handleMouseDown:function(e){if(this.splitPane.isExpandable()){var t=this.splitPane._dividerWidth,n,r;if(e.target===this.splitPane._expandCvs1){this.splitPane._orientation==="horizontal"?(n=this.view.clientWidth,t>n&&(t=n),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(r=this.view.clientHeight,t>r&&(t=r),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition()));return}if(e.target===this.splitPane._expandCvs2){this.splitPane._orientation==="horizontal"?(n=this.view.clientWidth,t>n&&(t=n),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(r=this.view.clientHeight,t>r&&(t=r),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition()));return}}if(!this.splitPane.isDividerDraggable())return;if(this.resizeDiv)this.clear(e);else if(e.target===this.dividerDiv||e.target===this.splitPane._coverDiv){this.resizeDiv=b.createDiv();var i=this.resizeDiv.style;i.left=this.dividerDiv.style.left,i.top=this.dividerDiv.style.top,i.width=this.dividerDiv.style.width,i.height=this.dividerDiv.style.height,i.opacity=this.splitPane.getDividerOpacity(),i.background=this.splitPane.getDividerBackground(),this.resizeDiv.lastPosition=this.splitPane._orientation==="horizontal"?e.clientX:e.clientY,this.resizeDiv.maskDiv=b.createDiv(),i=this.resizeDiv.maskDiv.style,i.left="0px",i.top="0px",i.width=this.view.clientWidth+"px",i.height=this.view.clientHeight+"px",i.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv),b.handle_mousedown(this,e),e.preventDefault()}},handleMouseMove:function(e){if(this.splitPane.isExpandable())if(e.target===this.splitPane._expandCvs1||e.target===this.splitPane._expandCvs2)return;if(!this.splitPane.isDividerDraggable())return;if(!this.resizeDiv&&!b.target){var t=this.splitPane._orientation==="horizontal"?"ew-resize":"ns-resize";this.view.style.cursor=e.target===this.dividerDiv||e.target===this.splitPane._coverDiv?t:"default"}else this.resizeDiv&&b.target===this&&(this.splitPane._orientation==="horizontal"?this.resizeDiv.style.left=this.dividerDiv.position+e.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+e.clientY-this.resizeDiv.lastPosition+"px")},handleMouseUp:function(e){if(this.splitPane.isExpandable())if(e.target===this.splitPane._expandCvs1||e.target===this.splitPane._expandCvs2)return;if(!this.splitPane.isDividerDraggable())return;e.button===0&&this.clear(e)},clear:function(e){if(this.resizeDiv){var t=this.splitPane._dividerWidth,n;if(this.splitPane._orientation==="horizontal"){var r=this.view.clientWidth;t>r&&(t=r),n=this.dividerDiv.position+e.clientX-this.resizeDiv.lastPosition,this.isPercentPosition?this.splitPane.setPosition(n/(r-t)):this.splitPane.setPosition(n)}else{var i=this.view.clientHeight;t>i&&(t=i),n=this.dividerDiv.position+e.clientY-this.resizeDiv.lastPosition,this.isPercentPosition?this.splitPane.setPosition(n/(i-t)):this.splitPane.setPosition(n)}this.splitPane.lastDividerLocation=this.splitPane.getPosition(),this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),n.controls.SplitPaneTouchInteraction=function(e){this.splitPane=e,this.view=e._view,this.dividerDiv=e._dividerDiv,this.isPercentPosition=e._isPercentPosition,b.addEventListener("touchstart","handleTouchstart",this.view,this)},r.ext("twaver.controls.SplitPaneTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e);if(this.splitPane.isExpandable()){var t=this.splitPane._dividerWidth,n,r;if(e.target===this.splitPane._expandCvs1){this.splitPane._orientation==="horizontal"?(n=this.view.clientWidth,t>n&&(t=n),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(r=this.view.clientHeight,t>r&&(t=r),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition()));return}if(e.target===this.splitPane._expandCvs2){this.splitPane._orientation==="horizontal"?(n=this.view.clientWidth,t>n&&(t=n),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(r=this.view.clientHeight,t>r&&(t=r),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition()));return}}if(this.resizeDiv)this.clear(e);else if(e.target===this.dividerDiv||e.target===this.splitPane._coverDiv){this.resizeDiv=b.createDiv();var i=this.resizeDiv.style;i.left=this.dividerDiv.style.left,i.top=this.dividerDiv.style.top,i.width=this.dividerDiv.style.width,i.height=this.dividerDiv.style.height,i.opacity=this.splitPane.getDividerOpacity(),i.background=this.splitPane.getDividerBackground();var s=e.changedTouches[0];this.resizeDiv.lastPosition=this.splitPane._orientation==="horizontal"?s.clientX:s.clientY,this.resizeDiv.maskDiv=b.createDiv();var i=this.resizeDiv.maskDiv.style;i.left="0px",i.top="0px",i.width=this.view.clientWidth+"px",i.height=this.view.clientHeight+"px",i.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv)}b.addEventListener("touchmove","handleTouchmove",this.view,this),b.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(e){b.preventDefault(e);if(this.splitPane.isExpandable())if(e.target===this.splitPane._expandCvs1||e.target===this.splitPane._expandCvs2)return;if(!!this.resizeDiv){var t=e.changedTouches[0];this.splitPane._orientation==="horizontal"?this.resizeDiv.style.left=this.dividerDiv.position+t.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+t.clientY-this.resizeDiv.lastPosition+"px"}},handleTouchend:function(e){if(this.splitPane.isExpandable())if(e.target===this.splitPane._expandCvs1||e.target===this.splitPane._expandCvs2)return;b.removeEventListener("touchmove",this.view,this),b.removeEventListener("touchend",this.view,this),this.clear(e)},clear:function(e){var t=e.changedTouches[0];if(this.resizeDiv){var n=this.splitPane._dividerWidth;if(this.splitPane._orientation==="horizontal"){var r=this.view.clientWidth;n>r&&(n=r);var i=this.dividerDiv.position+t.clientX-this.resizeDiv.lastPosition;this.isPercentPosition?this.splitPane.setPosition(i/(r-n)):this.splitPane.setPosition(i)}else{var s=this.view.clientHeight;n>s&&(n=s);var i=this.dividerDiv.position+t.clientY-this.resizeDiv.lastPosition;this.isPercentPosition?this.splitPane.setPosition(i/(s-n)):this.splitPane.setPosition(i)}this.splitPane.lastDividerLocation=this.splitPane.getPosition(),this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),n.controls.TabPane=function(){n.controls.TabPane.superClass.constructor.apply(this,arguments),this._tabBox=new n.TabBox,this._tabBox.addDataBoxChangeListener(this.handleTabChange,this),this._tabBox.addDataPropertyChangeListener(this.handleTabChange,this),this._tabBox.addHierarchyChangeListener(this.handleTabChange,this),this._tabBox.getSelectionModel().addSelectionChangeListener(this.handleTabChange,this),this._view=b.createView("hidden",!0),this._tabDiv=b.createDiv(),this._tabDiv.onmousedown=b.preventDefault,this._tabDiv.onkeydown=b.preventDefault,this._contentDiv=b.createDiv(),this._view.appendChild(this._tabDiv),this._view.appendChild(this._contentDiv),this._divPool=new n.Pool("div"),this._iconPool=new n.Pool("img"),this._closePool=new n.Pool("img"),this._textPool=new n.Pool("span"),this._resizePool=new n.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._closePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this.invalidateTab(),h.isTouchable&&new n.controls.TabPaneTouchInteraction(this),new n.controls.TabPaneInteraction(this)},r.ext("twaver.controls.TabPane",n.controls.ControlBase,{__accessor:["tabGap","tabRadius","tabHeight","horizontalAlign","tabOrientation","resizeTolerance","tabBackground","selectBackground","moveBackground","insertBackground","closeIcon","disabledColor"],__bool:["selectNextOnClose","selectNextOnInVisible"],_tabGap:$i.TABPANE_TAB_GAP,_tabRadius:$i.TABPANE_TAB_RADIUS,_tabHeight:$i.TABPANE_TAB_HEIGHT,_resizeTolerance:$i.TABPANE_RESIZE_TOLERANCE,_tabOrientation:$i.TABPANE_TAB_ORIENTATION,_tabBackground:$i.TABPANE_TAB_BACKGROUND,_disabledColor:$i.TABPANE_DISABLED_COLOR,_selectBackground:$i.TABPANE_SELECT_BACKGROUND,_moveBackground:$i.TABPANE_MOVE_BACKGROUND,_insertBackground:$i.TABPANE_INSERT_BACKGROUND,_horizontalAlign:$i.TABPANE_HORIZONTAL_ALIGN,_closeIcon:$i.TABPANE_CLOSE_ICON,_selectNextOnClose:$i.TABPANE_SELECT_NEXT_ON_CLOSE,_selectNextOnInVisible:$i.TABPANE_SELECT_NEXT_ON_INVISIBLE,onPropertyChanged:function(e){this.invalidateTab()},getTabBox:function(){return this._tabBox},getTabDiv:function(){return this._tabDiv},getContentDiv:function(){return this._contentDiv},handleTabChange:function(e){if(this._selectNextOnInVisible&&e.property==="visible"&&!e.newValue&&this._tabBox.getSelectionModel().contains(e.source)){var t=e.source,n=this._tabBox.getRoots().indexOf(t),r=this._tabBox.getRoots(),i=r.size(),s=n,o,u;while(s<i-1){o=r.get(++s);if(o.isVisible()&&!o.isDisabled()){u=o;break}}if(!u){s=n;while(s>0){o=r.get(--s);if(o.isVisible()&&!o.isDisabled()){u=o;break}}}this._tabBox.getSelectionModel().setSelection(u)}this.invalidateTab()},invalidateTab:function(e){this._invalidateTab||(this._invalidateTab=!0,this.invalidate(e))},validateImpl:function(){this._invalidateTab&&(this._invalidateTab=!1,this.validateTab());var e=this._view.offsetWidth,t=this._view.offsetHeight,n;this._tabOrientation==="top"?(this._tabDiv.style.top="0px",n={x:0,y:this._tabHeight,width:e,height:Math.max(0,t-this._tabHeight)}):(this._tabDiv.style.top=t-this._tabHeight+"px",n={x:0,y:0,width:e,height:Math.max(0,t-this._tabHeight)}),this._currentView&&r.setViewBounds(this._currentView,n)},getCurrentTab:function(){return this._currentTab},getCurrentView:function(){return this._currentView},onViewRemoved:function(e){},onViewAdded:function(e){},validateTab:function(){this._currentTab=this._tabBox.getSelectionModel().getLastData();var e=this._currentTab?this._currentTab.getView():null;if(e!==this._currentView){var t,n;this._currentView&&(t=this._currentView.getView?this._currentView.getView():this._currentView,t.style.visibility="hidden",this.onViewRemoved(this._currentView)),e&&(n=e.getView?e.getView():e,n.style.visibility="inherit",n.parentNode||this._contentDiv.appendChild(n),this.onViewAdded(e)),this._currentView=e}b.release(this._tabDiv);var r=this._tabBox.getRoots(),i=this._tabHeight+"px",s=this._tabHeight-2+"px",o=this._tabRadius+"px",u=r.size(),a=0;for(var f=0;f<u;f++){var l=r.get(f);if(l.isVisible()){var c=this._currentTab===l,h=l.getWidth();h<0&&(h=0);var p=Math.min(this._tabGap,h),d=this._divPool.get();d._tab=l;var v=d.style;v.position="absolute",v.whiteSpace="nowrap",v.lineHeight=s,v.overflow="hidden",v.textOverflow="ellipsis",v.background=c?this._selectBackground:this._tabBackground,v.textAlign=this._horizontalAlign,this._tabOrientation==="top"?(v.borderTopLeftRadius=o,v.borderTopRightRadius=o,v.borderBottomLeftRadius="0px",v.borderBottomRightRadius="0px"):(v.borderTopLeftRadius="0px",v.borderTopRightRadius="0px",v.borderBottomLeftRadius=o,v.borderBottomRightRadius=o),v.left=a+"px",v.width=h-p+"px",v.height=i,d._x=a,d._width=h-p,this.renderTab(d,l),this.onTabRendered(d,l),this._tabDiv.insertBefore(d,this._tabDiv.firstChild),a+=h,l.isResizable()&&(d=this._resizePool.get(),d._resizeTab=l,v=d.style,v.position="absolute",v.backgroundColor="white",v.opacity=0,v.left=a-p-this._resizeTolerance+"px",v.width=p+this._resizeTolerance*2+"px",v.height=i,this._tabDiv.appendChild(d))}}this._tabDiv.style.left="0px",this._tabDiv.style.width=a+"px",this._tabDiv.style.height=this._tabHeight+"px",this._pools.forEach(function(e){e.clear()})},renderTab:function(e,t){if(t.renderTab)t.renderTab(e);else{var n=t.getIcon();if(n){var i=this._iconPool.get();i.setAttribute("src",r.getImageSrc(n)),i.style.paddingLeft="4px",i.style.verticalAlign="middle",e.appendChild(i)}var s=t.getName();if(s){var o=this._textPool.get();o.style.whiteSpace="nowrap",o.style.verticalAlign="middle",o.style.padding="2px 4px",o.innerHTML=s,e.appendChild(o)}if(h.isOpera){var u=e.cloneNode(!1);u.style.left="0px",u.style.top="0px",u.style.opacity=0,e.appendChild(u)}}if(t.isClosable()){var a=this._tabRadius/4+2,i=this._closePool.get();i._closeTab=t,i.setAttribute("src",r.getImageSrc(this._closeIcon)),i.style.position="absolute",i.style.top=a+"px",i.style.right=a+"px",e.appendChild(i)}t.isDisabled()?e.style.color=this.getDisabledColor():e.style.color=""},onTabRendered:function(e,t){}}),n.controls.TabPaneInteraction=function(e){this.tabPane=e,this.view=e.getTabDiv();var t=this;this.view.addEventListener("mousedown",function(e){t.handleMouseDown(e)},!1),this.view.addEventListener("mousemove",function(e){t.handleMouseMove(e)},!1)},r.ext("twaver.controls.TabPaneInteraction",Object,{handleMouseDown:function(e){if(e.button!==0)return;if(this.movableDiv){this.handleMouseUp(e);return}this.resizeTab=e.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(e)),this.changeCursor(e),this.lastX=this.getX(e),this._startClient=b.getClientPoint(e),this._startLogicalX=this.lastX,b.handle_mousedown(this,e)},changeCursor:function(e){var t="";if(e.target._resizeTab)t="ew-resize";else{var n=this.getTabAt(e);n&&(!n.isDisabled()||n.isMovable())&&(t="pointer")}this.view.style.cursor=t},handleMouseMove:function(e){if(this.lastX==null){this.changeCursor(e);return}if(b.target!==this)return;var t=this._startLogicalX+e.clientX-this._startClient.x;if(this.resizeTab){if(this.stopX!=null){if(t<this.stopX)return;delete this.stopX}var n=this.resizeTab.getWidth()+(t-this.lastX);n<10&&(n=10,this.stopX=t),this.resizeTab.setWidth(n),this.lastX=t}else if(this.movableDiv){var r=t-this.lastX;if(!this.cloneDiv){if(Math.abs(r)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=b.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var i=this.cloneDiv._x+r;this.cloneDiv.style.left=i+"px",this.cloneDiv._x=i,this.lastX=t,this.tabInfo=this.getTabInfoAt(e),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}},handleMouseUp:function(e){if(e.button!==0)return;if(!this.resizeTab)if(this.movableDiv&&this.tabInfo){var t=this.movableDiv._tab,n=this.tabInfo.index;this.tabPane.getTabBox().moveTo(t,n)}else{var r=this.tabPane.getTabBox(),t=e.target._closeTab;if(t)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===t){var i=r.getRoots(),n=i.indexOf(t);r.remove(t),i.size()>0&&(n>=i.size()&&(n=i.size()-1),r.getSelectionModel().setSelection(i.get(n)))}else r.remove(t);else{var t=this.getTabAt(e);t&&!t.isDisabled()&&r.getSelectionModel().setSelection(t)}}this.clear()},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX,delete this._startLogicalX,delete this._startClient},getTabAt:function(e){e=e.target;var t;while(e&&e!==this.view&&!(t=e._tab))e=e.parentNode;return t},getMovableDivAt:function(e){e=e.target;var t;while(e&&e!==this.view&&!(t=e._tab))e=e.parentNode;return t&&t.isMovable()?e:null},getX:function(e){var t=b.getLogicalPoint(this.view,e);return t?t.x:null},getTabInfoAt:function(e){var t=this._startLogicalX+e.clientX-this._startClient.x,n=this.tabPane.getTabBox().getRoots(),r=n.size(),i=0,s=!1;for(var o=0;o<r;o++){var u=n.get(o);u===this.movableDiv._tab&&(s=!0);if(u.isVisible()){var a=u.getWidth();if(a<=0)continue;if(t>=i&&t<=i+a){var f=t<i+a/2;s&&(u!==this.movableDiv._tab||!f)&&o--;var l=f?Math.max(0,o):Math.min(o+1,r),c=f?i:i+a;return c=Math.max(0,c-1),{index:l,tab:u,position:c+"px"}}i+=a}}return this.tabInfo}}),n.controls.TabPaneTouchInteraction=function(e){this.tabPane=e,this.view=e.getTabDiv(),b.addEventListener("touchstart","handleTouchstart",this.view,this)},r.ext("twaver.controls.TabPaneTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e);if(this.movableDiv){this.handleTouchend(e);return}this.resizeTab=e.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(e)),this.lastX=this.getX(e),b.addEventListener("touchmove","handleTouchmove",this.view,this),b.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(e){if(this.lastX==null)return;if(this.resizeTab){var t=this.getX(e);if(this.stopX!=null){if(t<this.stopX)return;delete this.stopX}var n=this.resizeTab.getWidth()+(t-this.lastX);n<0&&(n=0,this.stopX=t),this.resizeTab.setWidth(n),this.lastX=t}else if(this.movableDiv){var t=this.getX(e),r=t-this.lastX;if(!this.cloneDiv){if(Math.abs(r)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=b.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var i=this.cloneDiv._x+r;this.cloneDiv.style.left=i+"px",this.cloneDiv._x=i,this.lastX=t,this.tabInfo=this.getTabInfoAt(e),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}},handleTouchend:function(e){if(!this.resizeTab)if(this.movableDiv&&this.tabInfo){var t=this.movableDiv._tab,n=this.tabInfo.index;this.tabPane.getTabBox().moveTo(t,n)}else{var r=this.tabPane.getTabBox(),t=e.target._closeTab;if(t)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===t){var i=r.getRoots(),n=i.indexOf(t);r.remove(t),i.size()>0&&(n>=i.size()&&(n=i.size()-1),r.getSelectionModel().setSelection(i.get(n)))}else r.remove(t);else{var t=this.getTabAt(e);t&&!t.isDisabled()&&r.getSelectionModel().setSelection(t)}}this.clear(),b.removeEventListener("touchmove",this.view,this),b.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX},getTabAt:function(e){e=e.target;var t;while(e&&e!==this.view&&!(t=e._tab))e=e.parentNode;return t},getMovableDivAt:function(e){e=e.target;var t;while(e&&e!==this.view&&!(t=e._tab))e=e.parentNode;return t&&t.isMovable()?e:null},getX:function(e){var t=b.getLogicalPoint(this.view,e);return t?t.x:null},getTabInfoAt:function(e){var t=this.getX(e),n=this.tabPane.getTabBox().getRoots(),r=n.size(),i=0,s=!1;for(var o=0;o<r;o++){var u=n.get(o);u===this.movableDiv._tab&&(s=!0);if(u.isVisible()){var a=u.getWidth();if(a<=0)continue;if(t>=i&&t<=i+a){var f=t<i+a/2;s&&(u!==this.movableDiv._tab||!f)&&o--;var l=f?Math.max(0,o):Math.min(o+1,r),c=f?i:i+a;return c=Math.max(0,c-1),{index:l,tab:u,position:c+"px"}}i+=a}}return this.tabInfo}}),n.controls.TitlePane=function(e,t,r){n.controls.TitlePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._titleDiv=b.createDiv(),this._titleDiv.tabIndex=-1,this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.fontWeight="bold",this._titleDiv.style.textOverflow="ellipsis",this._titleDiv.style.overflow="hidden",this._titleDiv.style.whiteSpace="nowrap",this._titleDiv.onmousedown=b.preventDefault,this._span=l.createElement("span"),this._span.style.verticalAlign="middle",this._span.style.paddingLeft="4px",this._span.style.paddingRight="4px",this._img=l.createElement("img"),this._img.style.verticalAlign="middle",this._img.style.paddingLeft="4px",this._view=b.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._titleDiv),t&&this.setTitle(t),e&&this.setContent(e),r&&this.setIcon(r)},r.ext("twaver.controls.TitlePane",n.controls.ControlBase,{__accessor:["icon","title","titleHeight","titleHorizontalAlign","titleBackground"],_titleHeight:$i.TITLEPANE_TITLE_HEIGHT,_titleBackground:$i.TITLEPANE_TITLE_BACKGROUND,_titleHorizontalAlign:$i.TITLEPANE_TITLE_HORIZONTAL_ALIGN,onPropertyChanged:function(e){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getContent:function(){return this._content},setContent:function(e){if(this._content===e)return;var t=this._content;t&&(t.getView?this._view.removeChild(t.getView()):this._view.removeChild(t)),this._content=e,e&&(e.getView?this._view.appendChild(e.getView()):this._view.appendChild(e)),this.firePropertyChange("content",t,e)},validateImpl:function(){var e=this._view.offsetWidth,t=this._view.offsetHeight,n=this._titleDiv.style;n.textAlign=this._titleHorizontalAlign,n.lineHeight=this._titleHeight-2+"px",n.background=this._titleBackground,b.clear(this._titleDiv),this._icon&&(this._img.setAttribute("src",r.getImageSrc(this._icon)),this._titleDiv.appendChild(this._img)),this._title&&(this._span.innerHTML=this._title,this._span.setAttribute("title",this._title),this._titleDiv.appendChild(this._span));var n=this._titleDiv.style;n.left="0px",n.top="0px",n.width=e+"px",n.height=this._titleHeight+"px",r.setViewBounds(this._content,{x:0,y:this._titleHeight,width:e,height:Math.max(t-this._titleHeight,0)})}}),n.controls.Accordion=function(){n.controls.Accordion.superClass.constructor.apply(this,arguments),this._titleMap={},this._titleList=new Oi,this._currentTitle=null,this._currentView=null,this._view=b.createView("hidden",!0),this.invalidate();var e=this;this._view.addEventListener("mousedown",function(t){e.handleMouseDown(t)},!1)},r.ext("twaver.controls.Accordion",n.controls.ControlBase,{__accessor:["expandIcon","collapseIcon","titleHeight","titleBackground","borderBottomColor","iconPosition"],_expandIcon:$i.ACCORDION_EXPAND_ICON,_collapseIcon:$i.ACCORDION_COLLAPSE_ICON,_titleHeight:$i.ACCORDION_TITLE_HEIGHT,_titleBackground:$i.ACCORDION_TITLE_BACKGROUND,_borderBottomColor:$i.ACCORDION_BORDER_BOTTOM_COLOR,_iconPosition:$i.ACCORDION_ICON_POSITION,onPropertyChanged:function(e){this.invalidate()},handleMouseDown:function(e){if(e.button!==0)return;var t=e.target._title;t||(t=e.target.parentNode._title),t&&(this._currentTitle===t?this.collapse():this.expand(t))},getTitles:function(){return this._titleList},getCurrentTitle:function(){return this._currentTitle},add:function(e,t){if(this._titleMap[e])throw"Title ' + title + ' already exists";var n=b.createDiv();n._title=e,n.onmousedown=b.preventDefault,n.style.cursor="pointer",n.style.textAlign="left",n.style.textOverflow="ellipsis",n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.borderBottomWidth="1px",n.style.borderBottomStyle="solid";var r=l.createElement("img");r.style.verticalAlign="middle",r.style.paddingLeft="4px";var i=l.createElement("span");i.style.verticalAlign="middle",i.style.paddingLeft="4px",i.innerHTML=e,i.setAttribute("title",e),this._view.appendChild(n),n.appendChild(r),n.appendChild(i);if(this._iconPosition=="right"){var s=r.style,o=(this._titleHeight-8)/2;s.marginTop=o+"px",s.right="15px",s.position="absolute"}this._titleMap[e]={content:t,titleDiv:n,span:i,img:r},this._titleList.add(e),this.invalidate()},remove:function(e){var t=this._titleMap[e];t&&this._view.removeChild(t.titleDiv),delete this._titleMap[e],this._titleList.remove(e),this.invalidate()},clear:function(){var e=this;Object.keys(e._titleMap).forEach(function(t){e._view.removeChild(e._titleMap[t].titleDiv)}),e._titleMap={},e._titleList.clear(),e.invalidate()},expand:function(e){this._titleMap[e]&&this._currentTitle!==e&&(this._currentTitle=e,this.onExpanded(e),this.invalidate())},onExpanded:function(e){},collapse:function(){this._currentTitle&&(this.onCollapsed(this._currentTitle),this._currentTitle=null,this.invalidate())},onCollapsed:function(e){},validateImpl:function(){var e=this._currentView;this._currentView=null;var t=this._view.offsetWidth,n=this._view.offsetHeight,i=this._titleList.size(),s=0;for(var o=0;o<i;o++){var u=this._titleList.get(o),a=this._titleMap[u],f=a.titleDiv.style;f.lineHeight=this._titleHeight-3+"px",f.background=this._titleBackground,f.borderBottomColor=this._borderBottomColor,f.left="0px",f.top=s+"px",f.width=t+"px",f.height=this._titleHeight-1+"px";var l=this._currentTitle===u,c=l?this._expandIcon:this._collapseIcon;a.img.setAttribute("src",r.getImageSrc(c));if(l){var h=Math.max(0,n-i*this._titleHeight);a.content&&(this._currentView=a.content.getView?a.content.getView():a.content,r.setViewBounds(a.content,{x:0,y:s+this._titleHeight,width:t,height:h}),a.content.style.overflowY="auto"),s+=this._titleHeight+h}else s+=this._titleHeight}this._currentView&&this._currentView!==e&&this._view.appendChild(this._currentView),e&&e!==this._currentView&&this._view.removeChild(e)}}),n.controls.BorderPane=function(e,t,r,i,s){n.controls.BorderPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._view=b.createView("hidden",!0),this._view.tabIndex=-1,e&&this.setCenter(e),t&&this.setTop(t),r&&this.setRight(r),i&&this.setBottom(i),s&&this.setLeft(s)},r.ext("twaver.controls.BorderPane",n.controls.ControlBase,{__accessor:["hGap","vGap","topHeight","bottomHeight","leftWidth","rightWidth"],_hGap:$i.BORDERPANE_HGAP,_vGap:$i.BORDERPANE_VGAP,_topHeight:0,_bottomHeight:0,_leftWidth:0,_rightWidth:0,onPropertyChanged:function(e){this.invalidate()},getCenter:function(){return this._center},setCenter:function(e){this._setContent("center",e)},getTop:function(){return this._top},setTop:function(e){this._setContent("top",e)},getRight:function(){return this._right},setRight:function(e){this._setContent("right",e)},getBottom:function(){return this._bottom},setBottom:function(e){this._setContent("bottom",e)},getLeft:function(){return this._left},setLeft:function(e){this._setContent("left",e)},_setContent:function(e,t){var n=this["_"+e];if(n===t)return;if(n){var r=n.getView?n.getView():n;this._view.contains(r)&&this._view.removeChild(r)}this["_"+e]=t,t&&(t.getView?this._view.appendChild(t.getView()):this._view.appendChild(t)),this.firePropertyChange(e,n,t)},validateImpl:function(){var e=this._view.offsetWidth,t=this._view.offsetHeight,n=0,i=0,s=e,o=t,u=0,a=0,f=0,l=0;this._top&&(u=this._topHeight||(this._top.getView?this._top.getView().offsetHeight:this._top.offsetHeight),i=u+this._vGap),this._bottom&&(a=this._bottomHeight||(this._bottom.getView?this._bottom.getView().offsetHeight:this._bottom.offsetHeight),o=t-a-this._vGap),this._left&&(f=this._leftWidth||(this._left.getView?this._left.getView().offsetWidth:this._left.offsetWidth),n=f+this._hGap),this._right&&(l=this._rightWidth||(this._right.getView?this._right.getView().offsetWidth:this._right.offsetWidth),s=e-l-this._hGap);var c=Math.max(0,s-n),h=Math.max(0,o-i);this._top&&r.setViewBounds(this._top,{x:0,y:0,width:e,height:u}),this._bottom&&r.setViewBounds(this._bottom,{x:0,y:o,width:e,height:a}),this._left&&r.setViewBounds(this._left,{x:0,y:i,width:f,height:h}),this._right&&r.setViewBounds(this._right,{x:s,y:i,width:l,height:h}),this._center&&r.setViewBounds(this._center,{x:n,y:i,width:c,height:h})}}),n.controls.PopupMenu=function(e){this._view=b.createDiv(),this._view.style.zIndex=100001,this._items=[],this._itemsMap={},this.setContextView(e);var t=this._view,n=this;t.addEventListener("mouseover",function(e){n._mouseOver=!0},!1),t.addEventListener("mouseout",function(e){n._mouseOver=!1},!1),t.oncontextmenu=function(e){e.preventDefault()},b.addEventListener("mousedown","_handleClick",t,this)},r.ext("twaver.controls.PopupMenu",Object,{_width:200,_xOffset:0,_yOffset:0,_menuItemHeight:25,_background:"#F9F9F9",_border:"2px outset white",_disabledColor:"#BABBBC",_focusColor:"white",_focusBackground:"#C2CFF1",_color:"black",_subMenuEnableIcon:$i.POPUPMENU_SUBNENU_ENABLE_ICON,_subMenuDisableIcon:$i.POPUPMENU_SUBNENU_DISABLE_ICON,_checkboxSelectedIcon:$i.POPUPMENU_CHECKBOX_SELECTED_ICON,_checkboxUnselectedIcon:$i.POPUPMENU_CHECKBOX_UNSELECTED_ICON,_radiobuttonSelectedIcon:$i.POPUPMENU_RADIOBUTTON_SELECTED_ICON,_radiobuttonUnselectedIcon:$i.POPUPMENU_RADIOBUTTON_UNSELECTED_ICON,getView:function(){return this._view},getContextView:function(){return this._contextView},setContextView:function(e){this._removeContextmenuListener(),this._contextView=e;if(e){var t=e.getView?e.getView():e;h.isTouchable?(t.addEventListener("touchstart",this._getTouchStartListener(),!1),t.addEventListener("touchmove",this._getTouchMoveListener(),!1),t.addEventListener("touchend",this._getTouchEndListener(),!1),b.addEventListener("contextmenu","_handleContextmenu",t,this)):b.addEventListener("contextmenu","_handleContextmenu",t,this)}},getMenuItems:function(){return this._items},setMenuItems:function(e){this._items=[],this._itemsMap={};if(e)for(var t=0,n=e.length;t<n;t++)this.addMenuItem(e[t])},addMenuItem:function(e){e.separator!==!0&&
(this._itemsMap[e.id||e.label]=e),this._items.push(e)},getMenuItem:function(e){return this._itemsMap[e]},addSeparator:function(){this.addMenuItem({separator:!0})},getMenuItemById:function(e){return this._itemsMap[e]},isVisible:function(e){return e.visible!==!1},isEnabled:function(e){return e.enabled!==!1},show:function(e){this.hide();var t=this._view,n=this._view.style,r,i;h.isTouchable?(r=e.changedTouches&&e.changedTouches[0].clientX||e.clientX,i=e.changedTouches&&e.changedTouches[0].clientY||e.clientY):(r=e.clientX,i=e.clientY),b.clear(t),this.renderMenu(t,this._items);if(this._height===0)return;h.isTouchable&&b.addEventListener("touchstart","_handleBodyClicked",l.body,this),b.addEventListener("mousedown","_handleBodyClicked",l.body,this);var s=b.windowWidth()-this._width-10,o=b.windowHeight()-this._height-10;r=r>s?s:r,i=i>o?o:i,r=r<0?0:r,i=i<0?0:i,n.left=r+kr.scrollLeft()+this._xOffset+"px",n.top=i+kr.scrollTop()+this._yOffset+"px",l.body.appendChild(t)},_showMenuItem:function(e,t){this._hideMenuItem(t);var n=l.createElement("div");t.menuItem.childrenDiv=n;var r=n.style;r.color="#000000",r.position="absolute";var i=this._width,s=t.offsetTop,o=t.menuItem.items;this._itemsShow=!0,t._itemsShow=!0,b.clear(n),this.renderMenu(n,o);if(this._height===0)return;var u=b.windowWidth()-this._width-10,a=b.windowHeight()-10,f=this._getPosition(this._view);i=f.left+this._width>u?-this._width:i,s=f.top+s+o.length*this._menuItemHeight>a?s-(o.length-1)*this._menuItemHeight:s,r.left=i+"px",r.top=s+"px",t.appendChild(n)},hide:function(){l.body.contains(this._view)&&l.body.removeChild(this._view),delete this._mouseOver,delete this._itemsShow,h.isTouchable&&b.removeEventListener("touchstart",l.body,this),b.removeEventListener("mousedown",l.body,this)},_hideMenuItem:function(e){var t=e.menuItem.childrenDiv;t&&e.contains(t)&&e.removeChild(t),this._itemsShow=!1,e._itemsShow=!1},dispose:function(){this._removeContextmenuListener(),this.hide()},onMenuShowing:function(e){return!0},onAction:function(e){},renderMenu:function(e,t){var n=e.style;n.background=this._background,n.border=this._border,n.width=this._width+"px",this._height=0,delete this._separator,e.menuItems=t;for(var r=0,i=t.length,s;r<i;r++){s=t[r];if(this.isVisible(s))if(s.separator===!0)this._separator=!0;else{var o=l.createElement("div");this.isEnabled(s)&&this._addMouseoverListener(o,s),o._itemsShow=!1,o.menuItem=s,e.appendChild(o),this.renderMenuItem(o,s),this.onMenuItemRendered(o,s),this._separator=!1,this._height+=this._menuItemHeight}}},renderMenuItem:function(e,t){var n=e.style;n.height=this._menuItemHeight+"px",this._separator&&(n.borderTop="1px solid gray"),this.isEnabled(t)||(n.color=this._disabledColor);var i=l.createElement("span");n=i.style,n.position="absolute",n.width="25px",n.height=this._menuItemHeight+"px",n.lineHeight=this._menuItemHeight+"px",n.textAlign="center",e.appendChild(i);var s;t.type==="check"?s=t.selected?this._checkboxSelectedIcon:this._checkboxUnselectedIcon:t.type==="radio"?s=t.selected?this._radiobuttonSelectedIcon:this._radiobuttonUnselectedIcon:t.icon&&(s=t.icon);if(s){var o=new c;o.src=r.getImageSrc(s),o.style.verticalAlign="middle",i.appendChild(o)}var u=l.createElement("label");r.setText(u,t.label,!0),n=u.style,n.position="absolute",n.height=this._menuItemHeight+"px",n.lineHeight=this._menuItemHeight+"px",n.left="25px",e.appendChild(u);if(t.items&&e.parentNode){var a=l.createElement("img");n=a.style,this.isEnabled(t)?a.setAttribute("src",r.getImageSrc(this._subMenuEnableIcon)):a.setAttribute("src",r.getImageSrc(this._subMenuDisableIcon));var f=(this._menuItemHeight-8)/2;n.marginTop=f+"px",n.right="5px",n.position="absolute",e.appendChild(a)}},onMenuItemRendered:function(e,t){},_addMouseoverListener:function(e,t){var n=this,r=this._contextView;h.isTouchable&&(e.addEventListener("touchstart",function(r){e.style.background=n._focusBackground,e.style.color=n._focusColor,this!==r.relatedTarget&&!this.contains(r.relatedTarget)&&t.items&&!n._itemsShow&&e.parentNode==n._view&&n._showMenuItem(r,e)},!1),e.addEventListener("touchend",function(r){e.style.background=n._background,e.style.color=n._color;if(this!==r.relatedTarget&&!this.contains(r.relatedTarget)&&t.items&&e.parentNode===n._view){var i=r.clientX,s=r.clientY,o=t.childrenDiv,u=n._getPosition(o);(i<u.left+2||i>u.left+o.offsetWidth-2||s<u.top+2||s>u.top+o.offsetHeight-2)&&n._hideMenuItem(e)}},!1)),e.addEventListener("mouseenter",function(r){e.style.background=n._focusBackground,e.style.color=n._focusColor,this!==r.relatedTarget&&!this.contains(r.relatedTarget)&&t.items&&!this._itemsShow&&this.parentNode&&n._showMenuItem(r,this)},!1),e.addEventListener("mouseleave",function(e){this.style.background=n._background,this.style.color=n._color;if(this!==e.relatedTarget&&!this.contains(e.relatedTarget)&&t.items&&this.parentNode){var r=e.clientX,i=e.clientY,s=t.childrenDiv,o=n._getPosition(s);(r<o.left+2||r>o.left+s.offsetWidth-2||i<o.top+2||i>o.top+s.offsetHeight-2)&&n._hideMenuItem(this)}},!1)},_getPosition:function(e){var t=0,n=0;while(e)n+=e.offsetLeft,t+=e.offsetTop,e=e.offsetParent;return{left:n,top:t}},_removeContextmenuListener:function(){var e=this._contextView;e&&(e=e.getView?e.getView():e,h.isTouchable?(e.removeEventListener("touchstart",this._getTouchStartListener(),!1),e.removeEventListener("touchmove",this._getTouchMoveListener(),!1),e.removeEventListener("touchend",this._getTouchEndListener(),!1),b.removeEventListener("contextmenu",e,this)):b.removeEventListener("contextmenu",e,this))},_handleContextmenu:function(e){this.onMenuShowing(e)===!0&&this.show(e),e.preventDefault()},_handleBodyClicked:function(e){if(h.isTouchable){var t=e.target;while(t&&t!==this._view)t=t.parentElement;t!==this._view&&this.hide()}else this._mouseOver||this.hide()},_handleClick:function(e){if(e.button!==0)return;var t=e.target;while(!t.menuItem&&t.parentElement)t=t.parentElement;var n=t?t.menuItem:null;n&&this.isEnabled(n)&&(n.type==="check"&&(n.selected=!n.selected),n.type==="radio"&&(n.groupName?(n.selected=!0,this._items.forEach(function(e){n!==e&&e.groupName===n.groupName&&(e.selected=!1),e.items&&e.items.forEach(function(e){n!==e&&e.groupName===n.groupName&&(e.selected=!1)})})):n.selected=!n.selected),n.action&&n.action(n),this.onAction(n),n.items&&n.items.length>0||this.hide())},_getTouchStartListener:function(){if(!this._touchStartListener){var e=this;this._touchStartListener=function(t){e._touchMoved=!1,e._lastTouch=new Date}}return this._touchStartListener},_getTouchMoveListener:function(){if(!this._touchMoveListener){var e=this;this._touchMoveListener=function(t){e._touchMoved=!0}}return this._touchMoveListener},_getTouchEndListener:function(){if(!this._touchEndListener){var e=this;this._touchEndListener=function(t){!e._touchMoved&&(new Date).getTime()-e._lastTouch.getTime()>1e3&&e._handleContextmenu(t)}}return this._touchEndListener},getWidth:function(){return this._width},setWidth:function(e){this._width=e},getMenuItemHeight:function(){return this._menuItemHeight},setMenuItemHeight:function(e){this._menuItemHeight=e},getBackground:function(){return this._background},setBackground:function(e){this._background=e},getBorder:function(){return this._border},setBorder:function(e){this._border=e},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(e){this._disabledColor=e},getFocusColor:function(){return this._focusColor},setFocusColor:function(e){this._focusColor=e},getFocusBackground:function(){return this._focusBackground},setFocusBackground:function(e){this._focusBackground=e},getColor:function(){return this._color},setColor:function(e){this._color=e},getSubMenuEnableIcon:function(){return this._subMenuEnableIcon},setSubMenuEnableIcon:function(e){this._subMenuEnableIcon=e},getSubMenuDisableIcon:function(){return this._subMenuDisableIcon},setSubMenuDisableIcon:function(e){this._subMenuDisableIcon=e},getCheckboxSelectedIcon:function(){return this._checkboxSelectedIcon},setCheckboxSelectedIcon:function(e){this._checkboxSelectedIcon=e},getCheckboxUnselectedIcon:function(){return this._checkboxUnselectedIcon},setCheckboxUnselectedIcon:function(e){this._checkboxUnselectedIcon=e},getRadiobuttonSelectedIcon:function(){return this._radiobuttonSelectedIcon},setRadiobuttonSelectedIcon:function(e){this._radiobuttonSelectedIcon=e},getRadiobuttonUnselectedIcon:function(){return this._radiobuttonUnselectedIcon},setRadiobuttonUnselectedIcon:function(e){this._radiobuttonUnselectedIcon=e},getXOffset:function(){return this._xOffset},setXOffset:function(e){this._xOffset=e},getYOffset:function(){return this._yOffset},setYOffset:function(e){this._yOffset=e}}),n.charts.IS_INVALIDATE_PROPERTY={xZoom:1,xTranslate:1,yZoom:1,yTranslate:1},n.charts.ChartBase=function(e){n.charts.ChartBase.superClass.constructor.apply(this,arguments),this._uniqueColors={},this._nonDataColors={},this._publishedDatas=new Oi,this._view=b.createView("hidden"),this._canvas=b.createCanvas(),this._view.appendChild(this._canvas),this.setDataBox(e?e:new n.ElementBox),this.invalidate(),h.isTouchable?h.isMSTouchable?new n.charts.ChartMSTouchInteraction(this):(new n.charts.ChartTouchInteraction(this),new n.charts.ChartInteraction(this)):new n.charts.ChartInteraction(this),this.setToolTipEnabled($i.CHART_TOOLTIP_ENABLED)},r.ext("twaver.charts.ChartBase",n.controls.ViewBase,{__accessor:["xGap","yGap","xTranslate","yTranslate","valueVisible","sortFunction","visibleFunction","xTranslateEnabled","yTranslateEnabled","xZoomEnabled","yZoomEnabled","selectTolerance","backgroundVisible","backgroundFill","backgroundFillColor","backgroundOutlineWidth","backgroundOutlineColor","backgroundGradient","backgroundGradientColor","outerZoom"],__bool:["doubleClickToReset","focusOnClick"],_backgroundVisible:$i.CHART_BACKGROUND_VISIBLE,_backgroundFill:$i.CHART_BACKGROUND_FILL,_backgroundFillColor:$i.CHART_BACKGROUND_FILL_COLOR,_backgroundOutlineWidth:$i.CHART_BACKGROUND_OUTLINE_WIDTH,_backgroundOutlineColor:$i.CHART_BACKGROUND_OUTLINE_COLOR,_backgroundGradient:$i.CHART_BACKGROUND_GRADIENT,_backgroundGradientColor:$i.CHART_BACKGROUND_GRADIENT_COLOR,_selectTolerance:$i.CHART_SELECT_TOLERANCE,_doubleClickToReset:$i.CHART_DOUBLE_CLICK_TO_RESET,_focusOnClick:$i.FOCUS_ON_CLICK,_sortFunction:null,_visibleFunction:null,_canvasWidth:0,_canvasHeight:0,_outerZoomL:1,_xGap:$i.CHART_XGAP,_yGap:$i.CHART_YGAP,_xTranslate:0,_yTranslate:0,_xTranslateEnabled:$i.CHART_XTRANSLATE_ENABLED,_yTranslateEnabled:$i.CHART_YTRANSLATE_ENABLED,_xZoom:1,_yZoom:1,_maxZoom:$i.ZOOM_MAX,_minZoom:$i.ZOOM_MIN,_xZoomEnabled:$i.CHART_XZOOM_ENABLED,_yZoomEnabled:$i.CHART_YZOOM_ENABLED,_valueVisible:$i.CHART_VALUE_VISIBLE,_valueFont:$i.CHART_VALUE_FONT,isToolTipEnabled:function(){return this._toolTipListener?!0:!1},setToolTipEnabled:function(e){if(e){if(!this._toolTipListener){var t=this;this._toolTipListener=function(e){Ar.showToolTip(e,t.getToolTip(e))},this._canvas.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ar.hideToolTip(),this._canvas.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},getToolTip:function(e){if(this._toolTipInfos){var t=this.getLogicalPoint(e);t.x-=this._xTranslate,t.y-=this._yTranslate;var n=this._toolTipInfos.size();for(var r=n-1;r>=0;r--){var i=this._toolTipInfos.get(r);if(i.rect&&m.containsPoint(i.rect,t))return this.getToolTipByData(i.data,i)}}else{var s=this.tryGetDataAt(e);if(s)return this.getToolTipByData(s,{value:this.getValue(s)})}return null},getToolTipByData:function(e,n){return n.value!==t?this.formatValueText(n.value,e):null},addToolTipInfo:function(e,t,n,r,i,s,o){this._toolTipInfos&&this._toolTipInfos.add({data:s,rect:{x:e,y:t,width:n,height:r},value:i,index:o})},getLogicalPoint:function(e){return b.getLogicalPoint(this._canvas,e,this._outerZoom)},getTextSize:function(e,t){var n=w.getTextSize(e,t);return n.width&&(n.width+=4),n},getUniqueColor:function(e,n){if(e==null)return null;var r;if(!n){r=this._nonDataColors[e];if(r)return r}var i=w.getColorArray(e);if(!n)return i[3]!=255?r=e:r="rgba("+i[0]+","+i[1]+","+i[2]+",0.99)",this._nonDataColors[e]=r,r;var s="rgb("+i[0]+","+i[1]+","+i[2]+")";if(this._uniqueColors[s]!==t&&this._uniqueColors[s]!==n){var o=1,u=-1,a=1;h.isOpera&&(i=[i[0],i[1],i[2]]);for(;;){i[0]+=o,i[0]>=255?(i[0]=255,o=-1):i[0]<=0&&(i[0]=0,o=1),s="rgb("+i[0]+","+i[1]+","+i[2]+")";if(this._uniqueColors[s]===t||this._uniqueColors[s]===n)break;i[1]+=u,i[1]>=255?(i[1]=255,u=-1):i[1]<=0&&(i[1]=0,u=1),s="rgb("+i[0]+","+i[1]+","+i[2]+")";if(this._uniqueColors[s]===t||this._uniqueColors[s]===n)break;i[2]+=a,i[2]>=255?(i[2]=255,a=-1):i[2]<=0&&(i[2]=0,a=1),s="rgb("+i[0]+","+i[1]+","+i[2]+")";if(this._uniqueColors[s]===t||this._uniqueColors[s]===n)break}}return this._uniqueColors[s]=n,s},tryGetDataAt:function(e,t){if(t==null||t<0)t=this._selectTolerance;e.target&&(e=b.getLogicalPoint(this._canvas,arguments[0],this._outerZoom));if(!e)return null;var n=e.x-t,r=e.y-t,i=t*2+1,s=t*2+1;try{var o=this._canvas.getContext("2d").getImageData(n,r,i,s).data;for(var u=0,a=o.length;u<a;u+=4)if(o[u+3]===255){var f="rgb("+o[u]+","+o[u+1]+","+o[u+2]+")",l=this._uniqueColors[f];if(l)return l}}catch(c){}return null},_getPoint:function(){var e,t;if(arguments.length===2)e=arguments[0],t=arguments[1];else if(arguments[0].target){var n=b.getLogicalPoint(this._canvas,arguments[0],this._outerZoom);if(!n)return null;e=n.x,t=n.y}else e=arguments[0].x,t=arguments[0].y;return{x:e,y:t}},getDataAt:function(){var e=this._getPoint.apply(this,arguments),t=e.x,n=e.y;if(t<0||n<0||t>this._canvasWidth||n>this._canvasHeight)return null;try{var r=this._canvas.getContext("2d").getImageData(t,n,1,1).data;if(r[3]===255){var i="rgb("+r[0]+","+r[1]+","+r[2]+")",s=this._uniqueColors[i];if(s)return s}}catch(o){}return null},getBackgroundRect:function(){return this._backgroundRect},drawBackground:function(e,t){this._backgroundRect=r.clone(t),t!=null&&t.width>0&&t.height>0&&this._backgroundVisible&&(this._backgroundFill&&w.fill(e,this.getUniqueColor(this._backgroundFillColor),this._backgroundGradient,this.getUniqueColor(this._backgroundGradientColor),t),this._backgroundOutlineWidth>0&&(e.lineWidth=this._backgroundOutlineWidth,e.strokeStyle=this._backgroundOutlineColor),e.beginPath(),e.rect(t.x,t.y,t.width,t.height),e.closePath(),this._backgroundFill&&e.fill(),this._backgroundOutlineWidth>0&&e.stroke())},getName:function(e){return e.getName()},getColor:function(e){return e.getStyle?e.getStyle("chart.color"):e.getClient("chart.color")},getValue:function(e){return e.getStyle?e.getStyle("chart.value"):0},getValueColor:function(e){return e.getStyle?e.getStyle("chart.value.color"):n.Styles.getStyle("chart.value.color")},setValueFont:function(e){if(e===this._valueFont)return;var t=e;this._valueFont=e,this.firePropertyChange("valueFont",t,e)},getValueFont:function(e){if(e){var t=e.getStyle?e.getStyle("chart.value.font"):n.Styles.getStyle("chart.value.font");if(t)return t}return this._valueFont},formatValueText:function(e,t){return e},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this.canvasHeight},getCanvas:function(){return this._canvas},isVisible:function(e){return this._internalVisibleFunction&&!this._internalVisibleFunction(e)?!1:this._visibleFunction?this._visibleFunction(e):!0},onPropertyChanged:function(e){n.charts.IS_INVALIDATE_PROPERTY[e.property]?this.invalidate():this.invalidateModel()},getDataBox:function(){return this._box},setDataBox:function(e){if(!e)throw"DataBox can not be null";if(this._box===e)return;var t=this._box;t&&(t.removeDataBoxChangeListener(this.handleDataBoxChange,this),t.removeDataPropertyChangeListener(this.handlePropertyChange,this),t.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||t.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=e,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(e):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",t,this._box)},handleDataBoxChange:function(e){this.invalidateModel()},handlePropertyChange:function(e){this.invalidateModel()},handleHierarchyChange:function(e){this.invalidateModel()},handleSelectionChange:function(e){this.invalidateModel()},getUnfilteredDatas:function(){return this._unfilteredDatas?this._unfilteredDatas:this._publishedDatas},getPublishedDatas:function(){return this._publishedDatas},createPublishedDatas:function(){return this._unfilteredDatas=new Oi,this._buildChildren(this._box.getRoots(),this._unfilteredDatas),this._sortFunction&&this._unfilteredDatas.sort(this._sortFunction),this._unfilteredDatas.toList(this.isVisible,this)},_buildChildren:function(e,t){e.forEach(function(e){t.add(e),this._buildChildren(e.getChildren(),t)},this)},invalidateModel:function(){if(this._invalidateModel)return;this._invalidateModel=!0,this.invalidate()},validateImpl:function(){this._invalidateModel&&(this._invalidateModel=!1,this._uniqueColors={},this._nonDataColors={},this._publishedDatas=this.createPublishedDatas(),this._publishedDatas.forEach(function(e){e.IStyle?e.getStyle("chart.color")||e.setStyle("chart.color",r.nextColor()):e.getClient("chart.color")||e.setClient("chart.color",r.nextColor())}),this.validateModel());var e=this._canvas.getContext("2d");this._canvasWidth=this._view.clientWidth,this._canvasHeight=this._view.clientHeight,this._canvas.setAttribute("width",this._canvasWidth),this._canvas.setAttribute("height",this._canvasHeight),e.clearRect(0,0,this._canvasWidth,this._canvasHeight),n.Util.makeHighRes(this._canvas),this._canvasWidth>0&&this._canvasHeight>0&&(e.translate(this._xTranslate,this._yTranslate),this._valueTexts=this._valueVisible?new Oi:null,this.validateDisplay(e,this._canvasWidth*this._xZoom,this._canvasHeight*this._yZoom),delete this._valueTexts,e.translate(-this._xTranslate,-this._yTranslate))},adjustBounds:function(e){n.charts.ChartBase.superClass.adjustBounds.apply(this,arguments)},validateModel:function(){},validateDisplay:function(e,t,n){},drawLine:function(e,t,n,r,i,s,o){n>0&&(e.lineWidth=n,e.strokeStyle=this.getUniqueColor(t),e.beginPath(),e.moveTo(r,i),e.lineTo(s,o),e.stroke())},drawValueTexts:function(e){this._valueTexts&&this._valueTexts.forEach(function(t){w.drawText(e,t.text,t,t.font,t.color)})},drawVerticalText:function(e,t,n,r,i){i=this.getUniqueColor(i),e.translate(n.x,n.y),e.rotate(-Math.PI/2),w.drawText(e,t,null,r,i),e.rotate(Math.PI/2),e.translate(-n.x,-n.y)},_getValueTextInfo:function(e,t){if(this._valueTexts){var n=this.formatValueText(t,e);if(n&&n!==""){var r=this.getValueColor(e),i={text:n,font:this.getValueFont(e),color:this.getUniqueColor(r,e)};return this._valueTexts.add(i),i}}return null},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(e){if(e<0)return;var t=this._maxZoom;this._maxZoom=e,this.firePropertyChange("maxZoom",t,e),this.getXZoom()>e&&this.setXZoom(e,!1),this.getYZoom()>e&&this.setYZoom(e,!1)},getMinZoom:function(){return this._minZoom},setMinZoom:function(e){if(e<0)return;var t=this._minZoom;this._minZoom=e,this.firePropertyChange("minZoom",t,e),this.getXZoom()<e&&this.setXZoom(e),this.getYZoom()<e&&this.setYZoom(e)},zoomIn:function(e){e==null&&(e=$i.ZOOM_ANIMATE),e?n.animate.AnimateManager.start(new n.animate.AnimateXYZoom(this,this._xZoom*$i.ZOOM_INCREMENT,this._yZoom*$i.ZOOM_INCREMENT)):(this.xZoomIn(!1),this.yZoomIn(!1))},zoomOut:function(e){e==null&&(e=$i.ZOOM_ANIMATE),e?n.animate.AnimateManager.start(new n.animate.AnimateXYZoom(this,this._xZoom/$i.ZOOM_INCREMENT,this._yZoom/$i.ZOOM_INCREMENT)):(this.xZoomOut(!1),this.yZoomOut(!1))},zoomReset:function(e){e==null&&(e=$i.ZOOM_ANIMATE),e?n.animate.AnimateManager.start(new n.animate.AnimateXYZoom(this,1,1)):(this.xZoomReset(!1),this.yZoomReset(!1))},getXZoom:function(){return this._xZoom},onXZoomChanged:function(e,t){},xZoomIn:function(e){this.setXZoom(this._xZoom*$i.ZOOM_INCREMENT,e)},xZoomOut:function(e){this.setXZoom(this._xZoom/$i.ZOOM_INCREMENT,e)},xZoomReset:function(e){this.setXZoom(1,e)},setXZoom:function(e,t){if(!r.num(e)||e<=0)return;e<this._minZoom&&(e=this._minZoom),e>this._maxZoom&&(e=this._maxZoom);if(e===this.xZoom)return;t==null&&(t=$i.ZOOM_ANIMATE);if(t)n.animate.AnimateManager.start(new n.animate.AnimateXZoom(this,e));else{var i=this._xZoom,s=this._xTranslate-(this._canvasWidth/2-this._xTranslate)/i*(e-i);this._xZoom=e,this.firePropertyChange("xZoom",i,e),this.onXZoomChanged(i,e),this.setXTranslate(s)}},getYZoom:function(){return this._yZoom},onYZoomChanged:function(e,t){},yZoomIn:function(e){this.setYZoom(this._yZoom*$i.ZOOM_INCREMENT,e)},yZoomOut:function(e){this.setYZoom(this._yZoom/$i.ZOOM_INCREMENT,e)},yZoomReset:function(e){this.setYZoom(1,e)},setYZoom:function(e,t){if(!r.num(e)||e<=0)return;e<this._minZoom&&(e=this._minZoom),e>this._maxZoom&&(e=this._maxZoom);if(e===this.YZoom)return;t==null&&(t=$i.ZOOM_ANIMATE);if(t)n.animate.AnimateManager.start(new n.animate.AnimateYZoom(this,e));else{var i=this._yZoom,s=this._yTranslate-(this._canvasHeight/2-this._yTranslate)/i*(e-i);this._yZoom=e,this.firePropertyChange("yZoom",i,e),this.onYZoomChanged(i,e),this.setYTranslate(s)}}}),n.charts.ScaleChart=function(e){n.charts.ScaleChart.superClass.constructor.apply(this,arguments)},r.ext("twaver.charts.ScaleChart",n.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","xAxisText","xAxisLineColor","xAxisLineWidth","xAxisTextColor","xAxisTextFont","yAxisText","yAxisLineColor","yAxisLineWidth","yAxisTextColor","yAxisTextFont","xScaleTexts","xScaleTextFont","xScaleTextColor","xScaleTextOrientation","yScaleTextVisible","yScaleTextColor","yScaleTextFont","yScaleLineColor","yScaleLineWidth","yScaleValueGap","yScalePixelGap","yScaleMinTextVisible","valueSpanCount"],_reset:function(){this._map={},this._max=0,this._min=0,this._columnCount=this._xScaleTexts?this._xScaleTexts.size():0,this._upperLimit!=null&&(this._max=this._upperLimit),this._lowerLimit!=null&&(this._min=this._lowerLimit)},getMin:function(){return this._min},getMax:function(){return this._max},getRange:function(){return this._range},getColumnCount:function(){return this._columnCount},getColumnWidth:function(){return this._columnWidth},getValues:function(e){return e.getStyle?e.getStyle("chart.values"):null},formatYScaleText:function(e){return e.toFixed(2)},_initRange:function(){this._lowerLimit==null&&(this._min>=this._max&&(this._min=this._max-Math.abs(this._max)*.1),this._min=this._min-(this._max-this._min)*.1),this._range=this._max-this._min},_initValuesProportion:function(){this._publishedDatas.forEach(function(e){var t=this._map[e.getId()];t.values.forEach(function(e){e==null?t.proportions.add(null):t.proportions.add(this._range==0?0:e/this._range)},this)},this)},_commonValidateModel:function(){this._publishedDatas.forEach(function(e){var t=new Oi(this.getValues(e));t.size()>this._columnCount&&(this._columnCount=t.size());var n={data:e,values:t,proportions:new Oi,color:this.getUniqueColor(this.getColor(e),e)};this._initInfo&&this._initInfo(e,n),this._map[e.getId()]=n,(this._upperLimit==null||this._lowerLimit==null)&&t.forEach(function(e){e!=null&&(this._upperLimit==null&&e>this._max&&(this._max=e),this._lowerLimit==null&&e<this._min&&(this._min=e))},this)},this),this._initRange(),this._initValuesProportion()},validateDisplay:function(e,t,n){var r=0;this._xAxisText&&(r=this.getTextSize(this._xAxisTextFont,this._xAxisText).height);var i=0;this._xScaleTexts&&this._xScaleTexts.forEach(function(e){var t=this.getTextSize(this._xScaleTextFont,e),n=this._xScaleTextOrientation==="vertical"?t.width:t.height;n>i&&(i=n)},this);var s=n-this._yGap-r-i,o=s-this._yGap,u=this._upperLimit==null?o*.9:o,a=0;this._yAxisText&&(a=this.getTextSize(this._yAxisTextFont,this._yAxisText).height);var f,l;this._yScaleValueGap>0?(f=Math.max(this._yScaleValueGap/this._range*u,1),l=this._yScaleValueGap):(f=Math.max(this._yScalePixelGap,1),l=this._range*(f/u));var c=0,h=new Oi,p,d;if(this._yScaleTextVisible){p=this._yScaleMinTextVisible?0:f;var v=this._min+(this._yScaleMinTextVisible?0:l);while(p<=o+1){d=this.formatYScaleText(v);if(d){var m=this.getTextSize(this._yScaleTextFont,d);m.width>c&&(c=m.width),h.add({text:d,size:m,cursor:p})}p+=f,v+=l}}var g={x:this._xGap+a+c,y:this._yGap,width:t-this._xGap-a-c-this._xGap,height:n-this._yGap-i-r-this._yGap};this.drawBackground(e,g),this._columnCount>0?this._columnWidth=g.width/(this._columnCount*3+1)*2:this._columnWidth=g.width/2,this._columnWidth===0&&(this._columnWidth=1);if(this._yScaleLineWidth>0){p=0;while(p<=o+1)this.drawLine(e,this._yScaleLineColor,this._yScaleLineWidth,g.x,s-p,g.x+g.width,s-p),p+=f}this._xAxisText&&w.drawText(e,this._xAxisText,{x:g.x+g.width/2,y:s+i+r/2},this._xAxisTextFont,this.getUniqueColor(this._xAxisTextColor)),this._yAxisText&&this.drawVerticalText(e,this._yAxisText,{x:this._xGap+a/2,y:o/2+this._yGap},this._yAxisTextFont,this.getUniqueColor(this._yAxisTextColor)),this.drawLine(e,this._yAxisLineColor,this._yAxisLineWidth,g.x,g.y+g.height,g.x,g.y);var y=this.getUniqueColor(this._yScaleTextColor);h.forEach(function(t){var n={x:this._xGap+a+c-t.size.width/2,y:s-t.cursor};w.drawText(e,t.text,n,this._yScaleTextFont,y)},this);var b=g.y+g.height+i/2;y=this.getUniqueColor(this._xScaleTextColor);var E=this._xScaleLineWidth>0?this.getUniqueColor(this._xScaleLineColor):null;for(var S=0;S<this._columnCount;S++){var x=g.x+this._columnWidth*(1+S*1.5);if(this._xScaleTexts&&S<this._xScaleTexts.size()){d=this._xScaleTexts.get(S);if(d){var T={x:x,y:b};this._xScaleTextOrientation==="vertical"?this.drawVerticalText(e,d,T,this._yScaleTextFont,y):this._valueSpanCount?S%this._valueSpanCount==0&&w.drawText(e,d,T,this._xScaleTextFont,y):w.drawText(e,d,T,this._xScaleTextFont,y)}}this._type!=="default"&&E&&(this._valueSpanCount?S%this._valueSpanCount==0&&this.drawLine(e,E,this._xScaleLineWidth,x,g.y+g.height,x,g.y):this.drawLine(e,E,this._xScaleLineWidth,x,g.y+g.height,x,g.y))}var N=s+this._min/l*f;this._publishedDatas.size()>0&&this._columnCount>0&&this.drawContent(e,g,u,N),this.drawLine(e,this._xAxisLineColor,this._xAxisLineWidth,g.x,g.y+g.height,g.x+g.width,g.y+g.height)}}),n.charts.PieChart=function(e){this._sum=0,this._map={},n.charts.PieChart.superClass.constructor.apply(this,arguments)},r.ext("twaver.charts.PieChart",n.charts.ChartBase,{__accessor:["type","selectOffset","startAngle","shadowColor","shadowOffset","lineRate","donutRate","valuePosition"],_type:$i.PIECHART_TYPE,_lineRate:$i.PIECHART_LINE_RATE,_donutRate:$i.PIECHART_DONUT_RATE,_startAngle:$i.PIECHART_START_ANGLE,_shadowColor:$i.PIECHART_SHADOW_COLOR,_shadowOffset:$i.PIECHART_SHADOW_OFFSET,_selectOffset:$i.PIECHART_SELECT_OFFSET,_valuePosition:$i.PIECHART_VALUE_POSITION,getSum:function(){return this._sum},validateModel:function(){this._sum=0,this._map={},this._publishedDatas.forEach(function(e){var t=this.getValue(e);this._map[e.getId()]={data:e,value:t,color:this.getUniqueColor(this.getColor(e),e)},this._sum+=t},this);var e=this._startAngle;this._publishedDatas.forEach(function(t){var n=this._map[t.getId()];n.proportion=this._sum===0?0:n.value/this._sum,this._type!=="line"&&(n.startAngle=e,n.arc=n.proportion*Math.PI*2,e+=n.arc)},this)},validateDisplay:function(e,t,n){var r={x:this._xGap,y:this._yGap,width:t-this._xGap*2,height:n-this._yGap*2};this.drawBackground(e,r),m.grow(r,-4,-4);if(r.width<=0||r.height<=0)return;var i=this._shadowOffset;i>0&&(e.shadowOffsetX=i,e.shadowOffsetY=i,e.shadowBlur=i*1.5,e.shadowColor=this._shadowColor);if(this._type==="oval"||this._type==="circle"){var s=r.x+r.width/2,o=r.y+r.height/2,u=r.width/2,a=r.height/2;this._type==="circle"&&(u=a=Math.min(u,a)),this._publishedDatas.forEach(function(t){var n=this._map[t.getId()];if(n.arc===0)return;var r=0,i=0;if(this.isSelected(t)){var f=n.startAngle+n.arc/2;r=Math.cos(f)*this._selectOffset,i=Math.sin(f)*this._selectOffset*a/u}e.fillStyle=n.color,e.beginPath(),e.moveTo(s+r,o-i),w.drawArc(e,s+r,o-i,n.startAngle,n.arc,u,a,!0),e.closePath(),e.fill();var l=this._getValueTextInfo(t,n.value);if(l){var f=n.startAngle+n.arc/2;l.x=s+r+Math.cos(f)*u*this._valuePosition,l.y=o-i-Math.sin(f)*a*this._valuePosition}},this)}else if(this._type==="donut"||this._type==="ovalDonut"){var s=r.x+r.width/2,o=r.y+r.height/2,u=r.width/2,a=r.height/2;this._type==="donut"&&(u=a=Math.min(u,a)),this._publishedDatas.forEach(function(t){var n=this._map[t.getId()];if(n.arc===0)return;var r=0,i=0;if(this.isSelected(t)){var f=n.startAngle+n.arc/2;r=Math.cos(f)*this._selectOffset,i=Math.sin(f)*this._selectOffset*a/u}var l=s+Math.cos(n.startAngle)*u*this._donutRate,c=o-Math.sin(n.startAngle)*a*this._donutRate,h=s+Math.cos(n.startAngle+n.arc)*u*this._donutRate,p=o-Math.sin(n.startAngle+n.arc)*a*this._donutRate;e.fillStyle=n.color,e.beginPath(),e.moveTo(l+r,c-i),w.drawArc(e,s+r,o-i,n.startAngle,n.arc,u,a,!0),e.lineTo(h+r,p-i),w.drawArc(e,s+r,o-i,n.startAngle+n.arc,-n.arc,u*this._donutRate,a*this._donutRate,!0),e.closePath(),e.fill();var d=this._getValueTextInfo(t,n.value);if(d){var f=n.startAngle+n.arc/2,v=this._donutRate+(1-this._donutRate)*this._valuePosition;d.x=s+r+Math.cos(f)*u*v,d.y=o-i-Math.sin(f)*a*v}},this)}else if(this._type==="line"){var f=r.height*this._lineRate;r.y=r.y+r.height/2-f/2,r.height=f;var l=r.x;this._publishedDatas.forEach(function(t){var n=this._map[t.getId()],i=r.width*n.proportion;if(i===0)return;e.beginPath(),e.fillStyle=n.color;var s=this.isSelected(t)?-this._selectOffset:0;e.rect(l,r.y+s,i,r.height),e.closePath(),e.fill();var o=this._getValueTextInfo(t,n.value);o&&(o.x=l+i/2,o.y=r.y+r.height+s-r.height*this._valuePosition),l+=i},this)}this._shadowOffset>0&&(e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0),this.drawValueTexts(e)}}),n.charts.BarChart=function(e){n.charts.BarChart.superClass.constructor.apply(this,arguments)},r.ext("twaver.charts.BarChart",n.charts.ScaleChart,{__accessor:["type"],_upperLimit:$i.BARCHART_UPPER_LIMIT,_lowerLimit:$i.BARCHART_LOWER_LIMIT,_type:$i.BARCHART_TYPE,_xAxisText:null,_xAxisTextColor:$i.BARCHART_XAXIS_TEXT_COLOR,_xAxisTextFont:$i.BARCHART_XAXIS_TEXT_FONT,_xAxisLineColor:$i.BARCHART_XAXIS_LINE_COLOR,_xAxisLineWidth:$i.BARCHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:$i.BARCHART_YAXIS_TEXT_COLOR,_yAxisTextFont:$i.BARCHART_YAXIS_TEXT_FONT,_yAxisLineColor:$i.BARCHART_YAXIS_LINE_COLOR,_yAxisLineWidth:$i.BARCHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:$i.BARCHART_XSCALE_TEXT_FONT,_xScaleTextColor:$i.BARCHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:$i.BARCHART_XSCALE_TEXT_ORIENTATION,_yScaleTextVisible:$i.BARCHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:$i.BARCHART_YSCALE_TEXT_COLOR,_yScaleTextFont:$i.BARCHART_YSCALE_TEXT_FONT,_yScaleLineColor:$i.BARCHART_YSCALE_LINE_COLOR,_yScaleLineWidth:$i.BARCHART_YSCALE_LINE_WIDTH,_yScaleValueGap:$i.BARCHART_YSCALE_VALUE_GAP,_yScalePixelGap:$i.BARCHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:$i.BARCHART_YSCALE_MIN_TEXT_VISIBLE,validateModel:function(){var e=this._type+"ValidateModel";this[e]&&(this._reset(),this[e]())},defaultValidateModel:function(){this._columnCount=this._publishedDatas.size(),this._publishedDatas.forEach(function(e){var t=this.getValue(e);this._upperLimit==null&&t>this._max&&(this._max=t),this._lowerLimit==null&&t<this._min&&(this._min=t),this._map[e.getId()]={data:e,value:t,color:this.getUniqueColor(this.getColor(e),e)}},this),this._initRange(),this._publishedDatas.forEach(function(e){var t=this._map[e.getId()];t.proportion=this._range==0?0:t.value/this._range},this)},layerValidateModel:function(){this._commonValidateModel()},groupValidateModel:function(){this._commonValidateModel()},stackValidateModel:function(){this._publishedDatas.forEach(function(e){var t=new Oi(this.getValues(e));t.size()>this._columnCount&&(this._columnCount=t.size());var n={data:e,values:t,proportions:new Oi,color:this.getUniqueColor(this.getColor(e),e)};this._map[e.getId()]=n},this);if(this._upperLimit==null||this._lowerLimit==null)for(var e=0;e<this._columnCount;e++){var t=0,n=0;this._publishedDatas.forEach(function(r){var s=this._map[r.getId()];if(s.values.size()>e){var o=s.values.get(e);o!=null&&(o>=0?t+=o:n+=o)}},this),this._upperLimit==null&&t>this._max&&(this._max=t),this._lowerLimit==null&&n<this._min&&(this._min=n)}this._initRange(),this._initValuesProportion()},percentValidateModel:function(){this._publishedDatas.forEach(function(e){var t=new Oi(this.getValues(e));t.size()>this._columnCount&&(this._columnCount=t.size());var n={data:e,values
:t,proportions:new Oi,color:this.getUniqueColor(this.getColor(e),e)};this._map[e.getId()]=n},this);var e=new Oi;for(var t=0;t<this._columnCount;t++){var n=0;this._publishedDatas.forEach(function(e){var r=this._map[e.getId()];if(r.values.size()>t){var s=r.values.get(t);s!=null&&(n+=s)}},this),e.add(n)}for(var t=0;t<this._columnCount;t++)this._publishedDatas.forEach(function(n){var r=this._map[n.getId()],s=e.get(t);if(s!==0&&r.values.size()>t){var o=r.values.get(t);if(o!=null){r.proportions.add(o/s);return}}r.proportions.add(null)},this);this._min=0,this._max=1,this._range=1},drawRect:function(e,t,n,r,i,s,o){e.fillStyle=t,n&&this._selectInfos.add({x:r,y:i,w:s,h:o,color:this.getUniqueColor(w.darker(t))}),e.beginPath(),e.rect(r,i,s,o),e.closePath(),e.fill()},drawContent:function(e,t,n,r){this._selectInfos=new Oi,this._toolTipInfos=this.isToolTipEnabled()?new Oi:null,this._type==="default"?this.drawDefaultContent(e,t,n,r):this._type==="group"?this.drawGroupContent(e,t,n,r):this._type==="percent"?this.drawPercentContent(e,t,n,r):this._type==="stack"?this.drawStackContent(e,t,n,r):this._type==="layer"&&this.drawLayerContent(e,t,n,r),this.drawValueTexts(e),this._selectInfos.forEach(function(t){e.lineWidth=2,e.strokeStyle=t.color,e.beginPath(),e.rect(t.x,t.y,t.w,t.h),e.closePath(),e.stroke()},this),delete this._selectInfos},drawDefaultContent:function(e,t,n,r){var i=this._publishedDatas.size(),s=this._columnWidth;for(var o=0;o<i;o++){var u=this._publishedDatas.get(o),a=this._map[u.getId()],f=t.x+s*(.5+o*1.5),l=Math.abs(n*a.proportion),c=a.proportion>0?r-l:r;this.drawRect(e,a.color,this.isSelected(u),f,c,s,l),this.addToolTipInfo(f,c,s,l,a.value,u);var h=this._getValueTextInfo(u,a.value);if(h){var p=this.getTextSize(h.font,h.text);h.x=f+s/2,h.y=c-p.height/2+1}}},drawPercentContent:function(e,t,n,r){this.drawStackContent(e,t,n,r)},drawStackContent:function(e,t,n,r){var i=this._columnCount,s=this._columnWidth;for(var o=0;o<i;o++){var u=r,a=t.x+s*(.5+o*1.5);this._publishedDatas.forEach(function(t){var r=this._map[t.getId()];if(o<r.proportions.size()){var i=r.proportions.get(o);if(i!=null){var f=n*i;u-=f,this.drawRect(e,r.color,this.isSelected(t),a,u,s,f),this.addToolTipInfo(a,u,s,f,r.values.get(o),t);var l=this._getValueTextInfo(t,r.values.get(o));l&&(l.x=a+s/2,l.y=u+f/2)}}},this)}},drawLayerContent:function(e,t,n,r){var i=this._publishedDatas.size(),s=this._columnCount,o=this._columnWidth,u=o*3/8/i;for(var a=0;a<s;a++){var f=t.x+o*(.5+a*1.5),l=0;this._publishedDatas.forEach(function(t){var s=this._map[t.getId()];if(a<s.proportions.size()){var c=s.proportions.get(a);if(c!=null){var h=n*c,p=r-h,d=f+o/2-o/8-u*(i-l),v=(o/8+u*(i-l))*2;this.drawRect(e,s.color,this.isSelected(t),d,p,v,h),this.addToolTipInfo(d,p,v,h,s.values.get(a),t);var m=this._getValueTextInfo(t,s.values.get(a));if(m){var g=this.getTextSize(m.font,m.text);m.x=d+v/2,m.y=p-g.height/2+1}}}l++},this)}},drawGroupContent:function(e,t,n,r){var i=this._publishedDatas.size(),s=this._columnCount,o=this._columnWidth,u=o/i;for(var a=0;a<s;a++){var f=t.x+o*(.5+a*1.5),l=0;this._publishedDatas.forEach(function(t){var i=this._map[t.getId()];if(a<i.proportions.size()){var s=i.proportions.get(a);if(s!=null){var o=n*s,c=r-o;this.drawRect(e,i.color,this.isSelected(t),f+u*l,c,u,o),this.addToolTipInfo(f+u*l,c,u,o,i.values.get(a),t);var h=this._getValueTextInfo(t,i.values.get(a));if(h){var p=this.getTextSize(h.font,h.text);h.x=f+u*l+u/2,h.y=c-p.height/2+1}}}l++},this)}}}),n.charts.LineChart=function(e){n.charts.LineChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},r.ext("twaver.charts.LineChart",n.charts.ScaleChart,{__accessor:["xScaleLineColor","xScaleLineWidth","interruptable"],_interruptable:$i.LINECHART_INTERRUPTABLE,_upperLimit:$i.LINECHART_UPPER_LIMIT,_lowerLimit:$i.LINECHART_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:$i.LINECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:$i.LINECHART_XAXIS_TEXT_FONT,_xAxisLineColor:$i.LINECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:$i.LINECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:$i.LINECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:$i.LINECHART_YAXIS_TEXT_FONT,_yAxisLineColor:$i.LINECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:$i.LINECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:$i.LINECHART_XSCALE_TEXT_FONT,_xScaleTextColor:$i.LINECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:$i.LINECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:$i.LINECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:$i.LINECHART_XSCALE_LINE_WIDTH,_valueSpanCount:$i.LINECHART_VALUESPANCOUNT,_yScaleTextVisible:$i.LINECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:$i.LINECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:$i.LINECHART_YSCALE_TEXT_FONT,_yScaleLineColor:$i.LINECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:$i.LINECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:$i.LINECHART_YSCALE_VALUE_GAP,_yScalePixelGap:$i.LINECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:$i.LINECHART_YSCALE_MIN_TEXT_VISIBLE,getLineWidth:function(e){return e.getStyle?e.getStyle("chart.line.width"):n.Styles.getStyle("chart.line.width")},getMarkerShape:function(e){return e.getStyle?e.getStyle("chart.marker.shape"):n.Styles.getStyle("chart.marker.shape")},getMarkerSize:function(e){return e.getStyle?e.getStyle("chart.marker.size"):n.Styles.getStyle("chart.marker.size")},_initInfo:function(e,t){t.markerShape=this.getMarkerShape(e),t.markerSize=this.getMarkerSize(e),t.lineWidth=this.getLineWidth(e),this.isSelected(e)&&(t.lineWidth+=2)},validateModel:function(){this._reset(),this._commonValidateModel()},getPointIndexAt:function(){var e=this._getPoint.apply(this,arguments),t=this.tryGetDataAt(e);if(!t)return-1;var n=this._map[t.getId()],r=n.points,i=n.markerSize;for(var s=0,o=r.size(),u;s<o;s++){u=r.get(s);if(u&&m.getDistance(e,u)<=i)return s}return-1},drawContent:function(e,t,n,r){this._toolTipInfos=this.isToolTipEnabled()?new Oi:null,this._publishedDatas.forEach(function(i){var s=this._map[i.getId()],o=s.markerSize>0?new Oi:null;e.strokeStyle=s.color,e.lineWidth=s.lineWidth,e.beginPath();var u=s.proportions,a=null,f=u.size(),l=new Oi;s.points=l;for(var c=0;c<f;c++){var h=u.get(c);if(h!=null){var p={x:t.x+this._columnWidth*(1+c*1.5),y:r-n*h};l.add(p),a==null?e.moveTo(p.x,p.y):e.lineTo(p.x,p.y);var d=s.values.get(c),v=this._getValueTextInfo(i,d);if(v){var m=this.getTextSize(v.font,v.text);v.x=p.x,v.y=p.y-m.height/2+2}o&&o.add({point:p,value:d,data:i,index:c}),a=p}else this._interruptable&&(a=null,l.add(null))}e.stroke();if(o){var g=s.markerSize/2;o.forEach(function(t){e.fillStyle=s.color;var n=t.point.x-g,r=t.point.y-g,i=s.markerSize,o=s.markerSize;w.drawVector(e,s.markerShape,null,n,r,i,o),e.fill(),this.addToolTipInfo(n,r,i,o,t.value,t.data,t.index)},this)}},this),this.drawValueTexts(e)}}),n.charts.BubbleChart=function(e){n.charts.BubbleChart.superClass.constructor.apply(this,arguments)},r.ext("twaver.charts.BubbleChart",n.charts.ScaleChart,{__accessor:["xAxisUpperLimit","xAxisLowerLimit","xScaleLineColor","xScaleLineWidth","selectShadowColor","selectShadowOffset"],_upperLimit:$i.BUBBLECHART_UPPER_LIMIT,_lowerLimit:$i.BUBBLECHART_LOWER_LIMIT,_xAxisUpperLimit:$i.BUBBLECHART_XAXIS_UPPER_LIMIT,_xAxisLowerLimit:$i.BUBBLECHART_XAXIS_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:$i.BUBBLECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:$i.BUBBLECHART_XAXIS_TEXT_FONT,_xAxisLineColor:$i.BUBBLECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:$i.BUBBLECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:$i.BUBBLECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:$i.BUBBLECHART_YAXIS_TEXT_FONT,_yAxisLineColor:$i.BUBBLECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:$i.BUBBLECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:$i.BUBBLECHART_XSCALE_TEXT_FONT,_xScaleTextColor:$i.BUBBLECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:$i.BUBBLECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:$i.BUBBLECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:$i.BUBBLECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:$i.BUBBLECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:$i.BUBBLECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:$i.BUBBLECHART_YSCALE_TEXT_FONT,_yScaleLineColor:$i.BUBBLECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:$i.BUBBLECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:$i.BUBBLECHART_YSCALE_VALUE_GAP,_yScalePixelGap:$i.BUBBLECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:$i.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE,_selectShadowColor:$i.BUBBLECHART_SELECT_SHADOW_COLOR,_selectShadowOffset:$i.BUBBLECHART_SELECT_SHADOW_OFFSET,_resetX:function(){this._xMax=0,this._xMin=0,this._xAxisUpperLimit!=null&&(this._xMax=this._xAxisUpperLimit),this._xAxisLowerLimit!=null&&(this._xMin=this._xAxisLowerLimit)},getXMin:function(){return this._xMin},getXMax:function(){return this._xMax},getXRange:function(){return this._xRange},getShape:function(e){return e.getStyle?e.getStyle("chart.bubble.shape"):n.Styles.getStyle("chart.bubble.shape")},getSize:function(e,t){return t},getNames:function(e){return e.getStyle?e.getStyle("chart.names"):n.Styles.getStyle("chart.names")},getXAxisValues:function(e){return e.getStyle?e.getStyle("chart.xaxis.values"):n.Styles.getStyle("chart.xaxis.values")},getYAxisValues:function(e){return e.getStyle?e.getStyle("chart.yaxis.values"):n.Styles.getStyle("chart.yaxis.values")},_initXRange:function(){this._xAxisLowerLimit==null&&(this._xMin>=this._xMax&&(this._xMin=this._xMax-Math.abs(this._xMax)*.1),this._xMin=this._xMin-(this._xMax-this._xMin)*.1),this._xRange=this._xMax-this._xMin},_initXYValuesProportion:function(){this._publishedDatas.forEach(function(e){var t=this._map[e.getId()];t.xAxisValues.forEach(function(e){e==null?t.xAxisProportions.add(null):t.xAxisProportions.add(this._xRange==0?0:e/this._xRange)},this),t.yAxisValues.forEach(function(e){e==null?t.yAxisProportions.add(null):t.yAxisProportions.add(this._range==0?0:e/this._range)},this)},this)},validateModel:function(){this._reset(),this._resetX(),this._columnCount=this._xScaleTexts==null?0:this._xScaleTexts.size(),this._publishedDatas.forEach(function(e){var t=new Oi(this.getYAxisValues(e)),n=new Oi(this.getXAxisValues(e)),r=new Oi(this.getValues(e));r.size()>this._columnCount&&(this._columnCount=r.size());var i={data:e,values:r,yAxisValues:t,xAxisValues:n,yAxisProportions:new Oi,xAxisProportions:new Oi,color:this.getUniqueColor(this.getColor(e),e),anchorShape:this.getShape(e)};this._map[e.getId()]=i,(this._upperLimit==null||this._lowerLimit==null)&&t.forEach(function(e){e!=null&&(this._upperLimit==null&&e>this._max&&(this._max=e),this._lowerLimit==null&&e<this._min&&(this._min=e))},this),(this._upperLimit==null||this._lowerLimit==null)&&n.forEach(function(e){e!=null&&(this._xAxisUpperLimit==null&&e>this._xMax&&(this._xMax=e),this._xAxisLowerLimit==null&&e<this._xMin&&(this._xMin=e))},this)},this),this._initRange(),this._initXRange(),this._initXYValuesProportion()},drawContent:function(e,t,n,r){this._toolTipInfos=this.isToolTipEnabled()?new Oi:null,this._publishedDatas.forEach(function(i){var s=this._map[i.getId()],o=s.yAxisProportions,u=s.xAxisProportions,a=s.values,f=s.yAxisProportions.size(),l=this._selectShadowOffset;this.isSelected(i)&&l>0?(e.shadowOffsetX=l,e.shadowOffsetY=l,e.shadowBlur=l*2,e.shadowColor=this._selectShadowColor):(e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowColor=s.color),e.fillStyle=s.color;for(var c=0;c<f;c++){var h=o.get(c),p=u.get(c);if(h!=null){var d={x:t.x+t.width*p,y:r-n*h},v=a.get(c),m=this.getSize(i,v),l=m/2,g=d.x-l,y=d.y-l,b=m,E=m;w.drawVector(e,s.anchorShape,null,g,y,b,E),e.fill(),this.addToolTipInfo(g,y,b,E,v,i,c);var S=this._getValueTextInfo(i,v);if(S){var m=this.getTextSize(S.font,S.text);S.x=d.x,S.y=d.y}}}},this),this.drawValueTexts(e)}}),n.charts.DialChart=function(e){n.charts.DialChart.superClass.constructor.apply(this,arguments)},r.ext("twaver.charts.DialChart",n.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","startAngle","endAngle","innerRadius","colorRangeFillColor","outlineWidth","outlineColor","majorScaleCount","majorScaleLineWidth","majorScaleLineLength","majorScaleLineColor","minorScaleCount","minorScaleLineWidth","minorScaleLineLength","minorScaleLineColor","scaleTextVisible","scaleUpperLimitTextVisible","scaleLowerLimitTextVisible","scaleTextFont","scaleTextColor","pivotRadius","pivotFillColor","pivotOutlineWidth","pivotOutlineColor","pivotGradient","pivotGradientColor","valuePosition","colorRangeList","innerDarkerRadius","outerBrighterRadius","selectShadowColor","selectShadowOffset"],__bool:["scaleInside","pivotFill"],_upperLimit:$i.DIALCHART_UPPER_LIMIT,_lowerLimit:$i.DIALCHART_LOWER_LIMIT,_startAngle:$i.DIALCHART_START_ANGLE,_endAngle:$i.DIALCHART_END_ANGLE,_innerRadius:$i.DIALCHART_INNER_RADIUS,_colorRangeFillColor:$i.DIALCHART_COLOR_RANGE_FILL_COLOR,_outlineWidth:$i.DIALCHART_OUTLINE_WIDTH,_outlineColor:$i.DIALCHART_OUTLINE_COLOR,_scaleInside:$i.DIALCHART_SCALE_INSIDE,_majorScaleCount:$i.DIALCHART_MAJOR_SCALE_COUNT,_majorScaleLineWidth:$i.DIALCHART_MAJOR_SCALE_LINE_WIDTH,_majorScaleLineLength:$i.DIALCHART_MAJOR_SCALE_LINE_LENGTH,_majorScaleLineColor:$i.DIALCHART_MAJOR_SCALE_LINE_COLOR,_minorScaleCount:$i.DIALCHART_MINOR_SCALE_COUNT,_minorScaleLineWidth:$i.DIALCHART_MINOR_SCALE_LINE_WIDTH,_minorScaleLineLength:$i.DIALCHART_MINOR_SCALE_LINE_LENGTH,_minorScaleLineColor:$i.DIALCHART_MINOR_SCALE_LINE_COLOR,_scaleTextVisible:$i.DIALCHART_SCALE_TEXT_VISIBLE,_scaleUpperLimitTextVisible:$i.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE,_scaleLowerLimitTextVisible:$i.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE,_scaleTextFont:$i.DIALCHART_SCALE_TEXT_FONT,_scaleTextColor:$i.DIALCHART_SCALE_TEXT_COLOR,_pivotRadius:$i.DIALCHART_PIVOT_RADIUS,_pivotFill:$i.DIALCHART_PIVOT_FILL,_pivotFillColor:$i.DIALCHART_PIVOT_FILL_COLOR,_pivotOutlineWidth:$i.DIALCHART_PIVOT_OUTLINE_WIDTH,_pivotOutlineColor:$i.DIALCHART_PIVOT_OUTLINE_COLOR,_pivotGradient:$i.DIALCHART_PIVOT_GRADIENT,_pivotGradientColor:$i.DIALCHART_PIVOT_GRADIENT_COLOR,_valuePosition:$i.DIALCHART_VALUE_POSITION,_innerDarkerRadius:$i.DIALCHART_INNER_DARKER_RADIUS,_outerBrighterRadius:$i.DIALCHART_OUTER_BRIGHTER_RADIUS,_selectShadowColor:$i.DIALCHART_SELECT_SHADOW_COLOR,_selectShadowOffset:$i.DIALCHART_SELECT_SHADOW_OFFSET,formatScaleText:function(e){return e.toFixed(2)},validateModel:function(){this._map={},this._valueRange=this._upperLimit-this._lowerLimit;var e=this._startAngle;e!=0&&(e=(e%360+360)%360,e==0&&(e=360)),this._positiveStartAngle=e;var t=this._endAngle;t!=0&&(t=(t%360+360)%360,t==0&&(t=360)),this._positiveEndAngle=t,this._whole=Math.abs(e-t)==360,this._startAngleByRadian=e*Math.PI/180,this._endAngleByRadian=t*Math.PI/180,this._clockwise=this._startAngleByRadian>this._endAngleByRadian,this._angleRange=Math.abs(this._startAngleByRadian-this._endAngleByRadian),this._publishedDatas.forEach(function(e){var t=this.getValue(e);this._map[e.getId()]={data:e,value:t,color:this.getUniqueColor(this.getColor(e),e),angle:this._startAngleByRadian+(this._clockwise?-1:1)*t/this._valueRange*this._angleRange}},this)},validateDisplay:function(e,t,n){var r={x:this._xGap,y:this._yGap,width:t-this._xGap*2,height:n-this._yGap*2};this.drawBackground(e,r);if(this._startAngleByRadian==this._endAngleByRadian)return;var i,s=this._lowerLimit,o=this._majorScaleCount>1?this._valueRange/(this._majorScaleCount-1):0,u=0,a=0,f,l=null,c=null;if(this._scaleTextVisible){l=new Oi;for(i=0;i<this._majorScaleCount;i++)i==0&&!this._scaleLowerLimitTextVisible||i==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible?(f=null,l.add({text:"",size:{width:0,height:0}})):(c=this.formatScaleText(s),f=this.getTextSize(this._scaleTextFont,c),l.add({text:c,size:f})),!this._scaleInside&&f!=null&&(f.width>u&&(u=f.width),f.height>a&&(a=f.height)),s+=o}this._angleRange<=Math.PI&&(u=Math.max(u,this._pivotRadius),a=Math.max(a,this._pivotRadius)),m.grow(r,-u,-a),this._calcluateCenterAndRadius(r),e.lineWidth=0;if(this._colorRangeList==null||this._colorRangeList.size()==0)this._drawArcGroup(e,this._startAngleByRadian,this._endAngleByRadian,this.getUniqueColor(this._colorRangeFillColor)),this._drawArcOutLine(e,this._startAngleByRadian,this._endAngleByRadian,!0,!0);else{var h=this._angleRange/this._colorRangeList.size(),p=this._startAngleByRadian;for(i=0;i<this._colorRangeList.size();i++){var d=this.getUniqueColor(this._colorRangeList.get(i)),v=p+(this._clockwise?-1:1)*h;this._drawArcGroup(e,p,v,d),this._drawArcOutLine(e,p,p+(this._clockwise?-1:1)*h,i==0,i==this._colorRangeList.size()-1),p+=(this._clockwise?-1:1)*h}}var g=this._startAngleByRadian,y=this._majorScaleCount>1?this._angleRange/(this._majorScaleCount-1):0,b,E,S,x,T,N,C,k;N=this._scaleInside?this._innerRadiusByPixel:this._outerRadius,C=N+this._majorScaleLineLength*(this._scaleInside?1:-1),k=N+this._minorScaleLineLength*(this._scaleInside?1:-1);for(i=0;i<this._majorScaleCount;i++){E=this._center.x+Math.cos(g)*N,S=this._center.y+Math.sin(-g)*N,x=this._center.x+Math.cos(g)*C,T=this._center.y+Math.sin(-g)*C,e.lineWidth=this._majorScaleLineWidth,e.strokeStyle=this.getUniqueColor(this._majorScaleLineColor),e.beginPath(),e.moveTo(E,S),e.lineTo(x,T),e.closePath(),e.stroke();if(this._scaleTextVisible&&!(i==0&&!this._scaleLowerLimitTextVisible||i==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible)){var L=l.get(i);if(L){var A=this.getScaleTextPosition(g/Math.PI*180,E,S,L.size.width,L.size.height);L.x=A.x,L.y=A.y}}if(this._whole||!this._whole&&i<this._majorScaleCount-1){var O=g,M=this._minorScaleCount>0?y/(this._minorScaleCount+1):0;for(b=0;b<this._minorScaleCount;b++)O+=(this._clockwise?-1:1)*M,E=this._center.x+Math.cos(O)*N,S=this._center.y+Math.sin(-O)*N,x=this._center.x+Math.cos(O)*k,T=this._center.y+Math.sin(-O)*k,e.lineWidth=this._minorScaleLineWidth,e.strokeStyle=this.getUniqueColor(this._minorScaleLineColor),e.beginPath(),e.moveTo(E,S),e.lineTo(x,T),e.closePath(),e.stroke()}g+=(this._clockwise?-1:1)*y}this._pivotFill&&w.fill(e,this.getUniqueColor(this._pivotFillColor),this._pivotGradient,this._pivotGradientColor,this._center.x-this._pivotRadius,this._center.y-this._pivotRadius,this._pivotRadius*2,this._pivotRadius*2),e.lineWidth=this._pivotOutlineWidth,e.strokeStyle=this.getUniqueColor(this._pivotOutlineColor),e.beginPath(),e.arc(this._center.x,this._center.y,this._pivotRadius,0,Math.PI*2,!0),e.closePath(),this._pivotFill&&e.fill(),l&&l.forEach(function(t){t&&w.drawText(e,t.text,t,this._scaleTextFont,this._scaleTextColor)},this),this._publishedDatas.forEach(function(t){var n=this._map[t.getId()],r=this._getDataStyle("dialchart.rear.extension",t),i=this._getDataStyle("dialchart.base.width",t),s=this._getDataStyle("dialchart.top.width",t),o=this._getDataStyle("dialchart.radius",t);o>=-1&&o<=1&&(o*=this._innerRadiusByPixel),e.fillStyle=n.color,e.lineWidth=0;var u=m.createMatrix(-n.angle,this._center.x,this._center.y),a=u.transform(this._center.x+o,this._center.y+s/2),f=u.transform(this._center.x+o,this._center.y-s/2),l=u.transform(this._center.x-r,this._center.y-i/2),c=u.transform(this._center.x-r,this._center.y+i/2),h=this._selectShadowOffset;this.isSelected(t)&&h>0?(e.shadowOffsetX=h,e.shadowOffsetY=h,e.shadowBlur=h*2,e.shadowColor=this._selectShadowColor):(e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowColor=n.color),e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(f.x,f.y),e.lineTo(l.x,l.y),e.lineTo(c.x,c.y),e.lineTo(a.x,a.y),e.closePath(),e.fill();var p=this._getValueTextInfo(t,n.value);if(p){var d=u.transform(this._center.x+o*this._valuePosition,this._center.y);p.x=d.x,p.y=d.y}},this),this.drawValueTexts(e)},_getDataStyle:function(e,t){return t.getStyle?t.getStyle(e):t.getClient(e)},_calcluateCenterAndRadius:function(e){var t=this._clockwise?this._positiveEndAngle:this._positiveStartAngle,n=this._clockwise?this._positiveStartAngle:this._positiveEndAngle,r=Math.abs(this._positiveEndAngle-this._positiveStartAngle);0<=t&&t<90?0<=n&&n<=90?(this._outerRadius=Math.min(e.width,e.height),this._center={x:e.x+(e.width-this._outerRadius)/2,y:e.y+(e.height+this._outerRadius)/2}):90<n&&n<=180?(this._outerRadius=Math.min(e.width/2,e.height),this._center={x:e.x+e.width/2,y:e.y+(e.height+this._outerRadius)/2}):(this._center={x:e.x+e.width/2,y:e.y+e.height/2},this._outerRadius=Math.min(e.width,e.height)/2):90<=t&&t<180?90<=n&&n<=180?(this._outerRadius=Math.min(e.width,e.height),this._center={x:e.x+(e.width+this._outerRadius)/2,y:e.y+(e.height+this._outerRadius)/2}):180<n&&n<=270?(this._outerRadius=Math.min(e.width,e.height/2),this._center={x:e.x+(e.width+this._outerRadius)/2,y:e.y+e.height/2}):(this._center={x:e.x+e.width/2,y:e.y+e.height/2},this._outerRadius=Math.min(e.width,e.height)/2):180<=t&&t<270?180<=n&&n<=270?(this._outerRadius=Math.min(e.width,e.height),this._center={x:e.x+(e.width+this._outerRadius)/2,y:e.y+(e.height-this._outerRadius)/2}):(this._outerRadius=Math.min(e.width/2,e.height),this._center={x:e.x+e.width/2,y:e.y+(e.height-this._outerRadius)/2}):(this._outerRadius=Math.min(e.width,e.height),this._center={x:e.x+(e.width-this._outerRadius)/2,y:e.y+(e.height-this._outerRadius)/2}),this._innerRadiusByPixel=this._innerRadius>1?this._innerRadius:this._outerRadius*this._innerRadius,this._innerDarkerRadiusByPixel=this._innerDarkerRadius>1?this._innerDarkerRadius:this._outerRadius*this._innerDarkerRadius,this._outerBrighterRadiusByPixel=this._outerBrighterRadius>1?this._outerBrighterRadius:this._outerRadius*this._outerBrighterRadius},_drawArcOutLine:function(e,t,n,r,i){if(this._outlineWidth<=0)return;var s=Math.abs(t-n),o=this._center.x+Math.cos(t)*this._innerRadiusByPixel,u=this._center.y+Math.sin(-t)*this._innerRadiusByPixel,a=this._center.x+Math.cos(t)*this._outerRadius,f=this._center.y+Math.sin(-t)*this._outerRadius,l=this._center.x+Math.cos(n)*this._innerRadiusByPixel,c=this._center.y+Math.sin(-n)*this._innerRadiusByPixel,h=this._center.x+Math.cos(n)*this._outerRadius,p=this._center.y+Math.sin(-n)*this._outerRadius;this._clockwise?(e.lineWidth=this._outlineWidth,e.strokeStyle=this.getUniqueColor(this._outlineColor),e.beginPath(),e.moveTo(this._center.x,this._center.y),w.drawArc(e,this._center.x,this._center.y,n,s,this._outerRadius,this._outerRadius,!1),e.stroke(),!this._whole&&r?(e.lineWidth=this._outlineWidth,e.strokeStyle=this.getUniqueColor(this._outlineColor)):e.lineWidth=0,e.lineTo(o,u),e.stroke(),e.beginPath(),e.lineWidth=this._outlineWidth,e.strokeStyle=this.getUniqueColor(this._outlineColor),e.moveTo(this._center.x,this._center.y),w.drawArc(e,this._center.x,this._center.y,t,-s,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),e.stroke(),!this._whole&&i?(e.lineWidth=this._outlineWidth,e.strokeStyle=this.getUniqueColor(this._outlineColor)):e.lineWidth=0,e.lineTo(h,p),e.stroke()):(e.lineWidth=this._outlineWidth,e.strokeStyle=this.getUniqueColor(this._outlineColor),e.beginPath(),e.moveTo(this._center.x,this._center.y),w.drawArc(e,this._center.x,this._center.y,t,s,this._outerRadius,this._outerRadius,!1),e.stroke(),!this._whole&&i?(e.lineWidth=this._outlineWidth,e.strokeStyle=this.getUniqueColor(this._outlineColor)):e.lineWidth=0,e.lineTo(l,c),e.stroke(),e.lineWidth=this._outlineWidth,e.strokeStyle=this.getUniqueColor(this._outlineColor),e.beginPath(),e.moveTo(this._center.x,this._center.y),w.drawArc(e,this._center.x,this._center.y,n,-s,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),e.stroke(),!this._whole&&r?(e.lineWidth=this._outlineWidth,e.strokeStyle=this.getUniqueColor(this._outlineColor)):e.lineWidth=0,e.lineTo(a,f),e.stroke())},_drawArcGroup:function(e,t,n,r){this._outerBrighterRadiusByPixel!=0&&this._drawArc(e,t,n,this._outerRadius-this._outerBrighterRadiusByPixel,this._outerRadius,w.brighter(r)),this._drawArc(e,t,n,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,this._outerRadius-this._outerBrighterRadiusByPixel,r),this._innerDarkerRadiusByPixel!=0&&this._drawArc(e,t,n,this._innerRadiusByPixel,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,w.darker(r,20))},_drawArc:function(e,t,n,r,i,s){var o=Math.abs(t-n);e.lineWidth=0,e.fillStyle=s;var u=this._center.x+Math.cos(t)*r,a=this._center.y+Math.sin(-t)*r,f=this._center.x+Math.cos(t)*i,l=this._center.y+Math.sin(-t)*i,c=this._center.x+Math.cos(n)*r,h=this._center.y+Math.sin(-n)*r,p=this._center.x+Math.cos(n)*i,d=this._center.y+Math.sin(-n)*i;e.beginPath(),this._clockwise?(e.moveTo(c,h),w.drawArc(e,this._center.x,this._center.y,n,o,i,i,!0),e.lineTo(u,a),w.drawArc(e,this._center.x,this._center.y,t,-o,r,r,!0),e.closePath()):(e.moveTo(u,a),w.drawArc(e,this._center.x,this._center.y,t,o,i,i,!0),e.lineTo(c,h),w.drawArc(e,this._center.x,this._center.y,n,-o,r,r,!0),e.closePath()),e.fill()},getScaleTextPosition:function(e,t,n,r,i){e=(e%360+360)%360;var s={x:t,y:n};return e==0&&(s=this._scaleInside?{x:t-r/2,y:n}:{x:t+r/2,y:n}),e==180&&(s=this._scaleInside?{x:t+r/2,y:n}:{x:t-r/2,y:n}),e==90&&(s=this._scaleInside?{x:t,y:n+i/2}:{x:t,y:n-i/2}),e==270&&(s=this._scaleInside?{x:t,y:n-i/2}:{x:t,y:n+i/2}),e>270&&e<360&&(s=this._scaleInside?{x:t-r/2,y:n-i/2}:{x:t+r/2,y:n+i/2}),e>180&&e<270&&(s=this._scaleInside?{x:t+r/2,y:n-i/2}:{x:t-r/2,y:n+i/2}),e>90&&e<180&&(s=this._scaleInside?{x:t+r/2,y:n+i/2}:{x:t-r/2,y:n-i/2}),e>0&&e<90&&(s=this._scaleInside?{x:t-r/2,y:n+i/2}:{x:t+r/2,y:n-i/2}),s}}),n.charts.RadarChart=function(e){n.charts.RadarChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},r.ext("twaver.charts.RadarChart",n.charts.ChartBase,{__accessor:["axisTextVisible","axisTextFont","axisTextColor","scaleTextVisible","scaleTextFont","scaleTextColor","axisVisible","axisLineColor","axisLineWidth","axisStartAngle","ringVisible","ringType","ringLineColor","ringLineWidth","scaleCount","scaleMaxValue","scaleMinValue","anchorVisible","areaFillAlpha","areaSelectFillAlpha","axisList"],__bool:["areaFill"],_axisTextVisible:$i.RADARCHART_AXIS_TEXT_VISIBLE,_axisTextFont:$i.RADARCHART_AXIS_TEXT_FONT,_axisTextColor:$i.RADARCHART_AXIS_TEXT_COLOR,_scaleTextVisible:$i.RADARCHART_SCALE_TEXT_VISIBLE,_scaleTextFont:$i.RADARCHART_SCALE_TEXT_FONT,_scaleTextColor:$i.RADARCHART_SCALE_TEXT_COLOR,_axisVisible:$i.RADARCHART_AXIS_VISIBLE,_axisLineColor:$i.RADARCHART_AXIS_LINE_COLOR,_axisLineWidth:$i.RADARCHART_AXIS_LINE_WIDTH,_axisStartAngle:$i.RADARCHART_AXIS_START_ANGLE,_ringVisible:$i.RADARCHART_RING_VISIBLE,_ringType:$i.RADARCHART_RING_TYPE,_ringLineColor:$i.RADARCHART_RING_LINE_COLOR,_ringLineWidth:$i.RADARCHART_RING_LINE_WIDTH,_scaleCount:$i.RADARCHART_SCALE_COUNT,_scaleMaxValue:$i.RADARCHART_SCALE_MAXVALUE,_scaleMinValue:$i.RADARCHART_SCALE_MINVALUE,_anchorVisible:$i.RADARCHART_ANCHOR_VISIBLE,_areaFill:$i.RADARCHART_AREA_FILL,_areaFillAlpha:$i.RADARCHART_AREA_FILL_ALPHA,_areaSelectFillAlpha:$i.RADARCHART_AREA_SELECT_FILL_ALPHA,getAxisCount:function(){return this._axisCount},formatScaleText:function(e,t){return e.toFixed(2)},getAnchorSize:function(e){return e.getStyle?e.getStyle("chart.marker.size"):n.Styles.getStyle("chart.marker.size")},getAnchorShape:function(e){return e.getStyle?e.getStyle("chart.marker.shape"):n.Styles.getStyle("chart.marker.shape")},getLineWidth:function(e){return e.getStyle?e.getStyle("chart.line.width"):n.Styles.getStyle("chart.line.width")},getValues:function(e){return e.getStyle?e.getStyle("chart.values"):null},tryGetDataAt:function(e,t){if(t==null||t<0)t=this._selectTolerance;e.target&&(e=b.getLogicalPoint(this._canvas,arguments[0],1));if(!e)return null;if(!this._areaFill){var n=e.x-t,r=e.y-t,i=t*2+1,s=t*2+1;try{var o=this._canvas.getContext("2d").getImageData(n,r,i,s).data;for(var u=0,a=o.length;u<a;u+=4)if(o[u+3]===255){var f="rgb("+o[u]+","+o[u+1]+","+o[u+2]+")",l=this._uniqueColors[f];if(l)return l}}catch(c){}return null}if(!this._center)return null;e={x:e.x-this._xTranslate,y:e.y-this._yTranslate};for(var u=this._publishedDatas.size()-1;u>=0;u--){var l=this._publishedDatas.get(u),h=this._map[l.getId()],p=m.isPointInPolygon(h.points,e);if(p)return l}return null},getDataAt:function(){var e,t;if(arguments.length===2)e=arguments[0],t=arguments[1];else if(arguments[0].target){var n=b.getLogicalPoint(this._canvas,arguments[0],1);if(!n)return;e=n.x,t=n.y}else e=arguments[0].x,t=arguments[0].y;if(e<0||t<0||e>this._canvasWidth||t>this._canvasHeight)return null;if(!this._areaFill){try{var r=this._canvas.getContext("2d").getImageData(e,t,1,1).data;if(r[3]===255){var i="rgb("+r[0]+","+r[1]+","+r[2]+")",s=this._uniqueColors[i];if(s)return s}}catch(o){}return null}for(var u=this._publishedDatas.size()-1;u>=0;u--){var s=this._publishedDatas.get(u),a=this._map[s.getId()],f=m.isPointInPolygon(a.points,{x:e-this._xTranslate,y:t-this._yTranslate});if(f)return s}return null},validateModel:function(){this._map={},this._axisTexts=new Oi,this._axisMaxValues=new Oi,this._axisMinValues=new Oi,this._axisRangeValues=new Oi,this._axisCount=this._axisList==null?0:this._axisList.size();if(this._axisCount==0)return;this._averageAngleByRadian=Math.PI*2/this._axisCount,this._averageAngle=360/this._axisCount,this._axisList.forEach(function(e){if(typeof e=="string")this._axisTexts.add(e),this._axisMaxValues.add(this._scaleMaxValue),this._axisMinValues.add(this._scaleMinValue),this._axisRangeValues.add(this._scaleMaxValue-this._scaleMinValue);else{this._axisTexts.add(e.text);var t=isNaN(e.max)?this._scaleMaxValue:e.max,n=isNaN(e.min)?this._scaleMinValue:e.min;this._axisMaxValues.add(t),this._axisMinValues.add(n),this._axisRangeValues.add(t-n)}},this),this._publishedDatas.forEach(function(e){var t=new Oi(this.getValues(e)),n={data:e,values:t,proportions:new Oi,color:this.getUniqueColor(this.getColor(e),e),anchorShape:this.getAnchorShape(e),anchorSize:this.getAnchorSize(e),lineWidth:this.getLineWidth(e),points:new Oi};this.isSelected(e)&&(n.lineWidth+=2),this._map[e.getId()]=n},this);for(var e=0;e<this._axisCount;e++)this._publishedDatas.forEach(function(t){var n=this._map[t.getId()],r=0;if(n.values.size()>e){var s=n.values.get(e),o=this._axisMinValues.get(e),u=this._axisRangeValues.get(e);u>0&&(r=(s-o)/u)}n.proportions.add(r)},this)},validateDisplay:function(e,t,n){var r={x:this._xGap,y:this._yGap,width:t-this._xGap*2,height:n-this._yGap*2};this.drawBackground(e,r);if(r.width<=0||r.height<=0||this._axisCount<3)return;var i=0,s=0,o=0,u=null,a=null,f=null,l=null;if(this._axisTextVisible){l=new Oi;for(o=0;o<this._axisCount;o++)f=this._axisTexts.get(o),u=this.getTextSize(this._axisTextFont,f),l.add({text:f,size:u}),u.width>i&&(i=u.width),u.height>s&&(s=u.height)}var c=r.width/2-i>r.height/2-s?r.height/2-s*2:r.width/2-i,h={x:r.x+r.width/2,y:r.y+r.height/2};this._center={x:h.x+this._xTranslate,y:h.y+this._yTranslate};var p=null;this._scaleTextVisible&&(p=new Oi);var d=this._axisStartAngle/180*Math.PI;for(o=0;o<this._axisCount;o++){var v=d*180/Math.PI,m=h.x+Math.cos(d)*c,g=h.y+Math.sin(-d)*c,y=null;p&&(y=new Oi,p.add(y)),this._ringVisible&&this._ringLineWidth>0&&(e.lineWidth=this._ringLineWidth,e.strokeStyle=this._ringLineColor);for(var b=1;b<=this._scaleCount;b++){var E=b/this._scaleCount,S=c*E,x=h.x+Math.cos(d)*S,T=h.y+Math.sin(-d)*S;if(this._ringVisible&&this._ringLineWidth>0){var N=h.x+Math.cos(d+this._averageAngleByRadian)*S,C=h.y+Math.sin(-d-this._averageAngleByRadian)*S;this._ringType=="line"?this.drawLine(e,this._ringLineColor,this._ringLineWidth,x,T,N,C):this._ringType=="arc"&&(e.beginPath(),e.moveTo(h.x,h.y),w.drawArc(e,h.x,h.y,d,this._averageAngleByRadian,S,S,!0),e.closePath(),e.stroke())}y&&(f=this.formatScaleText(this._axisMinValues.get(o)+this._axisRangeValues.get(o)*E,o),u=this.getTextSize(this._scaleTextFont,f),a=this.getScaleTextPosition(v,x,T,u.width,u.height),y.add({text:f,x:a.x,y:a.y}))}this._axisVisible&&this.drawLine(e,this._axisLineColor,this._axisLineWidth,h.x,h.y,m,g);if(l){var k=l.get(o);a=this.getAxisTextPosition(v,m,g,k.size.width,k.size.height),k.x=a.x,k.y=a.y}d+=this._averageAngleByRadian}this._publishedDatas.forEach(function(t){var n=this._map[t.getId()];n.points.clear();var r=n.anchorSize>0?new Oi:null,i=n.proportions;e.lineWidth=0,e.globalAlpha=this.isSelected(t)?this._areaSelectFillAlpha:this._areaFillAlpha,this._areaFill&&(e.fillStyle=n.color),this._drawItem(e,i,h,c,r,n),this._areaFill&&e.fill(),e.lineWidth=n.lineWidth,e.strokeStyle=n.color,e.globalAlpha=1,this._drawItem(e,i,h,c),e.lineWidth=0;if(r!=null&&r.size()>0){var s=n.anchorSize/2;r.forEach(function(t){e.fillStyle=n.color,w.drawVector(e,n.anchorShape,null,t.x-s,t.y-s,n.anchorSize,n.anchorSize),e.fill()})}},this),p&&p.forEach(function(t){t.forEach(function(t){w.drawText(e,t.text,t,this._scaleTextFont,this._scaleTextColor)},this)},this),l&&l.forEach(function(t){w.drawText(e,t.text,t,this._axisTextFont,this._axisTextColor)},this)},_drawItem:function(e,t,n,r,i,s){var o=this._axisStartAngle/180*Math.PI,u=null;e.beginPath();for(var a=0;a<this._axisCount;a++){var f=t.get(a),l={x:n.x+Math.cos(o)*r*f,y:n.y+Math.sin(-o)*r*f};u==null?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y),i!=null&&this._anchorVisible&&i.add(l),s&&s.points.add(l),a==0&&(u=l),o+=this._averageAngleByRadian}u!=null&&e.lineTo(u.x,u.y),e.closePath(),e.stroke
()},getAxisTextPosition:function(e,t,n,r,i){e=(e%360+360)%360;var s={x:t,y:n};return e==0&&(s={x:t+r/2,y:n}),e==180&&(s={x:t-r/2,y:n}),e==90&&(s={x:t,y:n-i/2}),e==270&&(s={x:t,y:n+i/2}),e>270&&e<360&&(s={x:t+r/2,y:n+i/2}),e>180&&e<270&&(s={x:t-r/2,y:n+i/2}),e>90&&e<180&&(s={x:t-r/2,y:n-i/2}),e>0&&e<90&&(s={x:t+r/2,y:n-i/2}),s},getScaleTextPosition:function(e,t,n,r,i){e=(e%360+360)%360;var s={x:t,y:n};return e==0&&(s={x:t,y:n+i/2}),e==180&&(s={x:t-r/2,y:n+i/2}),e==90&&(s={x:t+r/2,y:n}),e==270&&(s={x:t+r/2,y:n}),e>270&&e<360&&(s={x:t+r/2,y:n-i/2}),e>180&&e<270&&(s={x:t-r/2,y:n-i/2}),e>90&&e<180&&(s={x:t-r/2,y:n+i/2}),e>0&&e<90&&(s={x:t+r/2,y:n+i/2}),s}}),n.charts.LegendPane=function(e){n.charts.LegendPane.superClass.constructor.apply(this,arguments),this._divPool=new n.Pool("div"),this._iconPool=new n.Pool("div"),this._textPool=new n.Pool("span"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._textPool),this._chart=e,this._chart.addViewListener(this.handleViewChange,this),this._view=b.createView("hidden"),this._view.style.verticalAlign="middle",this._legendDiv=b.createDiv(),this._legendDiv.style.whiteSpace="nowrap",this._legendDiv.style.verticalAlign="middle",this._legendDiv.style.position="",this._view.appendChild(this._legendDiv),this._hiddenMap={};var t=this;this._chart._internalVisibleFunction=function(e){return!t.isHidden(e)},h.isTouchable&&new n.charts.LegendPaneTouchInteraction(this),new n.charts.LegendPaneInteraction(this)},r.ext("twaver.charts.LegendPane",n.controls.ControlBase,{__accessor:["iconWidth","iconHeight","iconRadius","rowHeight","orientation","hiddenColor","selectBackgroundColor","selectForegroundColor"],_iconWidth:$i.LEGENDPANE_ICON_WIDTH,_iconHeight:$i.LEGENDPANE_ICON_HEIGHT,_iconRadius:$i.LEGENDPANE_ICON_RADIUS,_rowHeight:$i.LEGENDPANE_ROW_HEIGHT,_orientation:$i.LEGENDPANE_ORIENTATION,_hiddenColor:$i.LEGENDPANE_HIDDEN_COLOR,_selectBackgroundColor:$i.LEGENDPANE_SELECT_BACKGROUND_COLOR,_selectForegroundColor:$i.LEGENDPANE_SELECT_FOREGROUND_COLOR,onPropertyChanged:function(e){this.invalidate()},getChart:function(){return this._chart},isHidden:function(e){return this._hiddenMap[e.getId()]!=null},handleViewChange:function(e){e.kind==="validateEnd"&&(this._invalidate=!0,this.validate())},validate:function(){if(!this._invalidate)return;this._invalidate=!1,b.release(this._legendDiv),r.keys(this._hiddenMap).forEach(function(e){this._chart.getDataBox().containsById(e)||delete this._hiddenMap[e]},this);var e=new Oi(this._chart.getUnfilteredDatas());for(var t=0;t<e.size();t++){var n=e.get(t);!this._chart.isVisible(n)&&!this.isHidden(n)&&(e.removeAt(t),t--)}var i=e.size(),s=this._view.style,o=this._orientation==="horizontal";o?(s.textAlign="center",s.height=this._rowHeight+"px"):(s.textAlign="",s.height=this._rowHeight*i+"px"),s.lineHeight=this._rowHeight-2+"px";for(t=0;t<i;t++){var n=e.get(t),u=this._divPool.get();u._data=n,u.style.cursor="pointer",u.style.height=this._rowHeight+"px",o?u.style.display="inline-block":u.style.display="block",this._legendDiv.appendChild(u),this.renderLegend(u,n),this.onLegendRendered(u,n)}this._pools.forEach(function(e){e.clear()})},renderLegend:function(e,t){var n=!this.isHidden(t),r=this._chart.isSelected(t),i=this._iconPool.get(),s=i.style;s.display="inline-block",s.verticalAlign="middle",s.marginLeft="4px",s.width=this.getIconWidth()+"px",s.height=this.getIconHeight()+"px",n?s.backgroundColor=this._chart.getColor(t):s.backgroundColor=this.getHiddenColor(),e.appendChild(i);var o=this._textPool.get();s=o.style,s.paddingLeft="2px",s.paddingRight="4px",s.display="inline-block",s.verticalAlign="middle",n?s.color=r?this._selectForegroundColor:"":s.color=this.getHiddenColor(),o.innerHTML=this._chart.getName(t),e.appendChild(o),n&&r?e.style.backgroundColor=this._selectBackgroundColor:e.style.backgroundColor=""},onLegendRendered:function(e,t){}}),n.charts.ChartPane=function(e,t,r,i){n.charts.ChartPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._chart=e,this._legendPane=new n.charts.LegendPane(e),this._titleDiv=b.createDiv(),this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.whiteSpace="nowrap",this._view=b.createView("hidden"),this._view.appendChild(this._titleDiv),this._view.appendChild(this._legendPane.getView()),this._view.appendChild(this._chart.getView());var s=this;this._legendPane.addPropertyChangeListener(function(e){(e.property==="rowHeight"||e.porperty==="orientation")&&s.invalidate()}),arguments.length>1&&this.setTitle(t),arguments.length>2&&this.setLegendOrientation(r),arguments.length>3&&this.setLegendWidth(i)},r.ext("twaver.charts.ChartPane",n.controls.ControlBase,{__accessor:["title","titleHorizontalAlign","titleHeight","legendWidth"],_title:null,_titleHeight:$i.CHARTPANE_TITLE_HEIGHT,_titleHorizontalAlign:$i.CHARTPANE_TITLE_HORIZONTAL_ALIGN,_legendOrientation:$i.CHARTPANE_LEGEND_ORIENTATION,_legendWidth:$i.CHARTPANE_LEGEND_WIDTH,getLegendOrientation:function(){return this._legendOrientation},setLegendOrientation:function(e){if(this._legendOrientation===e)return;var t=this._legendOrientation;this._legendOrientation=e,this.firePropertyChange("orientation",t,e),this._adjustLegendOrientation()},_adjustLegendOrientation:function(){this._legendOrientation==="left"||this._legendOrientation==="right"?this._legendPane.setOrientation("vertical"):this._legendPane.setOrientation("horizontal")},onPropertyChanged:function(e){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getChart:function(){return this._chart},getLegendPane:function(){return this._legendPane},validateImpl:function(){this._adjustLegendOrientation();var e=this._view.offsetWidth,t=this._view.offsetHeight,n=this._legendPane.getRowHeight(),r;this._title&&this._title!==""?(r=this._titleHeight,this._titleDiv.innerHTML=this._title):(r=0,this._titleDiv.innerHTML=""),this._titleDiv.innerHTML=this._title?this._title:"",this._titleDiv.style.textAlign=this._titleHorizontalAlign,this._titleDiv.style.lineHeight=this._titleHeight-2+"px";var i=this._titleDiv.style;i.left="0px",i.top="0px",i.width=e+"px",i.height=r+"px";var s,o;this._legendOrientation==="bottom"?(s={x:0,y:r,width:e,height:Math.max(t-r-n,0)},o={x:0,y:Math.max(t-n,0),width:e,height:n}):this._legendOrientation==="right"?(s={x:0,y:r,width:Math.max(e-this._legendWidth,0),height:Math.max(t-r,0)},o={x:Math.max(e-this._legendWidth,0),y:r,width:this._legendWidth,height:Math.max(t-r,0)}):this._legendOrientation==="top"?(s={x:0,y:r+n,width:e,height:Math.max(t-r-n,0)},o={x:0,y:r,width:e,height:n}):this._legendOrientation==="left"&&(s={x:this._legendWidth,y:r,width:Math.max(e-this._legendWidth,0),height:Math.max(t-r,0)},o={x:0,y:r,width:this._legendWidth,height:Math.max(t-r,0)}),s&&this._chart.adjustBounds(s),o&&this._legendPane.adjustBounds(o)}}),n.charts.ChartInteraction=function(e){this.chart=e,this.canvas=e._canvas;var t=this;this.canvas.addEventListener("mousedown",function(e){e.button===0&&t.handleMouseDown(e),e.preventDefault()},!1);var n=h.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(n,function(e){t.handleMouseWheel(e)},!1)},r.ext("twaver.charts.ChartInteraction",Object,{handleMouseDown:function(e){this.chart.isFocusOnClick()&&n.Util.setFocus(this.canvas),this.lastPoint=this.chart.getLogicalPoint(e);var t=this.chart.tryGetDataAt(e);e.detail===2&&t==null?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0)):(this._startLogical=this.lastPoint,this._startClient=b.getClientPoint(e),b.handle_mousedown(this,e))},handleMouseMove:function(e){if(this.lastPoint){var t={x:this._startLogical.x+e.clientX-this._startClient.x,y:this._startLogical.y+e.clientY-this._startClient.y};!this.startPan&&m.getDistance(this.lastPoint,t)>3&&(this.startPan=!0,this.lastPoint=t),this.startPan&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+t.x-this.lastPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+t.y-this.lastPoint.y),this.lastPoint=t)}},handleMouseUp:function(e){if(!this.startPan&&e.detail===1){var t=this.chart.tryGetDataAt(e),n=this.chart.getSelectionModel();t?r.isCtrlDown(e)?n.contains(t)?n.removeSelection(t):n.appendSelection(t):n.contains(t)||n.setSelection(t):r.isCtrlDown(e)||n.clearSelection()}delete this.lastPoint,delete this.startPan,delete this._startClient,delete this._startLogical},handleMouseWheel:function(e){b.preventDefault(e);var t=h.isFirefox?-e.detail:e.wheelDelta;t>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()*1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()*1.1,!1)):t<0&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))}}),n.charts.ChartTouchInteraction=function(e){this.chart=e,this.canvas=e._canvas,b.addEventListener("touchstart","handleTouchstart",this.canvas,this)},r.ext("twaver.charts.ChartTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e),this.chart.isFocusOnClick()&&n.Util.setFocus(this.canvas),this.endPoint=this.chart.getLogicalPoint(e),kr.isMultiTouch(e)&&(this.distance=kr.getDistance(e),this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom()),b.addEventListener("touchmove","handleTouchmove",this.canvas,this),b.addEventListener("touchend","handleTouchend",this.canvas,this)},handleTouchmove:function(e){b.preventDefault(e);if(!this.endPoint)return;var t=this.chart.getLogicalPoint(e);!this.moved&&m.getDistance(this.endPoint,t)>10&&(this.moved=!0,this.lastPoint=t);if(!this.moved)return;if(kr.isSingleTouch(e))this.endPoint&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+t.x-this.endPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+t.y-this.endPoint.y),this.endPoint=t);else if(this.distance){var n=kr.getDistance(e)/this.distance,r=this.xZoom*n,i=this.yZoom*n;this.chart.isXZoomEnabled()&&this.chart.setXZoom(r,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(i,!1)}},handleTouchend:function(e){b.preventDefault(e);if(!this.moved){this.endPoint=this.chart.getLogicalPoint(e);var t=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;t?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date);var n=this.chart.tryGetDataAt(e);if(t&&n==null)this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0));else{var r=this.chart.getSelectionModel();n?r.contains(n)||r.setSelection(n):r.clearSelection()}}delete this.endPoint,delete this.distance,delete this.xZoom,delete this.yZoom,delete this.moved,b.removeEventListener("touchmove",this.canvas,this),b.removeEventListener("touchend",this.canvas,this)}}),n.charts.ChartMSTouchInteraction=function(e){this.chart=e,this.canvas=e._canvas,this._pointerMap={},this._pointerIdArray=[],b.addEventListener("MSPointerDown","handleTouchstart",this.canvas,this),b.addEventListener("MSPointerMove","handleTouchmove",this.canvas,this),b.addEventListener("MSPointerUp","handleTouchend",this.canvas,this),b.addEventListener("MSPointerCancel","handleTouchend",this.canvas,this);var t=h.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(t,function(e){self.handleMouseWheel(e)},!1)},r.ext("twaver.charts.ChartMSTouchInteraction",Object,{handleTouchstart:function(e){this.chart.isFocusOnClick()&&n.Util.setFocus(this.canvas);var t=this.chart.getLogicalPoint(e);e.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[e.pointerId]&&t&&(this._pointerIdArray.push(e.pointerId),this._pointerMap[e.pointerId]=e);var r=this.chart.tryGetDataAt(e);if(this._pointerIdArray.length==1&&t){var i=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&m.getDistance(this._startTouchPoint,t)<=10;i&&r==null?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0),this._startTouchPoint=null,this._startTouchTime=null,this._startClientPoint=null):(this._startTouchPoint=t,this._startTouchTime=new Date,this._startClientPoint={x:e.clientX,y:e.clientY},b.handle_mousedown(this,e))}else this._pointerIdArray.length==2&&(this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom(),this._distance=this._getDistance())},handleTouchmove:function(e){if(this._pointerIdArray.length==0||!this._pointerMap[e.pointerId]||m.getDistance({x:this._pointerMap[e.pointerId].pageX,y:this._pointerMap[e.pointerId].pageY},{x:e.pageX,y:e.pageY})<=3)return;this._pointerMap[e.pointerId]=e;if(this._pointerIdArray.length==2){var t=this._getDistance()/this._distance,n=this.xZoom*t,r=this.yZoom*t;this.chart.isXZoomEnabled()&&this.chart.setXZoom(n,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(r,!1)}},handleTouchend:function(e){var t=this.chart.getLogicalPoint(e);if(this._pointerIdArray.length==1&&t&&!this.moved){var n=this.chart.tryGetDataAt(e),i=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&m.getDistance(this._startTouchPoint,t)<=10,s=this.chart.getSelectionModel();n&&i?r.isCtrlDown(e)?s.contains(n)?s.removeSelection(n):s.appendSelection(n):s.contains(n)||s.setSelection(n):r.isCtrlDown(e)||s.clearSelection()}this.moved=!1,this._pointerMap={},this._pointerIdArray=[]},handleMouseWheel:function(e){b.preventDefault(e);var t=h.isFirefox?-e.detail:e.wheelDelta;t>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()*1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()*1.1,!1)):t<0&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))},handle_mousemove:function(e){if(this._pointerIdArray.length==1&&this._startTouchPoint&&this._startClientPoint){var t={x:this._startTouchPoint.x+(e.clientX-this._startClientPoint.x)/this.chart.getXZoom(),y:this._startTouchPoint.y+(e.clientY-this._startClientPoint.y)/this.chart.getYZoom()};m.getDistance(this._startTouchPoint,t)>3&&(this.moved=!0,this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+t.x-this._startTouchPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+t.y-this._startTouchPoint.y),this._startClientPoint.x=e.clientX,this._startClientPoint.y=e.clientY)}},handle_mouseup:function(e){this.handleTouchend(e)},_getDistance:function(){return m.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),n.charts.LegendPaneInteraction=function(e){this.legendPane=e;var t=this;this.legendPane._legendDiv.addEventListener("mousedown",function(e){t.handleMouseDown(e)},!1)},r.ext("twaver.charts.LegendPaneInteraction",Object,{handleMouseDown:function(e){if(e.button!==0)return;var t=e.target._data;t||(t=e.target.parentNode._data),t&&(this.legendPane._hiddenMap[t.getId()]?delete this.legendPane._hiddenMap[t.getId()]:this.legendPane._hiddenMap[t.getId()]=t,this.legendPane._chart.invalidateModel())}}),n.charts.LegendPaneTouchInteraction=function(e){this.legendPane=e,b.addEventListener("touchstart","handleTouchstart",this.legendPane._legendDiv,this)},r.ext("twaver.charts.LegendPaneTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e);var t=e.target._data;t||(t=e.target.parentNode._data),t&&(this.legendPane._hiddenMap[t.getId()]?delete this.legendPane._hiddenMap[t.getId()]:this.legendPane._hiddenMap[t.getId()]=t,this.legendPane._chart.invalidateModel())}}),n.network.Network=function(e){n.network.Network.superClass.constructor.apply(this,arguments),this._elementUIMap={},this._layerMap={},this._layerList=new Oi,this._view=b.createView("auto"),this._rootDiv=b.createDiv(),this._topDiv=b.createDiv(),this._attachmentDiv=b.createDiv(),this._layersDiv=b.createDiv(),this._bottomDiv=b.createDiv(),this._rootDiv.appendChild(this._bottomDiv),this._rootDiv.appendChild(this._layersDiv),this._rootDiv.appendChild(this._attachmentDiv),this._rootDiv.appendChild(this._topDiv),this._view.appendChild(this._rootDiv),this.setElementBox(e?e:new n.ElementBox),h.isTouchable?h.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1);var t=this;this._flowLink=function(){if(t.isMovingElement()||t.isSelectingElement()||t.isEditingElement()||t._box._layoutMovingElements)return;t._flowLinkQuickFinder||(t._flowLinkQuickFinder=new n.QuickFinder(t._box,"link.flow","style"));var e=t._flowLinkQuickFinder.find(!0);e.forEach(function(e){e._styleMap["link.flow.offset"]=t.getLinkFlowOffset(e);var n=t.getElementUI(e);n.drawBody()})},this.setToolTipEnabled($i.NETWORK_TOOLTIP_ENABLED),this._view.addEventListener("scroll",function(e){lr.twm(t)}),this.addPropertyChangeListener(function(e){e.property==="zoom"&&lr.twm(t)}),n.imageUtil.addEventListener(this.invalidateElementUIs,this)},r.ext("twaver.network.Network",n.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable"],_viewRect:{x:0,y:0,width:0,height:0},_currentSubNetwork:null,_selectMode:$i.NETWORK_SELECT_MODE,_noAgentLinkVisible:$i.NETWORK_NO_AGENT_LINK_VISIBLE,_makeVisibleOnSelected:$i.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:$i.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:$i.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:$i.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_subNetworkAnimate:$i.NETWORK_SUBNETWORK_ANIMATE,_transparentSelectable:$i.NETWORK_TRANSPARENT_SELECTABLE,_removeElementUIOnInvisible:$i.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE,_elementUIFunction:$i.ELEMENTUI_FUNCTION,_doubleClickToUpSubNetwork:$i.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:$i.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:$i.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:$i.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:$i.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_sendToTopOnSelected:$i.NETWORK_SENDTOTOP_ON_SELECTED,_selectOutlineColor:$i.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:$i.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:$i.NETWORK_SELECT_FILL_COLOR,_lazyMoveOutlineColor:$i.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:$i.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:$i.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:$i.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:$i.NETWORK_LAZYMOVE_ANIMATE,_editPointSize:$i.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:$i.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:$i.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:$i.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:$i.NETWORK_EDIT_LINE_COLOR,_editLineWidth:$i.NETWORK_EDIT_LINE_WIDTH,_resizePointSize:$i.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:$i.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:$i.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:$i.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:$i.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:$i.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:$i.NETWORK_RESIZE_ANIMATE,_rotatePointSize:$i.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:$i.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:$i.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:$i.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:$i.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:$i.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:$i.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:$i.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:$i.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:$i.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:$i.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:$i.NETWORK_SELECTION_TOLERANCE,_invalidate:!1,_invalidateElementVisibility:!1,_invalidateElementIndex:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:n.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,getLabel:function(e){return e.getStyle("network.label")||e.getName()},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(e){this._toolTipEnabled=e;if(e){if(!this._toolTipListener){var t=this;this._toolTipListener=function(e){var n=t.getElementAt(e);if(t._preElement===n)return;t._preElement=n;if(n){var r=t.getToolTip(n);Ar.showToolTip({x:e.pageX,y:e.pageY},r);var i=Ar.getToolTipDiv();if(i.children.length>0){var s=t._view.getBoundingClientRect(),o=i.getBoundingClientRect();o.width+o.left>s.width+s.left&&(i.style.left=s.width+s.left-o.width+(l.documentElement.scrollLeft||l.body.scrollLeft)+"px"),o.height+o.top>s.height+s.top&&(i.style.top=s.height+s.top-o.height+(l.documentElement.scrollTop||l.body.scrollTop)+"px")}}else Ar.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ar.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(e){e?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(e){var t=this._linkFlowInterval;this._linkFlowInterval=e,this.firePropertyChange("linkFlowInterval",t,e),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getTopDiv:function(){return this._topDiv},getAttachmentDiv:function(){return this._attachmentDiv},getLayersDiv:function(){return this._layersDiv},getBottomDiv:function(){return this._bottomDiv},validateImpl:function(){lr.twm(this);if(!this.__lics__)return;var e=0,t=null,n=null,r=null,i=this._invalidateElementVisibility;this._invalidateElementVisibility&&(this._invalidateElementVisibility=!1,this._removeElementUIOnInvisible&&(this._invalidateElementIndex=!0),this.forEachElementUI(function(i){i.validate();var s=i.getElement();i.setVisible(this.isVisible(s));if(this._removeElementUIOnInvisible){t=this.getLayerDivByElement(s);if(i.isVisible()){if(i.getView().parentNode!==t){t.appendChild(i.getView()),n=i.getAttachments();for(e=0;e<n.size();e++)r=n.get(e),r.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(r.getView())}}else if(i.getView().parentNode===t){t.removeChild(i.getView()),n=i.getAttachments();for(e=0;e<n.size();e++)r=n.get(e),r.isShowInAttachmentDiv()&&this._attachmentDiv.removeChild(r.getView())}}else if(!i.getView().parentNode){t=this.getLayerDivByElement(s),t.appendChild(i.getView()),n=i.getAttachments();for(e=0;e<n.size();e++)r=n.get(e),r.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(r.getView())}},null,this));if(this._invalidateElementIndex){this._invalidateElementIndex=!1;var s,o=this;this._box.getLayerBox().forEachByDepthFirst(function(e){var t=o._layerMap[e.getId()],n;o._box.forEachByLayer(function(e){var r=o._elementUIMap[e.getId()];if(r&&r.getView().parentNode===t){n=b.insertAfter(r.getView(),n);var i=r.getAttachments();for(var u=0;u<i.size();u++){var a=i.get(u);a.getView().parentNode===o._attachmentDiv&&(s=b.insertAfter(a.getView(),s))}}},e)})}if(i&&!this._invalidateElementVisibility){var u;for(var a in this._elementUIMap){var f=this._elementUIMap[a];f.isVisible()&&(u=m.unionRect(u,f.getViewRect()))}u?u={x:0,y:0,width:u.x+u.width,height:u.y+u.height}:u={x:0,y:0,width:0,height:0};if(u.x!==this._viewRect.x||u.y!==this._viewRect.y||u.width!==this._viewRect.width||u.height!==this._viewRect.height){var l=this._viewRect;this._viewRect=u,this._rootDiv.style.left="0px",this._rootDiv.style.top="0px",this._rootDiv.style.width=u.width+"px",this._rootDiv.style.height=u.height+"px",this.firePropertyChange("viewRect",l,u)}}},setInteractions:function(e){var t=this._interactions;t&&t.forEach(function(e){e.tearDown()}),this._interactions=e,e&&e.forEach(function(e){e.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",t,e)},getInteractions:function(){return this._interactions},upSubNetwork:function(e,t){this._currentSubNetwork&&this.setCurrentSubNetwork(xr.getSubNetwork(this._currentSubNetwork),e,t)},sendToTop:function(e){if(!this.isVisible(e))return;var t=e;while(this.isVisible(t.getParent())){t=t.getParent();if(!t)break}t!==e&&this._box.adjustElementIndex(t),this._box.adjustElementIndex(e)},invalidateElementIndex:function(){this._invalidateElementIndex||(this._invalidateElementIndex=!0,this.invalidate())},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},updateLayers:function(){b.clear(this._layersDiv),b.clear(this._attachmentDiv),this._layerMap={},this._layerList.clear();var e=this;this._box.getLayerBox().forEachByDepthFirst(function(t){var n=b.createDiv();b.setVisible(n,t.isVisible()),e._layerMap[t.getId()]=n,e._layersDiv.appendChild(n),e._layerList.add(t)}),this._box.forEach(this.createElementUI,this)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(e,t,r){var i=n.animate.AnimateManager;i.endAnimate();if(t){if(this._currentSubNetwork===e)return;if(e&&!this._box.contains(e))throw e+" is not contained in this network's elementBox";i.start(new n.animate.AnimateSubNetwork(this,e,r))}else this._setCurrentSubNetwork(e),r&&r()},_setCurrentSubNetwork:function(e){if(this._currentSubNetwork===e)return;if(e&&!this._box.contains(e))throw e+" is not contained in this network's elementBox";var t=this._currentSubNetwork;this._currentSubNetwork=e,this.firePropertyChange("currentSubNetwork",t,e),this.invalidateElementVisibility()},isVisible:function(e){if(!this._box.contains(e))return!1;if(!e.isVisible())return!1;if(this._visibleFunction&&!this._visibleFunction(e))return!1;if(!this._box.getLayerBox().getLayerByElement(e).isVisible())return!1;if(xr.getSubNetwork(e)!==this._currentSubNetwork)return!1;if(e instanceof n.Link){if(!this.isNoAgentLinkVisible()){if(!e.getFromAgent()||!e.getToAgent())return!1;if(!this.isVisible(e.getFromAgent())||!this.isVisible(e.getToAgent()))return!1}if(e.getBundleIndex()>0&&e.getBundleCount()>1&&!e.getStyle("link.bundle.expanded"))return!1}else{var t=e.getParent();while(t&&!t.ISubNetwork){if(t instanceof ns)if(!t.isExpanded()||!this.isVisible(t))return!1;t=t.getParent()}}return e.IDummy?!1:!0},isMovable:function(e){return this._box.contains(e)?e instanceof n.Link?!1:this._movableFunction&&!this._movableFunction(e)?!1:this._box.getLayerBox().getLayerByElement(e).isMovable():!1},isEditable:function(e){return this._box.contains(e)?this._editableFunction&&!this._editableFunction(e)?!1:this._box.getLayerBox().getLayerByElement(e).isEditable():!1},isRotatable:function(e){return this._rotatableFunction&&!this._rotatableFunction(e)?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(e){var t=this._visibleFunction;this._visibleFunction=e,this.firePropertyChange("visibleFunction",t,e),this.invalidateElementVisibility()},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(e){var t=this._editableFunction;this._editableFunction=e,this.firePropertyChange("editableFunction",t,e),this.invalidateSelectedElementUIs(!0)},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(e){var t=this._rotatableFunction;this._rotatableFunction=e,this.firePropertyChange("rotatableFunction",t,e),this.invalidateSelectedElementUIs(!0)},isLinkable:function(e){return this._linkableFunction==null||this._linkableFunction(e)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(e){var t=this._linkableFunction;this._linkableFunction=e,this.firePropertyChange("linkableFunction",t,e),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getElementBox:function(){return this._box},setElementBox:function(e){if(!e)throw"ElementBox can not be null";if(this._box===e)return;var t=this._box;t&&(t.removeDataBoxChangeListener(this.handleElementBoxChange,this),t.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),t.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),t.removeIndexChangeListener(this.handleIndexChange,this),t.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),t.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),t.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||t.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=e,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new n.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(e):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this.updateLayers(),this.invalidateElementVisibility(),this.firePropertyChange("elementBox",t,this._box)},invalidateElementUI:function(e,t){var n=this.getElementUI(e);n&&n.invalidate(t)},invalidateElementUIs:function(e){for(var t in this._elementUIMap){var n=this._elementUIMap[t];n.invalidate(e)}},invalidateSelectedElementUIs:function(e){this.getSelectionModel().getSelection().forEach(function(t){this.invalidateElementUI(t,e)},this)},getElementUI:function(e){return e?this._elementUIMap[e.getId()]:null},getLayerDivByElement:function(e){var t=this._box.getLayerBox().getLayerByElement(e);return t?this._layerMap[t.getId()]:null},createElementUI:function(e){var t=this._elementUIMap[e.getId()];t||(t=this._elementUIFunction(this,e),t&&(this._elementUIMap[e.getId()]=t));if(t){var n=this.getLayerDivByElement(e);t.getView().parentNode!==n&&(n.appendChild(t.getView()),t.getAttachments().forEach(function(e){e.isShowInAttachmentDiv()&&e.getView().parentNode!==this._attachmentDiv&&this._attachmentDiv.appendChild(e.getView())},this)),this.invalidateElementIndex()}},invalidateBundleLink:function(e){if(e instanceof n.Link&&e._bundleLinks){var t=this._elementUIMap;e._bundleLinks.forEachSiblingLink(function(n){if(n!==e){var r=t[n._id];r&&r.invalidate
(!1)}},this)}},handleLayerBoxChange:function(e){this.updateLayers(),this.invalidateElementVisibility()},handleLayerPropertyChange:function(e){var t=e.source;if(e.property==="visible"){var n=this._layerMap[t.getId()];b.setVisible(n,t.isVisible())}else e.property==="editable"&&this.invalidateSelectedElementUIs(!0);this.invalidateElementVisibility()},handleLayerHierarchyChange:function(e){var t=0,n;this._layerList.clear(),this._box.getLayerBox().forEachByDepthFirst(function(e){var t=this._layerMap[e.getId()];n=b.insertAfter(t,n),this._layerList.add(e)},null,this),this.invalidateElementVisibility()},handleSelectionChange:function(e){e.datas.forEach(function(t){var n=this.getElementUI(t);n&&n.handleSelectionChange(e)},this),this.invalidateElementVisibility();var t=this.getSelectionModel().getLastData();t&&(e.kind==="append"||e.kind==="set")&&(this.isMakeVisibleOnSelected()&&this.makeVisible(t),this.isSendToTopOnSelected()&&this.sendToTop(t))},makeVisible:function(e){var t=this.getElementUI(e);if(!t)return;var n=xr.getSubNetwork(e);if(n!==this._currentSubNetwork){var i=this;this.setCurrentSubNetwork(n,this.isSubNetworkAnimate(),function(){r.callLater(i.makeVisible,i,[e])});return}var s=e;while((s=s.getParent())&&s!==n)s instanceof ns&&s.setExpanded(!0);var o=t.getUnionBodyBounds();if(!o)return;var u={x:this._view.scrollLeft/this._zoom,y:this._view.scrollTop/this._zoom,width:this._view.clientWidth/this._zoom,height:this._view.clientHeight/this._zoom};m.intersects(u,o)||this.isVisible(e)&&r.callLater(this.centerByLogicalPoint,this,[o.x+o.width/2,o.y+o.height/2])},handleElementBoxChange:function(e){var t=e.data;if(e.kind==="add")this.createElementUI(t),this.invalidateBundleLink(t);else if(e.kind==="remove"){var n=this.getElementUI(t);if(n){var r=this._box.getLayerBox().getLayerByElement(t),i=this._layerMap[r.getId()];n.getView().parentNode===i&&i.removeChild(n.getView()),n.dispose(),delete this._elementUIMap[t.getId()]}t===this._currentSubNetwork&&this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null)}else e.kind==="clear"&&(this.forEachElementUI(function(e){e.dispose()}),this._elementUIMap={},this.updateLayers(),this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility()},handleElementPropertyChange:function(e){var t=e.source,n=this.getElementUI(t);if(n){n.handlePropertyChange(e);if(e.property==="layerId"){var r=this._box.getLayerBox().getLayerByElement(t),i=this._layerMap[r.getId()];n.getView().parentNode!==i&&(i.appendChild(n.getView()),this.invalidateElementIndex())}}this.invalidateBundleLink(t),this.invalidateElementVisibility()},handleElementBoxPropertyChange:function(e){this.invalidateElementVisibility()},handleIndexChange:function(e){this.invalidateElementIndex()},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(e){if(!e)throw"ElementUIFunction can not be null";if(this._elementUIFunction===e)return;var t=this._elementUIFunction;this._elementUIFunction=e,this.firePropertyChange("elementUIFunction",t,e),this._box.isEmpty()||this.updateLayers()},getIconsNames:function(e){return e.getStyle("icons.names")},getIconsColors:function(e){return e.getStyle("icons.colors")},getLinkHandlerLabel:function(e){return e.isBundleAgent()?"+("+e.getBundleCount()+")":null},getSelectColor:function(e){return e.getStyle("select.color")},getShadowColor:function(e){var t=e.getStyle("shadow.color");return!t&&this.isSelected(e)&&e.getStyle("select.style")==="shadow"?e.getStyle("select.color"):t},getAlarmLabel:function(e){var t=e.getAlarmState().getHighestNewAlarmSeverity();if(t){var n=e.getAlarmState().getNewAlarmCount(t)+t.nickName;return e.getAlarmState().hasLessSevereNewAlarms()&&(n+="+"),n}return null},isRemoveElementUIOnInvisible:function(){return this._removeElementUIOnInvisible},setRemoveElementUIOnInvisible:function(e){var t=this._removeElementUIOnInvisible;this._removeElementUIOnInvisible=e,this.firePropertyChange("removeElementUIOnInvisible",t,e),this.invalidateElementVisibility()},setDefaultInteractions:function(e,t){var r=[new n.network.interaction.SelectInteraction(this),new n.network.interaction.MoveInteraction(this,e),new n.network.interaction.DefaultInteraction(this)];t&&r.push(new n.network.interaction.MoveLinkInteraction(this,e)),this.setInteractions(r)},setPanInteractions:function(){this.setInteractions([new n.network.interaction.PanInteraction(this),new n.network.interaction.DefaultInteraction(this)])},setEditInteractions:function(e,t){var r=[new n.network.interaction.SelectInteraction(this),new n.network.interaction.EditInteraction(this,e),new n.network.interaction.MoveInteraction(this,e),new n.network.interaction.DefaultInteraction(this)];t&&r.push(new n.network.interaction.MoveLinkInteraction(this,e)),this.setInteractions(r)},setCreateElementInteractions:function(e){this.setInteractions([new n.network.interaction.CreateElementInteraction(this,e),new n.network.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(e){this.setInteractions([new n.network.interaction.CreateLinkInteraction(this,e),new n.network.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(e){this.setInteractions([new n.network.interaction.CreateShapeLinkInteraction(this,e),new n.network.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(e){this.setInteractions([new n.network.interaction.CreateShapeNodeInteraction(this,e),new n.network.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){var e=[new n.network.interaction.SelectInteraction(this),new n.network.interaction.MoveInteraction(this,!1),new n.network.interaction.DefaultInteraction(this),new n.network.interaction.TouchInteraction(this)];this.setInteractions(e)},setMSTouchInteractions:function(){this.setInteractions([new n.network.interaction.MSTouchInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new n.network.interaction.SelectInteraction(this),new n.network.interaction.MoveInteraction(this),new n.network.interaction.DefaultInteraction(this),new n.network.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(e){var t=this._hasEditInteraction;this._hasEditInteraction=e,this.firePropertyChange("hasEditInteraction",t,e)},moveSelectedElements:function(e,t,r,i){if(e===0&&t===0)return;var s=this.getMovableSelectedElementsRect();if(s==null)return;this._limitElementInPositiveLocation&&(s.x+e<0&&(e=-s.x),s.y+t<0&&(t=-s.y)),n.Util.moveElements(this.getMovableSelectedElements(),e,t,r,i,this)},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(e){return this.isMovable(e)},this)},hasMovableSelectedElements:function(){var e=this.getSelectionModel().getSelection();for(var t=0;t<e.size();t++){var n=e.get(t);if(this.isMovable(n))return!0}return!1},getMovableSelectedElementsRect:function(){var e=this.getMovableSelectedElements();if(e.size()===0)return null;var t=null;for(var n=0,r=e.size();n<r;n++){var i=e.get(n);if(i instanceof es){var s=this.getElementUI(i);s&&(t=m.unionRect(t,s.getViewRect()))}}return t},getLayerByElement:function(e){return this._box.getLayerBox().getLayerByElement(e)},getPosition:function(e,t,r,i,s){var o,u=t instanceof n.network.ElementUI?t:this.getElementUI(t);if(u)if(e==="from"||e==="to"){if(u.getFromPosition){o=e==="from"?u.getFromPosition(i,s):u.getToPosition(i,s);if(o)return{x:o.x-r.width/2,y:o.y-r.height/2}}}else e==="hotspot"?o=u.getHotSpot():o=y.get(e,u.getBodyRect(),r);!o&&t.getRect&&(o=y.get(e,t.getRect(),r));if(o)return{x:o.x+i,y:o.y+s};throw"position '"+e+"' object '"+t+"'"},getViewRect:function(){return this._viewRect?r.clone(this._viewRect):{x:0,y:0,width:0,height:0}},forEachElementUI:function(e,t,n){t?this._box.forEachReverse(function(r){if(this.getLayerByElement(r)===t){var i=this.getElementUI(r);i&&(n?e.call(n,i):e(i))}},this):this._layerList.forEachReverse(function(t){this.forEachElementUI(e,t,n)},this)},findFirstElement:function(e,t){var n=this._layerList.size()-1,r=this._box.size()-1;for(var i=n;i>=0;i--){var s=this._layerList.get(i);for(var o=r;o>=0;o--){var u=this._box.getDataAt(o);if(this.getLayerByElement(u)===s)if(t){if(e.call(t,u)===!0)return u}else if(e(u)===!0)return u}}return null},getElementAt:function(e,t){arguments.length===1&&(t=!0);if(!this.isValidEvent(e))return null;e=this._getPoint(e),e||console.log("null");var n=e.x,r=e.y,i=this._selectionTolerance;if(i&&i>0){var s={x:n,y:r,width:0,height:0};m.grow(s,i,i)}return this.findFirstElement(function(e){if(t&&!this.isSelectable(e))return!1;var i=this.getElementUI(e);return i?s?!!i.intersectsTest(s):!!i.hitTest(n,r):!1},this)},_getPoint:function(e){return e?e.target?this.getLogicalPoint(e):e:null},getElementsAtRect:function(e,n,r,i){var s=new Oi;return i=i===t?!0:i,this.forEachElementUI(function(t){t.isVisible()&&(!r||r(t._element))&&(i&&this.isSelectable(t._element)||!i)&&(n?t.intersectsTest(e)&&s.add(t._element):m.contains(e,t.getViewRect())&&s.add(t._element))},null,this),s},hitTest:function(e){var t=this.getElementAt(e);if(!t)return null;var n=this.getElementUI(t);return n?(e=this._getPoint(e),n.hitTest(e.x,e.y)):null},addElementByInteraction:function(e){e.getParent()||e.setParent(this._currentSubNetwork),this._box.add(e),this.getSelectionModel().setSelection(e),this.fireInteractionEvent({kind:"createElement",element:e})},getLinkFlowStepping:function(e){var t=parseInt(e.getStyle("link.flow.stepping"));return t||(t=$i.NETWORK_LINK_FLOW_STEPPING),t},getLinkFlowOffset:function(e){var t=e.getStyle("link.flow.offset");return isNaN(t)&&(t=0),t+this.getLinkFlowStepping(e)},toCanvas:function(e,t,n){n||(n=b.createCanvas()),n.setAttribute("width",e),n.setAttribute("height",t),n._viewRect?(n._viewRect.width=e,n._viewRect.height=t):n._viewRect={x:0,y:0,width:e,height:t};var r=n.getContext("2d");r.clearRect(0,0,e,t);if(this._view.clientWidth===0||this._view.clientHeight===0)return n;var i=e/this._view.scrollWidth*this._zoom,s=t/this._view.scrollHeight*this._zoom;return r.scale(i,s),b.forEach(this._view,function(e){if((e.tagName==="CANVAS"||e.tagName==="IMG")&&!e._isIgnored){var t=e._viewRect;if(t)try{r.drawImage(e,t.x,t.y,t.width,t.height)}catch(e){}}}),n},toCanvasByRegion:function(e,t,n){n||(n=b.createCanvas());var r=e.width*t,i=e.height*t;n.setAttribute("width",r),n.setAttribute("height",i);var s=n.getContext("2d");return s.clearRect(0,0,r,i),this._view.clientWidth===0||this._view.clientHeight===0?n:(s.save(),s.scale(t,t),b.forEach(this._view,function(t){if((t.tagName==="CANVAS"||t.tagName==="IMG")&&!t._isIgnored){var n=t._viewRect;if(n&&m.intersects(n,e))try{s.drawImage(t,n.x-e.x,n.y-e.y,n.width,n.height)}catch(t){}}}),s.restore(),n)},getGroupChildrenRects:function(e){var t=new Oi;return e.getChildren().forEach(function(e){if(e instanceof es){var n=this.getElementUI(e);if(n){var r=n.getViewRect();r&&t.add(r)}}},this),t},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(e){var t=this._linkPathFunction;this._linkPathFunction=e,this.firePropertyChange("linkPathFunction",t,e),this.invalidateElementUIs()},onClickElement:function(e,t){},onClickBackground:function(e){},onDoubleClickElement:function(e,t){},onDoubleClickBackground:function(e){},onLongClickElement:function(e,t){},onLongClickBackground:function(e){},onMouseMove:function(e,t){},onMouseEnter:function(e,t){},onMouseLeave:function(e,t){},setMovingElement:function(e){if(e==this._movingElement)return;var t=this._movingElement;this._movingElement=e,this.firePropertyChange("movingElement",t,e),this._box._undoManager._enabled&&(e?this._box._undoManager.startBatch():this._box._undoManager.endBatch())},setEditingElement:function(e){if(e==this._editingElement)return;var t=this._editingElement;this._editingElement=e,this.firePropertyChange("editingElement",t,e),this._box._undoManager._enabled&&(e?this._box._undoManager.startBatch():this._box._undoManager.endBatch())},dispose:function(){n.imageUtil.removeEventListener(this.invalidateElementUIs,this)}}),n.network.Overview=function(e){n.network.Overview.superClass.constructor.apply(this,arguments),this._view=b.createView(),this._rootDiv=b.createDiv(),this._imageCanvas=b.createCanvas(),this._imageDiv=b.createDiv(),this._maskCanvas=b.createCanvas(),this._selectDiv=b.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,b.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(e),h.isTouchable?h.isMSTouchable?new n.network.OverviewMSTouchInteraction(this):(new n.network.OverviewTouchInteraction(this),new n.network.OverviewInteraction(this)):new n.network.OverviewInteraction(this)},r.ext("twaver.network.Overview",n.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:$i.OVERVIEW_FILL_COLOR,_outlineColor:$i.OVERVIEW_OUTLINE_COLOR,_outlineWidth:$i.OVERVIEW_OUTLINE_WIDTH,_selectColor:$i.OVERVIEW_SELECT_COLOR,_selectWidth:$i.OVERVIEW_SELECT_WIDTH,_padding:$i.OVERVIEW_PADDING,_animate:$i.OVERVIEW_ANIMATE,_maxPackingWidth:$i.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:$i.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(e){this._invalidateMask()},setNetwork:function(e){if(e===this._network)return;this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),b.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=e,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),b.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate()},_handleNetworkPropertyChange:function(e){(e.property==="zoom"||e.property==="currentSubNetwork"||e.property==="elementBox"||e.property==="dataBox")&&this.invalidate()},_handleNetworkViewChange:function(e){e.kind==="validateEnd"&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(e){if(!this._isNetworkDirty||!this._isMaskDirty)this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),r.callLater(this.validate,this,null,e)},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,r.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&this._network._view.clientWidth!==0&&this._network._view.clientHeight!==0){var e=this._maxPackingWidth>0&&this._maxPackingHeight>0,t;e?t={x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:t={x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},m.grow(t,-this._padding,-this._padding);var n=Math.min(t.width/this._network._view.scrollWidth,t.height/this._network._view.scrollHeight);e&&(b.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var r=this._network._view.scrollWidth*n,i=this._network._view.scrollHeight*n,s=t.x+(t.width-r)/2,o=t.y+(t.height-i)/2;if(this._isNetworkDirty){var u={x:s,y:o,width:r,height:i};this._network.toCanvas(u.width,u.height,this._imageCanvas),b.setDiv(this._imageDiv,u,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var a={x:this._network._view.scrollLeft*n,y:this._network._view.scrollTop*n,width:r*this._network._view.clientWidth/this._network._view.scrollWidth,height:i*this._network._view.clientHeight/this._network._view.scrollHeight},f=b.setCanvas(this._maskCanvas,s,o,r,i);f.lineWidth=0,f.fillStyle=this._fillColor,f.beginPath(),w.drawVector(f,"rectangle",null,s,o,r,i),f.fill(),f.clearRect(s+a.x,o+a.y,a.width,a.height);var l=this._outlineWidth<0?0:this._outlineWidth;f.lineWidth=l,f.strokeStyle=this._outlineColor,f.beginPath(),w.drawVector(f,"rectangle",null,s+a.x+l,o+a.y+l,a.width-l*2,a.height-l*2),l>=0&&f.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(e){return b.getLogicalPoint(this._view,e,1,this._rootDiv)},centerNetwork:function(e,t){var n=this._imageDiv._viewRect;m.containsPoint(n,e)&&(this._network.centerByLogicalPoint((e.x-n.x)/n.width*this._network._view.scrollWidth/this._network.getZoom(),(e.y-n.y)/n.height*this._network._view.scrollHeight/this._network.getZoom(),t),this._invalidateMask())}}),n.network.OverviewTouchInteraction=function(e){this.overview=e,this.network=e.getNetwork(),this.view=e._view,b.addEventListener("touchstart","handleTouchstart",this.view,this)},r.ext("twaver.network.OverviewTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e),this.clear(),this.endPoint=this.overview.getLogicalPoint(e),kr.isMultiTouch(e)&&(this.distance=kr.getDistance(e),this.zoom=this.network.getZoom()),b.addEventListener("touchmove","handleTouchmove",this.view,this),b.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(e){b.preventDefault(e),this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(e);if(kr.isSingleTouch(e))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var t=kr.getDistance(e)/this.distance;this.network.setZoom(this.zoom*t,!1)}},handleTouchend:function(e){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(e);var t=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;t?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),t?r.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,b.removeEventListener("touchmove",this.view,this),b.removeEventListener("touchend",this.view,this)),this.moved=!1}}),n.network.OverviewInteraction=function(e){this.overview=e,this.network=e.getNetwork(),this.view=e._view,b.addEventListener("mousedown","handleMousedown",this.view,this)},r.ext("twaver.network.OverviewInteraction",Object,{handleMousedown:function(e){if(e.button!==0)return;this.clear(),this.endPoint=this.overview.getLogicalPoint(e),r.isCtrlDown(e)&&(this.startPoint=this.endPoint,b.setVisible(this.overview._selectDiv,!0)),b.addEventListener("mousemove","handleMousemove",this.view,this),b.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(e){this.endPoint=this.overview.getLogicalPoint(e);if("detail"in e&&e.detail===2)r.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(b.isVisible(this.overview._selectDiv)&&this.startPoint){var t=this.overview._imageDiv._viewRect,n=this.overview._selectDiv._viewRect.x,i=this.overview._selectDiv._viewRect.y,s=t.width/this.overview._selectDiv._viewRect.width,o=t.height/this.overview._selectDiv._viewRect.height,u=Math.min(s,o),a=this.network._view.scrollWidth/this.network.getZoom()*((n-t.x+this.overview._selectDiv._viewRect.width/2)/t.width),f=this.network._view.scrollHeight/this.network.getZoom()*((i-t.y+this.overview._selectDiv._viewRect.height/2)/t.height);this.network.setZoom(u*Math.min(this.network._view.clientWidth/this.network._view.scrollWidth,this.network._view.clientHeight/this.network._view.scrollHeight)*this.network.getZoom(),!1),r.callLater(this.network.centerByLogicalPoint,this.network,[a,f,this.overview._animate]),b.setVisible(this.overview._selectDiv,!1),b.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(e){var t=this.overview.getLogicalPoint(e);this.endPoint=t;if(b.isVisible(this.overview._selectDiv)&&this.startPoint){var n=t.x>this.startPoint.x?this.startPoint.x:t.x,r=t.x>this.startPoint.x?this.startPoint.y:t.y;t.x>this.startPoint.x&&t.y<this.startPoint.y&&(r=t.y),t.x<this.startPoint.x&&t.y>this.startPoint.y&&(r=this.startPoint.y);var i=this.overview._imageDiv._viewRect;n<i.x&&(n=i.x),n>i.x+i.width&&(n=i.x+i.width),r<i.y&&(r=i.y),r>i.y+i.height&&(r=i.y+i.height);var s=Math.abs(t.x-this.startPoint.x),o=Math.abs(t.y-this.startPoint.y);n+s>i.x+i.width&&(s=i.x+i.width-n),r+o>i.y+i.height&&(o=i.y+i.height-r),b.setDiv(this.overview._selectDiv,{x:n,y:r,width:s,height:o},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(t,!1)},clear:function(){this.endPoint&&(this.endPoint=null,b.removeEventListener("mousemove",this.view,this),b.removeEventListener("mouseup",this.view,this))}}),n.network.OverviewMSTouchInteraction=function(e){this.overview=e,this.network=e.getNetwork(),this.view=e._view,this._pointerMap={},this._pointerIdArray=[],b.addEventListener("MSPointerDown","handleTouchstart",this.view,this),b.addEventListener("MSPointerMove","handleTouchmove",this.view,this),b.addEventListener("MSPointerUp","handleTouchend",this.view,this),b.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},r.ext("twaver.network.OverviewMSTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e),e.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[e.pointerId]&&this.overview.getLogicalPoint(e)&&(this._pointerIdArray.push(e.pointerId),this._pointerMap[e.pointerId]=e),this._pointerIdArray.length==1?(this._startTouchPoint=this.overview.getLogicalPoint(e),this._startTouchTime=new Date):this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(e){if(this._pointerIdArray.length==0||!this._pointerMap[e.pointerId]||m.getDistance({x:this._pointerMap[e.pointerId].pageX,y:this._pointerMap[e.pointerId].pageY},{x:e.pageX,y:e.pageY})<=10)return;this._pointerMap[e.pointerId]=e;if(this._pointerIdArray.length==2){var t=this._getDistance()/this._distance;this.network.setZoom(this._zoom*t,!1)}else if(this._pointerIdArray.length==1&&this._startTouchPoint){var n=this.overview.getLogicalPoint(e);if(n==null)return;this._startTouchPoint=n,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(e){var t=this.overview.getLogicalPoint(e);if(this._pointerIdArray.length==1&&t){var n=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&m.getDistance(this._endTouchPoint,t)<=10;n?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=t,this._endTouchTime=new Date),n?r.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return m.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),n.network.ElementUI=function(e,t){this._view=b.createDiv(),this._bodyView=b.createDiv(),this._view.appendChild(this._bodyView),this._network=e,this._element=t,this._attachments=new Oi,this._bodyBounds=new Oi,this.invalidate(!0)},r.ext("twaver.network.ElementUI",Object,{_invalidateFlag:!1,_invalidateAttachmentsFlag:!1,getElement:function(){return this._element},getNetwork:function(){return this._network},getAttachments:function(){return this._attachments},getStyle:function(e){return this._element.getStyle(e)},getFont:function(e){var t=this._element.getStyle(e);return t?t:$i.FONT},getDyeColor:function(e){return this._innerColor?this._innerColor:this.getStyle(e)},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},getHotSpot:function(){return this._hotSpot?r.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(e){this._hotSpot=e},getUnionBodyBounds:function(){return r.clone(this._unionBodyBounds)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),r.clone(this._bodyRect)},invalidate:function(e){e===t&&(e=!0),e&&(this._invalidateAttachmentsFlag=!0);if(this._invalidateFlag)return;this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility()},updateMeasure:function(){},validate:function(){if(!this._invalidateFlag)return;this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this._bodyBounds.clear(),b.clear(this._bodyView),this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this.updateMeasure();var e=this._element.getStyle("whole.alpha");this._view.style.opacity=e,this._attachments.forEach(function(t){t.updateMeasure();var n=t.getAlpha();t.isShowInAttachmentDiv()?t._view.style.opacity=n*e:t._view.style.opacity=n});var t;this._bodyBounds.forEach(function(e){t=m.unionRect(t,e)}),this._unionBodyBounds=r.clone(t),this._attachments.forEach(function(e){t=m.unionRect(t,e.getViewRect())}),this._viewRect=t},cleanUp:function(e){var t=e.length;for(var n=0;n<t;n++){var r=e[n],i=this[r];i&&!i.parentNode&&(this[r]=null)}},setVisible:function(e){if(this.isVisible()===e)return;b.setVisible(this._view,e),this._attachments.forEach(function(t){t.isShowInAttachmentDiv()&&b.setVisible(t._view,e)}),this.invalidate(!0)},isVisible:function(){return b.isVisible(this._view)},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var e=this._network.getLabel(this._element);e!=null&&e!==""?this._labelAttachment||(this._labelAttachment=new n.network.LabelAttachment(this,$i.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var e=this._network.getAlarmLabel(this._element);e!=null&&e!==""?this._alarmAttachment||(this._alarmAttachment=new n.network.AlarmAttachment(this,$i.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var e=this._network.getIconsNames(this._element);e&&e.length>0?this._iconsAttachment||(this._iconsAttachment=new n.network.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this.isEditable()&&this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)?this._editAttachment||(this._editAttachment=new n.network.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},isEditable:function(){return!0},handlePropertyChange:function(e){this.invalidate(!0)},handleSelectionChange:function(e){this.invalidate(!0)},dispose:function(){this._attachments.forEach(function(e){e.getView().parentNode&&e.getView().parentNode.removeChild(e.getView()),e.dispose()}),this._attachments.clear()},addAttachment:function(e){this._attachments.add(e),e.isShowInAttachmentDiv()?this._network.getAttachmentDiv().appendChild(e.getView()):this._view.appendChild(e.getView()),this.invalidate(!1)},removeAttachment:function(e){this._attachments.remove(e),e.getView().parentNode&&e.getView().parentNode.removeChild(e.getView()),e.dispose(),this.invalidate(!1)},addBodyBounds:function(e){e&&this._bodyBounds.add(e)},addComponent:function(e){this._bodyView.appendChild(e)},getBodyView:function(){return this._bodyView},getView:function(){return this._view},getViewRect:function(){return r.clone(this._viewRect)},setShadow:function(e,t,n){var r=e.isShadowable()&&this._shadowColor&&!this._editAttachment;r&&(this._shadowXOffset>0?n.width+=this._shadowXOffset:(n.x+=this._shadowXOffset,n.width+=-this._shadowXOffset),this._shadowYOffset>0?n.height+=this._shadowYOffset:(n.y+=this._shadowYOffset,n.height+=-this._shadowYOffset),m.grow(n,this._shadowBlur,this._shadowBlur));var i=b.setCanvas(t,n);return r&&(i.shadowOffsetX=this._shadowXOffset,i.shadowOffsetY=this._shadowYOffset,i.shadowBlur=this._shadowBlur,i.shadowColor=this._shadowColor),i},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&this._element.getStyle("select.style")==="shadow"?!0:!1},hit:function(e,t){return!1},hitCanvas:function(e,t,n){var r=n.length;for(var i=0;i<r;i++){var s=n[i],o=this[s];if(w.hit(o,e,t,this._network.getSelectionTolerance()))return!0}return!1},hitComponent:function(e,t,n){var r=n.length;for(var i=0;i<r;i++){var s=n[i],o=this[s];if(o&&m.containsPoint(o._viewRect,e,t))return!0}return!1},hitTest:function(e,t){if(!this.isVisible()||!m.containsPoint(this._viewRect,e,t))return null;var n,r=this._attachments.size(),i;for(n=r-1;n>=0;n--){i=this._attachments.get(n);if(i.isShowInAttachmentDiv()&&i.hit(e,t))return i}for(n=r-1;n>=0;n--){i=this._attachments.get(n);if(!i.isShowInAttachmentDiv()&&i.hit(e,t))return i}return m.containsPoint(this._unionBodyBounds,e,t)&&this.hit(e,t)?this:null},intersects:function(e){return!1},intersectsComponent:function(e,t){var n=t.length;for(var r=0;r<n;r++){var i=t[r],s=this[i];if(s&&m.intersects(s._viewRect,e))return!0}return!1},intersectsCanvas:function(e,t){var n=t.length;for(var r=0;r<n;r++){var i=t[r],s=this[i];if(w.intersects(s,e))return!0}return!1},intersectsTest:function(e){if(!this.isVisible()||!m.intersects(this._viewRect,e))return null;var t=this._attachments.size(),n,r;for(n=t-1;n>=0;n--){r=this._attachments.get(n);if(r.isShowInAttachmentDiv()&&r.intersects(e))return r}for(n=t-1;n>=0;n--){r=this._attachments.get(n);if(!r.isShowInAttachmentDiv()&&r.intersects(e))return r}return m.intersects(this._unionBodyBounds,e)&&this.intersects(e)?this:null}}),n.network.Attachment=function(e,t){this._view=b.createDiv(),this._ui=e,this._element=this._ui.getElement(),this._network=e.getNetwork(),this._isShowInAttachmentDiv=t===!0,this._isShowInAttachmentDiv&&b.setVisible(this._view,e.isVisible())},r.ext("twaver.network.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},getStyle:function(e){return this._ui.getStyle(e)},getFont:function(e){return this._ui.getFont(e)},isShowInAttachmentDiv:function(){return this._isShowInAttachmentDiv},getView:function(){return this._view},getViewRect:function(){return r.clone(this._viewRect)},getAlpha:function(){return 1},updateMeasure:function(){},dispose:function(){},hit:function(e,t){return m.containsPoint(this._viewRect,e,t)},intersects:function(e){return m.intersects(this._viewRect,e)}}),n.network.BasicAttachment=function(e,t){n.network.BasicAttachment.superClass.constructor.call(this,e,t),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._attachmentCanvas=b.createCanvas(),this._view.insertBefore(this._attachmentCanvas,this._view.firstChild)},r.ext("twaver.network.BasicAttachment",n.network.Attachment,{calculateMeasure:function(){var e=this.getContentWidth(),t=this.getContentHeight(),n=this.getCornerRadius(),r=this.getPointerLength(),i=this.getPointerWidth(),s=this.getPosition(),o=this.getXOffset(),u=this.getYOffset(),a=this._roundRect;a.width=e+n*2,a.height=t;var f
;if(r>0){var l=this.getDirection();f=this._network.getPosition(s,this._ui,null,o,u);var c;if(l==="aboveleft")a.y=f.y-r-a.height,a.x=f.x-(a.width-n),c=Math.max(f.x-i,a.x+n/2),this._pointers=[f,{x:f.x,y:f.y-r},{x:c,y:f.y-r}];else if(l==="aboveright")a.y=f.y-r-a.height,a.x=f.x-n,c=Math.min(f.x+i,a.x+a.width-n/2),this._pointers=[f,{x:f.x,y:f.y-r},{x:c,y:f.y-r}];else if(l==="belowleft")a.y=f.y+r,a.x=f.x-(a.width-n),c=Math.max(f.x-i,a.x+n/2),this._pointers=[f,{x:f.x,y:f.y+r},{x:c,y:f.y+r}];else if(l==="belowright")a.y=f.y+r,a.x=f.x-n,c=Math.min(f.x+i,a.x+a.width-n/2),this._pointers=[f,{x:f.x,y:f.y+r},{x:c,y:f.y+r}];else if(l==="leftabove")a.y=f.y+n-a.height,a.x=f.x-r-a.width,c=Math.max(f.y-i,a.y+n/2),this._pointers=[f,{x:f.x-r,y:f.y},{x:f.x-r,y:c}];else if(l==="leftbelow")a.y=f.y-n,a.x=f.x-r-a.width,c=Math.min(f.y+i,a.y+a.height-n/2),this._pointers=[f,{x:f.x-r,y:f.y},{x:f.x-r,y:c}];else if(l==="rightabove")a.y=f.y+n-a.height,a.x=f.x+r,c=Math.max(f.y-i,a.y+n/2),this._pointers=[f,{x:f.x+r,y:f.y},{x:f.x+r,y:c}];else if(l==="rightbelow")a.y=f.y-n,a.x=f.x+r,c=Math.min(f.y+i,a.y+a.height-n/2),this._pointers=[f,{x:f.x+r,y:f.y},{x:f.x+r,y:c}];else if(l==="above")a.y=f.y-r-a.height,a.x=f.x-a.width/2,c=Math.min(e/2,i/2),this._pointers=[f,{x:f.x-c,y:f.y-r},{x:f.x+c,y:f.y-r}];else if(l==="below")a.y=f.y+r,a.x=f.x-a.width/2,c=Math.min(e/2,i/2),this._pointers=[f,{x:f.x-c,y:f.y+r},{x:f.x+c,y:f.y+r}];else if(l==="left")a.y=f.y-a.height/2,a.x=f.x-r-a.width,c=Math.min(t/2,i/2),this._pointers=[f,{x:f.x-r,y:f.y+c},{x:f.x-r,y:f.y-c}];else{if(l!=="right")throw"Can not resolve '"+l+"' attachment direction";a.y=f.y-a.height/2,a.x=f.x+r,c=Math.min(t/2,i/2),this._pointers=[f,{x:f.x+r,y:f.y+c},{x:f.x+r,y:f.y-c}]}}else f=this._network.getPosition(s,this._ui,{width:a.width,height:a.height},o,u),a.x=f.x,a.y=f.y,this._pointers=null;this._contentRect.x=a.x+(a.width-e)/2,this._contentRect.y=a.y+(a.height-t)/2,this._contentRect.width=e,this._contentRect.height=t;var h=this.getPadding();h!=0&&m.grow(a,h,h),h=this.getPaddingLeft(),h!=0&&(a.x-=h,a.width+=h),h=this.getPaddingRight(),h!=0&&(a.width+=h),h=this.getPaddingTop(),h!=0&&(a.y-=h,a.height+=h),h=this.getPaddingBottom(),h!=0&&(a.height+=h),a.width<0&&(a.width=a.width,a.x-=a.width),a.height<0&&(a.height=-a.height,a.y-=a.height)},updateMeasure:function(){n.network.BasicAttachment.superClass.updateMeasure.call(this),this.calculateMeasure();var e=this.isFill(),t=this.getOutlineWidth();this._viewRect=m.getRect(this._pointers),this._viewRect=m.unionRect(this._viewRect,this._roundRect),t>0&&m.grow(this._viewRect,t/2,t/2);var r=this._ui.setShadow(this,this._attachmentCanvas,this._viewRect);if(t>0||e){r.beginPath(),w.drawRoundRect(r,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(r.moveTo(this._pointers[0].x,this._pointers[0].y),r.lineTo(this._pointers[1].x,this._pointers[1].y),r.lineTo(this._pointers[2].x,this._pointers[2].y)),r.closePath(),t>0&&(r.lineWidth=t,r.strokeStyle=this.getOutlineColor(),r.lineCap=this.getCap(),r.lineJoin=this.getJoin(),r.stroke());if(e){var i=this.getFillColor(),s=this.getGradient();s?w.fill(r,i,s,this.getGradientColor(),this._viewRect):r.fillStyle=i,r.fill()}}return r},getRoundRect:function(){return r.clone(this._roundRect)},getContentRect:function(){return r.clone(this._contentRect)},getContent:function(){return this._content},setContent:function(e){if(this._content===e)return;this._content&&this._view.removeChild(this._content),this._content=e,e&&this._view.appendChild(e)},getContentWidth:function(){return $i.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return $i.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return $i.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return $i.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return $i.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return $i.ATTACHMENT_POSITION},getXOffset:function(){return $i.ATTACHMENT_XOFFSET},getYOffset:function(){return $i.ATTACHMENT_YOFFSET},getPadding:function(){return $i.ATTACHMENT_PADDING},getPaddingLeft:function(){return $i.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return $i.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return $i.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return $i.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return $i.ATTACHMENT_DIRECTION},isFill:function(){return $i.ATTACHMENT_FILL},getFillColor:function(){return $i.ATTACHMENT_FILL_COLOR},getGradient:function(){return $i.ATTACHMENT_GRADIENT},getGradientColor:function(){return $i.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return $i.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return $i.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return $i.ATTACHMENT_CAP},getJoin:function(){return $i.ATTACHMENT_JOIN},isShadowable:function(){return $i.ATTACHMENT_SHADOWABLE},hit:function(e,t){return m.containsPoint(this._viewRect,e,t)?m.containsPoint(this._contentRect,e,t)?!0:w.hit(this._attachmentCanvas,e,t):!1},intersects:function(e){return m.intersects(this._viewRect,e)?m.intersects(this._contentRect,e)?!0:w.intersects(this._attachmentCanvas,e):!1}}),n.network.LabelAttachment=function(e,t){n.network.LabelAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.network.LabelAttachment",n.network.BasicAttachment,{updateMeasure:function(){var e=this.getFont("label.font"),t,i=this.getLabel(),s=r.g.getTextSize(e,i),o=this.getMaxLength();o!==0&&s.width>o?(t=r.g.getCollapseTextInLength(e,i,o),this._textSize=r.g.getTextSize(e,t)):(t=i,this._textSize=s);var u=n.network.LabelAttachment.superClass.updateMeasure.call(this),a=this._element.getStyle("label.align");w.drawText(u,t,this._contentRect,e,this.getStyle("label.color"),a)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),n.network.AlarmAttachment=function(e,t){n.network.AlarmAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.network.AlarmAttachment",n.network.BasicAttachment,{updateMeasure:function(){var e=this.getFont("alarm.font"),t=this._network.getAlarmLabel(this._element);this._textSize=w.getTextSize(e,t),this._fillColor=this._network.getAlarmFillColor(this._element);var r=n.network.AlarmAttachment.superClass.updateMeasure.call(this);w.drawText(r,t,this._contentRect,e,this.getStyle("alarm.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return this._fillColor!=null},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),n.network.LinkHandlerAttachment=function(e,t){n.network.LinkHandlerAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.network.LinkHandlerAttachment",n.network.BasicAttachment,{updateMeasure:function(){var e=this.getFont("link.handler.font"),t=this._network.getLinkHandlerLabel(this._element);this._textSize=w.getTextSize(e,t);var r=n.network.LabelAttachment.superClass.updateMeasure.call(this);w.drawText(r,t,this._contentRect,e,this.getStyle("link.handler.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),n.network.EditAttachment=function(e,t){n.network.EditAttachment.superClass.constructor.call(this,e,t),this._attachmentDiv=b.createDiv(),this._view.appendChild(this._attachmentDiv)},r.ext("twaver.network.EditAttachment",n.network.Attachment,{updateMeasure:function(){n.network.EditAttachment.superClass.updateMeasure.call(this),this._viewRect=null,this._element instanceof es&&this._addResizingPoint(this._element),this._network.isRotatable(this._element)&&this._element instanceof es&&!(this._element instanceof n.ShapeNode)&&!(this._element instanceof n.Grid)&&!(this._element instanceof n.Group)&&this._addRotatePoint(this._element),this._element instanceof n.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof n.network.ShapeLinkUI&&this._addShapeLinkPoints(this._ui),this._ui instanceof n.network.LinkUI&&this._addLinkControlPoint(this._ui)},_addRotatePoint:function(e){var t=this._network.getRotatePointSize();if(t<=0)return;var n=e.getOriginalRect();if(!this._rotateDiv){var r=b.createDiv();this._attachmentDiv.appendChild(r),this._rotateDiv=r}var i=this._network.getRotatePointOutlineWidth(),s=this._network.getRotatePointOutlineColor(),o=this._network.getRotatePointFillColor(),t=this._network.getRotatePointSize(),u=t+i,a=t*2,f={x:n.x+n.width/2-t,y:n.y-this._network.getRotatePointOffset()-a,width:a,height:a},l;e.angle==0?l=f:l=this._getRotateRect(f,e.getAngle(),{x:n.x+n.width/2,y:n.y+n.height/2});var c=m.unionRect(e.getRect(),l);this._viewRect=m.unionRect(c,this._viewRect),b.setDiv(this._rotateDiv,f,o,i,s),this._rotateDiv._viewRect=l,b.setBorderRaidus(this._rotateDiv,a+"px"),this._rotateAttachments(this._rotateDiv,a/2,i)},_addResizingPoint:function(e){var t=this._network.getResizePointSize();if(t<=0)return;var n=e.getOriginalRect(),r=new Oi([{x:n.x,y:n.y},{x:n.x+n.width/2,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x,y:n.y+n.height/2},{x:n.x+n.width,y:n.y+n.height/2},{x:n.x,y:n.y+n.height},{x:n.x+n.width/2,y:n.y+n.height},{x:n.x+n.width,y:n.y+n.height}]);if(!this._resizeDivs){this._resizeDivs=new Array;for(var i=0;i<8;i++){var s=b.createDiv();this._attachmentDiv.appendChild(s),this._resizeDivs[i]=s}}if(this._resizeDivs){this._resizeRects=new Array;for(var i=0;i<8;i++){var o=r.get(i),u={x:o.x-t,y:o.y-t,width:t*2,height:t*2},a;e.getAngle()==0?a=u:a=this._getRotateRect(u,e.getAngle(),{x:n.x+n.width/2,y:n.y+n.height/2}),this._resizeRects[i]=a}}var f=this._network.getResizePointOutlineWidth(),l=this._network.getResizePointOutlineColor(),c=this._network.getResizePointFillColor();this._addPoints(e.getRect(),r,f,l,c,!0)},_addPoints:function(e,t,n,r,i,s){var o=s?this._network.getResizePointSize():this._network.getEditPointSize();if(o<=0)return;var u=o+n;m.grow(e,u,u),this._viewRect=m.unionRect(e,this._viewRect);var a=o*2,f=new Oi,l,c,h,p;for(l=0,c=t.size();l<c;l++)h=t.get(l),p={x:h.x-o,y:h.y-o,width:a,height:a},f.add(p);var d;if(s)d=this._resizeDivs;else{this._controlDivs||(this._controlDivs=new Array);if(this._controlDivs.length<c)for(l=this._controlDivs.length;l<c;l++){var v=b.createDiv();this._attachmentDiv.appendChild(v),this._controlDivs[l]=v}else if(this._controlDivs.length>c){for(l=c;l<this._controlDivs.length;l++)this._attachmentDiv.removeChild(this._controlDivs[l]);this._controlDivs.splice(c)}d=this._controlDivs}for(l=0,c=f.size();l<c;l++)p=f.get(l),b.setDiv(d[l],p,i,n,r),b.setBorderRaidus(d[l],(s?"0":a)+"px"),this._rotateAttachments(d[l],a/2,n,t.get(l))},_rotateAttachments:function(e,t,n,r){if(this._element instanceof es){var i=this._element.getAngle();if(i==0)return;var s=this._element.getOriginalRect(),o=e.style.left.split("px")[0],u=e.style.top.split("px")[0],a=s.x+s.width/2,f=s.y+s.height/2;r||(r={x:parseFloat(o)+t+n,y:parseFloat(u)+t+n});var l=m.createMatrix(i*Math.PI/180,s.x+s.width/2,s.y+s.height/2),c=l.transform(r);e.style.webkitTransform="rotate("+i+"deg)",e.style.mozTransform="rotate("+i+"deg)",e.style.OTransform="rotate("+i+"deg)",e.style.msTransform="rotate("+i+"deg)",e.style.transform="rotate("+i+"deg)",e.style.left=c.x-t-n+"px",e.style.top=c.y-t-n+"px"}},_addShapeLinkPoints:function(e){this._addEditPoints(e._element.getPoints())},_addShapeNodePoint:function(e){this._addEditPoints(e.getPoints())},_addLinkControlPoint:function(e){if(Nr.isOrthogonalLink(e._element)){var t=e.getControlPoint();if(t){var n=new Oi;n.add(t),this._addEditPoints(n)}}},_addEditPoints:function(e){var t=m.getRect(e);if(!t)return;var n=this._network.getEditPointOutlineWidth(),r=this._network.getEditPointOutlineColor(),i=this._network.getEditPointFillColor();this._addPoints(t,e,n,r,i,!1)},hit:function(e,t){if(!m.containsPoint(this._viewRect,e,t))return!1;var n;if(this._resizeDivs)for(n=this._resizeDivs.length-1;n>=0;n--)if(m.containsPoint(this._resizeRects[n],e,t))return!0;if(this._rotateDiv&&m.containsPoint(this._rotateDiv._viewRect,e,t))return!0;if(this._controlDivs)for(n=this._controlDivs.length-1;n>=0;n--)if(m.containsPoint(this._controlDivs[n]._viewRect,e,t))return!0;return!1},intersects:function(e){if(!m.intersects(this._viewRect,e))return!1;var t;if(this._resizeDivs)for(t=this._resizeDivs.length-1;t>=0;t--)if(m.intersects(this._resizeRects[t],e))return!0;if(this._rotateDiv&&m.containsPoint(this._rotateDiv._viewRect,e))return!0;if(this._controlDivs)for(t=this._controlDivs.length-1;t>=0;t--)if(m.intersects(this._controlDivs[t]._viewRect,e))return!0;return m.intersects(this._viewRect,e)?!1:!1},_getRotateRect:function(e,t,r){var i=m.createMatrix(t*Math.PI/180,r.x,r.y),s={x:e.x+e.width/2,y:e.y+e.height/2},o=i.transform(s),u=new n.List([{x:o.x-e.width/2,y:o.y-e.height/2},{x:o.x+e.width/2,y:o.y-e.height/2},{x:o.x+e.width/2,y:o.y+e.height/2},{x:o.x-e.width/2,y:o.y+e.height/2}]);return m.getRect(u)}}),n.network.IconsAttachment=function(e,t){n.network.IconsAttachment.superClass.constructor.call(this,e,t),this._iconsCanvas=null},r.ext("twaver.network.IconsAttachment",n.network.Attachment,{isShadowable:function(){return $i.ATTACHMENT_SHADOWABLE},updateMeasure:function(){n.network.IconsAttachment.superClass.updateMeasure.call(this);var e=this._network.getIconsNames(this._element);if(!e||e.length==0)return;var t=this._network.getIconsColors(this._element),i=this._element.getStyle("icons.orientation"),s=this._element.getStyle("icons.position"),o=this._element.getStyle("icons.xoffset");o=o instanceof Array?o[0]:o;var u=this._element.getStyle("icons.yoffset");u=u instanceof Array?u[0]:u;var a=this._element.getStyle("icons.xgap");a=a instanceof Array?a[0]:a;var f=this._element.getStyle("icons.ygap");f=f instanceof Array?f[0]:f;var l=this._getIconsSize(e,i,a,f);if(!l)return;var c=this._network.getPosition(s,this._ui,l,o,u);this._viewRect={x:c.x,y:c.y,width:l.width,height:l.height},i==="top"?c.y+=l.height:i==="left"&&(c.x+=l.width),this._iconsCanvas||(this._iconsCanvas=b.createCanvas(),this._view.appendChild(this._iconsCanvas));var h=this._ui.setShadow(this,this._iconsCanvas,r.clone(this._viewRect)),p=c.x,d=c.y,v=0;for(var m in e){var g=null,y=null;t&&t.length>v&&(y=t[v++]);var w=r.getImageAsset(e[m]);if(w==null)continue;if(i==="right")g={x:p,y:d,width:w.getWidth(),height:w.getHeight()},p+=g.width+a;else if(i==="left")g={x:p-w.getWidth(),y:d,width:w.getWidth(),height:w.getHeight()},p-=g.width+a;else if(i==="top")g={x:p,y:d-w.getHeight(),width:w.getWidth(),height:w.getHeight()},d-=g.height+f;else{if(i!=="bottom")throw"Can not resolve '"+i+"' orientation";g={x:p,y:d,width:w.getWidth(),height:w.getHeight()},d+=g.height+f}Rr(h,w.getImage(y,g.width,g.height),y,g,this._element,this._network)}},_getIconsSize:function(e,t,n,i){var s=0,o=0,u=null,a=null,f=null;for(var l in e){a=r.getImageAsset(e[l]);if(!a)continue;if(t==="right")u={x:s,y:o,width:a.getWidth(),height:a.getHeight()},s+=u.width+n;else if(t==="left")u={x:s-a.getWidth(),y:o,width:a.getWidth(),height:a.getHeight()},s-=u.width+n;else if(t==="top")u={x:s,y:o-a.getHeight(),width:a.getWidth(),height:a.getHeight()},o-=u.height+i;else{if(t!=="bottom")throw"Can not resolve '"+t+"' orientation";u={x:s,y:o,width:a.getWidth(),height:a.getHeight()},o+=u.height+i}f==null?f=r.clone(u):f=m.unionRect(f,u)}return f?{width:Math.abs(f.width),height:Math.abs(f.height)}:null}}),n.network.HTMLBasicAttachment=function(e,t){function i(e,t,r,i,s,o,u){r||(r=this._origin.x),i||(i=this._origin.y),s||(s=this._location.x),o||(o=this._location.y),e=e-r-s,t=t-i-o;var a=n.Util.transformPoint({x:r+s,y:i+o},u?this._radian:-this._radian,e,t).point;return a}n.network.HTMLBasicAttachment.superClass.constructor.call(this,e,t),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._triangleDiv=n.Util.createDiv(),this._roundDiv=n.Util.createDiv(),this._contentDiv=n.Util.createDiv(),n.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),n.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var r=this;this.hit=function(e,t){if(this._radian&&this._origin){var s=i.call(r,e,t);e=s.x,t=s.y}return n.Util.containsPoint(this._roundRect,e,t)||n.Util.containsPoint(this._pointerRect,e,t)},this.intersects=function(e){var t={x:e.x,y:e.y},s={x:e.x+e.width,y:e.y},o={x:e.x,y:e.y+e.height},u={x:e.x+e.width,y:e.y+e.height};if(this._radian&&this._origin){if(e.width*e.height>50)return!1;t=i.call(r,t.x,t.y),s=i.call(r,s.x,s.y),o=i.call(r,o.x,o.y),u=i.call(r,u.x,u.y)}return e=n.Util.getRect([t,s,o,u]),n.Util.intersects(this._roundRect,e)||n.Util.intersects(this._pointerRect,e)},this.getContentWidth=function(){return this._contentDiv.scrollWidth||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},this.getContentHeight=function(){return this._contentDiv.scrollHeight||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},this._view.appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},n.Util.ext("twaver.network.HTMLBasicAttachment",n.network.BasicAttachment,{calculateMeasure:function(){var e=this.getContentWidth(),t=this.getContentHeight(),n=Math.min(this.getCornerRadius(),t/2),r=this.getPointerLength(),i=this.getPointerWidth(),s=this.getPosition(),o=this.getXOffset(),u=this.getYOffset();this._contentRect.width=e,this._contentRect.height=t,this._contentRect.x=n;var a=this._roundRect;a.width=e+n*2,a.height=t;var f;if(r>0){var l=this.getDirection();f=this._network.getPosition(s,this._ui,null,o,u);var c;if(l==="aboveleft"){a.y=f.y-r-a.height,a.x=f.x-(a.width-n),this._pointers=[f,{x:f.x,y:f.y-r},{x:f.x-Math.min(i,e),y:f.y-r}];var h=r/2,p=Math.min(i,e)/2,d=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+p+"px "+h+"px "+p+"px",this._triangleBorderColorStyle=d+" "+d+" transparent transparent",this._triangleDivLocation=this._pointers[2]}else if(l==="aboveright"){a.y=f.y-r-a.height,a.x=f.x-n,this._pointers=[f,{x:f.x,y:f.y-r},{x:f.x+Math.min(i,e),y:f.y-r}];var h=r/2,p=Math.min(i,e)/2,d=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+p+"px "+h+"px "+p+"px",this._triangleBorderColorStyle=d+" transparent transparent "+d,this._triangleDivLocation=this._pointers[1]}else if(l==="belowleft"){a.y=f.y+r,a.x=f.x-(a.width-n),this._pointers=[f,{x:f.x,y:f.y+r},{x:f.x-Math.min(i,e),y:f.y+r}];var h=r/2,p=Math.min(i,e)/2,d=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+p+"px "+h+"px "+p+"px",this._triangleBorderColorStyle=" transparent "+d+" "+d+" transparent",this._triangleDivLocation={x:this._pointers[2].x,y:f.y}}else if(l==="belowright"){a.y=f.y+r,a.x=f.x-n,this._pointers=[f,{x:f.x,y:f.y+r},{x:f.x+Math.min(i,e),y:f.y+r}];var h=r/2,p=Math.min(i,e)/2,d=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+p+"px "+h+"px "+p+"px",this._triangleBorderColorStyle="transparent transparent "+d+" "+d,this._triangleDivLocation=this._pointers[0]}else if(l==="above"){a.y=f.y-r-a.height,a.x=f.x-a.width/2,this._pointers=[f,{x:f.x-Math.min(i,e)/2,y:f.y-r},{x:f.x+Math.min(i,e)/2,y:f.y-r}];var h=r,p=Math.min(i,e)/2,d=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+p+"px "+"0px "+p+"px",this._triangleBorderColorStyle=d+" transparent transparent transparent",this._triangleDivLocation=this._pointers[1]}else if(l==="below"){a.y=f.y+r,a.x=f.x-a.width/2,this._pointers=[f,{x:f.x-Math.min(i,e)/2,y:f.y+r},{x:f.x+Math.min(i,e)/2,y:f.y+r}];var h=r,p=Math.min(i,e)/2,d=this.getFillColor();this._triangleBorderWidthStyle="0px "+p+"px "+h+"px "+p+"px",this._triangleBorderColorStyle="transparent transparent "+d+" transparent ",this._triangleDivLocation={x:this._pointers[1].x,y:f.y}}else if(l==="left"){a.y=f.y-a.height/2,a.x=f.x-a.width-r,this._pointers=[f,{x:f.x-r,y:f.y-Math.min(i,t)/2},{x:f.x-r,y:f.y+Math.min(i,t)/2}];var h=Math.min(i,t)/2,p=r,d=this.getFillColor();this._triangleBorderWidthStyle=h+"px 0px "+h+"px "+p+"px",this._triangleBorderColorStyle="transparent transparent  transparent "+d,this._triangleDivLocation=this._pointers[1]}else{if(l!=="right")throw"Can not resolve '"+l+"' attachment direction";a.y=f.y-a.height/2,a.x=f.x+r,this._pointers=[f,{x:f.x+r,y:f.y-Math.min(i,t)/2},{x:f.x+r,y:f.y+Math.min(i,t)/2}];var h=Math.min(i,t)/2,p=r,d=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+p+"px "+h+"px "+"0px",this._triangleBorderColorStyle="transparent "+d+" transparent  transparent ",this._triangleDivLocation={x:f.x,y:this._pointers[1].y}}}else f=this._network.getPosition(s,this._ui,{width:a.width,height:a.height},o,u),a.x=f.x,a.y=f.y,this._pointers=null;this._location=f},updateMeasure:function(){this.calculateMeasure(),this._ui.isShadowable()&&this.isShadowable()?n.Util.setCSSStyle(this._roundDiv,"text-shadow",this._ui._shadowXOffset+"px "+this._ui._shadowYOffset+"px "+this._ui._shadowBlur+"px "+this._ui._shadowColor):n.Util.removeCSSStyle(this._roundDiv,"text-shadow"),this._pointerRect=n.Util.getRect(this._pointers),this._viewRect=n.Util.unionRect(this._pointerRect,this._roundRect),n.Util.setCSSStyle(this._contentDiv,"left",this._contentRect.x+"px"),n.Util.setCSSStyle(this._contentDiv,"top",this._contentRect.y+"px"),n.Util.setCSSStyle(this._roundDiv,"left",this._roundRect.x+"px"),n.Util.setCSSStyle(this._roundDiv,"top",this._roundRect.y+"px"),n.Util.setCSSStyle(this._roundDiv,"width",this._roundRect.width+"px"),n.Util.setCSSStyle(this._roundDiv,"height",this._roundRect.height+"px"),n.Util.setCSSStyle(this._roundDiv,"background",this.isFill()?this.getFillColor():null),n.Util.setCSSStyle(this._roundDiv,"-webkit-border-radius",this.getCornerRadius()+"px"),n.Util.setCSSStyle(this._roundDiv,"-moz-border-radius",this.getCornerRadius()+"px"),n.Util.setCSSStyle(this._roundDiv,"border-radius",this.getCornerRadius()+"px"),this._pointers?(n.Util.setCSSStyle(this._triangleDiv,"left",this._triangleDivLocation.x+"px"),n.Util.setCSSStyle(this._triangleDiv,"top",this._triangleDivLocation.y+"px"),n.Util.setCSSStyle(this._triangleDiv,"border-width",this._triangleBorderWidthStyle),n.Util.setCSSStyle(this._triangleDiv,"border-color",this._triangleBorderColorStyle),this._view.appendChild(this._triangleDiv)):this._triangleDiv.parentNode==this._view&&this._view.removeChild(this._triangleDiv);if(this._element.getStyle("label.rotatable")&&this.label){var e=this._ui.getFromPoint(),t=this._ui.getToPoint(),r=this._ui.getLinkPoints();r.size()%2==0&&(e=r.get(r.size()/2-1),t=r.get(r.size()/2)),e.x>t.x?this._radian=n.Util.getRadiansBetweenLines(t,e):this._radian=n.Util.getRadiansBetweenLines(e,t),this._origin={x:this._contentRect.width/2,y:0};var i="rotate("+n.Util.toDegrees(this._radian)+"deg)",s=this._origin.x+"px "+this._origin.y+"px";n.Util.isChrome||n.Util.isSafari?(n.Util.setCSSStyle(this._roundDiv,"-webkit-transform",i),n.Util.setCSSStyle(this._roundDiv,"-webkit-transform-origin",s)):n.Util.isIE?(n.Util.setCSSStyle(this._roundDiv,"-ms-transform",i),n.Util.setCSSStyle(this._roundDiv,"-ms-transform-origin",s)):(n.Util.setCSSStyle(this._roundDiv,"transform",i),n.Util.setCSSStyle(this._roundDiv,"transform-origin",s))}else n.Util.removeCSSStyle(this._roundDiv,"-webkit-transform"),n.Util.removeCSSStyle(this._roundDiv,"-webkit-transform-origin"),n.Util.removeCSSStyle(this._roundDiv,"-ms-transform"),n.Util.removeCSSStyle(this._roundDiv,"-ms-transform-origin"),n.Util.removeCSSStyle(this._roundDiv,"transform"),n.Util.removeCSSStyle(this._roundDiv,"transform-origin"),delete this._origin,delete this._radian}}),n.network.HTMLLabelAttachment=function(e,t){n.network.HTMLBasicAttachment.call(this,e,t),this.label=!0},n.Util.ext("twaver.network.HTMLLabelAttachment",n.network.LabelAttachment,{updateMeasure:function(){var e=this.getFont("label.font"),t=this.getLabel();this._contentDiv.innerHTML=t,n.Util.setCSSStyle(this._contentDiv,"font",e),n.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),n.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:n.network.HTMLBasicAttachment.prototype.calculateMeasure}),n.network.HTMLAlarmAttachment=function(e,t){n.network.HTMLBasicAttachment.call(this,e,t),this.alarm=!0},n.Util.ext("twaver.network.HTMLAlarmAttachment",n.network.AlarmAttachment,{updateMeasure:function(){var e=this.getFont("alarm.font");this._contentDiv.innerHTML=this._network.getAlarmLabel(this._element),n.Util.setCSSStyle(this._contentDiv,"font",e),this._fillColor=this._network.getAlarmFillColor(this._element),n.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),n.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:n.network.HTMLBasicAttachment.prototype.calculateMeasure}),n.network.NodeUI=function(e,t){n.network.NodeUI.superClass.constructor.call(this,e,t)},r.ext("twaver.network.NodeUI",n.network.ElementUI,{createBodyRect:function(){return this._element.getRect()},invalidate:function(e){n.network.NodeUI.superClass.invalidate.call(this,e);var t=this._element.getAgentLinks();t&&t.forEach(function(e){this._network.invalidateElementUI(e,!1)},this)},updateMeasure:function(){n.network.NodeUI.superClass.updateMeasure.call(this);var e=this.getStyle("vector.shape"),t=this.getBodyRect();this._hotSpot=m.getHotSpot(t.x,t.y,t.width,t.height,e),this.drawBody(),this._outerColor&&this.drawOuterBorder(),!this._editAttachment&&this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.drawSelectBorder(),this.cleanUp(["_selectCanvas","_nodeCanvas","_nodeImage","_nodeComponent","_vectorCanvas","_outerCanvas"]);var r=this._element.getParent();r instanceof ns&&this._network.invalidateElementUI(r,!1)},drawBody:function(){var e=this.getStyle("body.type");e==="default"?this.drawDefaultBody():e==="vector"?this.drawVectorBody():e==="default.vector"?(this.drawVectorBody(),this.drawDefaultBody()):e==="vector.default"?(this.drawDefaultBody(),this.drawVectorBody()):this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0})},drawOuterBorder:function(){var e=this._element,t=e.getStyle("outer.width");if(t>0){var n=this.getBodyRect();m.addPadding(n,e,"outer.padding",1),this._outerCanvas||(this._outerCanvas=b.createCanvas());var i=r.clone(n);m.grow(i,t/2,t/2);var s=b.setCanvas(this._outerCanvas,i);s.lineWidth=t,s.lineCap=e.getStyle("outer.cap"),s.lineJoin=e.getStyle("outer.join"),s.strokeStyle=this._outerColor,w.drawVector(s,e.getStyle("outer.shape"),null,n),s.stroke(),this.addComponent(this._outerCanvas),this.addBodyBounds(i)}},drawSelectBorder:function(){var e=this._element,t=e.getStyle("select.width");if(t>0){var n=this.getBodyRect();n=r.clone(n);var i=e.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();m.addPadding(n,e,"select.padding",1/i),this._selectCanvas||(this._selectCanvas=b.createCanvas()),m.grow(n,t/2/i,t/2/i);var s=b.setCanvas(this._selectCanvas,bounds);s.lineWidth=t/i,s.lineCap=e.getStyle("select.cap"),s.lineJoin=e.getStyle("select.join"),s.strokeStyle=e.getStyle("select.color"),w.drawVector(s,e.getStyle("select.shape"),null,n),s.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}},drawDefaultBody:function(){var e=this._element,t=r.getImageAsset(e.getImage()),i=this.getBodyRect();if(!t){this.addBodyBounds(i),this._currentImageAsset=null;return}m.addPadding(i,this._element,"image.padding",1);if(t.getImage()){this._nodeCanvas||(this._nodeCanvas=b.createCanvas());var s=r.clone(i),o=this.setShadow(this,this._nodeCanvas,s);e.getAngle()!=0&&(i=e.getOriginalRect(),n.Util.rotateCanvas(o,i,e.getAngle())),Rr(o,e.getImage(),this.getInnerColor(),i,e,this._network),i=s,this.addComponent(this._nodeCanvas)}else if(t.getSrc())this._nodeImage||(this._nodeImage=b.createImg()),b.setImg(this._nodeImage,t.getSrc(),i),this.addComponent(this._nodeImage);else{if(!t.getFunction())throw"ImageAsset '"+e.getImage()+" ' is empty";this._currentImageAsset!==t?this._nodeComponent=t.getFunction()(this,i):this._nodeComponent=t.getFunction()(this,i,this._nodeComponent),this.addComponent(this._nodeComponent),this._nodeComponent._viewRect=r.clone(i)}this.addBodyBounds(i),this._currentImageAsset=t},hit:function(e,t){if(this._network._transparentSelectionEnable){var n=this.getBodyRect();if(r.math.containsPoint(n,e,t))return!0}return this.hitCanvas(e,t,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.hitComponent(e,t,["_nodeImage","_nodeComponent"
])},intersects:function(e){if(this._network._transparentSelectionEnable){var t=this.getBodyRect();if(r.math.intersects(t,e))return!0}return this.intersectsCanvas(e,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.intersectsComponent(e,["_nodeImage","_nodeComponent"])},drawVectorBody:function(){this._vectorCanvas||(this._vectorCanvas=b.createCanvas());var e=w.drawPath(this,this._vectorCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern")),t=this.getStyle("vector.deep"),r=this._vectorCanvas.getContext("2d"),i=this.getBodyRect(),s=this.getStyle("vector.fill.color");if(t!==0&&s){var o=this._element.getAngle();o!=0&&(i=this._element.getOriginalRect(),n.Util.rotateCanvas(r,i,-o),n.Util.rotateCanvas(r,i,o)),this.getStyle("vector.shape")==="rectangle"&&w.draw3DRect(r,s,t,i)}this.addBodyBounds(e),this.addComponent(this._vectorCanvas)}}),n.network.LinkUI=function(e,t){n.network.LinkUI.superClass.constructor.call(this,e,t),this._linkCanvas=b.createCanvas()},r.ext("twaver.network.LinkUI",n.network.ElementUI,{isEditable:function(){return Nr.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},createBodyRect:function(){var e=this.getHotSpot();return e?{x:e.x-1,y:e.y-1,width:2,height:2}:null},hit:function(e,t){return this.hitCanvas(e,t,["_linkCanvas"])},intersects:function(e){return this.intersectsCanvas(e,["_linkCanvas"])},checkAttachments:function(){n.network.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var e=this._network.getLinkHandlerLabel(this._element);e!=null&&e!==""?this._linkHandlerAttachment||(this._linkHandlerAttachment=new n.network.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=m.calculateLineLength(this._linkPoints)),this._linkPoints},invalidate:function(e){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,n.network.LinkUI.superClass.invalidate.call(this,e)},getFromPosition:function(e,t){var n=this.getFromPoint();return n?{x:n.x+e,y:n.y+t}:null},getToPosition:function(e,t){var n=this.getToPoint();return n?{x:n.x+e,y:n.y+t}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=Nr.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=Nr.createToPoint(this)),this._toPoint},updateMeasure:function(){n.network.LinkUI.superClass.updateMeasure.call(this),this.drawBody()},createLinkPoints:function(){var e=this.getFromPoint(),t=this.getToPoint(),n=this.getStyle("link.type"),r=new Oi;if(Nr.isOrthogonalOrFlexionalLink(this._element))r=Nr.orthogonalAndFlexional(this,n);else if(this._element.isLooped()){var i=this._network.getElementUI(this._element.getFromAgent());i!=null&&(this._hotSpot=Nr.fillLoopedPoints(this,i.getBodyRect(),r))}else{if(n!=="arc"&&n!=="triangle"&&n!=="parallel")throw"Can not resolve link type '"+n+"'";this._hotSpot=Nr.fillBundlePoints(this,n,e,t,r)}if(this._network._linkPathFunction){var s=this._network._linkPathFunction(this,r);s&&(r=s)}return r},drawLinePoints:function(e,t,n,r,i){e.lineWidth=n,e.strokeStyle=r;if(this._element.getStyle("link.flow")===!0&&i&&i.length>1){var s=new Sr(e,i[0],i[1]),o=this._element.getStyle("link.flow.offset");this._element.getStyle("link.flow.converse")?o<i[0]?s.overflow=i[0]-o:o>=i[0]&&o<=i[0]+i[1]?(s.overflow=i[1]-(o-i[0]),s.overflow&&(s.isLine=!1)):(o-=i[0]+i[1],s.overflow=i[0]-o):o<=i[1]?(s.overflow=o,o&&(s.isLine=!1)):o>i[1]&&o<=i[0]+i[1]?s.overflow=o-i[1]:(o-=i[0]+i[1],o&&(s.isLine=!1),s.overflow=o),this._element._styleMap["link.flow.offset"]=o,e.beginPath(),w._drawLine(t,e),e.stroke(),e.shadowColor="transparent",e.beginPath();var u=this._element.getStyle("link.flow.color");u=u?u:$i.NETWORK_LINK_FLOW_COLOR,e.strokeStyle=u,w._drawLine(t,s),e.stroke(),e.shadowColor=this._shadowColor}else e.beginPath(),w.drawLinePoints(e,t,i),e.stroke()},drawBody:function(){var e=this.getLinkPoints();if(!e||e.size()<2)return;var t=this._element,n=m.getLineRect(e),r=t.getStyle("link.width"),i=r;if(this._outerColor){var s=t.getStyle("outer.width");i+=s*2}var o=!this._editAttachment&&t.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(o){var u=t.getStyle("select.width");i+=u*2}m.grow(n,i/2,i/2),t.getStyle("arrow.from")&&(n=m.unionRect(n,Mi.getArrowRect(e,!0,t.getStyle("arrow.from.shape"),t.getStyle("arrow.from.width"),t.getStyle("arrow.from.height"),t.getStyle("arrow.from.xoffset"),t.getStyle("arrow.from.yoffset")))),t.getStyle("arrow.to")&&(n=m.unionRect(n,Mi.getArrowRect(e,!1,t.getStyle("arrow.to.shape"),t.getStyle("arrow.to.width"),t.getStyle("arrow.to.height"),t.getStyle("arrow.to.xoffset"),t.getStyle("arrow.to.yoffset"))));var a=this.setShadow(this,this._linkCanvas,n);a.lineCap=t.getStyle("link.cap"),a.lineJoin=t.getStyle("link.join");var f=t.getStyle("link.pattern");o&&this.drawLinePoints(a,e,i,t.getStyle("select.color"),f),this._outerColor&&this.drawLinePoints(a,e,r+s*2,this._outerColor,f),this.drawLinePoints(a,e,r,this._innerColor||t.getStyle("link.color"),f),this.addBodyBounds(n),this.addComponent(this._linkCanvas),Mi.drawLinkArrow(this,a,e)},getControlPoint:function(){return Nr.getControlPoint(this._element,this)},setControlPoint:function(e){if(!e)return;var t=this.getStyle("link.type");if(!Nr.hasControlPoint(t))return;var n=Nr.getLinkSourceBounds(this),r=Nr.getLinkTargetBounds(this);Nr.setParamsByControlPoint(e,n,r,t,this._element)},getLineLength:function(){return this._lineLength}}),n.network.HTMLLinkUI=function(e,t){n.network.HTMLLinkUI.superClass.constructor.call(this,e,t)},r.ext("twaver.network.HTMLLinkUI",n.network.LinkUI,{checkAttachments:function(){n.network.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var e=this._element.getStyle("attachment.label.style");if(e&&e==="none"){n.network.HTMLLinkUI.superClass.checkLabelAttachment.call(this);return}var t=this._network.getLabel(this._element);t!=null&&t!==""?this._labelAttachment||(this._labelAttachment=new n.network.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var e=this._element.getStyle("attachment.alarm.style");if(e&&e==="none"){n.network.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);return}var t=this._network.getAlarmLabel(this._element);t!=null&&t!==""?this._alarmAttachment||(this._alarmAttachment=new n.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),n.network.GroupUI=function(e,t){n.network.GroupUI.superClass.constructor.call(this,e,t)},r.ext("twaver.network.GroupUI",n.network.NodeUI,{isEditable:function(){return!this._element.isExpanded()},drawBody:function(){var e=this.getBodyRect();this._shapeRect?this.drawExpandedGroup():n.network.GroupUI.superClass.drawBody.call(this)},drawExpandedGroup:function(){this._nodeCanvas||(this._nodeCanvas=b.createCanvas());var e=w.drawPath(this,this._nodeCanvas,"group",!1,this._element.getStyle("vector.outline.pattern")),t=this.getStyle("group.deep"),n=this.getStyle("group.fill.color");t!==0&&n&&this.getStyle("group.shape")==="rectangle"&&w.draw3DRect(this._nodeCanvas.getContext("2d"),n,t,this._bodyRect),this.addBodyBounds(e),this.addComponent(this._nodeCanvas)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var e=this._element;if(e.isExpanded()){var t=this.getChildrenRects();if(!t.isEmpty()){var r=e.getStyle("group.shape"),i=g[r];if(!i)throw"Can not resolve group shape '"+r+"'";this._shapeRect=i(t)}}return this._shapeRect?(m.addPadding(this._shapeRect,e,"group.padding",1),this._shapeRect):n.network.GroupUI.superClass.createBodyRect.call(this)}}),n.network.GridUI=function(e,t){n.network.GridUI.superClass.constructor.call(this,e,t)},r.ext("twaver.network.GridUI",n.network.NodeUI,{drawDefaultBody:function(){this._element.getImage()?n.network.GridUI.superClass.drawDefaultBody.call(this):this.drawGridBody()},drawGridBody:function(){var e=this.getStyle("grid.fill"),t=this.getStyle("grid.deep"),n=this.getStyle("grid.cell.deep");if(!e&&t===0&&n===0)return;var i=this.getBodyRect(),s=this.getDyeColor("grid.fill.color");this._nodeCanvas||(this._nodeCanvas=b.createCanvas());var o=r.clone(i),u=this.setShadow(this,this._nodeCanvas,o);u.rect(i.x,i.y,i.width,i.height),this.addComponent(this._nodeCanvas),e&&(u.fillStyle=s,u.fill()),t!=0&&w.draw3DRect(u,s,t,i.x,i.y,i.width,i.height);if(n!=0){var a=this.getStyle("grid.row.count"),f=this.getStyle("grid.column.count");for(var l=0;l<a;l++)for(var c=0;c<f;c++){var h=this._element.getCellRect(l,c);h!=null&&w.draw3DRect(u,s,n,h.x,h.y,h.width,h.height)}}this.addBodyBounds(o)}}),n.network.ShapeNodeUI=function(e,t){n.network.ShapeNodeUI.superClass.constructor.call(this,e,t)},r.ext("twaver.network.ShapeNodeUI",n.network.NodeUI,{drawDefaultBody:function(){if(this._element._points.size()<2){this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0});return}this._nodeCanvas||(this._nodeCanvas=b.createCanvas());var e=w.drawPath(this,this._nodeCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed"));this.addBodyBounds(e),this.addComponent(this._nodeCanvas),Mi.drawLinkArrow(this,this._nodeCanvas.getContext("2d"),m.getPointObject(this._element._points,this._element._segments))},drawSelectBorder:function(){var e=this._element,t=e.getStyle("select.width");if(t>0){var n=this.getBodyRect();n=r.clone(n);var i=e.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();m.addPadding(n,e,"select.padding",1/i);var s=e.getStyle("vector.outline.width");s>0&&m.grow(n,s/2,s/2),this._selectCanvas||(this._selectCanvas=b.createCanvas()),m.grow(n,t/2/i,t/2/i);var o=b.setCanvas(this._selectCanvas,n);o.lineWidth=t/i,o.lineCap=e.getStyle("select.cap"),o.lineJoin=e.getStyle("select.join"),o.strokeStyle=e.getStyle("select.color"),w.drawVector(o,e.getStyle("select.shape"),null,n),o.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}}}),n.network.ShapeLinkUI=function(e,t){n.network.ShapeLinkUI.superClass.constructor.call(this,e,t)},r.ext("twaver.network.ShapeLinkUI",n.network.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var e=this.getFromPoint(),t=this.getToPoint(),n=new Oi,i=this.getStyle("shapelink.type");n.add(e),this._element._points!=null&&n.addAll(this._element._points),n.add(t);var s=n.size(),o=Math.floor(s/2);if(s%2===0){var u=n.get(o),a=n.get(o-1);this._hotSpot={x:(u.x+a.x)/2,y:(u.y+a.y)/2}}else this._hotSpot=r.clone(n.get(o));var f,l,c;if(i!=="lineto")if(i==="quadto"){f=new Oi(n.get(0));for(l=1,s=n.size();l<s;l++)l<s-1?f.add(new Oi([n.get(l++),n.get(l)])):f.add(n.get(l));n=f}else if(i==="cubicto"){f=new Oi(n.get(0));for(l=1,s=n.size();l<s;l++)l<s-2?f.add(new Oi([n.get(l++),n.get(l++),n.get(l)])):l<s-1?f.add(new Oi([n.get(l++),n.get(l)])):f.add(n.get(l));n=f}else{if(i!=="orthogonalto")throw"Can not resolve shapelink type '"+i+"'";c=n.get(0),f=new Oi(c);for(l=1,s=n.size();l<s;l++)if(l<s-1){var h=r.clone(n.get(l)),p=h.x,d=h.y,v=p-c.x,m=d-c.y;Math.abs(v)>Math.abs(m)?(h.x=p,h.y=c.y):(h.x=c.x,h.y=d),c=h,f.add(c)}else f.add(n.get(l));n=f}return n}}),n.network.RotatableNodeUI=function(e,t){n.network.RotatableNodeUI.superClass.constructor.call(this,e,t)},r.ext("twaver.network.RotatableNodeUI",n.network.NodeUI,{isEditable:function(){return!1},drawDefaultBody:function(){var e=this._element,t=r.getImageAsset(e.getImage()),n=this.getBodyRect();if(!t){this.addBodyBounds(n),this._currentImageAsset=null;return}m.addPadding(n,this._element,"image.padding",1);if(t.getImage()){this._nodeCanvas||(this._nodeCanvas=b.createCanvas());var i=r.clone(n),s=this.setShadow(this,this._nodeCanvas,i),o=this._element._getOrignalWidth(),u=this._element._getOrignalHeight(),a=this._element._getRotateRect();s.save(),s.translate(n.x-a.x+o/2,n.y-a.y+u/2),s.rotate(this._element._angle*Math.PI/180);var n={x:-o/2,y:-u/2,width:o,height:u};Rr(s,t.getImage(this._innerColor,n.width,n.height),this._innerColor,n,e,this._network),s.restore(),this.addComponent(this._nodeCanvas)}else if(!t.getSrc()&&!t.getFunction())throw"ImageAsset '"+e.getImage()+" ' is empty";this.addBodyBounds(n),this._currentImageAsset=t}}),n.network.HTMLNodeUI=function(e,t){n.network.HTMLNodeUI.superClass.constructor.call(this,e,t)},n.Util.ext("twaver.network.HTMLNodeUI",n.network.NodeUI,{checkAttachments:function(){n.network.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var e=this._element.getStyle("attachment.label.style");if(e&&e==="none"){n.network.HTMLNodeUI.superClass.checkLabelAttachment.call(this);return}var t=this._network.getLabel(this._element);t!=null&&t!==""?this._labelAttachment||(this._labelAttachment=new n.network.HTMLLabelAttachment(this,$i.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var e=this._element.getStyle("attachment.alarm.style");if(e&&e==="none"){n.network.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);return}var t=this._network.getAlarmLabel(this._element);t!=null&&t!==""?this._alarmAttachment||(this._alarmAttachment=new n.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),n.network.interaction.BaseInteraction=function(e){this.network=e},r.ext("twaver.network.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},addListener:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];b.addEventListener(t,"handle_"+t,this.network.getView(),this)}},removeListener:function(){for(var e=0;e<arguments.length;e++)b.removeEventListener(arguments[e],this.network.getView(),this)},_handle_mousedown:function(e){if(e.button!==0)return;this._startLogical=this.network.getLogicalPoint(e),this._startClient=b.getClientPoint(e),this._startLogical&&b.handle_mousedown(this,e)},_handle_mousemove:function(e){this._endLogical={x:this._startLogical.x+(e.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(e.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(e){delete this._startClient,delete this._startLogical,delete this._endLogical}}),n.network.interaction.SelectInteraction=function(e){n.network.interaction.SelectInteraction.superClass.constructor.call(this,e)},r.ext("twaver.network.interaction.SelectInteraction",n.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown"),this.end()},handle_mousedown:function(e){this._button=e.button;if(!this.network.isValidEvent(e)||this.network.isMovingElement()||this.network.isEditingElement())return;if(e.shiftKey)return;var t=this.network.getElementAt(e),n=this.network.getSelectionModel();t?r.isCtrlDown(e)?n.contains(t)?n.removeSelection(t):n.appendSelection(t):n.contains(t)||n.setSelection(t):(r.isCtrlDown(e)||n.clearSelection(),this.end(e),this.network.getLogicalPoint(e)&&this.network.isRectSelectEnabled()&&this._handle_mousedown(e))},handle_mouseup:function(e){this.end(e)},handle_mousemove:function(e){if(this._button!==0||this.network.isMovingElement()||this.network.isEditingElement()){this.end(e);return}this._handle_mousemove(e),this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:e}):(this.mark=b.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:e}));var t=m.getRect([this._startLogical,this._endLogical]);b.setDiv(this.mark,t,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())},end:function(e){if(this._startLogical){if(this.mark){if(this._endLogical&&this._startLogical.x!==this._endLogical.x&&this._startLogical.y!==this._endLogical.y){var t=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(t&&t.size()>0){var n=this.network.getSelectionModel(),r=n.toSelection();t.forEach(function(e){n.contains(e)?r.remove(e):r.add(e)},this),n.setSelection(r)}this.network.fireInteractionEvent({kind:"selectEnd",event:e})}var i=this;setTimeout(function(){i.mark&&(i.network.getTopDiv().removeChild(i.mark),i.mark=null)},0),this.network.setSelectingElement(!1)}this._handle_mouseup(e)}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startLogical.x>this._endLogical.x&&this._startLogical.y>this._endLogical.y}}),n.network.interaction.MoveInteraction=function(e,t){this.lazyMode=t,this.xoffset=0,this.yoffset=0,n.network.interaction.MoveInteraction.superClass.constructor.call(this,e),this.currentKeyEvent=null},r.ext("twaver.network.interaction.MoveInteraction",n.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","keydown","mouseleave")},tearDown:function(){this.removeListener("mousedown","keydown","mouseleave"),this.end()},handle_keydown:function(e){this.currentKeyEvent=e,this.addListener("keyup")},handle_keyup:function(e){this.currentKeyEvent=null,this.removeListener("keyup")},handle_mouseleave:function(e){this.end(e)},isParenting:function(){return this._startLogical&&this.currentKeyEvent!=null&&this.currentKeyEvent.keyCode===80},parentProcess:function(e,t){var n=null;this.parent!=null&&(n=this.network.getElementUI(this.parent).getViewRect(),this.parent=null);var i=this;e=this.network.getLogicalPoint(e);if(!t&&this.isParenting()){var s={};s.x=e.x-1,s.y=e.y-1,s.width=2,s.height=2;var o=this.network.getElementsAtRect(s,!0);if(o&&o.size()>0){var u=o.size();for(var a=0;a<u;a++){var f=o.get(a);if(!i.network.getElementBox().getSelectionModel().contains(f)){i.parent=f;break}}}}this.parent!=null&&(n=this.network.getElementUI(this.parent).getViewRect()),n!=null&&!t?(this.parentMark||(this.parentMark=r.html.createDiv(),this.network.getTopDiv().appendChild(this.parentMark)),r.html.setDiv(this.parentMark,n,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor())):this.parentMark&&(this.network.getTopDiv().removeChild(this.parentMark),this.parentMark=null)},handle_mousedown:function(e){if(e.button!==0)return;if(this.network.isSelectingElement()||this.network.isEditingElement())return;var t=this.network.getElementAt(e);if(!this.network.isMovable(t))return;this.end(e),this._handle_mousedown(e)},handle_mouseup:function(e){this.end(e)},handle_mousemove:function(e){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()||!this._startLogical){this.end(e);return}this._handle_mousemove(e),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y;if(this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:e});else{this.mark=b.createDiv();var t;this.network.getMovableSelectedElements().forEach(function(e){var n=this.getElementUI(e);n&&(t=m.unionRect(t,n.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),b.setDiv(this.mark,t,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:e})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else this._startLogical=this._endLogical,this._startClient=b.getClientPoint(e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e})),this.network.moveSelectedElements(this.xoffset,this.yoffset);this.parentProcess(e,!1)},end:function(e){if(this._startLogical){if(this.lazyMode){if(this.mark){var t=this,n=function(){t.network.fireInteractionEvent({kind:"lazyMoveEnd",event:e}),t.mark&&(t.network.getTopDiv().removeChild(t.mark),t.mark=null,t.network.setMovingElement(!1))};this.network.moveSelectedElements(this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),n)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e}));if(this.isParenting()){this.parent==null&&(this.parent=this.network.getCurrentSubNetwork());var t=this;this.network.getMovableSelectedElements().forEach(function(e){e.setParent(t.parent)},this.network)}this.parentProcess(e,!0),this._handle_mouseup(e)}}}),n.network.interaction.DefaultInteraction=function(e){n.network.interaction.DefaultInteraction.superClass.constructor.call(this,e)},r.ext("twaver.network.interaction.DefaultInteraction",n.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(e){if(!this.network.isValidEvent(e))return;this.network.isFocusOnClick()&&n.Util.setFocus(this.network.getView());var t=this.network.getElementAt(e);e.detail===2?this.handleDoubleClicked(e,t):this.handleClicked(e,t)},handleClicked:function(e,t){Or.handleClicked(this.network,e,t)},handleDoubleClicked:function(e,t){Or.handleDoubleClicked(this.network,e,t)},handle_keydown:function(e){Or.handleKeyDown(this.network,e)},handle_mousemove:function(e){var t=this.network.getElementAt(e),n=this._preElement,r=Mr(n),i=Mr(t);n!==t&&(n&&(r&&r.onMouseLeave&&r.onMouseLeave(n,this.network),this.network.onMouseLeave(n,e)),t&&(i&&i.onMouseEnter&&i.onMouseEnter(t,this.network),this.network.onMouseEnter(t,e))),t&&i&&i.onMouseMove&&i.onMouseMove(t,this.network),this.network.onMouseMove(t,e),this._preElement=t}}),n.network.interaction.PanInteraction=function(e){n.network.interaction.PanInteraction.superClass.constructor.call(this,e)},r.ext("twaver.network.interaction.PanInteraction",n.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(e){this._startLogical=this.network.getLogicalPoint(e),this._startLogical&&(this._handle_mousedown(e),this.network.getView().style.cursor="pointer")},handle_mouseup:function(e){this._clear()},handle_mousemove:function(e){if(!this._startLogical)return;this._handle_mousemove(e);var t=this._startLogical.x-this._endLogical.x,n=this._startLogical.y-this._endLogical.y,r=this.network.panByOffset(t,n);this._startLogical=this._endLogical,this._startClient=b.getClientPoint(e)},_clear:function(e){this._startLogical&&(this._handle_mouseup(e),this.network.getView().style.cursor=this._oldCursor)}}),n.network.interaction.EditInteraction=function(e,t){this.lazyMode=t,this.pointIndex=-1,n.network.interaction.EditInteraction.superClass.constructor.call(this,e)},r.ext("twaver.network.interaction.EditInteraction",n.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear()},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.mouseMoved=!1,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null),this.rotateScale&&this.network.getTopDiv().contains(this.rotateScale)&&(this.network.getTopDiv().removeChild(this.rotateScale),this.rotateScale=null)},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(e){this.cursorID=e,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(e){if(e.button!==0)return;if(r.isAltDown(e)&&!this.network.isEditingElement()){var t=this.network.getElementAt(e),i=this.network.getLogicalPoint(e);if(t instanceof n.ShapeNode){var s=this.getPointIndex(t.getPoints(),i,!0);s>0&&(this._handle_mousedown(e),this.pointIndex=s,this.shapeNode=t,t.addPoint(i,s),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:e,element:t,pointIndex:s}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:t,pointIndex:s}))}if(t instanceof n.ShapeLink){var o=new n.List(t.getPoints()),u=this.network.getElementUI(t);o.add(u.getFromPoint(),0),o.add(u.getToPoint());var s=this.getPointIndex(o,i)-1;s>0&&(this._handle_mousedown(e),this.pointIndex=s,this.shapeLink=t,t.addPoint(i,s),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:e,element:t,pointIndex:s}),this.network.fireInteractionEvent({kind:this.lazyMode?"lazeMovePointStart":"liveMovePointStart",event:e,element:t,pointIndex:s}))}return}if(!this.network.isEditingElement()||this.isStart||this.isStartRotate)return;this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:e,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?r.isAltDown(e)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:e,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyMovePointStart":"liveMovePointStart",event:e,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?r.isAltDown(e)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:e,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyMovePointStart":"liveMovePointStart",event:e,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyMovePointStart":"liveMovePointStart",event:e,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(e))},handle_mouseup:function(e){if(this.isStart){var t=r.clone(this._endLogical);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var i=this,s=new n.animate.AnimateBounds(this.node,this.resizingRect,function(){i.network.fireInteractionEvent({kind:"lazyResizeEnd",event:e,element:i.node,resizeDirection:i.resizeDirection}),i.clear()});n.animate.AnimateManager.start(s)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:e,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:e,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0&&t){var o=this.shapeNode.getPoints().get(this.pointIndex);this.horizontal&&(t.y=o.y),this.vertical&&(t.x=o.x),this.shapeNode.setPoint(this.pointIndex,t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.shapeNode,pointIndex:this.pointIndex})}else if(this.shapeLink&&this.pointIndex>=0&&t){var o=this.shapeLink.getPoints().get(this.pointIndex);this.horizontal&&(t.y=o.y),this.vertical&&(t.x=o.x),this.shapeLink.setPoint(this.pointIndex,t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.shapeLink,pointIndex:this.pointIndex})}else this.linkUI&&t&&(this.linkUI.setControlPoint(t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.linkUI._element}))}this._handle_mouseup(e),this.lazyMode||this.clear()},handle_mousemove:function(e){if(this.isStartRotate&&this.node){this._handleRotateElement(e,this.node),this.network.isShowRotateScale()&&this.showRotateScale();return}if(this.isStart){if(this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(e);return}if(this.shapeLink&&this.pointIndex>=0){this._handleMovingShapeLinkPoint(e);return}if(this.node&&this.resizeDirection){this._handleResizing(e);return}if(this.linkUI){this._handleMovingLinkControlPoint(e);return}return}if(!this.network.isValidEvent(e))return;if(this.network.isSelectingElement()||this.network.isMovingElement()||this.network.getSelectionModel().size()===0){this.clear();return}var t=this.network.getElementAt(e),r=this.network.getElementUI(t);if(!r||!r.getEditAttachment()){this.clear();return}var i=this.network.getLogicalPoint(e);if(t instanceof es){this.node=t;if(this._isEditingShapeNode(i)||this._isResizingNode(i)){this.network.setEditingElement(!0);return}if(this._isRotatingElement(i)){this.network.setRotatingElement(!0),this.network.setEditingElement(!0);return}}else if(t instanceof n.ShapeLink){this.shapeLink=t;if(this._isEditingShapeLink(i)){this.network.setEditingElement(!0);return}}else if(r instanceof n.network.LinkUI){var s=this.network.getEditPointSize();if(Nr.isOrthogonalLink(r._element)){this.linkUI=r;var o=this.linkUI.getControlPoint();o&&this._contains(i,o,s)&&(this._setCrossCursor(),this.network.setEditingElement(!0));return}}this.clear()},_isRotatingElement:function(e){var t=this.network.getRotatePointSize();if(t<=0)return!1;var n=this.node.getOriginalRect(),r=this.node.getAngle();return this._isRotating(e,"crosshair",n,r)},_isRotating:function(e,t,n,r){var i=this.network.getRotatePointSize(),s={x:n.x+n.width/2,y:n.y-this.network.getRotatePointOffset()-i},o=this._rotatePoint(s,r,n),u={x:o.x-i,y:o.y-i,width:i*2,height:i*2};return m.containsPoint(u,e)?(this._removeCursor(),this._setCursor(t),!0):!1},_handleRotateElement:function(e,t){this._handle_mousemove(e);var n=this._calculateAngle(this.network.getLogicalPoint(e),t);t.setAngle(n)},_calculateAngle:function(e,t){var n=t.getCenterLocation();return Math.round(Math.atan2(n.x-e.x,e.y-n.y)*180/Math.PI+180)},_handleMovingShapeNodePoint:function(e){this._handle_mousemove(e);if(!this.mouseMoved&&r.isCtrlDown(e)){var t=this._endLogical.x-this._startLogical.x,n=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(t)>=Math.abs(n),this.vertical=!this.horizontal,this.mouseMoved=!0}var i=this.shapeNode.getPoints().get(this.pointIndex),s=r.clone(this._endLogical);this.horizontal&&(s.y=i.y),this.vertical&&(s.x=i.x),this.shapeNode.setPoint(this.pointIndex,s),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:e,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(e){this._handle_mousemove(e);if(!this.mouseMoved&&r.isCtrlDown(e)){var t=this._endLogical.x-this._startLogical.x,n=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(t)>=Math.abs(n),this.vertical=!this.horizontal,this.mouseMoved=!0}var i=this.shapeLink.getPoints().get(this.pointIndex),s=r.clone(this._endLogical);this.horizontal&&(s.y=i.y),this.vertical&&(s.x=i.x),this.shapeLink.setPoint(this.pointIndex,s),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:e,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(e){this._handle_mousemove(e),this.linkUI.setControlPoint(r.clone(this
._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:e,element:this.linkUI._element})},_handleResizing:function(e){this._handle_mousemove(e);var t=this.node.getAngle(),n=this.node.getLocation(),r=this.node.getWidth()/2,i=this.node.getHeight()/2,s={x:n.x+r,y:n.y+i},o={x:-r,y:-i},u={x:-r,y:i},a={x:r,y:i},f={x:r,y:-i},l={x:0,y:-i},c={x:r,y:0},h={x:0,y:i},p={x:-r,y:0};this.resizeDirection==="northwest"&&(this._transformPoint(a,s,t),o.x=this._endLogical.x,o.y=this._endLogical.y,s.x=(o.x+a.x)/2,s.y=(o.y+a.y)/2,this._reversPoint(o,s,t),this._reversPoint(a,s,t),this.resizingRect={x:o.x,y:o.y,width:a.x-o.x,height:a.y-o.y});if(this.resizeDirection==="north"){var d={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(d,s,t),l.y=d.y-s.y,this._transformPoint(l,s,t),this._transformPoint(h,s,t),s.x=(l.x+h.x)/2,s.y=(l.y+h.y)/2,this._reversPoint(l,s,t),this._reversPoint(h,s,t),this.resizingRect={x:s.x-this.node.getWidth()/2,y:s.y-(h.y-l.y)/2,width:this.node.getWidth(),height:h.y-l.y}}this.resizeDirection==="northeast"&&(this._transformPoint(u,s,t),f.x=this._endLogical.x,f.y=this._endLogical.y,s.x=(u.x+f.x)/2,s.y=(u.y+f.y)/2,this._reversPoint(u,s,t),this._reversPoint(f,s,t),this.resizingRect={x:u.x,y:f.y,width:f.x-u.x,height:u.y-f.y});if(this.resizeDirection==="west"){var d={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(d,s,t),p.x=d.x-s.x,this._transformPoint(c,s,t),this._transformPoint(p,s,t),s.x=(c.x+p.x)/2,s.y=(c.y+p.y)/2,this._reversPoint(c,s,t),this._reversPoint(p,s,t),this.resizingRect={x:s.x-(c.x-p.x)/2,y:s.y-this.node.getHeight()/2,width:c.x-p.x,height:this.node.getHeight()}}if(this.resizeDirection==="east"){var d={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(d,s,t),c.x=d.x-s.x,this._transformPoint(c,s,t),this._transformPoint(p,s,t),s.x=(c.x+p.x)/2,s.y=(c.y+p.y)/2,this._reversPoint(c,s,t),this._reversPoint(p,s,t),this.resizingRect={x:s.x-(c.x-p.x)/2,y:s.y-this.node.getHeight()/2,width:c.x-p.x,height:this.node.getHeight()}}this.resizeDirection==="southwest"&&(this._transformPoint(f,s,t),u.x=this._endLogical.x,u.y=this._endLogical.y,s.x=(u.x+f.x)/2,s.y=(u.y+f.y)/2,this._reversPoint(u,s,t),this._reversPoint(f,s,t),this.resizingRect={x:u.x,y:f.y,width:f.x-u.x,height:u.y-f.y});if(this.resizeDirection==="south"){var d={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(d,s,t),h.y=d.y-s.y,this._transformPoint(l,s,t),this._transformPoint(h,s,t),s.x=(l.x+h.x)/2,s.y=(l.y+h.y)/2,this._reversPoint(l,s,t),this._reversPoint(h,s,t),this.resizingRect={x:s.x-this.node.getWidth()/2,y:s.y-(h.y-l.y)/2,width:this.node.getWidth(),height:h.y-l.y}}this.resizeDirection==="southeast"&&(this._transformPoint(o,s,t),a.x=this._endLogical.x,a.y=this._endLogical.y,s.x=(o.x+a.x)/2,s.y=(o.y+a.y)/2,this._reversPoint(o,s,t),this._reversPoint(a,s,t),this.resizingRect={x:o.x,y:o.y,width:a.x-o.x,height:a.y-o.y}),this.lazyMode?(this.mark||(this.mark=b.createDiv(),this.mark.style.webkitTransform="rotate("+t+"deg)",this.mark.style.mozTransform="rotate("+t+"deg)",this.mark.style.OTransform="rotate("+t+"deg)",this.mark.style.msTransform="rotate("+t+"deg)",this.mark.style.transform="rotate("+t+"deg)",this.network.getTopDiv().appendChild(this.mark)),b.setDiv(this.mark,this.resizingRect,null,this.network.getResizeLineWidth(),this.network.getResizeLineColor()),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:e,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:e,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(e){var t=this.network.getEditPointSize();if(this.node instanceof n.ShapeNode){this.shapeNode=this.node;var r=this.shapeNode.getPoints();for(var i=0,s=r.size();i<s;i++){var o=r.get(i);if(this._contains(e,o,t))return this._setCrossCursor(),this.pointIndex=i,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(e){var t=this.shapeLink.getPoints(),n=this.network.getEditPointSize();for(var r=0,i=t.size();r<i;r++){var s=t.get(r);if(this._contains(e,s,n))return this._setCrossCursor(),this.pointIndex=r,!0}return this.pointIndex=-1,!1},_isResizingNode:function(e){var t=this.network.getResizePointSize();if(t<=0)return!1;var n=this.node.getOriginalRect(),r=this.node.getAngle(),i={x:n.x,y:n.y},s=this._rotatePoint(i,r,n);return this._isResizing(e,s.x,s.y,"northwest","nwse-resize")?!0:(i={x:n.x+n.width/2,y:n.y},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"north","ns-resize")?!0:(i={x:n.x+n.width,y:n.y},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"northeast","nesw-resize")?!0:(i={x:n.x,y:n.y+n.height/2},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"west","ew-resize")?!0:(i={x:n.x+n.width,y:n.y+n.height/2},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"east","ew-resize")?!0:(i={x:n.x,y:n.y+n.height},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"southwest","nesw-resize")?!0:(i={x:n.x+n.width/2,y:n.y+n.height},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"south","ns-resize")?!0:(i={x:n.x+n.width,y:n.y+n.height},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(e,t,n){var r=m.createMatrix(t*Math.PI/180,n.x+n.width/2,n.y+n.height/2),i=r.transform(e);return i},_isResizing:function(e,t,n,r,i){var s=this.network.getResizePointSize();return this._contains(e,{x:t,y:n},s)?(this.resizeDirection!==r&&(this._removeCursor(),i=this._changeCursorWithAngle(r,this.node.getAngle()),this._setCursor(i),this.resizeDirection=r),!0):!1},_getRect:function(e,t,n,r){var i=e<n?e:n,s=t<r?t:r,o=Math.abs(e-n),u=Math.abs(t-r);return{x:i,y:s,width:o,height:u}},_contains:function(e,t,n){var r={x:t.x-n,y:t.y-n,width:n*2,height:n*2};return m.containsPoint(r,e)},getPointIndex:function(e,t,n){if(e.size()<2)return 0;var r=e.get(0),i;for(var s=1;s<e.size();s++){i=e.get(s);if(this.isPointOnLine(t,r,i,6))return s;r=i}return r=e.get(0),n&&this.isPointOnLine(t,r,i,6)?e.size():0},showRotateScale:function(){this.rotateScale||(this.rotateScale=r.html.createCanvas());var e=new n.List,t=this.network.getRotateScaleWidth(),i=this.network.getRotateScaleHeight(),s=this.network.getRotatePointSize(),o=this.node.getAngle(),u=this.node.getOriginalRect(),a={x:u.x+u.width/2,y:u.y-this.network.getRotatePointOffset()-s},f=this._rotatePoint(a,o,u),l,c="13px Arial",h=o+"°",p,d,v,m;this.node.getAngle()>=0&&this.node.getAngle()<=180?(p={x:f.x+s,y:f.y},d={x:p.x+t,y:p.y},v={x:d.x,y:d.y-i},m={x:p.x,y:v.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(p={x:f.x-s,y:f.y},d={x:p.x-t,y:p.y},v={x:d.x,y:d.y-i},m={x:p.x,y:v.y});var g=new n.List([p,d,v,m]),l=r.math.getRect(g),y=r.html.setCanvas(this.rotateScale,l);y.fillStyle=this.network.getRotateScaleFillColor(),y.fillRect(l.x,l.y,l.width,l.height),y.fillStyle=this.network.getRotateScaleFontColor(),y.textBaseline="middle",y.textAlign="center",y.font=c,y.fillText(h,l.x+l.width/2,l.y+l.height/2),this.network.getTopDiv().appendChild(this.rotateScale)},isPointOnLine:function(e,t,n,r){r<0&&(r=0);var i=this.getDistanceFromPointToLine(e,t,n);return i<=r&&e.x>=Math.min(t.x,n.x)-r&&e.x<=Math.max(t.x,n.x)+r&&e.y>=Math.min(t.y,n.y)-r&&e.y<=Math.max(t.y,n.y)+r},getDistanceFromPointToLine:function(e,t,n){if(t.x===n.x)return Math.abs(e.x-t.x);var r=(n.y-t.y)/(n.x-t.x),i=(n.x*t.y-t.x*n.y)/(n.x-t.x);return Math.abs(r*e.x-e.y+i)/Math.sqrt(r*r+1)},_transformPoint:function(e,t,n){var r=Math.cos(n*Math.PI/180),i=Math.sin(n*Math.PI/180),s=e.x,o=e.y,u=s*r-o*i,a=s*i+o*r;e.x=u+t.x,e.y=a+t.y},_reversPoint:function(e,t,n){n*=-1;var r=Math.cos(n*Math.PI/180),i=Math.sin(n*Math.PI/180),s=e.x-t.x,o=e.y-t.y,u=s*r-o*i,a=s*i+o*r;e.x=u+t.x,e.y=a+t.y},_changeCursorWithAngle:function(e,t){var n,r=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(e){case"northwest":n=1;break;case"north":n=2;break;case"northeast":n=3;break;case"east":n=4;break;case"southeast":n=5;break;case"south":n=6;break;case"southwest":n=7;break;case"west":n=8;break;default:n=0}if(t>=360||t<=-360)t%=360;return t>22.5&&t<=67.5&&(n+=1),t<-22.5&&t>=-67.5&&(n-=1),t>67.5&&t<=112.5&&(n+=2),t<-67.5&&t>=-112.5&&(n-=2),t>112.5&&t<=157.5&&(n+=3),t<-112.5&&t>=-157.5&&(n-=3),t>157.5&&t<=202.5&&(n+=4),t<-157.5&&t>=-202.5&&(n-=4),t>202.5&&t<=247.5&&(n+=5),t<-202.5&&t>=-247.5&&(n-=5),t>247.5&&t<=292.5&&(n+=6),t<-247.5&&t>=-292.5&&(n-=6),t>292.5&&t<=337.5&&(n+=7),t<-292.5&&t>=-337.5&&(n-=7),n>8&&(n-=8),n<=0&&(n+=8),r[n]}}),n.network.interaction.CreateElementInteraction=function(e,t){t||(t=es),n.Util.isTypeOf(t,es)?this.elementFunction=function(e){var n=new t;return n instanceof es&&n.setCenterLocation(e),n}:this.elementFunction=t,n.network.interaction.CreateElementInteraction.superClass.constructor.call(this,e)},r.ext("twaver.network.interaction.CreateElementInteraction",n.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(e){var t=this.network.getLogicalPoint(e);if(t){var n=this.elementFunction(t);n&&this.network.addElementByInteraction(n)}}}),n.network.interaction.CreateLinkInteraction=function(e,t){t||(t=n.Link),n.Util.isTypeOf(t,n.Link)?this.linkFunction=function(e,r){var i=new t;return i instanceof n.Link&&(i.setFromNode(e),i.setToNode(r)),i}:this.linkFunction=t,n.network.interaction.CreateLinkInteraction.superClass.constructor.call(this,e)},r.ext("twaver.network.interaction.CreateLinkInteraction",n.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){var e=this;setTimeout(function(){e._fromRectangle&&(e.network.getTopDiv().removeChild(e._fromRectangle),e._fromRectangle=null),e._currentRectangle&&(e.network.getTopDiv().removeChild(e._currentRectangle),e._currentRectangle=null),e._line&&(e.network.getTopDiv().removeChild(e._line),e._line=null)}),this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(e){if(!this.network.isValidEvent(e))return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var t=this.createLink();t&&this.network.addElementByInteraction(t)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.updateMark()},handle_mousemove:function(e){var t=this.network.getLogicalPoint(e);if(!t)return;if(this.network.isMovingElement()||this.network.isEditingElement()){this.clear();return}var n=null;this.fromNode?(this.currentNode=this.getToNode(e),this.currentPoint=t,this.updateMark()):(n=this.getFromNode(e),this.currentNode!==n&&(this.currentNode=n,this.updateMark()))},getFromNode:function(e){return this.getNode(e)},getToNode:function(e){return this.getNode(e)},getNode:function(e){var t=this.network.getElementAt(e);return t instanceof es&&this.network.isLinkable(t)?t:null},updateMark:function(){var e;this.fromNode&&!this._fromRectangle&&this._currentRectangle&&(this._fromRectangle=this._currentRectangle,this._currentRectangle=null),!this.fromNode&&this._fromRectangle&&(this.network.getTopDiv().removeChild(this._fromRectangle),this._fromRectangle=null),this.currentNode&&!this._currentRectangle&&(e=this.network.getElementUI(this.currentNode),this._currentRectangle=b.createDiv(),this.network.getTopDiv().appendChild(this._currentRectangle),b.setDiv(this._currentRectangle,e._viewRect,null,this.network.getEditLineWidth(),this.network.getEditLineColor())),!this.currentNode&&this._currentRectangle&&(this.network.getTopDiv().removeChild(this._currentRectangle),this._currentRectangle=null),this.updateLine()},updateLine:function(){if(this.currentPoint){var e=this.fromNode.getCenterLocation(),t=e.x,n=e.y,r=this.currentPoint.x,i=this.currentPoint.y;this._line||(this._line=b.createCanvas(),this.network.getTopDiv().appendChild(this._line));var s=b.setCanvas(this._line,Math.min(t,r),Math.min(n,i),Math.abs(t-r),Math.abs(n-i));s.lineWidth=this.network.getEditLineWidth(),s.strokeStyle=this.network.getEditLineColor(),s.beginPath(),s.moveTo(t,n),s.lineTo(r,i),s.stroke()}else this._line&&(this.network.getTopDiv().removeChild(this._line),this._line=null)}}),n.network.interaction.CreateShapeNodeInteraction=function(e,t){t||(t=n.ShapeNode),n.Util.isTypeOf(t,n.ShapeNode)?this.shapeNodeFunction=function(e){var r=new t;return r instanceof n.ShapeNode&&e&&r.setPoints(e),r}:this.shapeNodeFunction=t,n.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,e),this.timeStamp=-1},r.ext("twaver.network.interaction.CreateShapeNodeInteraction",n.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){this.network.setEditingElement(!1),this.points=null,this.currentPoint=null,this.lastPoint=null,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},handle_mousedown:function(e){if(e.button!==0)return;var t=this.network.getLogicalPoint(e);if(!t)return;if(e.detail===2||e.timeStamp-this.timeStamp<300){if(this.points){var n=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(n),this.clear();var i=this;setTimeout(function(){i.network.setEditingElement(!1)},0)}}else{this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new Oi);if(this.points.size()>0){var s=this.points.get(this.points.size()-1);if(s.x===t.x&&s.y===t.y)return}this._handle_mousedown(e),this.points.size()>0&&r.isCtrlDown(e)&&(this.horizontal&&(t.y=s.y),this.vertical&&(t.x=s.x),this.horizontal=!1,this.vertical=!1),this.lastPoint=t,this.points.add(t),this.updateMark()}this.timeStamp=e.timeStamp},handle_mousemove:function(e){if(this.points){this.currentPoint=this.network.getLogicalPoint(e);if(r.isCtrlDown(e)){var t=this.currentPoint.x-this.lastPoint.x,n=this.currentPoint.y-this.lastPoint.y;this.horizontal=Math.abs(t)>=Math.abs(n),this.vertical=!this.horizontal}else this.horizontal=!1,this.vertical=!1;this.horizontal&&(this.currentPoint.y=this.lastPoint.y),this.vertical&&(this.currentPoint.x=this.lastPoint.x),this.updateMark()}},updateMark:function(e){if(this.points&&this.points.size()>0&&this.currentPoint){this.mark||(this.mark=b.createCanvas(),this.network.getTopDiv().appendChild(this.mark));var t=new Oi(this.points);t.add(this.currentPoint);var n=m.getRect(t),i=this.network.getEditLineWidth();r.math.grow(n,i,i);var s=b.setCanvas(this.mark,n);s.lineWidth=i,s.strokeStyle=this.network.getEditLineColor(),s.beginPath(),w.drawLinePoints(s,t),s.stroke()}}}),n.network.interaction.CreateShapeLinkInteraction=function(e,t){n.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,e),t||(t=n.ShapeLink),n.Util.isTypeOf(t,n.ShapeLink)?this.linkFunction=function(e,r,i){var s=new t;return s instanceof n.ShapeLink&&(s.setFromNode(e),s.setToNode(r),i&&s.setPoints(i)),s}:this.linkFunction=t},r.ext("twaver.network.interaction.CreateShapeLinkInteraction",n.network.interaction.CreateLinkInteraction,{clear:function(){this.network.setEditingElement(!1),this.points=null,this.polyline&&(this.network.getTopDiv().removeChild(this.polyline),this.polyline=null),n.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(e){if(e.button!==0)return;var t=this.network.getLogicalPoint(e);if(!t)return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var n=this.createLink();n&&this.network.addElementByInteraction(n),this.clear()}else{this.points||(this.points=new Oi);if(this.points.size()>0){var r=this.points.get(this.points.size()-1);if(r.x===t.x&&r.y===t.y)return}this.points.add(t),this.updateMark()}}else this.fromNode=this.currentNode,this.fromNode&&(this.polyline||(this.polyline=b.createCanvas(),this.network.getTopDiv().appendChild(this.polyline))),this.points=null,this.currentNode=null,this.currentPoint=null,this.updateMark()},updateLine:function(){if(this.currentPoint&&this.polyline){var e=new Oi(this.points);e.add(this.fromNode.getCenterLocation(),0),e.add(this.currentPoint);var t=m.getRect(e),n=b.setCanvas(this.polyline,t);n.lineWidth=this.network.getEditLineWidth(),n.strokeStyle=this.network.getEditLineColor(),n.beginPath(),w.drawLinePoints(n,e),n.stroke()}}}),n.network.interaction.CreateOrthogonalLinkInteraction=function(e,t,r,i,s,o){n.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this,e,t),this.linkType=r||"orthogonal",this.isByControlPoint=i,this.splitPercent=s,this.isSplitByPercent=o,this.link=new n.Link,this.link.setStyle("link.type",this.linkType),this.link.setStyle("link.split.by.percent",this.isSplitByPercent),Nr.isFlexionalTypeLink(this.linkType)||Nr.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=n.Styles.getStyle("link.extend")),this.link.setStyle("link.extend",this.splitPercent)):Nr.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=n.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?this.link.setStyle("link.split.percent",this.splitPercent):this.link.setStyle("link.split.value",this.splitPercent))},r.ext("twaver.network.interaction.CreateOrthogonalLinkInteraction",n.network.interaction.CreateLinkInteraction,{clear:function(){this.path&&(this.network.getTopDiv().removeChild(this.path),this.path=null),n.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this)},createLink:function(){var e=n.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this);e.setStyle("link.type",this.linkType),e.setStyle("link.split.by.percent",this.isSplitByPercent);if(this.isByControlPoint){var t=Nr.getControlPoint(e);if(t)return e.SetStyle("link.control.point",t),e}else Nr.isFlexionalTypeLink(this.linkType)||Nr.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=n.Styles.getStyle("link.extend")),e.setStyle("link.extend",this.splitPercent)):Nr.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=n.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?e.setStyle("link.split.percent",this.splitPercent):e.setStyle("link.split.value",this.splitPercent));return e},updateLine:function(){if(this.currentPoint){if(!this.fromNode||this.currentNode===this.fromNode)return;var e,t=this.network.getElementUI(this.fromNode);if(!t)return;e=t.getBodyRect();if(e==null)return;var n;if(this.currentNode&&this.currentNode!==this.fromNode){var r=this.network.getElementUI(this.currentNode);if(!r)return;n=r.getBodyRect()}else n={x:this.currentPoint.x,y:this.currentPoint.y,width:1,height:1};if(!n)return;var i=Nr.calculateOrthogonalAndFlexionalLinkPoints(this.linkType,e,n,this.link);Nr.drawCorner(i,this.link);if(i.size()<2)return;this.line||(this.line=b.createCanvas(),this.network.getTopDiv().appendChild(this.line));var s=b.setCanvas(this.line,m.getLineRect(i));s.lineWidth=this.network.getEditLineWidth(),s.strokeStyle=this.network.getEditLineColor(),s.beginPath(),w.drawLinePoints(s,i),s.stroke()}else this.line&&(this.network.getTopDiv().removeChild(this.line),this.line=null)}}),n.network.interaction.MagnifyInteraction=function(e,t,r,i,s){n.network.interaction.MagnifyInteraction.superClass.constructor.call(this,e),this.zoom=t||2,this.xRadius=r||100,this.yRadius=i||100,this.shape=s||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=b.createCanvas(),this.markCanvas._isIgnored=!0},r.ext("twaver.network.interaction.MagnifyInteraction",n.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove")},tearDown:function(){this.removeListener("mousemove"),this._clear()},handle_mousemove:function(e){var t=this.network.getLogicalPoint(e);if(!t)return;this.lastPoint||this.network.getView().appendChild(this.markCanvas),this.lastPoint=t,this.updateMark()},updateMark:function(){var e=this.network._zoom,t=this.zoom*e,n=this.lastPoint.x*e-this.xRadius,r=this.lastPoint.y*e-this.yRadius,i=this.xRadius*2,s=this.yRadius*2,o={x:this.lastPoint.x-this.xRadius/t,y:this.lastPoint.y-this.yRadius/t,width:i/t,height:s/t},u=this.borderWidth,a=b.createCanvas(),f;a.width=i,a.height=s,this.network.toCanvasByRegion(o,t,a),b.setCanvas(this.markCanvas,n,r,i,s),f=this.markCanvas.getContext("2d"),f.save(),f.beginPath(),w.drawVector(f,this.shape,null,n,r,i,s),f.clip(),f.fillStyle=this.backgroundColor,f.beginPath(),f.rect(n,r,i,s),f.fill(),f.drawImage(a,n,r),f.restore(),f.beginPath(),f.lineWidth=u,w.drawVector(f,this.shape,null,n+u/2,r+u/2,i-u,s-u),f.strokeStyle=this.borderColor,f.stroke()},_clear:function(e){this.lastPoint&&(this.network.getView().removeChild(this.markCanvas),this.lastPoint=null)},getZoom:function(){return this.zoom},setZoom:function(e){this.zoom=e,this.updateMark()},getShape:function(){return this.shape},setShape:function(e){this.shape=e,this.updateMark()},getXRadius:function(){return this.xRadius},setXRadius:function(e){this.xRadius=e,this.updateMark()},getYRadius:function(){return this.yRadius},setYRadius:function(e){this.yRadius=e,this.updateMark()},getBorderColor:function(){return this.borderColor},setBorderColor:function(e){this.borderColor=e,this.updateMark()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(e){this.borderWidth=e,this.updateMark()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(e){this.backgroundColor=e,this.updateMark()}}),n.network.interaction.TouchInteraction=function(e){n.network.interaction.TouchInteraction.superClass.constructor.call(this,e)},r.ext("twaver.network.interaction.TouchInteraction",n.network.interaction.BaseInteraction,{setUp:function(){var e=this.network.getView();b.addEventListener("touchstart","handleTouchstart",e,this),b.addEventListener("touchmove","handleTouchmove",e,this),b.addEventListener("touchend","handleTouchend",e,this),b.addEventListener("touchcancel","handleTouchend",e,this)},tearDown:function(){var e=this.network.getView();b.removeEventListener("touchstart",e,this),b.removeEventListener("touchmove",e,this),b.removeEventListener("touchend",e,this),b.removeEventListener("touchcancel",e,this)},handleTouchstart:function(e){b.preventDefault(e);if(e.touches&&e.touches.length==1){var t=this.network.getLogicalPoint(e),n=this.network.getElementAt(t);this._startTouchTime=new Date,this._startTouchPoint=t;var r=this;n?(this._haveElementUnderTouch=!0,this._startTouchElement=n):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Or.handleLongClicked(r.network,e,n)},1e3)}else e.touches&&e.touches.length==2&&(this._distance=kr.getDistance(e),this._zoom=this.network.getZoom(),this._startTouchPoint={x:e.touches[0].clientX,y:e.touches[0].clientY});this._touchCount=e.touches.length},handleTouchmove:function(e){b.preventDefault(e);if(this._touchCount==2&&e.touches&&e.touches.length==2){this.timer&&clearTimeout(this.timer);if(Math.abs(this._distance-kr.getDistance(e))>=$i.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var t=kr.getDistance(e)/this._distance;this.network.setTouchZoom(this._zoom*t,!1)}else{var n=e.touches[0],r=this._startTouchPoint.x-n.clientX,i=this._startTouchPoint.y-n.clientY,s=this.network.panByOffset(r,i);this._startTouchPoint.x-=r-s.x,this._startTouchPoint.y-=i-s.y}}else if(this._touchCount==1&&e.touches&&e.touches.length==1)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var o=this.network.getLogicalPoint(e),u=this.network.getElementAt(o);if(this.network.isMovingElement()||this._startTouchElement!=null&&this._startTouchElement==u&&this.network.getMovableSelectedElements().contains(u)){var r=o.x-this._startTouchPoint.x,i=o.y-this._startTouchPoint.y;if(Math.abs(r)>=$i.TOUCH_MOVE_THRESHOLD||Math.abs(i)>=$i.TOUCH_MOVE_THRESHOLD)this._startTouchPoint=o,this.network.moveSelectedElements(r,i),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e}),this.timer&&clearTimeout(this.timer))}else{var r=o.x-this._startTouchPoint.x,i=o.y-this._startTouchPoint.y;(Math.abs(r)>=$i.TOUCH_MOVE_THRESHOLD||Math.abs(i)>=$i.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer)}}else{this._moveTouchPoint=this.network.getLogicalPoint(e);var r=this._moveTouchPoint.x-this._startTouchPoint.x,i=this._moveTouchPoint.y-this._startTouchPoint.y;if(Math.abs(r)>=$i.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(i)>=$i.TOUCH_RECT_SELECT_THRESHOLD){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:e}):(this.mark=b.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:e}),this.timer&&clearTimeout(this.timer));var a=m.getRect([this._startTouchPoint,this._moveTouchPoint]);b.setDiv(this.mark,a,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}}},handleTouchend:function(e){b.preventDefault(e);if(this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e});else if(this.network.isSelectingElement()){var t=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(t&&t.size()>0){var n=this.network.getSelectionModel(),r=n.toSelection();t.forEach(function(e){n.contains(e)?r.remove(e):r.add(e)},this),n.setSelection(r)}this.network.fireInteractionEvent({kind:"selectEnd",event:e}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1),this.timer&&clearTimeout(this.timer)}else if(this._startTouchPoint){this._zoomFlag=!1;var i=new Date,s=this.network.getLogicalPoint(e),o=this.network.getElementAt(this._startTouchPoint);this._startTouchPoint&&s&&i.getTime()-this._startTouchTime.getTime()<=500&&m.getDistance(this._startTouchPoint,s)<=20&&(o?this.network.getSelectionModel().contains(o)||this.network.getSelectionModel().setSelection(o):this.network.getSelectionModel().clearSelection(),Or.handleClicked(this.network,e,o),this.timer&&clearTimeout(this.timer),this._endTouchTime&&i.getTime()-this._endTouchTime.getTime()<=500&&m.getDistance(this._endTouchPoint,s)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Or.handleDoubleClicked(this.network,e,o),this.timer&&clearTimeout(this.timer)):(this._endTouchTime=i,this._endTouchPoint=s))}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),n.network.interaction.MSTouchInteraction=function(e){n.network.interaction.MSTouchInteraction.superClass.constructor.call(this,e),this._pointerMap={},this._pointerIdArray=[]},r.ext("twaver.network.interaction.MSTouchInteraction",n.network.interaction.BaseInteraction,{setUp:function(){var e=this.network.getView();b.addEventListener("MSPointerDown","handleTouchstart",e,this),b.addEventListener("MSPointerMove","handleTouchmove",e,this),b.addEventListener("MSPointerUp","handleTouchend",e,this),b.addEventListener("MSPointerCancel","handleTouchend",e,this)},tearDown:function(){var e=this.network.getView();b.removeEventListener("MSPointerDown",e,this),b.removeEventListener("MSPointerMove",e,this),b.removeEventListener("MSPointerUp",e,this),b.removeEventListener("MSPointerCancel",e,this)},handleTouchstart:function(e){this.network.isFocusOnClick()&&n.Util.setFocus(this.network._view);if(this.network.isSelectingElement()&&e.pointerType==e.MSPOINTER_TYPE_MOUSE)return;var t=this.network.getLogicalPoint(e),i=new Date;e.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(e),this._pointerMap[e.pointerId]||(this._pointerIdArray.push(e.pointerId),this._pointerMap[e.pointerId]=e);if(this._pointerIdArray.length==1){var s=this.network.getElementAt(t);this._startTouchElement=s,this._startClientPoint={x:e.clientX,y:e.clientY},Or.handleClicked(this.network,e,s),this._startTouchTime&&this._startTouchPoint&&i.getTime()-this._startTouchTime.getTime()<=500&&m.getDistance(this._startTouchPoint,t)<=20?(Or.handleDoubleClicked(this.network,e,s),this._doubleClick=!0):(b.handle_mousedown(this,e),this._startTouchPoint=t,this._startTouchTime=i);var o=this.network.getSelectionModel();s?r.isCtrlDown(e)?o.contains(s)?o.removeSelection(s):o.appendSelection(s):o.contains(s)||o.setSelection(s):r.isCtrlDown(e)||o.clearSelection()}else this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(e){if(this._startTouchPoint==null||this._pointerIdArray.length==0||!this._pointerMap[e.pointerId]||m.getDistance({x:this._pointerMap[e.pointerId].pageX,y:this._pointerMap[e.pointerId].pageY},{x:e.pageX,y:e.pageY})<=10)return;this._pointerMap[e.pointerId]=e;if(this._pointerIdArray.length==2){var t=this._getDistance()/this._distance;this.network.setZoom(this._zoom*t,!1)}},handleTouchend:function(e){this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e}));if(this.network.isSelectingElement()){var t=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(t&&t.size()>0){var n=this.network.getSelectionModel(),r=n.toSelection();t.forEach(function(e){n.contains(e)?r.remove(e):r.add(e)},this),n.setSelection(r)}this.network.fireInteractionEvent({kind:"selectEnd",event:e}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1)}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);var i=-1;for(var s=0;s<this._pointerIdArray.length;s++)if(this._pointerIdArray[s]==e.pointerId){i=s;break}i>=0&&this._pointerIdArray.splice(i,1),delete this._pointerMap[e.pointerId]},_getDistance:function(){return m.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(e){if(this._startTouchPoint&&this._pointerIdArray.length==1){this._moveTouchPoint={x:this._startTouchPoint.x+(e.clientX-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(e.clientY-this._startClientPoint.y)/this.network.getZoom()};if(m.getDistance(this._startTouchPoint,this._moveTouchPoint)<3)return;if(this._startTouchElement==null&&this.network.isRectSelectEnabled()){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:e}):(this.mark=b.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:e}));var t=m.getRect([this._startTouchPoint,this._moveTouchPoint]);b.setDiv(this.mark,t,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}else{var n=this.network.getElementAt(this._moveTouchPoint),r=this._moveTouchPoint.x-this._startTouchPoint.x,i=this._moveTouchPoint.y-this._startTouchPoint.y;if(this._startTouchElement==null&&!this.network.isRectSelectEnabled())var s=this.network.panByOffset(-r,-i);else if(this.network.isMovingElement()||this._startTouchElement!=null&&n==this._startTouchElement&&this.network.getMovableSelectedElements().contains(n))this.network.moveSelectedElements(r,i),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e}));this._startClientPoint.x=e.clientX,this._startClientPoint.y=e.clientY}}},handle_mouseup:function(e){this.handleTouchend(e),this._pointerIdArray=[],this._pointerMap={}}});var rs={_hitCanvas:null,getHitCanvas:function(e,t){this._hitCanvas==null&&(this.
_hitCanvas=b.createCanvas()),arguments.length==0&&(e=2,t=2),this._hitCanvas.setAttribute("width",""+e-1),this._hitCanvas.setAttribute("height",""+t-1),this._hitCanvas.setAttribute("width",""+e),this._hitCanvas.setAttribute("height",""+t);var n=this.getCtx(this._hitCanvas);return n.clearRect(0,0,e,t),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(e){return e.getContext("2d")},render:function(e,n,r){n!=t&&(e.fillStyle=n,e.fill()),r!=t&&(e.strokeStyle=r,e.stroke())},text:function(e,t,n,r,i,s){e.textAlign="center",e.textBaseline="middle",i!=null&&(e.fillStyle=i,e.fillText(t,n,r)),s&&(e.strokeStyle=s,e.strokeText(t,n,r))},circle:function(e,t,n,r,i,s){e.arc(t,n,r,0,2*Math.PI,!0),e.closePath(),this.render(e,i,s)},rect:function(e,t,n,r,i,s,o){e.rect(t,n,r,i),e.closePath(),this.render(e,s,o)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(e,t,n,r,i,s){var o=0;return i<=0?o|=this.OUT_LEFT|this.OUT_RIGHT:e<n?o|=this.OUT_LEFT:e>n+i&&(o|=this.OUT_RIGHT),s<=0?o|=this.OUT_TOP|this.OUT_BOTTOM:t<r?o|=this.OUT_TOP:t>r+s&&(o|=this.OUT_BOTTOM),o},intersectsLine:function(e,t,n,r,i,s,o,u){var a,f;if((f=this.outcode(n,r,i,s,o,u))==0)return!0;while((a=this.outcode(e,t,i,s,o,u))!=0){if((a&f)!=0)return!1;if((a&(this.OUT_LEFT|this.OUT_RIGHT))!=0){var l=i;(a&this.OUT_RIGHT)!=0&&(l+=o),t+=(l-e)*(r-t)/(n-e),e=l}else{var c=s;(a&this.OUT_BOTTOM)!=0&&(c+=u),e+=(c-t)*(n-e)/(r-t),t=c}}return!0}};n.canvas={},n.canvas.interaction={},n.canvas.Network=function(e){n.canvas.Network.superClass.constructor.apply(this,arguments),this._rootCanvas=b.createCanvas(),this._topCanvas=b.createCanvas(),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._visibleMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new n.List,this._topAttachmentList=new n.List,this.setElementBox(e?e:new n.ElementBox),a||(this._view=b.createView("hidden"),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),h.isTouchable?h.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(n.Defaults.NETWORK_TOOLTIP_ENABLED));var t=this;this._flowLink=function(){if(t.isMovingElement()||t.isSelectingElement()||t.isEditingElement()||t._box._layoutMovingElements)return;t._flowLinkQuickFinder||(t._flowLinkQuickFinder=new n.QuickFinder(t._box,"link.flow","style"));var e=t._flowLinkQuickFinder.find(!0);e.forEach(function(e){e._styleMap["link.flow.offset"]=t.getLinkFlowOffset(e);var n=t.getElementUI(e);n.invalidate(!1)})},n.imageUtil.addEventListener(this.invalidateElementUIs,this)},r.ext("twaver.canvas.Network",n.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","paddingRight","paddingBottom","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","debug","showShadowInEdit"],_currentSubNetwork:null,_subNetworkAnimate:n.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!0,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:n.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:n.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:n.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:$i.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:n.Defaults.CANVASUI_FUNCTION,_doubleClickToUpSubNetwork:n.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:n.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:n.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:n.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:n.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:n.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:n.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:n.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:n.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:n.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:n.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:n.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:n.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:n.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:n.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:n.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:n.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:n.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:n.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:n.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:n.Defaults.NETWORK_RESIZE_ANIMATE,_editPointSize:n.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:n.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:n.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:n.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:n.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:n.Defaults.NETWORK_EDIT_LINE_WIDTH,_rotatePointSize:n.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:n.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:n.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:n.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:n.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:$i.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:$i.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:$i.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:$i.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:$i.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:$i.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:$i.NETWORK_SELECTION_TOLERANCE,_invalidateElementVisibility:!1,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_paddingRight:0,_paddingBottom:0,_transparentSelectionEnable:n.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_debug:!1,_showShadowInEdit:!1,adjustBounds:function(e){if(a)this._rootCanvas=new u(e.width,e.height),this._topCanvas=new u(e.width,e.height),this.setViewRect(e.x,e.y,e.width,e.height);else{var t=!1,r=this._view.style;r.left==e.x+"px"&&r.top==e.y+"px"&&r.width==e.width+"px"&&r.height==e.height+"px"&&(t=!0),n.canvas.Network.superClass.adjustBounds.apply(this,arguments);if(t==1)return;var i=this._view.offsetWidth,s=this._view.offsetHeight;this._rootCanvas.setAttribute("width",i),this._rootCanvas.setAttribute("height",s),this._topCanvas.setAttribute("width",i),this._topCanvas.setAttribute("height",s),this.setViewRect(this.viewRect.x,this.viewRect.y,i,s)}typeof n.gis=="undefined"&&(n.Util.makeHighRes(this._rootCanvas),n.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()},getLabel:function(e){return e.getStyle("network.label")||e.getName()},getBackgroundImage:function(){return this._backgroundImage},setBackgroundImage:function(e){if(this._backgroundImage!=e){var t=this._backgroundImage;this._backgroundImage=e;var n=this._backgroundImage;if(n&&!n._viewRect)if(n.width>0)n._viewRect={x:0,y:0,width:n.width,height:n.height},this.validateCanvasSize(),this.firePropertyChange("backgroundImage",t,n);else{var r=this;n.onload=function(){n._viewRect={x:0,y:0,width:n.width,height:n.height},r.validateCanvasSize(),r.firePropertyChange("backgroundImage",t,n),n.onload=null}}else this.firePropertyChange("backgroundImage",t,n),this.validateCanvasSize()}},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){!a&&lr.twm(this);if(this._invalidateElementVisibility==1){this._invalidateElementVisibility=!1;var e=this.getElementBox().getDatas()._as,t=e.length,n={},r,i,s,o=this._visibleFunction,u=this._box._layerBox.size()===1?this._box._layerBox._defaultLayer:null;for(r=0;r<t;r++)i=e[r],n[i._id]=this.isVisible(i,o,u);if(this._visibleMap)for(r=0;r<t;r++)i=e[r],n[i._id]!==this._visibleMap[i._id]&&(s=this._elementUIMap[i._id],s&&s.invalidate());for(r=0;r<t;r++)i=e[r],s=this._elementUIMap[i._id],s&&s.validate();this._visibleMap=n,this.paintRoot()}this.validateCanvasSize(),this._repaintTopFlag==1&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(e){e?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(e){var t=this._linkFlowInterval;this._linkFlowInterval=e,this.firePropertyChange("linkFlowInterval",t,e),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(e){if(!e)throw"ElementBox can not be null";if(this._box===e)return;var t=this._box;t&&(t.removeDataBoxChangeListener(this.handleElementBoxChange,this),t.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),t.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),t.removeIndexChangeListener(this.handleIndexChange,this),t.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),t.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),t.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||t.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=e,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new n.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(e):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",t,this._box)},handleElementBoxChange:function(e){var t=e.data;if(e.kind==="add")this.createElementUI(t),this.invalidateBundleLink(t);else if(e.kind==="remove"){var n=this.getElementUI(t);n&&(n.dispose(),delete this._elementUIMap[t.getId()]),t===this._currentSubNetwork&&this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null)}else if(e.kind==="clear"){for(var r in this._elementUIMap)this._elementUIMap[r]&&this._elementUIMap[r].dispose&&this._elementUIMap[r].dispose();this._elementUIMap={},this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null)}this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(e){var t=e.source,n=this.getElementUI(t);n&&n.handlePropertyChange(e),this.invalidateBundleLink(t),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(e){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(e){e.property==="editable"&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(e){e.datas.forEach(function(t){var n=this.getElementUI(t);n&&n.handleSelectionChange(e)},this);var t=this.getSelectionModel().getLastData();t&&(e.kind==="append"||e.kind==="set")&&(this.isMakeVisibleOnSelected()&&this.makeVisible(t),this.isSendToTopOnSelected()&&this.sendToTop(t)),this.invalidateElementVisibility()},sendToTop:function(e){if(!this._box.contains(e))return;var t=e;while(t._parent&&this.isVisible(t._parent)){t=t._parent;if(!t)break}t!==e&&this._box.adjustElementIndex(t),this._box.adjustElementIndex(e)},getScopeRect:function(e){var t=this._zoom;if(e==="viewsize")return{x:this._unionBounds.x-this.viewRect.x,y:this._unionBounds.y-this.viewRect.y,width:this._unionBounds.width,height:this._unionBounds.height};if(e==="viewport"){if(this.viewRect)return r.cloneRect(this.viewRect)}else if(e==="rootcanvas")return{x:this.viewRect.x,y:this.viewRect.y,width:(Math.abs(this.viewRect.x-this._unionBounds.x)+this._unionBounds.width)*t,height:(Math.abs(this.viewRect.y-this._unionBounds.y)+this._unionBounds.height)*t};return{x:0,y:0,width:0,height:0}},getViewRect:function(){return this.viewRect?r.clone(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},getUnionBounds:function(){return this._unionBounds},setViewOffSet:function(e,t){var n=this.viewRect.x,r=this.viewRect.y,i=this.viewRect.width,s=this.viewRect.height;this.setViewRect(n+e,r+t,i,s)},setViewRect:function(e,t,n,r){this.isLimitViewInCanvas()==1&&(e<0&&(e=0),n>this.realWidth?e=0:e+n>this.realWidth&&(e=this.realWidth-n),t<0&&(t=0),r>this.realHeight?t=0:t+r>this.realHeight&&(t=this.realHeight-r));var i=this.viewRect;if(this.viewRect!=null&&e==this.viewRect.x&&t==this.viewRect.y&&n==this.viewRect.width&&r==this.viewRect.height)return;this.viewRect={x:e,y:t,width:n,height:r},this.firePropertyChange("viewRect",i,this.viewRect),this.invalidateElementVisibility()},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(e){this.hScrollBarVisible=e},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(e){this.vScrollBarVisible=e},dispose:function(){n.imageUtil.removeEventListener(this.invalidateElementUIs,this);for(var e in this._elementUIMap){var t=this._elementUIMap[e];t.curInterval&&clearTimeout(t.curInterval)}this.setInteractions(null)},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(e){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){if(this._invalidateCanvasSizeFlag==0)return;this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize()},_validateCanvasSize:function(){if(this.isMovingElement())return;if(this.isAutoValidateCanvasSize()==0){this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};return}var e=this.getElementBox().getDatas(),t=e.size();if(t>0){var n={x:0,y:0,width:0,height:0};for(var r=0;r<t;r++){var i=e.get(r);if(this._visibleMap[i._id]){var s=this._elementUIMap[i._id];s&&(n=m.unionRect(n,s._viewRect))}}var o=this.getBackgroundImage();o&&(n=m.unionRect(n,o._viewRect));if(this.realWidth==(n.x+n.width)*this.getZoom()&&this.realHeight==(n.y+n.height)*this.getZoom())return;var u=this.getZoom();this.realWidth=(n.x+n.width)*u+this._paddingRight,this.realHeight=(n.y+n.height)*u+this._paddingBottom,this._unionBounds={x:n.x*u,y:n.y*u,width:n.width*u+this._paddingRight,height:n.height*u+this._paddingRight}}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)},getElementUI:function(e){return e==null?null:this._elementUIMap[e._id]},createElementUI:function(e){var t=this._elementUIMap[e.getId()];t||(t=this._elementUIFunction(this,e),t&&(this._elementUIMap[e.getId()]=t))},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(e){if(!e)throw"ElementUIFunction can not be null";if(this._elementUIFunction===e)return;var t=this._elementUIFunction;this._elementUIFunction=e,this.firePropertyChange("elementUIFunction",t,e),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())},invalidateElementUI:function(e,t){var n=this.getElementUI(e);n&&n.invalidate(t)},invalidateElementUIs:function(e){for(var t in this._elementUIMap){var n=this._elementUIMap[t];n.invalidate(e)}},invalidateSelectedElementUIs:function(e){this.getSelectionModel().getSelection().forEach(function(t){this.invalidateElementUI(t,e)},this)},invalidateBundleLink:function(e){if(e instanceof n.Link&&e._bundleLinks){var t=this._elementUIMap;e._bundleLinks.forEachSiblingLink(function(n){if(n!==e){var r=t[n._id];r&&r.invalidate(!1)}},this)}},paintRoot:function(){var e=this._rootCanvas.getContext("2d");e.clearRect(0,0,this._rootCanvas.width,this._rootCanvas.height),this.visibleList=new n.List,this._topAttachmentList=new n.List;if(this.getElementBox()==null)return;Li.draw(e,this);var i=this.getElementBox().getDatas()._as,s=i.length;e.save(),e.scale(this.getZoom(),this.getZoom()),e.translate(-this.viewRect.x/this.getZoom(),-this.viewRect.y/this.getZoom()),this.paintBottom(e);var o={x:this.viewRect.x/this.getZoom(),y:this.viewRect.y/this.getZoom(),width:this.viewRect.width/this.getZoom(),height:this.viewRect.height/this.getZoom()},u=this.getBackgroundImage(),a=this.getBackgroundImageRect();u instanceof c&&(a?e.drawImage(u,a.x,a.y,a.width,a.height):e.drawImage(u,0,0,u.width,u.height),u._viewRect={x:0,y:0,width:u.width,height:u.height});if(typeof u=="string"){var f=r.getImageAsset(u),l={x:0,y:0,width:f.getWidth(),height:f.getHeight()};Rr(e,u,null,l,null,this)}var h=this._box._layerBox,p,d,v,m;if(h.size()===1)for(p=0;p<s;p++)d=i[p],this._visibleMap[d._id]&&(v=this._elementUIMap[d._id],v!=null&&this._isInView(v,o)?(v.paint(e),v.setAttachmentVisible&&v.setAttachmentVisible(!0),this.visibleList.add(d)):v.setAttachmentVisible&&v.setAttachmentVisible(!1));else h.forEachByDepthFirst(function(t){for(p=0;p<s;p++)d=i[p],h.getLayerByElement(d)===t&&this._visibleMap[d._id]&&(v=this._elementUIMap[d._id],v!=null&&this._isInView(v,o)?(v.paint(e),v.setAttachmentVisible&&v.setAttachmentVisible(!0),this.visibleList.add(d)):v.setAttachmentVisible&&v.setAttachmentVisible(!1))},null,this);s=this._topAttachmentList.size();for(p=0;p<s;p++)m=this._topAttachmentList.get(p),m.getElementUI().paintAttachment(e,m);if(this._xyz){var g=this._xyz,y=g.markText,b=g.type,w=g.expired,E=g.innerHTML,S=0,x=0,s,T=1,N=this.viewRect;e.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),e.scale(1/this.getZoom(),1/this.getZoom());var C=this.getZoom();y!=t&&y!=null&&y!=""||b=="2"?(e.font="15px Arial sans-serif",s=r.g.getTextSize(e.font,E),e.fillStyle="red",S=N.width-s.width,x=N.height-20):(e.font="10px Arial sans-serif",s=r.g.getTextSize(e.font,E),S=N.width/2-s.width/2,x=N.height/2),e.fillText(E,S,x)}e.restore()},paintBottom:function(e){},_isInView:function(e,t){return m.intersects(t,e._viewRect)},paintTopCanvas:function(){var e=this._topCanvas.getContext("2d");e.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(e)},paintMarker:function(e){var t=this.markerList.size();for(var n=0;n<t;n++){var r=this.markerList.get(n);r.paint(e)}},getLayerByElement:function(e){return this._box.getLayerBox().getLayerByElement(e)},getLogicalPoint:function(e){var t;if(h.isTouchable&&e.changedTouches&&e.changedTouches.length>0){var n=this._view.getBoundingClientRect(),r=e.changedTouches[0],i=h.isAndroid?0:kr.scrollLeft(),s=h.isAndroid?0:kr.scrollTop();return t={x:(r.clientX+this.viewRect.x-n.left-i)/this._zoom,y:(r.clientY+this.viewRect.y-n.top-s)/this._zoom},t}return h.isFirefox?t={x:(e.layerX+this.viewRect.x)/this.getZoom(),y:(e.layerY+this.viewRect.y)/this.getZoom()}:t={x:(e.offsetX+this.viewRect.x)/this.getZoom(),y:(e.offsetY+this.viewRect.y)/this.getZoom()},t},getElementAt:function(e,t){if(this.visibleList==null)return null;arguments.length===1&&(t=!0);var n,r;e.target?n=this.getLogicalPoint(e):e.event?e.event.target&&(n=this.getLogicalPoint(e.event)):n=e;if(this._topAttachmentList!=null){var i=this._topAttachmentList.size();for(var s=i-1;s>=0;s--){var o=this._topAttachmentList.get(s);r=o.getElement();if((!t||this.isSelectable(r))&&o.hit(n.x,n.y))return r}}if(this.visibleList!=null){var u=this.visibleList.size();for(var a=u-1;a>=0;a--){var f=this.visibleList.get(a),l=this.getElementUI(f);if((!t||this.isSelectable(f))&&l&&l.hit(n.x,n.y))return f}}return null},hitTest:function(e){var t=this.getElementAt(e);if(!t)return null;var n=this.getElementUI(t);if(!n)return null;var r;return e.target?r=this.getLogicalPoint(e):r=e,n.hitTest(r.x,r.y)},getElementsAtRect:function(e,r,i,s){var o=new n.List;if(this.visibleList==null)return o;s=s===t?!0:s;var u=this.visibleList.size();for(var a=u-1;a>=0;a--){var f=this.visibleList.get(a),l=this.getElementUI(f);l&&(!i||i(l._element))&&(s&&this.isSelectable(l._element)||!s)&&(r?l.intersects(e)&&o.add(f):m.contains(e,l.getViewRect())&&o.add(f))}return o},getPosition:function(e,t,r,i,s){var o,u=t instanceof n.canvas.ElementUI?t:this.getElementUI(t);if(u)if(e==="from"||e==="to"){if(u.getFromPosition){o=e==="from"?u.getFromPosition(i,s):u.getToPosition(i,s);if(o)return r?{x:o.x-r.width/2,y:o.y-r.height/2}:o}}else e==="hotspot"?o=u.getHotSpot():o=y.get(e,u.getBodyRect(),r);!o&&t.getRect&&(o=y.get(e,t.getRect(),r));if(o)return{x:o.x+i,y:o.y+s};throw"position '"+e+"' object '"+t+"'"},isValidEvent:function(e){if(!e)return!1;var t,n;if(e.currentTarget===this._view){h.isFirefox?(t=e.layerX,n=e.layerY):(t=e.offsetX,n=e.offsetY);if(this.isHScrollBarVisible()==1&&n>=this.viewRect.height-this.getScrollBarWidth())return!1;if(this.isVScrollBarVisible()==1&&t>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(e){this.markerList.add(e),this.repaintTopCanvas()},removeMarker:function(e){this.markerList.remove(e),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(e){return this._box.contains(e)?e instanceof n.Link?!1:this._movableFunction&&!this._movableFunction(e)?!1:this.getLayerByElement(e).isMovable():!1},hasMovableSelectedElements:function(){var e=this.getSelectionModel().getSelection();for(var t=0;t<e.size();t++){var n=e.get(t);if(this.isMovable(n))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(e){return this.isMovable(e)},this)},moveSelectedElements:function(e,t,r,i){if(e===0&&t===0)return;var s=this.getMovableSelectedElementsRect();if(s==null)return;this._limitElementInPositiveLocation&&(s.x+e<0&&(e=-s.x),s.y+t<0&&(t=-s.y)),n.Util.moveElements(this.getMovableSelectedElements(),e,t,r,i,this)},getMovableSelectedElementsRect:function(){var e=this.getMovableSelectedElements();if(e.size()===0)return null;var t=null;for(var n=0,r=e.size();n<r;n++){var i=e.get(n);if(i instanceof es){var s=this.getElementUI(i);s&&(t=m.unionRect(t,s.getViewRect()))}}return t},isVisible:function(e,t,r){if(!this._box.contains(e))return!1;if(!e.isVisible())return!1;arguments.length!==3&&(t=this._visibleFunction);if(t&&!t(e))return!1;if(!(r||this._box._layerBox.getLayerByElement(e))._visible)return!1;if(xr.getSubNetwork(e)!==this._currentSubNetwork)return!1;if(e instanceof n.Link){if(!this._noAgentLinkVisible){if(!e._fromAgent||!e._toAgent)return!1;if(!this.isVisible(e._fromAgent,t,r)||!this.isVisible(e._toAgent,t,r))return!1}if(e.getBundleIndex()>0&&e.getBundleCount()>1&&!e.getStyle("link.bundle.expanded"))return!1}else{var i=e._parent;while(i&&!i.ISubNetwork){if(i instanceof n.Group)if(!i.isExpanded()||!this.isVisible(i,t,r))return!1;i=i._parent}}return e.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(e){var t=this._visibleFunction;this._visibleFunction=e,this.firePropertyChange("visibleFunction",t,e),this.invalidateElementVisibility()},isEditable:function(e){return this._box.contains(e)?this._editableFunction&&!this._editableFunction(e)?!1:this.getLayerByElement(e).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(e){var t=this._editableFunction;this._editableFunction=e,this.firePropertyChange("editableFunction",t,e),this.invalidateSelectedElementUIs(!0)},isRotatable:function(e){return this._rotatableFunction&&!this._rotatableFunction(e)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(e){var t=this._rotatableFunction;this._rotatableFunction=e,this.firePropertyChange("rotatableFunction",t,e),this.invalidateSelectedElementUIs(!0)},isLinkable:function(e){return this._linkableFunction==null||this._linkableFunction(e)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(e){var t=this._linkableFunction;this._linkableFunction=e,this.firePropertyChange("linkableFunction",t,e),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(e){var t=e.getStyle("shadow.color");return!t&&this.isSelected(e)&&e.getStyle("select.style")==="shadow"?e.getStyle("select.color"):t},getSelectColor:function(e){return e.getStyle("select.color")},getAlarmLabel:function(e){var t=e.getAlarmState().getHighestNewAlarmSeverity();if(t){var n=e.getAlarmState().getNewAlarmCount(t)+t.nickName;return e.getAlarmState().hasLessSevereNewAlarms()&&(n+="+"),n}return null},getLinkHandlerLabel:function(e){return e.isBundleAgent()?"+("+e.getBundleCount()+")":null},setInteractions:function(e){var t=this._interactions;t&&t.forEach(function(e){e.tearDown()}),this._interactions=e,e&&e.forEach(function(e){e.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",t,e)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(e,t){var r=[new n.canvas.interaction.DefaultInteraction(this),new n.canvas.interaction.SelectInteraction(this),new n.canvas.interaction.MoveInteraction(this,e),new n.canvas.interaction.ScrollInteraction(this)];t&&r.push(new n.canvas.interaction.MoveLinkInteraction(this,e)),this.setInteractions(r)},setTouchInteractions:function(){this.setInteractions([new n.canvas.interaction.DefaultInteraction(this),new n.canvas.interaction.SelectInteraction(this),new n.canvas.interaction.MoveInteraction(this,!1),new n.canvas.interaction.ScrollInteraction(this),new n.canvas.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new n.canvas.interaction.ScrollInteraction(this),new n.canvas.interaction.MSTouchInteraction(this)])},setEditInteractions:function(e){this.setInteractions([new n.canvas.interaction.DefaultInteraction(this),new n.canvas.interaction.SelectInteraction(this),new n.canvas.interaction.EditInteraction(this,e),new n.canvas.interaction.MoveInteraction(this,e),new n.canvas.interaction.ScrollInteraction(this)])},setCreateElementInteractions:function(e){this.setInteractions([new n.canvas.interaction.DefaultInteraction(this),new n.canvas.interaction.CreateElementInteraction(this,e)])},setCreateLinkInteractions:function(e){this.setInteractions([new n.canvas.interaction.DefaultInteraction(this),new n.canvas.interaction.CreateLinkInteraction(this,e),new n.canvas.interaction.ScrollInteraction(this)])},setCreateShapeLinkInteractions:function(e){this.setInteractions([new n.canvas.interaction.DefaultInteraction(this),new n.canvas.interaction.CreateShapeLinkInteraction(this,e),new n.canvas.interaction.ScrollInteraction(this)])},setCreateShapeNodeInteractions:function(e){this.setInteractions([new n.canvas.interaction.DefaultInteraction(this),new n.canvas.interaction.CreateShapeNodeInteraction(this,e),new n.canvas.interaction.ScrollInteraction(this)])},setPanInteractions:function(){this.setInteractions([new n.canvas.interaction.DefaultInteraction(this),new n.canvas.interaction.PanInteraction(this),new n.canvas.interaction.ScrollInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new n.canvas.interaction.DefaultInteraction(this),new n.canvas.interaction.SelectInteraction(this),new n.canvas.interaction.MoveInteraction(this),new n.canvas.interaction.ScrollInteraction(this),new n.canvas.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(e){var t=this._hasEditInteraction;this._hasEditInteraction=e,this.firePropertyChange("hasEditInteraction",t,e)},addElementByInteraction:function(e){e.getParent()||e.setParent(this._currentSubNetwork),this._box.add(e),this.getSelectionModel().setSelection(e),this.fireInteractionEvent({kind:"createElement",element:e})},getToolTip:function(e){if(e){var t=e.getToolTip();return t?t:e.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(e){this._toolTipEnabled=e;if(e){if(!this._toolTipListener){var t=this;this._toolTipListener=function(e){if(t.isMovingElement()){Ar.hideToolTip();return}var n=t.getElementAt(e);if(t._preElement===n)return;t._preElement=n;if(n){var r=t.getToolTip(n);Ar.showToolTip({x:e.pageX,y:e.pageY},r);var i=Ar.getToolTipDiv(),i=Ar.getToolTipDiv();if(i.children.length>0){var s=t._view.getBoundingClientRect(),o=i.getBoundingClientRect();o.width+o.left>s.width+s.left&&(i.style.left=s.width+s.left-o.width+(l.documentElement.scrollLeft||l.body.scrollLeft)+"px"),o.height+o.top>s.height+s.top&&(i.style.top=s.height+s.top-o.height+(l.documentElement.scrollTop||l.body.scrollTop)+"px")}return}Ar.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ar.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(e){e=this.checkZoom(e);var t=this._zoom;if(this._zoom==e)return;var n={x:(this.viewRect.x+this.viewRect.width/2)/this.getZoom()*e,y:(this.viewRect.y+this.viewRect.height/2)/this.getZoom()*e};this._zoom=e,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.setViewRect(n.x-this.viewRect.width/2,n.y-this.viewRect.height/2,this.viewRect.width,this.viewRect.height),this.firePropertyChange("zoom",t,this._zoom)},getZoom:function(){return this._zoom},setTouchZoom:function(e){this.setZoom(e,!1)},zoomOverview:function(e){if(this.realWidth<=0||this.realHeight<=0)return;var t=this.realWidth/this.getZoom(),n=this.realHeight/this.getZoom(),r=this.viewRect.width/t,i=this.viewRect.height/n,s=Math.min(r,i);this.setZoom(s)},zoomReset:function(){this.setZoom(1)},zoomIn:function(){this.setZoom(this.getZoom()*1.2)},zoomOut:function(){this.setZoom(this.getZoom()/1.2)},upSubNetwork:function(e,t){this._currentSubNetwork&&this.setCurrentSubNetwork(xr.getSubNetwork(this._currentSubNetwork),e,t)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(
e,t,r){n.animate.AnimateManager.endAnimate();if(t){if(this._currentSubNetwork===e)return;if(e&&!this._box.contains(e))throw e+" is not contained in this network's elementBox";var i=new n.animate.AnimateSubNetwork(this,e,r);n.animate.AnimateManager.start(i)}else this._setCurrentSubNetwork(e),r&&r()},_setCurrentSubNetwork:function(e){if(this._currentSubNetwork===e)return;if(e&&!this._box.contains(e))throw e+" is not contained in this network's elementBox";var t=this._currentSubNetwork;this._currentSubNetwork=e,this.firePropertyChange("currentSubNetwork",t,e),this.invalidateElementVisibility(),this.invalidateCanvasSize()},makeVisible:function(e){var t=this.getElementUI(e);if(!t)return;var i=xr.getSubNetwork(e);if(i!==this._currentSubNetwork){var s=this;this.setCurrentSubNetwork(i,this.isSubNetworkAnimate(),function(){r.callLater(s.makeVisible,s,[e])});return}var o=e;while((o=o.getParent())&&o!==i)o instanceof n.Group&&o.setExpanded(!0);var u=t.getViewRect();if(!u)return;var a={x:u.x*this.getZoom(),y:u.y*this.getZoom(),width:u.width*this.getZoom(),height:u.height*this.getZoom()};m.intersects(this.viewRect,a)||this.isVisible(e)&&r.callLater(this.centerByLogicalPoint,this,[a.x+a.width/2,a.y+a.height/2])},centerByLogicalPoint:function(e,t,n){var r=e-this.viewRect.width/2,i=t-this.viewRect.height/2;this.setViewRect(r,i,this.viewRect.width,this.viewRect.height)},panByOffset:function(e,t){this.setViewOffSet(e,t)},getIconsNames:function(e){return e.getStyle("icons.names")},getIconsColors:function(e){return e.getStyle("icons.colors")},getLinkFlowStepping:function(e){var t=parseInt(e.getStyle("link.flow.stepping"));return t||(t=$i.NETWORK_LINK_FLOW_STEPPING),t},getLinkFlowOffset:function(e){var t=e.getStyle("link.flow.offset");return isNaN(t)&&(t=0),t+this.getLinkFlowStepping(e)},toCanvas:function(e,t,r,i,s,o){r||(r=b.createCanvas()),r.setAttribute("width",e),r.setAttribute("height",t),r._viewRect?(r._viewRect.width=e,r._viewRect.height=t):r._viewRect={x:0,y:0,width:e,height:t};var u=r.getContext("2d");u.translate(-s,-o),u.clearRect(0,0,e,t),Li.draw(u,this);if(this._view.clientWidth===0||this._view.clientHeight===0)return r;var a=e/this.realWidth*this.getZoom(),f=t/this.realHeight*this.getZoom();u.scale(i,i);var l=this.getElementBox().getDatas()._as,c=l.length;this._topAttachmentList=new n.List;var h=this.getElementBox().getLayerBox(),p=h.getRoots(),d=p.size(),v,m,g,y,w,E;if(d===1)for(g=0;g<c;g++)y=l[g],this._visibleMap[y._id]&&(w=this._elementUIMap[y._id],w!=null&&w.paint(u));else for(v=0;v<d;v++){m=p.get(v);for(g=0;g<c;g++)y=l[g],h.getLayerByElement(y)===m&&this._visibleMap[y._id]&&(w=this._elementUIMap[y._id],w!=null&&w.paint(u))}c=this._topAttachmentList.size();for(g=0;g<c;g++)E=this._topAttachmentList.get(g),E.getElementUI().paintAttachment(u,E);return r},toCanvasByRegion:function(e,t,r){r||(r=b.createCanvas());var i=e.width*t,s=e.height*t;r.setAttribute("width",i),r.setAttribute("height",s),r._viewRect?(r._viewRect.width=i,r._viewRect.height=s):r._viewRect={x:0,y:0,width:i,height:s};var o=r.getContext("2d");o.clearRect(0,0,i,s),Li.draw(o,this);if(this._view.clientWidth===0||this._view.clientHeight===0)return r;o.save(),o.scale(t,t),o.beginPath(),o.translate(-e.x,-e.y);var u=this.getElementBox().getDatas()._as,a=u.length;this._topAttachmentList=new n.List;var f=this.getBackgroundImage();if(f&&f._viewRect&&m.intersects(e,f._viewRect)){var e=m.intersection(e,f._viewRect),l=f._viewRect;try{o.drawImage(f,l.x,l.y,l.width,l.height)}catch(c){}}var h=this.getElementBox().getLayerBox(),p=h.getRoots(),d=p.size(),v,g,y,w,E,S;if(d===1)for(y=0;y<a;y++)w=u[y],this._visibleMap[w._id]&&(E=this._elementUIMap[w._id],E!=null&&m.intersects(e,E._viewRect)&&E.paint(o));else for(v=0;v<d;v++){g=p.get(v);for(y=0;y<a;y++)w=u[y],h.getLayerByElement(w)===g&&this._visibleMap[w._id]&&(E=this._elementUIMap[w._id],E!=null&&m.intersects(e,E._viewRect)&&E.paint(o))}a=this._topAttachmentList.size();for(y=0;y<a;y++)S=this._topAttachmentList.get(y),S.getElementUI().paintAttachment(o,S);return o.restore(),r},getGroupChildrenRects:function(e){var t=new Oi;return e.getChildren().forEach(function(e){if(e instanceof es){var n=this.getElementUI(e);if(n){var r=n.getViewRect();r&&t.add(r)}}},this),t},getBackgroundImageRect:function(){return null},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(e){var t=this._linkPathFunction;this._linkPathFunction=e,this.firePropertyChange("linkPathFunction",t,e),this.invalidateElementUIs()},onClickElement:function(e,t){},onClickBackground:function(e){},onDoubleClickElement:function(e,t){},onDoubleClickBackground:function(e){},onLongClickElement:function(e,t){},onLongClickBackground:function(e){},onMouseMove:function(e,t){},onMouseEnter:function(e,t){},onMouseLeave:function(e,t){},setMovingElement:function(e){if(e==this._movingElement)return;var t=this._movingElement;this._movingElement=e,this.firePropertyChange("movingElement",t,e),this._box._undoManager._enabled&&(e?this._box._undoManager.startBatch():this._box._undoManager.endBatch())},setEditingElement:function(e){if(e==this._editingElement)return;var t=this._editingElement;this._editingElement=e,this.firePropertyChange("editingElement",t,e),this._box._undoManager._enabled&&(e?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}}),n.canvas.Overview=function(e){n.canvas.Overview.superClass.constructor.apply(this,e),this._view=b.createView(),this._rootDiv=b.createDiv(),this._imageCanvas=b.createCanvas(),this._imageDiv=b.createDiv(),this._maskCanvas=b.createCanvas(),this._selectDiv=b.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,b.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=b.createCanvas(),this._imageCtx=this._imageCanvas.getContext("2d"),this.setNetwork(e),h.isTouchable?h.isMSTouchable?new n.canvas.OverviewMSTouchInteraction(this):(new n.canvas.OverviewTouchInteraction(this),new n.canvas.OverviewInteraction(this)):new n.canvas.OverviewInteraction(this)},r.ext("twaver.canvas.Overview",n.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:$i.OVERVIEW_FILL_COLOR,_outlineColor:$i.OVERVIEW_OUTLINE_COLOR,_outlineWidth:$i.OVERVIEW_OUTLINE_WIDTH,_selectColor:$i.OVERVIEW_SELECT_COLOR,_selectWidth:$i.OVERVIEW_SELECT_WIDTH,_padding:$i.OVERVIEW_PADDING,_animate:$i.OVERVIEW_ANIMATE,_maxPackingWidth:$i.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:$i.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(e){this._invalidateMask()},setNetwork:function(e){if(e===this._network)return;this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),b.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=e,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),b.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate()},_handleNetworkPropertyChange:function(e){(e.property==="zoom"||e.property==="currentSubNetwork"||e.property==="elementBox"||e.property==="dataBox"||e.property==="canvasSizeChange")&&this.invalidate()},_handleNetworkViewChange:function(e){e.kind==="validateEnd"&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(e){if(!this._isNetworkDirty||!this._isMaskDirty)this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),r.callLater(this.validate,this,null,e)},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,r.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&this._network.getViewRect().width!==0&&this._network.getViewRect().height!==0&&!this._network._invalidate){var e=this._maxPackingWidth>0&&this._maxPackingHeight>0,t;e?t={x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:t={x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},m.grow(t,-this._padding,-this._padding),e&&(b.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var n=this._network.getZoom(),r=this._network._unionBounds;r=m.unionRect(r,{x:0,y:0,width:r.x,height:r.y}),r={x:r.x/n,y:r.y/n,width:r.width/n,height:r.height/n};var i={x:this._network.viewRect.x/n,y:this._network.viewRect.y/n,width:this._network.viewRect.width/n,height:this._network.viewRect.height/n},s=m.unionRect(r,i),o=Math.min(t.width/s.width,t.height/s.height),u=s.width*o,a=s.height*o,f=s.width*o,l=s.height*o,c=t.x+(t.width-f)/2,h=t.y+(t.height-l)/2;if(this._isNetworkDirty){var p={x:c,y:h,width:f,height:l};this._network.toCanvas(u,a,this._exportImageCanvas,o,s.x*o,s.y*o),this._imageCanvas.setAttribute("width",f),this._imageCanvas.setAttribute("height",l),this._imageCtx.drawImage(this._exportImageCanvas,0,0,u,a),b.setDiv(this._imageDiv,p,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var d={x:(i.x-s.x)*o,y:(i.y-s.y)*o,width:i.width*o,height:i.height*o},v=b.setCanvas(this._maskCanvas,c,h,f,l);v.lineWidth=0,v.fillStyle=this._fillColor,w.drawVector(v,"rectangle",null,c,h,f,l),v.closePath(),v.fill(),v.stroke(),v.clearRect(c+d.x,h+d.y,d.width,d.height),v.lineWidth=this._outlineWidth,v.strokeStyle=this._outlineColor;var g=d.width-this._outlineWidth*2,y=d.height-this._outlineWidth*2;g=Math.min(g,f-2-d.x-this._outlineWidth),y=Math.min(y,l-2-d.y-this._outlineWidth),w.drawVector(v,"rectangle",null,c+d.x+this._outlineWidth,h+d.y+this._outlineWidth,g,y),v.closePath(),v.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(e){return b.getLogicalPoint(this._view,e,1,this._rootDiv)},centerNetwork:function(e,t){var n=this._imageDiv._viewRect;m.containsPoint(n,e)&&(this._network.centerByLogicalPoint((e.x-n.x)/n.width*this._network.getCanvasSize().width,(e.y-n.y)/n.height*this._network.getCanvasSize().height,t),this._invalidateMask())}}),n.canvas.OverviewTouchInteraction=function(e){this.overview=e,this.network=e.getNetwork(),this.view=e._view,b.addEventListener("touchstart","handleTouchstart",this.view,this)},r.ext("twaver.canvas.OverviewTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e),this.clear(),this.endPoint=this.overview.getLogicalPoint(e),kr.isMultiTouch(e)&&(this.distance=kr.getDistance(e),this.zoom=this.network.getZoom()),b.addEventListener("touchmove","handleTouchmove",this.view,this),b.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(e){this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(e);if(kr.isSingleTouch(e))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var t=kr.getDistance(e)/this.distance;this.network.setZoom(this.zoom*t,!1)}},handleTouchend:function(e){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(e);var t=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;t?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),t?r.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,b.removeEventListener("touchmove",this.view,this),b.removeEventListener("touchend",this.view,this)),this.moved=!1}}),n.canvas.OverviewMSTouchInteraction=function(e){this.overview=e,this.network=e.getNetwork(),this.view=e._view,this._pointerMap={},this._pointerIdArray=[],b.addEventListener("MSPointerDown","handleTouchstart",this.view,this),b.addEventListener("MSPointerMove","handleTouchmove",this.view,this),b.addEventListener("MSPointerUp","handleTouchend",this.view,this),b.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},r.ext("twaver.canvas.OverviewMSTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e),e.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[e.pointerId]&&this.overview.getLogicalPoint(e)&&(this._pointerIdArray.push(e.pointerId),this._pointerMap[e.pointerId]=e),this._pointerIdArray.length==1?(this._startTouchPoint=this.overview.getLogicalPoint(e),this._startTouchTime=new Date):this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(e){if(this._pointerIdArray.length==0||!this._pointerMap[e.pointerId]||m.getDistance({x:this._pointerMap[e.pointerId].pageX,y:this._pointerMap[e.pointerId].pageY},{x:e.pageX,y:e.pageY})<=10)return;this._pointerMap[e.pointerId]=e;if(this._pointerIdArray.length==2){var t=this._getDistance()/this._distance;this.network.setZoom(this._zoom*t,!1)}else if(this._pointerIdArray.length==1&&this._startTouchPoint){var n=this.overview.getLogicalPoint(e);if(n==null)return;this._startTouchPoint=n,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(e){var t=this.overview.getLogicalPoint(e);if(this._pointerIdArray.length==1&&t){var n=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&m.getDistance(this._endTouchPoint,t)<=10;n?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=t,this._endTouchTime=new Date),n?r.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return m.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),n.canvas.OverviewInteraction=function(e){this.overview=e,this.network=e.getNetwork(),this.view=e._view,b.addEventListener("mousedown","handleMousedown",this.view,this)},r.ext("twaver.canvas.OverviewInteraction",Object,{handleMousedown:function(e){if(e.button!==0)return;this.clear(),this.endPoint=this.overview.getLogicalPoint(e),r.isCtrlDown(e)&&(this.startPoint=this.endPoint,b.setVisible(this.overview._selectDiv,!0)),b.addEventListener("mousemove","handleMousemove",this.view,this),b.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(e){this.endPoint=this.overview.getLogicalPoint(e);if("detail"in e&&e.detail===2)r.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(b.isVisible(this.overview._selectDiv)&&this.startPoint){var t=this.overview._imageDiv._viewRect,n=this.overview._selectDiv._viewRect.x,i=this.overview._selectDiv._viewRect.y,s=t.width/this.overview._selectDiv._viewRect.width,o=t.height/this.overview._selectDiv._viewRect.height,u=Math.min(s,o);this.network.setZoom(u*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var a=this.network.getCanvasSize().width*((n-t.x+this.overview._selectDiv._viewRect.width/2)/t.width),f=this.network.getCanvasSize().height*((i-t.y+this.overview._selectDiv._viewRect.height/2)/t.height);r.callLater(this.network.centerByLogicalPoint,this.network,[a,f,this.overview._animate]),b.setVisible(this.overview._selectDiv,!1),b.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(e){var t=this.overview.getLogicalPoint(e);this.endPoint=t;if(b.isVisible(this.overview._selectDiv)&&this.startPoint){var n=t.x>this.startPoint.x?this.startPoint.x:t.x,r=t.x>this.startPoint.x?this.startPoint.y:t.y;t.x>this.startPoint.x&&t.y<this.startPoint.y&&(r=t.y),t.x<this.startPoint.x&&t.y>this.startPoint.y&&(r=this.startPoint.y);var i=this.overview._imageDiv._viewRect;n<i.x&&(n=i.x),n>i.x+i.width&&(n=i.x+i.width),r<i.y&&(r=i.y),r>i.y+i.height&&(r=i.y+i.height);var s=Math.abs(t.x-this.startPoint.x),o=Math.abs(t.y-this.startPoint.y);n+s>i.x+i.width&&(s=i.x+i.width-n),r+o>i.y+i.height&&(o=i.y+i.height-r),b.setDiv(this.overview._selectDiv,{x:n,y:r,width:s,height:o},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(t,!1)},clear:function(){this.endPoint&&(this.endPoint=null,b.removeEventListener("mousemove",this.view,this),b.removeEventListener("mouseup",this.view,this))}}),n.canvas.ElementUI=function(e,t){this._network=e,this._element=t,this._attachments=new n.List,this._bodyBounds=new n.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},r.ext("twaver.canvas.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(e){this.invalidate(!0)},handleSelectionChange:function(e){this.invalidate(!0)},invalidate:function(e){e===t&&(e=!0),e&&(this._invalidateAttachmentsFlag=!0);if(this._invalidateFlag)return;this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility()},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){if(this._invalidateFlag==0)return;this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(e){e.validate()});var e;this._bodyBounds.forEach(function(t){e=m.unionRect(e,t)}),this._unionBodyBounds=r.clone(e),this._attachments.forEach(function(t){e=m.unionRect(e,t.getViewRect())}),this._viewRect=e},validateImpl:function(){},setShadow:function(e,t){var n=e.isShadowable()&&this._shadowColor&&!this._editAttachment;if(t.shadowOffsetX===this._shadowXOffset&&t.shadowOffsetY===this._shadowYOffset&&t.shadowBlur===this._shadowBlur)return t;if(n||this._network._showShadowInEdit)t.shadowOffsetX=this._shadowXOffset,t.shadowOffsetY=this._shadowYOffset,t.shadowBlur=this._shadowBlur,t.shadowColor=this._shadowColor;return t},clearShadow:function(e){if(e.shadowOffsetX!=0||e.shadowOffsetY!=0||e.shadowBlur!=0)e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0},appendShadowBound:function(e,t){var n=e.isShadowable()&&this._shadowColor&&!this._editAttachment;return n&&(this._shadowXOffset>0?t.width+=this._shadowXOffset:(t.x+=this._shadowXOffset,t.width+=-this._shadowXOffset),this._shadowYOffset>0?t.height+=this._shadowYOffset:(t.y+=this._shadowYOffset,t.height+=-this._shadowYOffset),m.grow(t,this._shadowBlur,this._shadowBlur)),t},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&this._element.getStyle("select.style")==="shadow"?!0:!1},addAttachment:function(e){this._attachments.add(e)},removeAttachment:function(e){this._attachments.remove(e)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var e=this._network.getLabel(this._element);e!=null&&e!==""?this._labelAttachment||(this._labelAttachment=new n.canvas.LabelAttachment(this,$i.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var e=this._network.getAlarmLabel(this._element);e!=null&&e!==""?this._alarmAttachment||(this._alarmAttachment=new n.canvas.AlarmAttachment(this,$i.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var e=this._network.getIconsNames(this._element);e&&e.length>0?this._iconsAttachment||(this._iconsAttachment=new n.canvas.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new n.canvas.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(e){return this._innerColor?this._innerColor:this.getStyle(e)},getStyle:function(e){return this._element.getStyle(e)},getFont:function(e){var t=this._element.getStyle(e);return t?t:n.Defaults.FONT},paint:function(e){e.save(),e.globalAlpha=this._wholeAlpha,e.beginPath(),this.paintBody(e),this.clearShadow(e),e.closePath(),e.beginPath(),this.paintAttachments(e),e.closePath(),e.restore()},paintBody:function(e){},paintAttachments:function(e){e.beginPath();var t=this._attachments.size();for(var n=0;n<t;n++){var r=this._attachments.get(n);this._hitTest==1&&r.isShowOnTop()==0&&this.paintAttachment(e,r),this._intersectTest==1&&this.paintAttachment(e,r),this._hitTest==0&&this._intersectTest==0&&(r.isShowOnTop()?this._network._topAttachmentList.add(r):this.paintAttachment(e,r))}},paintAttachment:function(e,t){e.beginPath(),t.paint(e),this.clearShadow(e)},getViewRect:function(){return r.clone(this._viewRect)},getUnionBodyBounds:function(){return r.clone(this._unionBodyBounds)},addBodyBounds:function(e){e&&this._bodyBounds.add(e)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),r.clone(this._bodyRect)},getHotSpot:function(){return this._hotSpot?r.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(e){this._hotSpot=e},hit:function(e,t){return!1},intersects:function(e){return m.contains(e,this.getViewRect())?!0:!1},hitCanvasRectAtBody:function(e){var t=rs.getHitCanvas(e.width,e.height),n=rs.getCtx(t);n.save(),n.translate(-e.x,-e.y);if(this._element.getImage){var i=r.getImageAsset(this._element.getImage());if(i&&i.getImage()instanceof Qi)return 1}this.paintBody(n);try{var s=n.getImageData(0,0,e.width,e.height),o=s.data;for(var u=0;u<s.width;u++)for(var a=0;a<s.height;a++){var f=4*(a*s.width+u),l=o[f+3];if(l!==0)return n.restore(),1}}catch(c){rs.disposeHitCanvas();if(m.contains(this.getUnionBodyBounds(),e))return 0}return n.restore(),-1},hitCanvasRectAtAttachments:function(e){var t=rs.getHitCanvas(e.width,e.height),n=rs.getCtx(t);n.save(),n.translate(-e.x,-e.y),this.paintAttachments(n);try{var r=n.getImageData(0,0,e.width,e.height),i=r.data;for(var s=0;s<r.width;s++)for(var o=0;o<r.height;o++){var u=4*(o*r.width+s),a=i[u+3];if(a!==0)return n.restore(),1}}catch(f){rs.disposeHitCanvas()}return n.restore(),-1},hitCanvasRect:function(e){this._intersectTest=!0,this._hitTest==1&&(this._intersectTest=!1);var t=m.intersection(e,this._viewRect),n=this.hitCanvasRectAtBody(t);if(n==1)return this._intersectTest=!1,!0;var r=this.hitCanvasRectAtAttachments(t);return r==1?(this._intersectTest=!1,!0):(this._intersectTest=!1,n==0)},hitCanvasPoint:function(e,t){var n={x:e,y:t,width:0,height:0},r=this._network.getSelectionTolerance();r&&r>0&&m.grow(n,r,r);if(!m.intersects(this._viewRect,n))return!1;this._hitTest=!0;var i=this.hitCanvasRect(n);return this._hitTest=!1,i},hitTest:function(e,t){var n={x:e,y:t,width:0,height:0},r=this._network.getSelectionTolerance();r&&r>0&&m.grow(n,r,r);if(!m.intersects(this._viewRect,n))return null;var i=m.intersection(n,this._viewRect),s=this.hitCanvasRectAtBody(i);if(s==1)return this;var o=this._attachments.size();for(var u=0;u<o;u++){var a=this._attachments.get(u);if(a.hit(e,t))return a}return s==0?this:null},dispose:function(){this._attachments.forEach(function(e){e.dispose()}),this._attachments.clear()}}),n.canvas.NodeUI=function(e,t){n.canvas.NodeUI.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.NodeUI",n.canvas.ElementUI,{invalidate:function(e){n.canvas.NodeUI.superClass.invalidate.call(this,e),this.curInterval&&clearInterval(this.curInterval);var t=this._element.getAgentLinks();t&&t.forEach(function(e){this._network.invalidateElementUI(e,!1)},this);var r=this._element.getParent();r instanceof n.Group&&this._network.invalidateElementUI(r,!1)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){n.canvas.NodeUI.superClass.validateImpl.call(this);var e=this.getStyle("vector.shape"),t=this.getBodyRect();this._hotSpot=m.getHotSpot(t.x,t.y,t.width,t.height,e),this.validateBodyBounds()},validate:function(){if(this._invalidateFlag==0)return;n.canvas.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var e=this.getStyle("body.type");e==="default"?this.addBodyBounds(this.getDefaultBodyRect()):e==="vector"?this.addBodyBounds(this.getVectorBody()):e==="default.vector"?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):e==="vector.default"&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var e=this._element,t=r.getImageAsset(e.getImage()),n=this.getBodyRect();if(!t)return n;m.addPadding(n,this._element,"image.padding",1),this._defaultRect=n;var i=r.clone(n);return this.appendShadowBound(this,i),n=i,n},getVectorBody:function(){var e=this.getPathRect("vector");return e},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(e){var t=this._element,n=t.getStyle(e+".width");if(n>0){var i=this.getBodyRect();m.addPadding(i,t,e+".padding",1);var s=r.clone(i);return m.grow(s,n/2,n/2),s}return null},getPathRect:function(e,t){var n=this._element,i=this.getBodyRect();t&&m.addPadding(i,n,e+".padding",1);var s=r.clone(i),o=n.getStyle(e+".outline.width");return o>0&&m.grow(s,o/2,o/2),this.appendShadowBound(this,s),s},paintBody:function(e){this.curInterval&&clearInterval(this.curInterval);var t=this.getStyle("body.type");t==="default"?this.drawDefaultBody(e):t==="vector"?this.drawVectorBody(e):t==="default.vector"?(this.drawVectorBody(e),this.drawDefaultBody(e)):t==="vector.default"&&(this.drawDefaultBody(e),this.drawVectorBody(e)),this._outerColor&&this.drawOuterBorder(e),this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.drawSelectBorder(e)},drawOuterBorder:function(e){var t=this._element,n=t.getStyle("outer.width");if(n>0){var r=this.getBodyRect();m.addPadding(r,t,"outer.padding",1),e.lineWidth=n,e.lineCap=t.getStyle("outer.cap"),e.lineJoin=t.getStyle("outer.join"),e.strokeStyle=this._outerColor,w.drawVector(e,t.getStyle("outer.shape"),null,r),e.stroke()}},drawDefaultBody:function(e){var t=this._element,i=r.getImageAsset(t.getImage()),s=this._defaultRect;if(!i)return;if(i.getImage()){t.getAngle()!=0&&(e.save(),s=t.getOriginalRect(),n.Util.rotateCanvas(e,s,t.getAngle())),this.setShadow(this,e);var o=this;if(i.getImage()instanceof Qi){var u=i.getImage().frames,a=i.getImage().size,f=0,l;l=Yi(u,a,0),e.drawImage(l,s.x,s.y,s.width,s.height),this.curInterval=setInterval(function(){f=(f+u.length)%u.length,l=Yi(u,a,f),e.drawImage(l,s.x,s.y,s.width,s.height),f++},100)}else Rr(e,t.getImage(),this.getInnerColor(),s,t,this._network);t.getAngle()!=0&&e.restore()}},drawSelectBorder:function(e){var t=this._element,n=t.getStyle("select.width");if(n>0){var i=this.getBodyRect();i=r.clone(i);var s=t.getStyle("select.physicalZoom")?1:this._network.getZoom();m.addPadding(i,t,"select.padding",1/s),m.grow(i,n/2/s,n/2/s),e.lineWidth=n/s,e.lineCap=t.getStyle("select.cap"),e.lineJoin=t.getStyle("select.join"),e.strokeStyle=t.getStyle("select.color"),w.drawVector(e,t.getStyle("select.shape"),null,i),e.stroke()}},drawVectorBody:function(e){this.drawPath(e,"vector",!0,this._element.getStyle("vector.outline.pattern"));var t=this.getStyle("vector.deep"),r=this.getStyle("vector.fill.color"),i=this.getBodyRect();if(t!==0&&r){var s=this._element.getAngle();s!=0&&(e.save(),i=this._element.getOriginalRect(),n.Util.rotateCanvas(e,i,s)),this.getStyle("vector.shape")==="rectangle"&&w.draw3DRect(e,r,t,i),s!=0&&e.restore()}},drawPath:function(e,t,r,i,s,o,u){var a=this._element,f=this.getBodyRect();r&&m.addPadding(f,a,t+".padding",1);var l=a.getStyle(t+".outline.width");this.setShadow(this,e),a.getAngle()!=0&&(a instanceof ns||(f=a.getOriginalRect()),e.save(),n.Util.rotateCanvas(e,f,a.getAngle()));var c=a.getStyle(t+".fill"),h;if(c){this._innerColor&&!xr.hasDefault(this._element)?h=this._innerColor:h=a.getStyle(t+".fill.color");var p=a.getStyle(t+".gradient");p?w.fill(e,h,p,a.getStyle(t+".gradient.color"),f):e.fillStyle=h}var d=a.getStyle(t+".shape"),v=a.getStyle("group.shape.roundrect.radius");v<0&&(v=10),c&&(e.beginPath(),s?w.drawLinePoints(e,s,null,o,u):d==="roundrect"&&t==="group"?w.drawVector(e,d,null,f,v):w.drawVector(e,d,null,f),e.fill()),l>0&&(e.lineWidth=l,e.lineCap=a.getStyle(t+".cap"),e.lineJoin=a.getStyle(t+".join"),e.strokeStyle=a.getStyle(t+".outline.color"),e.beginPath(),s?w.drawLinePoints(e,s,i,o,u):d==="roundrect"&&t==="group"?w.drawVector(e,d,i,f,v):w.drawVector(e,d,i,f),e.stroke()),a.getAngle()!=0&&e.restore()},hit:function(e,t){var n={x:e,y:t,width:0,height:0},i=this._network.getSelectionTolerance();i&&i>0&&m.grow(n,i,i);if(this._network._transparentSelectionEnable){var s=this.getBodyRect();if(r.math.intersects(s,n))return!0}return m.intersects(this.getViewRect(),n)?this.hitCanvasPoint(e,t):!1},intersects:function(e){var t=n.canvas.NodeUI.superClass.intersects.apply(this,arguments);if(t==1)return!0;if(this._network._transparentSelectionEnable){var i=this.getBodyRect();if(r.math.intersects(i,e))return!0}return m.intersects(e,this.getViewRect())?this.hitCanvasRect(e):!1}}),n.canvas.LinkUI=function(e,t){n.canvas.LinkUI.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.LinkUI",n.canvas.ElementUI,{isEditable:function(){return Nr.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},invalidate:function(e){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,n.canvas.LinkUI.superClass.invalidate.call(this,e)},validateImpl:function(){this.validateBodyBounds(),n.canvas.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var e=this.getLinkPoints();if(!e||e.size()<2)return;var t=this._element,n=m.getLineRect(e),r=t.getStyle("link.width"),i=r;if(this._outerColor){var s=t.getStyle("outer.width");i+=s*2}var o=!this._editAttachment&&t.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(o){var u=t.getStyle("select.width");i+=u*2}m.grow(n,i/2,i/2),t.getStyle("arrow.from")&&(this._network._debug&&(this._arrowFromRect=Mi.getArrowRect(this,e,!0,t.getStyle("arrow.from.shape"),t.getStyle("arrow.from.width"),t.getStyle("arrow.from.height"),t.getStyle("arrow.from.xoffset"),t.getStyle("arrow.from.yoffset"
))),n=m.unionRect(n,Mi.getArrowRect(this,e,!0,t.getStyle("arrow.from.shape"),t.getStyle("arrow.from.width"),t.getStyle("arrow.from.height"),t.getStyle("arrow.from.xoffset"),t.getStyle("arrow.from.yoffset")))),t.getStyle("arrow.to")&&(this._network._debug&&(this._arrowToRect=Mi.getArrowRect(this,e,!1,t.getStyle("arrow.to.shape"),t.getStyle("arrow.to.width"),t.getStyle("arrow.to.height"),t.getStyle("arrow.to.xoffset"),t.getStyle("arrow.to.yoffset"))),n=m.unionRect(n,Mi.getArrowRect(this,e,!1,t.getStyle("arrow.to.shape"),t.getStyle("arrow.to.width"),t.getStyle("arrow.to.height"),t.getStyle("arrow.to.xoffset"),t.getStyle("arrow.to.yoffset")))),this.appendShadowBound(this,n),this.addBodyBounds(n)},createBodyRect:function(){var e=this.getHotSpot();return e?{x:e.x-1,y:e.y-1,width:2,height:2}:null},paintBody:function(e){var t=this._linkPoints;if(!t||t.size()<2)return;var n=this._element,r=n.getStyle("link.width"),i=r;if(this._outerColor){var s=n.getStyle("outer.width");i+=s*2}var o=!this._editAttachment&&n.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(o){var u=n.getStyle("select.width");i+=u*2}this.setShadow(this,e),e.lineCap=n.getStyle("link.cap"),e.lineJoin=n.getStyle("link.join");var a=n.getStyle("link.pattern");o&&this.drawLinePoints(e,t,i,n.getStyle("select.color"),a),this._outerColor&&this.drawLinePoints(e,t,r+s*2,this._outerColor,a),this.drawLinePoints(e,t,r,this._innerColor||n.getStyle("link.color"),a),Mi.drawLinkArrow(this,e,t)},drawLinePoints:function(e,t,n,r,i){e.lineWidth=n,e.strokeStyle=r;if(this._element.getStyle("link.flow")===!0&&i&&i.length>1){var s=new Sr(e,i[0],i[1]),o=this._element.getStyle("link.flow.offset"),u=Math.floor(o/(i[0]+i[1]));u>2&&(o-=(i[0]+i[1])*u),this._element.getStyle("link.flow.converse")?o<i[0]?s.overflow=i[0]-o:o>=i[0]&&o<=i[0]+i[1]?(s.overflow=i[1]-(o-i[0]),s.overflow&&(s.isLine=!1)):(o-=i[0]+i[1],s.overflow=i[0]-o):o<=i[1]?(s.overflow=o,o&&(s.isLine=!1)):o>i[1]&&o<=i[0]+i[1]?s.overflow=o-i[1]:(o-=i[0]+i[1],o&&(s.isLine=!1),s.overflow=o),this._element._styleMap["link.flow.offset"]=o,e.beginPath(),w._drawLine(t,e),e.stroke(),e.shadowColor="transparent",e.beginPath();var a=this._element.getStyle("link.flow.color");a=a?a:$i.NETWORK_LINK_FLOW_COLOR,e.strokeStyle=a,w._drawLine(t,s),e.stroke(),e.shadowColor=this._shadowColor}else e.beginPath(),w.drawLinePoints(e,t,i),e.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=m.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(e,t){var n=this.getFromPoint();return n?{x:n.x+e,y:n.y+t}:null},getToPosition:function(e,t){var n=this.getToPoint();return n?{x:n.x+e,y:n.y+t}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=Nr.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=Nr.createToPoint(this)),this._toPoint},createLinkPoints:function(){var e=this.getFromPoint(),t=this.getToPoint(),r=this.getStyle("link.type"),i=new n.List;if(Nr.isOrthogonalOrFlexionalLink(this._element))i=Nr.orthogonalAndFlexional(this,r);else if(this._element.isLooped()){var s=this._network.getElementUI(this._element.getFromAgent());s!=null&&(this._hotSpot=Nr.fillLoopedPoints(this,s.getBodyRect(),i))}else{if(r!=="arc"&&r!=="triangle"&&r!=="parallel")throw"Can not resolve link type '"+r+"'";this._hotSpot=Nr.fillBundlePoints(this,r,e,t,i)}if(this._network._linkPathFunction){var o=this._network._linkPathFunction(this,i);o&&(i=o)}return i},checkAttachments:function(){n.canvas.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var e=this._network.getLinkHandlerLabel(this._element);e!=null&&e!==""?this._linkHandlerAttachment||(this._linkHandlerAttachment=new n.canvas.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return Nr.getControlPoint(this._element,this)},setControlPoint:function(e){if(!e)return;var t=this.getStyle("link.type");if(!Nr.hasControlPoint(t))return;var n=Nr.getLinkSourceBounds(this),r=Nr.getLinkTargetBounds(this);Nr.setParamsByControlPoint(e,n,r,t,this._element)},getLineLength:function(){return this._lineLength},hit:function(e,t){var n={x:e,y:t,width:0,height:0},r=this._network.getSelectionTolerance();return r&&r>0&&m.grow(n,r,r),m.intersects(this.getViewRect(),n)?this.hitCanvasPoint(e,t):!1},intersects:function(e){var t=n.canvas.LinkUI.superClass.intersects.apply(this,arguments);if(t==1)return!0;if(m.intersects(e,this.getViewRect())==0)return!1;var r=this.getLinkPoints(),i=r.size();if(i==2)for(var s=0;s<i;s+=2){var o=r.get(s);if(s+1<i){var u=r.get(s+1);if(rs.intersectsLine(o.x,o.y,u.x,u.y,e.x,e.y,e.width,e.height))return!0}}return this.hitCanvasRect(e)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=m.getAngle(this._fromPoint,this._toPoint)),this._angle||0}}),n.canvas.GroupUI=function(e,t){n.canvas.GroupUI.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.GroupUI",n.canvas.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(e){this._shapeRect?this.drawExpandedGroup(e):n.canvas.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect(),this._shapeRect?this.addBodyBounds(this.getPathRect("group",!1)):n.canvas.GroupUI.superClass.validateBodyBounds.call(this)},drawExpandedGroup:function(e){this.drawPath(e,"group",!1,this._element.getStyle("vector.outline.pattern"));var t=this.getStyle("group.deep"),n=this.getStyle("group.fill.color");t!==0&&n&&this.getStyle("group.shape")==="rectangle"&&w.draw3DRect(e,n,t,this._bodyRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var e=this._element,t=this._network;if(e.isExpanded()){e.getChildren().forEach(function(e){var n=t.getElementUI(e);n&&n.validate()});var r=this.getChildrenRects();if(!r.isEmpty()){var i=e.getStyle("group.shape"),s=g[i];if(!s)throw"Can not resolve group shape '"+i+"'";this._shapeRect=s(r)}}return this._shapeRect?(m.addPadding(this._shapeRect,e,"group.padding",1),this._shapeRect):n.canvas.GroupUI.superClass.createBodyRect.call(this)}}),n.canvas.ShapeNodeUI=function(e,t){n.canvas.ShapeNodeUI.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.ShapeNodeUI",n.canvas.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this.getPathRect("vector",!0)},drawDefaultBody:function(e){if(this._element._points.size()<2)return;this.drawPath(e,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed")),Mi.drawLinkArrow(this,e,m.getPointObject(this._element._points,this._element._segments))},drawSelectBorder:function(e){var t=this._element,n=t.getStyle("select.width");if(n>0){var i=this.getBodyRect();i=r.clone(i);var s=t.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();m.addPadding(i,t,"select.padding",1/s),m.grow(i,n/2,n/2);var o=t.getStyle("vector.outline.width");o>0&&m.grow(i,o/2/s,o/2/s),e.lineWidth=n/s,e.lineCap=t.getStyle("select.cap"),e.lineJoin=t.getStyle("select.join"),e.strokeStyle=t.getStyle("select.color"),w.drawVector(e,t.getStyle("select.shape"),null,i),e.stroke()}}}),n.canvas.ShapeLinkUI=function(e,t){n.canvas.ShapeLinkUI.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.ShapeLinkUI",n.canvas.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var e=this.getFromPoint(),t=this.getToPoint(),i=new n.List,s=this.getStyle("shapelink.type");i.add(e),this._element._points!=null&&i.addAll(this._element._points),i.add(t);var o=m.calculateLineLength(i)/2,u,a=i.size(),f,l,c,h,p,d,v=0,g=0;for(u=0;u<a;u++){c=i.get(u);if(u==0){f=c;continue}l=c,l instanceof Oi&&(l=l._as),l instanceof Array?(h=m.calculateCurveLength(f,l,1),f=l[l.length-1]):(d=c.y-f.y,p=c.x-f.x,h=Math.sqrt(p*p+d*d),f=l),g+=h;if(v<=o&&g>=o){var y=o-v,b=i.get(u-1);b instanceof Oi&&(b=b._as,b instanceof Array&&(b=b[b.length-1]));var w=i.get(u),E=m.getPathInfo(w,b,y,0,-1).point;this._hotSpot=r.clone(E)}v=g}var S,x,T;if(s!=="lineto")if(s==="quadto"){S=new n.List(i.get(0));for(x=1,pointCount=i.size();x<pointCount;x++)x<pointCount-1?S.add(new n.List([i.get(x++),i.get(x)])):S.add(i.get(x));i=S}else if(s==="cubicto"){S=new n.List(i.get(0));for(x=1,pointCount=i.size();x<pointCount;x++)x<pointCount-2?S.add(new n.List([i.get(x++),i.get(x++),i.get(x)])):x<pointCount-1?S.add(new n.List([i.get(x++),i.get(x)])):S.add(i.get(x));i=S}else{if(s!=="orthogonalto")throw"Can not resolve shapelink type '"+s+"'";T=i.get(0),S=new n.List(T);for(x=1,pointCount=i.size();x<pointCount;x++)if(x<pointCount-1){var c=r.clone(i.get(x)),N=c.x,C=c.y,p=N-T.x,d=C-T.y;Math.abs(p)>Math.abs(d)?(c.x=N,c.y=T.y):(c.x=T.x,c.y=C),T=c,S.add(T)}else S.add(i.get(x));i=S}return i}}),n.canvas.GridUI=function(e,t){n.canvas.GridUI.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.GridUI",n.canvas.NodeUI,{drawDefaultBody:function(e){this._element.getImage()?n.canvas.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(e)},validateBodyBounds:function(){if(this._element.getImage())n.canvas.GridUI.superClass.validateBodyBounds.call(this);else{var e=this.getBodyRect(),t=r.clone(e);this.appendShadowBound(this,t),this.addBodyBounds(t)}},drawGridBody:function(e){var t=this.getStyle("grid.fill"),n=this.getStyle("grid.deep"),r=this.getStyle("grid.cell.deep");if(!t&&n===0&&r===0)return;e.beginPath();var i=this._element.getRect(),s=this.getDyeColor("grid.fill.color");this.setShadow(this,e),t&&(e.fillStyle=s,e.rect(i.x,i.y,i.width,i.height),e.fill()),e.closePath(),this.clearShadow(e),e.beginPath(),n!=0&&w.draw3DRect(e,s,n,i.x,i.y,i.width,i.height),e.closePath();if(r!=0){var o=this.getStyle("grid.row.count"),u=this.getStyle("grid.column.count");for(var a=0;a<o;a++)for(var f=0;f<u;f++){var l=this._element.getCellRect(a,f);l!=null&&(e.beginPath(),w.draw3DRect(e,s,r,l.x,l.y,l.width,l.height),e.closePath())}}}}),n.canvas.RotatableNodeUI=function(e,t){n.canvas.RotatableNodeUI.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.RotatableNodeUI",n.canvas.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var e=this._element,t=r.getImageAsset(e.getImage()),n=this.getBodyRect();return t?(m.addPadding(n,this._element,"image.padding",1),n):n},drawDefaultBody:function(e){var t=this._element,n=r.getImageAsset(t.getImage()),i=this.getBodyRect();m.addPadding(i,this._element,"image.padding",1);if(n.getImage()){var s=this._element._getOrignalWidth(),o=this._element._getOrignalHeight(),u=this._element._getRotateRect();e.save(),e.translate(i.x-u.x+s/2,i.y-u.y+o/2),e.rotate(this._element._angle*Math.PI/180);var i={x:-s/2,y:-o/2,width:s,height:o};Rr(e,n.getImage(this._innerColor,i.width,i.height),this._innerColor,i,t,this._network),e.restore()}else if(!n.getSrc()&&!n.getFunction())throw"ImageAsset '"+t.getImage()+" ' is empty"}}),n.canvas.HTMLNodeUI=function(e,t){n.canvas.HTMLNodeUI.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.HTMLNodeUI",n.canvas.NodeUI,{checkAttachments:function(){n.canvas.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var e=this._element.getStyle("attachment.label.style");if(e&&e==="none"){n.canvas.HTMLNodeUI.superClass.checkLabelAttachment.call(this);return}var t=this._network.getLabel(this._element);t!=null&&t!==""?this._labelAttachment||(this._labelAttachment=new n.canvas.HTMLLabelAttachment(this,$i.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var e=this._element.getStyle("attachment.alarm.style");if(e&&e==="none"){n.canvas.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);return}var t=this._network.getAlarmLabel(this._element);t!=null&&t!==""?this._alarmAttachment||(this._alarmAttachment=new n.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(e){e?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),n.canvas.HTMLLinkUI=function(e,t){n.canvas.HTMLLinkUI.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.HTMLLinkUI",n.canvas.LinkUI,{checkAttachments:function(){n.canvas.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var e=this._element.getStyle("attachment.label.style");if(e&&e==="none"){n.canvas.HTMLLinkUI.superClass.checkLabelAttachment.call(this);return}var t=this._network.getLabel(this._element);t!=null&&t!==""?this._labelAttachment||(this._labelAttachment=new n.canvas.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var e=this._element.getStyle("attachment.alarm.style");if(e&&e==="none"){n.canvas.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);return}var t=this._network.getAlarmLabel(this._element);t!=null&&t!==""?this._alarmAttachment||(this._alarmAttachment=new n.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),n.canvas.Attachment=function(e,t){this._ui=e,this._element=this._ui.getElement(),this._network=e.getNetwork(),this._showOnTop=t},r.ext("twaver.canvas.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(e){this._showOnTop=e},getStyle:function(e){return this._ui.getStyle(e)},getFont:function(e){return this._ui.getFont(e)},getViewRect:function(){return r.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(e){},hit:function(e,t){return m.containsPoint(this._viewRect,e,t)?this.hitCanvasRect({x:e-1,y:t-1,width:2,height:2}):!1},hitCanvasRect:function(e){var t=rs.getHitCanvas(e.width,e.height),n=rs.getCtx(t);n.save(),n.translate(-e.x,-e.y),this.paint(n);try{var r=n.getImageData(0,0,e.width,e.height),i=r.data;for(var s=0;s<r.width;s++)for(var o=0;o<r.height;o++){var u=4*(o*r.width+s),a=i[u+3];if(a!==0)return n.restore(),!0}}catch(f){rs.disposeHitCanvas()}return n.restore(),!1},dispose:function(){},_rotatePoint:function(e,t,n){var r=m.createMatrix(t*Math.PI/180,n.x+n.width/2,n.y+n.height/2),i=r.transform(e);return i},_rotatePointList:function(e,t,r){var i=this,s=new n.List;return e.forEach(function(e){s.add(i._rotatePoint(e,t,r))}),s}}),n.canvas.BasicAttachment=function(e,t){n.canvas.BasicAttachment.superClass.constructor.call(this,e,t),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},r.ext("twaver.canvas.BasicAttachment",n.canvas.Attachment,{paint:function(e){n.canvas.BasicAttachment.superClass.paint.apply(this,arguments);var t=this.isFill(),r=this.getOutlineWidth();this.getElementUI().setShadow(this,e);if(r>0||t){w.drawRoundRect(e,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(e.moveTo(this._pointers[0].x,this._pointers[0].y),e.lineTo(this._pointers[1].x,this._pointers[1].y),e.lineTo(this._pointers[2].x,this._pointers[2].y)),e.closePath(),r>0&&(e.lineWidth=r,e.strokeStyle=this.getOutlineColor(),e.lineCap=this.getCap(),e.lineJoin=this.getJoin(),e.stroke());if(t){var i=this.getFillColor(),s=this.getGradient();s?w.fill(e,i,s,this.getGradientColor(),this._viewRect):e.fillStyle=i,e.fill()}}},validate:function(){n.canvas.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var e=this.getOutlineWidth();this._viewRect=m.getRect(this._pointers),this._viewRect=m.unionRect(this._viewRect,this._roundRect),e>0&&m.grow(this._viewRect,e/2,e/2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect)},calculateMeasure:function(){var e=this.getContentWidth(),t=this.getContentHeight(),r=this.getCornerRadius(),i=this.getPointerLength(),s=this.getPointerWidth(),o=this.getPosition(),u=this.getXOffset(),a=this.getYOffset(),f=this._roundRect;f.width=e+r,f.height=t;var l;if(this._ui._element instanceof n.Link){var c=this._ui.getLinkPoints(),h;this._ui.getLineLength?h=this._ui.getLineLength():h=this._ui._element.getLineLength(),Math.abs(u)>0&&Math.abs(u)<1?o==="from"?u*=h:o==="to"?u=h*(1-u):(u/=2,u+=.5,u*=h):o==="from"?u=u:o==="to"?u=h-u:u+=h/2;var p=m.calculatePointInfoAlongLine(c,!0,u,a),d=p.point,v=p.angle,g;o==="from"?g=this._ui.getFromPoint():o==="to"?g=this._ui.getToPoint():g=this._ui._hotSpot,u=d.x-g.x,a=d.y-g.y}if(i>0){var y=this.getDirection();l=this._network.getPosition(o,this._ui,null,u,a,!1);var b;if(y==="aboveleft")f.y=l.y-i-f.height,f.x=l.x-(f.width-r),b=Math.max(l.x-s,l.x-(f.width-r)+r/2),this._pointers=[l,{x:l.x,y:l.y-i},{x:b,y:l.y-i}];else if(y==="aboveright")f.y=l.y-i-f.height,f.x=l.x-r,b=Math.min(l.x+s,l.x-r+f.width-r/2),this._pointers=[l,{x:l.x,y:l.y-i},{x:b,y:l.y-i}];else if(y==="belowleft")f.y=l.y+i,f.x=l.x-(f.width-r),b=Math.max(l.x-s,l.x-(f.width-r)+r/2),this._pointers=[l,{x:l.x,y:l.y+i},{x:b,y:l.y+i}];else if(y==="belowright")f.y=l.y+i,f.x=l.x-r,b=Math.min(l.x+s,l.x-r+f.width-r/2),this._pointers=[l,{x:l.x,y:l.y+i},{x:b,y:l.y+i}];else if(y==="leftabove")f.y=l.y+r-f.height,f.x=l.x-i-f.width,b=Math.max(l.y-s,l.y+r-f.height+r/2),this._pointers=[l,{x:l.x-i,y:l.y},{x:l.x-i,y:b}];else if(y==="leftbelow")f.y=l.y-r,f.x=l.x-i-f.width,b=Math.min(l.y+s,l.y-r+f.height-r/2),this._pointers=[l,{x:l.x-i,y:l.y},{x:l.x-i,y:b}];else if(y==="rightabove")f.y=l.y+r-f.height,f.x=l.x+i,b=Math.max(l.y-s,l.y+r-f.height+r/2),this._pointers=[l,{x:l.x+i,y:l.y},{x:l.x+i,y:b}];else if(y==="rightbelow")f.y=l.y-r,f.x=l.x+i,b=Math.min(l.y+s,l.y-r+f.height-r/2),this._pointers=[l,{x:l.x+i,y:l.y},{x:l.x+i,y:b}];else if(y==="above")f.y=l.y-i-f.height,f.x=l.x-f.width/2,b=Math.min(e/2,s/2),this._pointers=[l,{x:l.x-b,y:l.y-i},{x:l.x+b,y:l.y-i}];else if(y==="below")f.y=l.y+i,f.x=l.x-f.width/2,b=Math.min(e/2,s/2),this._pointers=[l,{x:l.x-b,y:l.y+i},{x:l.x+b,y:l.y+i}];else if(y==="left")f.y=l.y-f.height/2,f.x=l.x-i-f.width,b=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-i,y:l.y+b},{x:l.x-i,y:l.y-b}];else{if(y!=="right")throw"Can not resolve '"+y+"' attachment direction";f.y=l.y-f.height/2,f.x=l.x+i,b=Math.min(t/2,s/2),this._pointers=[l,{x:l.x+i,y:l.y+b},{x:l.x+i,y:l.y-b}]}}else l=this._network.getPosition(o,this._ui,{width:f.width,height:f.height},u,a,!1),f.x=l.x,f.y=l.y,this._pointers=null;this._contentRect.x=f.x+(f.width-e)/2,this._contentRect.y=f.y+(f.height-t)/2,this._contentRect.width=e,this._contentRect.height=t;var w=this.getPadding();w!=0&&m.grow(f,w,w),w=this.getPaddingLeft(),w!=0&&(f.x-=w,f.width+=w),w=this.getPaddingRight(),w!=0&&(f.width+=w),w=this.getPaddingTop(),w!=0&&(f.y-=w,f.height+=w),w=this.getPaddingBottom(),w!=0&&(f.height+=w),f.width<0&&(f.width=f.width,f.x-=f.width),f.height<0&&(f.height=-f.height,f.y-=f.height)},getContentWidth:function(){return n.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return n.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return n.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return n.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return n.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return n.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return n.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return n.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return n.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return n.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return n.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return n.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return n.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return n.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return n.Defaults.ATTACHMENT_FILL},getFillColor:function(){return n.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return n.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return n.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return n.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return n.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return n.Defaults.ATTACHMENT_CAP},getJoin:function(){return n.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return n.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return r.clone(this._roundRect)},getContentRect:function(){return r.clone(this._contentRect)}}),n.canvas.LabelAttachment=function(e,t){n.canvas.LabelAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.LabelAttachment",n.canvas.BasicAttachment,{paint:function(e){var t=this._element instanceof n.Link&&this._element.getStyle("link.label.rotatable");if(t){e.save();var r=this._viewRect.x+this._viewRect.width/2,i=this._viewRect.y+this._viewRect.height/2;e.translate(r,i),e.rotate(this._network.getElementUI(this._element).getAngle()),e.translate(-r,-i)}n.canvas.LabelAttachment.superClass.paint.apply(this,arguments);var s=this._element.getStyle("label.align"),o=this._element&&this._element.getStyle("label.rotate.angle");o!==0&&(e.save(),n.Util.rotateCanvas(e,this._contentRect,o)),w.drawText(e,this.text,this._contentRect,this.font,this.getStyle("label.color"),s),(t||o!==0)&&e.restore()},validate:function(){this.font=this.getFont("label.font");var e=this.getLabel(),t=r.g.getTextSize(this.font,e),i=this.getMaxLength();i!==0&&t.width>i?(this.text=r.g.getCollapseTextInLength(this.font,e,i),this._textSize=r.g.getTextSize(this.font,this.text)):(this.text=e,this._textSize=t),n.canvas.LabelAttachment.superClass.validate.call(this);var s=this._viewRect,o=this._element&&this._element.getStyle("label.rotate.angle");if(o!==0){var u=new n.List;u.add({x:s.x,y:s.y}),u.add({x:s.x+s.width,y:s.y}),u.add({x:s.x+s.width,y:s.y+s.height}),u.add({x:s.x,y:s.y+s.height}),u=this._rotatePointList(u,o,s);var a=n.Util.getRect(u);this._viewRect=a}},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),n.canvas.AlarmAttachment=function(e,t){n.canvas.AlarmAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.AlarmAttachment",n.canvas.BasicAttachment,{paint:function(e){n.canvas.AlarmAttachment.superClass.paint.apply(this,arguments),w.drawText(e,this.text,this._contentRect,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=w.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),n.canvas.LabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return this._fillColor!=null},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),n.canvas.LinkHandlerAttachment=function(e,t){n.canvas.LinkHandlerAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.LinkHandlerAttachment",n.canvas.BasicAttachment,{paint:function(e){n.canvas.LinkHandlerAttachment.superClass.paint.apply(this,arguments),w.drawText(e,this.linkHandlerLabel,this._contentRect,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=w.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),n.canvas.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),n.canvas.IconsAttachment=function(e,t){n.canvas.IconsAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.IconsAttachment",n.canvas.Attachment,{isShadowable:function(){return n.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){n.canvas.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element);if(!this.iconsNames||this.iconsNames.length==0)return;var e=this._makeGroup(this.iconsNames),t=this._makeGroup(this._network.getIconsColors(this._element));len=e.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[];var r,s;for(i=0;i<len;i++){var o=e[i],u=this.iconsOrientation[i]||"right",a=this.iconsPosition[i]||"topleft.bottomright",f=this.iconsXgap[i]||1,l=this.iconsYgap[i]||1,c=this.iconsXoffset[i]||0,h=this.iconsYoffset[i]||0;if(this._ui._element instanceof n.Link){var p=this._ui.getLinkPoints(),d;this._ui.getLineLength?d=this._ui.getLineLength():d=this._ui._element.getLineLength(),Math.abs(c)>0&&Math.abs(c)<1?a==="from"?c*=d:a==="to"?c=d*(1-c):(c/=2,c+=.5,c*=d):a==="from"?c=c:a==="to"?c=d-c:c+=d/2;var v=m.calculatePointInfoAlongLine(p,!0,c,h),g=v.point,y=v.angle,b;a==="from"?b=this._ui.getFromPoint():a==="to"?b=this._ui.getToPoint():b=this._ui._hotSpot,c=g.x-b.x,h=g.y-b.y}s=null,r=this._getIconsSize(o,u,f,l),r&&(s=this._network.getPosition(a,this._ui,r,c,h),u==="top"?s.y+=r.height:u==="left"&&(s.x+=r.width)),this.locations.push(s),this.iconsSizes.push(r)}var w=null;for(i=0;i<this.locations.length;i++){s=this.locations[i],r=this.iconsSizes[i];if(s==null)continue;w==null?w={x:s.x,y:s.y,width:r.width,height:r.height}:w=m.unionRect(w,{x:s.x,y:s.y,width:r.width,height:r.height})}this._viewRect=w||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=e,this.colorGroups=t;var E=this._element instanceof n.Link&&this._element.getStyle("link.icons.rotatable");for(i=0;i<len;i++)if(E instanceof Array&&E[i]&&this._viewRect){var S=this._viewRect.x+this._viewRect.width/2,x=this._viewRect.y+this._viewRect.height/2,T=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:S-T/2,y:x-T/2,width:T,height:T}}},_makeGroup:function(e){if(!Array.isArray(e))return[[e]];var t=[],n=!1,r,i=e.length,s,o;for(r=0;r<i;r++)s=e[r],Array.isArray(s)?(n=!0,t.push(s)):(o=[s],t.push(o));return n||(t.length=0,t.push(e)),t},_makeArray:function(e,t,n){if(Array.isArray(e))return e;var r=[];for(var i=0;i<t;i++)r.push(e||n);return r},paint:function(e){n.canvas.IconsAttachment.superClass.paint.apply(this,arguments);if(!this.iconsNames||this.iconsNames.length==0||!this.locations)return;var t,i,s,o,u,a,f,l,c,h;for(t=0;t<this.iconsGroups.length;t++){i=this.locations[t];if(!i)continue;u=i.x,a=i.y,o=this.iconsGroups[t],f=this.colorGroups[t],l=this.iconsOrientation[t],c=this.iconsXgap[t]||1,h=this.iconsYgap[t]||1,s=0;for(var p in o){var d=null,v=null;f&&f.length>s&&(v=f[s++]);var m=r.getImageAsset(o[p]);if(m==null)continue;if(l==="right")d={x:u,y:a,width:m.getWidth(),height:m.getHeight()},u+=d.width+c;else if(l==="left")d={x:u-m.getWidth(),y:a,width:m.getWidth(),height:m.getHeight()},u-=d.width+c;else if(l==="top")d={x:u,y:a-m.getHeight(),width:m
.getWidth(),height:m.getHeight()},a-=d.height+h;else{if(l!=="bottom")throw"Can not resolve '"+l+"' orientation";d={x:u,y:a,width:m.getWidth(),height:m.getHeight()},a+=d.height+h}var g=this._element instanceof n.Link&&this._element.getStyle("link.icons.rotatable");if(g instanceof Array&&g[t]){e.save();var y=d,u=y.x+y.width/2,a=y.y+y.height/2;e.translate(u,a),e.rotate(this._network.getElementUI(this._element).getAngle()),e.translate(-u,-a),Rr(e,m.getImage(v,d.width,d.height),v,d,this._element,this._network),e.restore()}else Rr(e,m.getImage(v,d.width,d.height),v,d,this._element,this._network);if(this._network._debug){var d=this._viewRect;w.strokeRect(e,d,"#FCFC00",1),w.strokeRect(e,d,"#FCFC00",1)}}}},_getIconsSize:function(e,t,n,i){var s=0,o=0,u=null,a=null,f=null;for(var l in e){a=r.getImageAsset(e[l]);if(!a)continue;if(t==="right")u={x:s,y:o,width:a.getWidth(),height:a.getHeight()},s+=u.width+n;else if(t==="left")u={x:s-a.getWidth(),y:o,width:a.getWidth(),height:a.getHeight()},s-=u.width+n;else if(t==="top")u={x:s,y:o-a.getHeight(),width:a.getWidth(),height:a.getHeight()},o-=u.height+i;else{if(t!=="bottom")throw"Can not resolve '"+t+"' orientation";u={x:s,y:o,width:a.getWidth(),height:a.getHeight()},o+=u.height+i}f==null?f=r.clone(u):f=m.unionRect(f,u)}return f?{width:Math.abs(f.width),height:Math.abs(f.height)}:null}}),n.canvas.EditAttachment=function(e,t){n.canvas.EditAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.canvas.EditAttachment",n.canvas.Attachment,{paint:function(e){n.canvas.EditAttachment.superClass.paint.apply(this,arguments),this._viewRect=null,this.paintResizingPoints(e),this.paintEditPoints(e),this.paintRotatePoints(e)},paintResizingPoints:function(e){var t=this.resizingPoints.size();if(t<=0)return;var r=this.resizePointSize*2,i=this.resizePointSize*2,s=this._network.getResizePointFillColor(),o=this._network.getResizePointOutlineWidth(),u=this._network.getResizePointOutlineColor(),a=this._element.getAngle(),f=this._element.getOriginalRect();e.lineWidth=o;for(var l=0;l<t;l++){var c=this.resizingPoints.get(l),h={x:c.x-this.resizePointSize,y:c.y-this.resizePointSize,width:this.resizePointSize*2,height:this.resizePointSize*2},p=this._getRotateRect(h,a,{x:f.x+f.width/2,y:f.y+f.height/2});e.save(),n.Util.rotateCanvas(e,p,a),rs.rect(e,p.x,p.y,r,i),e.restore()}e.fillStyle=s,e.strokeStyle=u,e.fill(),e.stroke()},paintEditPoints:function(e){var t=this.editPoints.size();if(t<=0)return;var n=this._network.getEditPointOutlineColor(),r=this._network.getEditPointFillColor(),i=this._network.getEditPointOutlineWidth();e.beginPath(),e.lineWidth=i;for(var s=0;s<t;s++){var o=this.editPoints.get(s);e.beginPath(),rs.circle(e,o.x,o.y,this.editPointSize,r,n),e.closePath()}},paintRotatePoints:function(e){var t=this.rotatePoints.size();if(t<=0)return;var n=this._network.getRotatePointOutlineColor(),r=this._network.getRotatePointFillColor(),i=this._network.getRotatePointOutlineWidth();e.beginPath(),e.lineWidth=i;for(var s=0;s<t;s++){var o=this.rotatePoints.get(s);e.beginPath(),rs.circle(e,o.x,o.y,this.rotatePointSize,r,n),e.closePath()}},validate:function(){n.canvas.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new n.List,this.editPoints=new n.List,this.rotatePoints=new n.List,this._element instanceof n.Node&&this._addResizingPoint(this._element),this._network.isRotatable(this._element)&&this._element instanceof es&&!(this._element instanceof n.ShapeNode)&&!(this._element instanceof n.Grid)&&!(this._element instanceof n.Group)&&this._addRotatePoint(this._element),this._element instanceof n.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof n.canvas.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof n.canvas.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(e){var t=e.getOriginalRect();if(!t)return;var n=this._network.getResizePointSize();if(n<=0)return;var r=new Oi([{x:t.x,y:t.y},{x:t.x+t.width/2,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x,y:t.y+t.height/2},{x:t.x+t.width,y:t.y+t.height/2},{x:t.x,y:t.y+t.height},{x:t.x+t.width/2,y:t.y+t.height},{x:t.x+t.width,y:t.y+t.height}]),i=this._network.getResizePointOutlineWidth(),s=this._network.getResizePointOutlineColor(),o=this._network.getResizePointFillColor();this._addPoints(e.getRect(),r,i,s,o,!0)},_addRotatePoint:function(e){var t=e.getOriginalRect();if(!t)return;var r=this._network.getRotatePointSize();if(r<=0)return;var i=r*2,s=new n.List([{x:t.x+t.width/2,y:t.y-this._network.getRotatePointOffset()-i/2}]),o=e.getAngle();o!=0&&(s=this._rotatePointList(s,o,e.getOriginalRect()));var u=s.get(0),a={x:u.x-i/2,y:u.y-i/2,width:i,height:i},f=this._network.getRotatePointOutlineWidth(),l=this.rotatePointSize+f;m.grow(t,l,l);var c=m.unionRect(e.getRect(),a);this._viewRect=m.unionRect(c,this._viewRect),this.rotatePoints=s},_addShapeNodePoint:function(e){this._addEditPoints(e.getPoints())},_addShapeLinkPoints:function(e){this._addEditPoints(e.getPoints())},_addLinkControlPoint:function(e){if(Nr.isOrthogonalLink(e._element)){var t=e.getControlPoint();if(t){var r=new n.List;r.add(t),this._addEditPoints(r)}}},_addEditPoints:function(e){var t=m.getRect(e);if(!t)return;var n=this._network.getEditPointSize();if(n<=0)return;var r=this._network.getEditPointOutlineWidth();this._addPoints(t,e,r,!1)},_addPoints:function(e,t,n,r,i,s){var o=s?this._network.getResizePointSize():this._network.getEditPointSize();if(o<0)return;var u=o+n;m.grow(e,u,u),this._viewRect=m.unionRect(e,this._viewRect),s==1?this.resizingPoints=t:this.editPoints=t},_rotatePoint:function(e,t,n){var r=m.createMatrix(t*Math.PI/180,n.x+n.width/2,n.y+n.height/2),i=r.transform(e);return i},_rotatePointList:function(e,t,r){var i=this,s=new n.List;return e.forEach(function(e){s.add(i._rotatePoint(e,t,r))}),s},_getRotateRect:function(e,t,r){var i=m.createMatrix(t*Math.PI/180,r.x,r.y),s={x:e.x+e.width/2,y:e.y+e.height/2},o=i.transform(s),u=new n.List([{x:o.x-e.width/2,y:o.y-e.height/2},{x:o.x+e.width/2,y:o.y-e.height/2},{x:o.x+e.width/2,y:o.y+e.height/2},{x:o.x-e.width/2,y:o.y+e.height/2}]);return m.getRect(u)}}),n.canvas.HTMLLabelAttachment=function(e,t){n.canvas.HTMLLabelAttachment.superClass.constructor.call(this,e,t),this._triangleDiv=n.Util.createDiv(),this._roundDiv=n.Util.createDiv(),this._contentDiv=n.Util.createDiv();var r=this;this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},r.ext("twaver.canvas.HTMLLabelAttachment",n.canvas.LabelAttachment,{validate:function(){var e=this._element.getStyle("attachment.htmllabel.hyperlink");e?(n.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),n.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(n.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),n.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),n.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),n.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var t=this.getFont("label.font"),r=this.getLabel();this._contentDiv.innerHTML=r,this._contentDiv.style.visibility="hidden",n.canvas.HTMLLabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(e){var t=this.isFill(),n=this.getOutlineWidth(),r=this._contentRect;this.getElementUI().setShadow(this,e);if(n>0||t){w.drawRoundRect(e,r.x,r.y,r.width,r.height,this.getCornerRadius());if(this._pointers){var i=this._pointers;e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(i[2].x,i[2].y)}e.closePath(),n>0&&(e.lineWidth=n,e.strokeStyle=this.getOutlineColor(),e.lineCap=this.getCap(),e.lineJoin=this.getJoin(),e.stroke());if(t){var s=this.getFillColor(),o=this.getGradient();o?w.fill(e,s,o,this.getGradientColor(),this._viewRect):e.fillStyle=s,e.fill()}}var u=this.getFont("label.font"),a=this.getLabel(),f=this._network.getViewRect().x,l=this._network.getViewRect().y,c=this._network.getZoom(),h={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},p=h.x*c-f-this._contentDiv.offsetWidth/2*c+"px",d=h.y*c-l-this._contentDiv.offsetHeight/2*c+"px";this._contentDiv.style.left=p,this._contentDiv.style.top=d,this._contentDiv.style.setProperty("-webkit-transform","scale("+c+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&w.strokeRect(e,this._contentRect,"#AAAAAA")},setVisibility:function(e){this._contentDiv.style.visibility=e},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),n.canvas.HTMLAlarmAttachment=function(e,t){n.canvas.HTMLAlarmAttachment.superClass.constructor.call(this,e,t),this._triangleDiv=n.Util.createDiv(),this._roundDiv=n.Util.createDiv(),this._contentDiv=n.Util.createDiv(),n.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),n.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),n.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),n.Util.setCSSStyle(this._contentDiv,"pointer-events","none");var r=this;this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},r.ext("twaver.canvas.HTMLAlarmAttachment",n.canvas.AlarmAttachment,{validate:function(){var e=this.getFont("alarm.font"),t=this._network.getAlarmLabel(this._element);this._contentDiv.innerHTML=t,this._contentDiv.style.visibility="hidden",n.canvas.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(e){var t=this.isFill(),r=this.getOutlineWidth(),i=this._contentRect;this.getElementUI().setShadow(this,e);if(r>0||t){w.drawRoundRect(e,i.x,i.y,i.width,i.height,this.getCornerRadius());if(this._pointers){var s=this._pointers;e.moveTo(s[0].x,s[0].y),e.lineTo(s[1].x,s[1].y),e.lineTo(s[2].x,s[2].y)}e.closePath(),r>0&&(e.lineWidth=r,e.strokeStyle=this.getOutlineColor(),e.lineCap=this.getCap(),e.lineJoin=this.getJoin(),e.stroke());if(t){var o=this.getFillColor(),u=this.getGradient();u?w.fill(e,o,u,this.getGradientColor(),this._viewRect):e.fillStyle=o,e.fill()}}var a=this.getFont("alarm.font"),f=this._network.getAlarmLabel(this._element),l=this._network.getViewRect().x,c=this._network.getViewRect().y,h=this._network.getZoom(),p={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},d=p.x*h-l-this._contentDiv.offsetWidth/2*h+"px",v=p.y*h-c-this._contentDiv.offsetHeight/2*h+"px";this._contentDiv.style.left=d,this._contentDiv.style.top=v,this._contentDiv.style.setProperty("-webkit-transform","scale("+h+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&w.strokeRect(e,this._contentRect,"#AAAAAB"),n.canvas.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(e){this._contentDiv.style.visibility=e},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),n.canvas.interaction.BaseInteraction=function(e){this.network=e},r.ext("twaver.canvas.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},convertPointFromView:function(e){var t=e.x*this.network.getZoom()-this.network.getViewRect().x,n=e.y*this.network.getZoom()-this.network.getViewRect().y;return{x:t,y:n}},convertFromUIToMarkerRect:function(e,t,n){var r=this.network.getZoom();return{x:e.x*r-this.network.getViewRect().x+t*r,y:e.y*r-this.network.getViewRect().y+n*r,width:e.width*r,height:e.height*r}},getMarkerPoint:function(e){var t;if(h.isTouchable&&e.changedTouches&&e.changedTouches.length>0){var n=e.changedTouches[0];return t={x:n.clientX,y:n.clientY},t}return h.isFirefox?t={x:e.layerX,y:e.layerY}:t={x:e.offsetX,y:e.offsetY},t},paint:function(e){},addListener:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];b.addEventListener(t,"handle_"+t,this.network.getView(),this)}},removeListener:function(){for(var e=0;e<arguments.length;e++)b.removeEventListener(arguments[e],this.network.getView(),this)},_handle_mousedown:function(e){if(e.button!==0)return;this._startLogical=this.network.getLogicalPoint(e),this._startClient=b.getClientPoint(e),this._startLogical&&b.handle_mousedown(this,e)},_handle_mousemove:function(e){this._endLogical={x:this._startLogical.x+(e.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(e.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(e){delete this._startClient,delete this._startLogical,delete this._endLogical}}),n.canvas.interaction.SelectInteraction=function(e){n.canvas.interaction.SelectInteraction.superClass.constructor.call(this,e)},r.ext("twaver.canvas.interaction.SelectInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup"),this.end(),this.network.removeMarker(this)},paint:function(e){if(this.startPoint==null||this.endPoint==null)return;var t=this.convertPointFromView(this.startPoint),n=this.convertPointFromView(this.endPoint),r=t.x,i=t.y,s=n.x,o=n.y,u=m.getRect([{x:r,y:i},{x:s,y:o}]);if(u!=null){e.beginPath();var a=this.network.getSelectOutlineWidth(),f=this.getIntersectMode()?this.network.getSelectFillColor():null;e.strokeStyle=this.network.getSelectOutlineColor(),e.lineWidth=a,rs.rect(e,u.x,u.y,u.width,u.height,f,this.network.getSelectOutlineColor()),e.closePath()}},handle_mousedown:function(e){if(!this.network.isValidEvent(e)||this.network.isMovingElement()||this.network.isEditingElement())return;if(e.shiftKey)return;var t=this.network.getElementAt(e),n=this.network.getSelectionModel();t?r.isCtrlDown(e)?n.contains(t)?n.removeSelection(t):n.appendSelection(t):n.contains(t)||n.setSelection(t):(r.isCtrlDown(e)||n.clearSelection(),this.end(e),this.startPoint=this.network.getLogicalPoint(e),this.startPoint&&this.network.isRectSelectEnabled()&&this.addListener("mousemove"))},handle_mouseup:function(e){this.end(e)},handle_mousemove:function(e){if(this.network.isMovingElement()||this.network.isEditingElement()){this.end(e);return}var t=this.network.getLogicalPoint(e);if(!t)return;this.network.setSelectingElement(!0),this.endPoint==null?this.network.fireInteractionEvent({kind:"selectStart",event:e}):this.network.fireInteractionEvent({kind:"selectBetween",event:e}),this.endPoint=t,this.repaint()},end:function(e){if(this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var t=m.getRect([this.startPoint,this.endPoint]),n=this.network.getElementsAtRect(t,this.getIntersectMode(),this.network.getRectSelectFilter());if(n&&n.size()>0){var r=this.network.getSelectionModel(),i=r.toSelection();n.forEach(function(e){r.contains(e)?i.remove(e):i.add(e)},this),r.setSelection(i)}this.network.fireInteractionEvent({kind:"selectEnd",event:e})}this.network.setSelectingElement(!1),this.removeListener("mousemove"),this.startPoint=null,this.endPoint=null,this.repaint()}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y}}),n.canvas.interaction.MoveInteraction=function(e,t){this.lazyMode=t,n.canvas.interaction.MoveInteraction.superClass.constructor.call(this,e)},r.ext("twaver.canvas.interaction.MoveInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","keydown","mouseout"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","keydown","mouseout"),this.end(),this.network.removeMarker(this)},handle_keydown:function(e){this.currentKeyEvent=e,this.addListener("keyup")},handle_keyup:function(e){this.currentKeyEvent=null,this.removeListener("keyup")},isParenting:function(){return this.pressPoint&&this.currentKeyEvent!=null&&this.currentKeyEvent.keyCode===80},parentProcess:function(e,t){var n=null;this.parent=null;var r=this;if(!t&&this.isParenting()){var i={},s=this.network.getLogicalPoint(e);i.x=s.x-1,i.y=s.y-1,i.width=2,i.height=2;var o=this.network.getElementsAtRect(i,!0);if(o&&o.size()>0){var u=o.size();for(var a=0;a<u;a++){var f=o.get(a);if(!r.network.getElementBox().getSelectionModel().contains(f)){r.parent=f;break}}}}else this.parent=null;this.parent!=null&&(n=this.network.getElementUI(this.parent).getViewRect()),n!=null&&!t?this.parentRect=n:this.parentRect=null},paint:function(e){if(this.lazyMode){if(this.pressPoint==null||this.dragPoint==null)return;e.beginPath();var t=this.dragPoint.x-this.pressPoint.x,n=this.dragPoint.y-this.pressPoint.y,r=this.network.getMovableSelectedElements(),i=r.size(),s=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,o=this.network.getLazyMoveOutlineWidth(),u=this.network.getLazyMoveOutlineColor();e.strokeStyle=u,e.lineWidth=o,e.fillStyle=s;for(var a=0;a<i;a++){var f=r.get(a),l=this.network.getElementUI(f);if(l){var c=this.convertFromUIToMarkerRect(l.getViewRect(),t,n);rs.rect(e,c.x,c.y,c.width,c.height)}}e.fill(),e.stroke()}if(this.parentRect){e.beginPath();var s=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,o=this.network.getLazyMoveOutlineWidth(),u=this.network.getLazyMoveOutlineColor();e.strokeStyle=u,e.lineWidth=o,e.fillStyle=s;var c=this.parentRect;rs.rect(e,c.x,c.y,c.width,c.height),e.fill(),e.stroke()}},handle_mousedown:function(e){if(e.button!==0)return;if(!this.network.isValidEvent(e)||this.network.isSelectingElement()||this.network.isEditingElement())return;var t=this.network.getElementAt(e);if(!this.network.isMovable(t))return;this.end(e),this.lastPoint=this.network.getLogicalPoint(e),this.lazyMode&&(this.pressPoint=this.lastPoint),this.lastPoint&&this.addListener("mousemove")},handle_mouseup:function(e){this.end(e)},handle_mouseout:function(e){this.end(e)},handle_mousemove:function(e){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()){this.end(e);return}var t=this.network.getLogicalPoint(e);if(!t)return;if(!this.lastPoint)return;this.xoffset=t.x-this.lastPoint.x,this.yoffset=t.y-this.lastPoint.y;if(Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1)return;this.lazyMode?this.dragPoint==null?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:e}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:e}):(this.lastPoint=t,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e})),this.network.moveSelectedElements(this.xoffset,this.yoffset)),this.parentProcess(e,!1),this.lazyMode&&(this.dragPoint=t),(this.lazyMode||this.isParenting())&&this.repaint()},end:function(e){if(this.lazyMode){if(this.dragPoint!=null&&this.pressPoint!=null){var t=this,n=function(){t.network.fireInteractionEvent({kind:"lazyMoveEnd",event:e}),t.network.setMovingElement(!1)},r=this.dragPoint.x-this.pressPoint.x,i=this.dragPoint.y-this.pressPoint.y;this.network.moveSelectedElements(r,i,this.network.isLazyMoveAnimate(),n)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e}));if(this.isParenting()){this.parent==null&&(this.parent=this.network.getCurrentSubNetwork());var t=this;this.network.getMovableSelectedElements().forEach(function(e){e.setParent(t.parent)},this.network)}this.parentProcess(e,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.removeListener("mousemove"),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null}}),n.canvas.interaction.ScrollInteraction=function(e){n.canvas.interaction.ScrollInteraction.superClass.constructor.call(this,e),this.hThumbRect=null,this.vThumbRect=null,this.scrollBarVisible=!1},r.ext("twaver.canvas.interaction.ScrollInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout"),h.isFirefox?b.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):b.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),b.addEventListener("mouseup","handleMouseUp",e,this),b.addEventListener("mousemove","handleMouseMove",e,this),this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout"),h.isFirefox?b.removeEventListener("DOMMouseScroll",this.network.getView(),this):b.removeEventListener("mousewheel",this.network.getView(),this),b.removeEventListener("mouseup",e,this),b.removeEventListener("mousemove",e,this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.network.removeMarker(this)},handleViewRectChange:function(e){(e.property=="viewRect"||e.property=="canvasSizeChange")&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){this.hThumbRect=null,this.vThumbRect=null;if(this.network.isScrollBarVisible()==0){this.repaint();return}var e=this.network.getViewRect().height,t=this.network.getViewRect().width,n=this.network.getViewRect().x,r=this.network.getViewRect().y,i=this.network.getCanvasSize(),s=i.width,o=i.height;if(s>t)if(n<0||n+t>s){this.repaint();return}if(o>e)if(r<0||r+e>o){this.repaint();return}var u=0,a=e<o,f=t<s,l=this.getScrollBarWidth();if(e<o){f?u=e*(e-l)/o:u=e*e/o;var c=r/(o-e)*(e-u-l);this.vThumbRect={x:t-l,y:c,width:l,height:u}}var h=0;if(t<s){a?h=t*(t-l)/s:h=t*t/s;var p=n/(s-t)*(t-h-l);this.hThumbRect={x:p,y:e-l,width:h,height:l}}this.network.setHScrollBarVisible(this.hThumbRect!=null),this.network.setVScrollBarVisible(this.vThumbRect!=null),this.repaint()},scrollXOffset:function(e){var t=this.network.getViewRect().height,n=this.network.getViewRect().width,r=this.network.getViewRect().x,i=this.network.getViewRect().y,s=30;e&&(s=-30),this.network.setViewRect(r+s,i,n,t)},scrollYOffset:function(e){var t=this.network.getViewRect().height,n=this.network.getViewRect().width,r=this.network.getViewRect().x,i=this.network.getViewRect().y,s=30;e&&(s=-30),this.network.setViewRect(r,i+s,n,t)},handle_mousedown:function(e){if(this.network.isValidEvent(e)==1)return;var t=this.getMarkerPoint(e);this.hBarDownPoint=null,this.vBarDownPoint=null,this.vThumbRect!=null&&m.containsPoint(this.vThumbRect,t.x,t.y)&&(this.vBarDownPoint={x:e.screenX,y:e.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),this.hThumbRect!=null&&m.containsPoint(this.hThumbRect,t.x,t.y)&&(this.hBarDownPoint={x:e.screenX,y:e.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x)},handle_mouseover:function(e){if(this.scrollBarVisible==1)return;this.scrollBarVisible=!0,this.repaint()},handle_mouseout:function(e){if(this.scrollBarVisible==0)return;this.scrollBarVisible=!1,this.repaint()},handleMouseUp:function(e){this.vBarDownPoint=null,this.hBarDownPoint=null,this.repaint()},handleMouseMove:function(e){var t={x:e.screenX,y:e.screenY},n=this.network.getCanvasSize(),r=this.network.getViewRect().height,i=this.network.getViewRect().width,s=this.getScrollBarWidth();if(this.hBarDownPoint!=null){var o=t.x-this.hBarDownPoint.x;this.hBarDownPoint=t,this.network.setViewOffSet(o*n.width/(i-s),0);return}if(this.vBarDownPoint!=null){var u=t.y-this.vBarDownPoint.y;this.vBarDownPoint=t,this.network.setViewOffSet(0,u*n.height/(r-s));return}},handleMouseWheel:function(e){var t=!1,n=!1;e.wheelDelta!==e.wheelDeltaX?(e.wheelDelta?e.wheelDelta>0&&(t=!0):e.detail<0&&(t=!0),this.scrollYOffset(t)):(e.wheelDelta?e.wheelDelta>0&&(t=!0):e.detail<0&&(t=!0),this.scrollYOffset(t))},paintRoundRect:function(e,t,n,r,i,s,o,u){e.beginPath(),e.globalAlpha=n,e.fillStyle=t,w.drawRoundRect(e,r,i,s,o,u),e.fill()},paint:function(e){if(this.network.isScrollBarVisible()==0)return;if(this.scrollBarVisible==0&&this.hBarDownPoint==null&&this.vBarDownPoint==null)return;var t=this.getScrollBarWidth(),n=this.network.getViewRect().height,r=this.network.getViewRect().width;e.save();var i,s=this.getScrollBarColor();this.hThumbRect!=null&&(i=e.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),i.addColorStop(0,s),i.addColorStop(1,"#666666"),this.paintRoundRect(e,this.getScrollBarColor(),.5,0,n-t,r-t,t,t/2),this.paintRoundRect(e,i,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,t/2)),this.vThumbRect!=null&&(i=e.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),i.addColorStop(0,s),i.addColorStop(1,"#666666"),this.paintRoundRect(e,this.getScrollBarColor(),.5,r-t,0,t,n-t,t/2),this.paintRoundRect(e,i,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,t/2)),e.restore()}}),n.canvas.interaction.DefaultInteraction=function(e){n.canvas.interaction.DefaultInteraction.superClass.constructor.call(this,e)},r.ext("twaver.canvas.interaction.DefaultInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(e){if(!this.network.isValidEvent(e))return;this.network.isFocusOnClick()&&n.Util.setFocus(this.network.getView());var t=this.network.getElementAt(e);e.detail===2?this.handleDoubleClicked(e,t):this.handleClicked(e,t)},handleClicked:function(e,t){Or.handleClicked(this.network,e,t)},handleDoubleClicked:function(e,t){Or.handleDoubleClicked(this.network,e,t)},handle_keydown:function(e){Or.handleKeyDown(this.network,e)},handle_mousemove:function(e){var t=this.network.getElementAt(e),n=this._preElement,r=Mr(n),i=Mr(t);n!==t&&(n&&(r&&r.onMouseLeave&&r.onMouseLeave(n,this.network),this.network.onMouseLeave(n,e)),t&&(i&&i.onMouseEnter&&i.onMouseEnter(t,this.network),this.network.onMouseEnter(t,e))),t&&i&&i.onMouseMove&&i.onMouseMove(t,this.network),this.network.onMouseMove(t,e),this._preElement=t}}),n.canvas.interaction.PanInteraction=function(e){n.canvas.interaction.PanInteraction.superClass.constructor.call(this,e)},r.ext("twaver.canvas.interaction.PanInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown","mouseup")},handle_mousedown:function(e){if(!this.network.isValidEvent(e))return;this.lastPoint=this.getMarkerPoint(e),this.lastPoint&&(this.addListener("mousemove"),this.network.getView().style.cursor="pointer")},handle_mouseup:function(e){this._clear()},handle_mousemove:function(e){if(!this.lastPoint)return;var t=this.getMarkerPoint(e);if(!t)return;var n=t.x-this.lastPoint.x,r=t.y-this.lastPoint.y;this.network.panByOffset(-n,-r),this.lastPoint=t},_clear:function(e){this.lastPoint&&(this.lastPoint=null,this.network.getView().style.cursor=this._oldCursor,this.removeListener("mousemove"))}}),n.canvas.interaction.CreateElementInteraction=function(e,t){t||(t=n.Node),n.Util.isTypeOf(t,n.Node)?this.elementFunction=function(e){var r=new t;return r instanceof n.Node&&r.setCenterLocation(e),r}:this.elementFunction=t,n.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this,e)},r.ext("twaver.canvas.interaction.CreateElementInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(e){var t=this.network.getLogicalPoint(e);if(t){var n=this.elementFunction(t);n&&this.network.addElementByInteraction(n)}}}),n.canvas.interaction.EditInteraction=function(e,t){this.lazyMode=t,this.pointIndex=-1,n.canvas.interaction.EditInteraction.superClass.constructor.call(this,e)},r.ext("twaver.canvas.interaction.EditInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(e){if(this.lazyMode==1&&this.resizingRect!=null){e.lineWidth=this.network.getResizeLineWidth();var t=this.convertFromUIToMarkerRect(this.resizingRect,0,0);e.save(),n.Util.rotateCanvas(e,t,this.node.getAngle()),e.beginPath(),rs.rect(e,t.x,t.y,t.width,t.height,null,this.network.getResizeLineColor()),e.restore()}this.isStartRotate&&this.showRotateScale(e)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(e){this.cursorID=e,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(e){if(e.button!==0)return;if(r.isAltDown(e)&&!this.network.isEditingElement()){var t=this.network.getElementAt(e),i=this.network.getLogicalPoint(e);if(t instanceof n.ShapeNode){var s=this.getPointIndex(t.getPoints(),i,!0);s>0&&(this._handle_mousedown(e),this.pointIndex=s,this.shapeNode=t,t.addPoint(i,s),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:e,element:t,pointIndex:s}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:t,pointIndex:s}))}if(t instanceof n.ShapeLink){var o=new n.List(t.getPoints()),u=this.network.getElementUI(t);o.add(u.getFromPoint(),0),o.add(u.getToPoint());var s=this.getPointIndex(o,i)-1;s>0&&(this._handle_mousedown(e),this.pointIndex=s,this.shapeLink=t,t.addPoint(i,s),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:e,element:t,pointIndex:s}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:t,pointIndex:s}))}return}if(!this.network.isEditingElement()||this.isStart||this.isStartRotate)return;this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:e,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?r.isAltDown(e)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:e,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?r.isAltDown(e)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:e,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(e))},handle_mouseup:function(e){if(this.isStart){var t=this.network.getLogicalPoint(e);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var r=this,i=new n.animate.AnimateBounds(this.node,this.
resizingRect,function(){r.network.fireInteractionEvent({kind:"lazyResizeEnd",event:e,element:r.node,resizeDirection:r.resizeDirection}),r.clear()});n.animate.AnimateManager.start(i)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:e,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:e,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&t?(this.shapeNode.setPoint(this.pointIndex,t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&t?(this.shapeLink.setPoint(this.pointIndex,t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&t&&(this.linkUI.setControlPoint(t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.linkUI._element}))}this._handle_mouseup(e),this.lazyMode||this.clear()},handle_mousemove:function(e){if(!this.network.isValidEvent(e))return;if(this.isStartRotate&&this.node){this._handleRotateElement(e,this.node),this.network.isShowRotateScale()&&this.repaint();return}if(this.isStart){if(this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(e);return}if(this.shapeLink&&this.pointIndex>=0){this._handleMovingShapeLinkPoint(e);return}if(this.node&&this.resizeDirection){this._handleResizing(e);return}if(this.linkUI){this._handleMovingLinkControlPoint(e);return}}if(this.network.isSelectingElement()||this.network.isMovingElement()||this.network.getSelectionModel().size()===0){this.clear();return}var t=this.network.getElementAt(e),r=this.network.getElementUI(t);if(!r||!r.getEditAttachment()){this.clear();return}var i=this.network.getLogicalPoint(e);if(t instanceof n.Node){this.node=t;if(this._isEditingShapeNode(i)||this._isResizingNode(i)){this.network.setEditingElement(!0);return}if(this._isRotatingElement(i)){this.network.setRotatingElement(!0),this.network.setEditingElement(!0);return}}else if(t instanceof n.ShapeLink){this.shapeLink=t;if(this._isEditingShapeLink(i)){this.network.setEditingElement(!0);return}}else if(r instanceof n.canvas.LinkUI){var s=this.network.getEditPointSize();if(Nr.isOrthogonalLink(r._element)){this.linkUI=r;var o=this.linkUI.getControlPoint();o&&this._contains(i,o,s)&&(this._setCrossCursor(),this.network.setEditingElement(!0));return}}this.clear()},_isRotatingElement:function(e){var t=this.network.getRotatePointSize();if(t<=0)return!1;var n=this.node.getOriginalRect(),r=this.node.getAngle();return this._isRotating(e,"crosshair",n,r)},_isRotating:function(e,t,n,r){var i=this.network.getRotatePointSize(),s={x:n.x+n.width/2,y:n.y-this.network.getRotatePointOffset()-i},o=this._rotatePoint(s,r,n),u={x:o.x-i,y:o.y-i,width:i*2,height:i*2};return m.containsPoint(u,e)?(this._removeCursor(),this._setCursor(t),!0):!1},_handleRotateElement:function(e,t){this._handle_mousemove(e);var n=this._calculateAngle(this.network.getLogicalPoint(e),t);t.setAngle(n)},_calculateAngle:function(e,t){var n=t.getCenterLocation();return Math.round(Math.atan2(n.x-e.x,e.y-n.y)*180/Math.PI+180)},_handleMovingShapeNodePoint:function(e){var t=this.network.getLogicalPoint(e);this.shapeNode.setPoint(this.pointIndex,t),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:e,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(e){var t=this.network.getLogicalPoint(e);this.shapeLink.setPoint(this.pointIndex,t),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:e,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(e){this.linkUI.setControlPoint(this.network.getLogicalPoint(e)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:e,element:this.linkUI._element})},_handleResizing:function(e){this._handle_mousemove(e);var t=this.node.getAngle(),n=this.node.getLocation(),r=this.node.getWidth()/2,i=this.node.getHeight()/2,s={x:n.x+r,y:n.y+i},o={x:-r,y:-i},u={x:-r,y:i},a={x:r,y:i},f={x:r,y:-i},l={x:0,y:-i},c={x:r,y:0},h={x:0,y:i},p={x:-r,y:0};this.resizeDirection==="northwest"&&(this._transformPoint(a,s,t),o.x=this._endLogical.x,o.y=this._endLogical.y,s.x=(o.x+a.x)/2,s.y=(o.y+a.y)/2,this._reversPoint(o,s,t),this._reversPoint(a,s,t),this.resizingRect={x:o.x,y:o.y,width:a.x-o.x,height:a.y-o.y});if(this.resizeDirection==="north"){var d={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(d,s,t),l.y=d.y-s.y,this._transformPoint(l,s,t),this._transformPoint(h,s,t),s.x=(l.x+h.x)/2,s.y=(l.y+h.y)/2,this._reversPoint(l,s,t),this._reversPoint(h,s,t),this.resizingRect={x:s.x-this.node.getWidth()/2,y:s.y-(h.y-l.y)/2,width:this.node.getWidth(),height:h.y-l.y}}this.resizeDirection==="northeast"&&(this._transformPoint(u,s,t),f.x=this._endLogical.x,f.y=this._endLogical.y,s.x=(u.x+f.x)/2,s.y=(u.y+f.y)/2,this._reversPoint(u,s,t),this._reversPoint(f,s,t),this.resizingRect={x:u.x,y:f.y,width:f.x-u.x,height:u.y-f.y});if(this.resizeDirection==="west"){var d={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(d,s,t),p.x=d.x-s.x,this._transformPoint(c,s,t),this._transformPoint(p,s,t),s.x=(c.x+p.x)/2,s.y=(c.y+p.y)/2,this._reversPoint(c,s,t),this._reversPoint(p,s,t),this.resizingRect={x:s.x-(c.x-p.x)/2,y:s.y-this.node.getHeight()/2,width:c.x-p.x,height:this.node.getHeight()}}if(this.resizeDirection==="east"){var d={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(d,s,t),c.x=d.x-s.x,this._transformPoint(c,s,t),this._transformPoint(p,s,t),s.x=(c.x+p.x)/2,s.y=(c.y+p.y)/2,this._reversPoint(c,s,t),this._reversPoint(p,s,t),this.resizingRect={x:s.x-(c.x-p.x)/2,y:s.y-this.node.getHeight()/2,width:c.x-p.x,height:this.node.getHeight()}}this.resizeDirection==="southwest"&&(this._transformPoint(f,s,t),u.x=this._endLogical.x,u.y=this._endLogical.y,s.x=(u.x+f.x)/2,s.y=(u.y+f.y)/2,this._reversPoint(u,s,t),this._reversPoint(f,s,t),this.resizingRect={x:u.x,y:f.y,width:f.x-u.x,height:u.y-f.y});if(this.resizeDirection==="south"){var d={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(d,s,t),h.y=d.y-s.y,this._transformPoint(l,s,t),this._transformPoint(h,s,t),s.x=(l.x+h.x)/2,s.y=(l.y+h.y)/2,this._reversPoint(l,s,t),this._reversPoint(h,s,t),this.resizingRect={x:s.x-this.node.getWidth()/2,y:s.y-(h.y-l.y)/2,width:this.node.getWidth(),height:h.y-l.y}}this.resizeDirection==="southeast"&&(this._transformPoint(o,s,t),a.x=this._endLogical.x,a.y=this._endLogical.y,s.x=(o.x+a.x)/2,s.y=(o.y+a.y)/2,this._reversPoint(o,s,t),this._reversPoint(a,s,t),this.resizingRect={x:o.x,y:o.y,width:a.x-o.x,height:a.y-o.y}),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:e,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:e,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(e){var t=this.network.getEditPointSize();if(this.node instanceof n.ShapeNode){this.shapeNode=this.node;var r=this.shapeNode.getPoints();for(var i=0,s=r.size();i<s;i++){var o=r.get(i);if(this._contains(e,o,t))return this._setCrossCursor(),this.pointIndex=i,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(e){var t=this.network.getEditPointSize(),n=this.shapeLink.getPoints();for(var r=0,i=n.size();r<i;r++){var s=n.get(r);if(this._contains(e,s,t))return this._setCrossCursor(),this.pointIndex=r,!0}return this.pointIndex=-1,!1},_isResizingNode:function(e){var t=this.network.getResizePointSize();if(t<=0)return!1;var n=this.node.getOriginalRect(),r=this.node.getAngle(),i={x:n.x,y:n.y},s=this._rotatePoint(i,r,n);return this._isResizing(e,s.x,s.y,"northwest","nwse-resize")?!0:(i={x:n.x+n.width/2,y:n.y},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"north","ns-resize")?!0:(i={x:n.x+n.width,y:n.y},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"northeast","nesw-resize")?!0:(i={x:n.x,y:n.y+n.height/2},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"west","ew-resize")?!0:(i={x:n.x+n.width,y:n.y+n.height/2},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"east","ew-resize")?!0:(i={x:n.x,y:n.y+n.height},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"southwest","nesw-resize")?!0:(i={x:n.x+n.width/2,y:n.y+n.height},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"south","ns-resize")?!0:(i={x:n.x+n.width,y:n.y+n.height},s=this._rotatePoint(i,r,n),this._isResizing(e,s.x,s.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(e,t,n){var r=m.createMatrix(t*Math.PI/180,n.x+n.width/2,n.y+n.height/2),i=r.transform(e);return i},_isResizing:function(e,t,n,r,i){var s=this.network.getResizePointSize();return this._contains(e,{x:t,y:n},s)?(this.resizeDirection!==r&&(this._removeCursor(),i=this._changeCursorWithAngle(r,this.node.getAngle()),this._setCursor(i),this.resizeDirection=r),!0):!1},_getRect:function(e,t,n,r){var i=e<n?e:n,s=t<r?t:r,o=Math.abs(e-n),u=Math.abs(t-r);return{x:i,y:s,width:o,height:u}},_contains:function(e,t,n){var r={x:t.x-n,y:t.y-n,width:n*2,height:n*2};return m.containsPoint(r,e)},getPointIndex:function(e,t,n){if(e.size()<2)return 0;var r=e.get(0),i;for(var s=1;s<e.size();s++){i=e.get(s);if(this.isPointOnLine(t,r,i,6))return s;r=i}return r=e.get(0),n&&this.isPointOnLine(t,r,i,6)?e.size():0},showRotateScale:function(e){var t=new n.List,i=this.network.getRotateScaleWidth(),s=this.network.getRotateScaleHeight(),o=this.network.getRotatePointSize(),u=this.node.getAngle(),a=this.node.getOriginalRect(),f={x:a.x+a.width/2,y:a.y-this.network.getRotatePointOffset()-o},l=this._rotatePoint(f,u,a),c,h="13px Arial",p=u+"°",d,v,m,g;this.node.getAngle()>=0&&this.node.getAngle()<=180?(d={x:l.x+o,y:l.y},v={x:d.x+i,y:d.y},m={x:v.x,y:v.y-s},g={x:d.x,y:m.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(d={x:l.x-o,y:l.y},v={x:d.x-i,y:d.y},m={x:v.x,y:v.y-s},g={x:d.x,y:m.y});var y=new n.List([d,v,m,g]),c=r.math.getRect(y);e.fillStyle=this.network.getRotateScaleFillColor(),e.fillRect(c.x,c.y,c.width,c.height),e.fillStyle=this.network.getRotateScaleFontColor(),e.textBaseline="middle",e.textAlign="center",e.font=h,e.fillText(p,c.x+c.width/2,c.y+c.height/2)},isPointOnLine:function(e,t,n,r){r<0&&(r=0);var i=this.getDistanceFromPointToLine(e,t,n);return i<=r&&e.x>=Math.min(t.x,n.x)-r&&e.x<=Math.max(t.x,n.x)+r&&e.y>=Math.min(t.y,n.y)-r&&e.y<=Math.max(t.y,n.y)+r},getDistanceFromPointToLine:function(e,t,n){if(t.x===n.x)return Math.abs(e.x-t.x);var r=(n.y-t.y)/(n.x-t.x),i=(n.x*t.y-t.x*n.y)/(n.x-t.x);return Math.abs(r*e.x-e.y+i)/Math.sqrt(r*r+1)},_transformPoint:function(e,t,n){var r=Math.cos(n*Math.PI/180),i=Math.sin(n*Math.PI/180),s=e.x,o=e.y,u=s*r-o*i,a=s*i+o*r;e.x=u+t.x,e.y=a+t.y},_reversPoint:function(e,t,n){n*=-1;var r=Math.cos(n*Math.PI/180),i=Math.sin(n*Math.PI/180),s=e.x-t.x,o=e.y-t.y,u=s*r-o*i,a=s*i+o*r;e.x=u+t.x,e.y=a+t.y},_changeCursorWithAngle:function(e,t){var n,r=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(e){case"northwest":n=1;break;case"north":n=2;break;case"northeast":n=3;break;case"east":n=4;break;case"southeast":n=5;break;case"south":n=6;break;case"southwest":n=7;break;case"west":n=8;break;default:n=0}if(t>=360||t<=-360)t%=360;return t>22.5&&t<=67.5&&(n+=1),t<-22.5&&t>=-67.5&&(n-=1),t>67.5&&t<=112.5&&(n+=2),t<-67.5&&t>=-112.5&&(n-=2),t>112.5&&t<=157.5&&(n+=3),t<-112.5&&t>=-157.5&&(n-=3),t>157.5&&t<=202.5&&(n+=4),t<-157.5&&t>=-202.5&&(n-=4),t>202.5&&t<=247.5&&(n+=5),t<-202.5&&t>=-247.5&&(n-=5),t>247.5&&t<=292.5&&(n+=6),t<-247.5&&t>=-292.5&&(n-=6),t>292.5&&t<=337.5&&(n+=7),t<-292.5&&t>=-337.5&&(n-=7),n>8&&(n-=8),n<=0&&(n+=8),r[n]}}),n.canvas.interaction.CreateLinkInteraction=function(e,t){t||(t=n.Link),n.Util.isTypeOf(t,n.Link)?this.linkFunction=function(e,r){var i=new t;return i instanceof n.Link&&(i.setFromNode(e),i.setToNode(r)),i}:this.linkFunction=t,n.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this,e)},r.ext("twaver.canvas.interaction.CreateLinkInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(e){e.beginPath();var t,n;e.lineWidth=this.network.getEditLineWidth();var r=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(t=this.network.getElementUI(this.currentNode).getViewRect(),n=this.convertFromUIToMarkerRect(t,0,0),rs.rect(e,n.x,n.y,n.width,n.height,null,r)),this.fromNode&&(t=this.network.getElementUI(this.fromNode).getViewRect(),n=this.convertFromUIToMarkerRect(t,0,0),rs.rect(e,n.x,n.y,n.width,n.height,null,r)),this.currentPoint&&this.paintLine(e),e.closePath()},paintLine:function(e){var t=this.network.getEditLineColor(),n=this.convertPointFromView(this.fromNode.getCenterLocation()),r=n.x,i=n.y,s=this.currentPoint.x,o=this.currentPoint.y;e.strokeStyle=t,e.beginPath(),e.moveTo(r,i),e.lineTo(s,o),e.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(e){if(!this.network.isValidEvent(e))return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var t=this.createLink();t&&this.network.addElementByInteraction(t)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(e){var t=this.getMarkerPoint(e);if(!t)return;if(this.network.isMovingElement()||this.network.isEditingElement()){this.clear();return}var n=null;this.fromNode?(this.currentNode=this.getToNode(e),this.currentPoint=t,this.repaint()):(n=this.getFromNode(e),this.currentNode!==n&&(this.currentNode=n,this.repaint()))},getFromNode:function(e){return this.getNode(e)},getToNode:function(e){return this.getNode(e)},getNode:function(e){var t=this.network.getElementAt(e);return t instanceof es&&this.network.isLinkable(t)&&this.network.getElementBox().getSelectionModel().isSelectable(t)?t:null}}),n.canvas.interaction.CreateShapeLinkInteraction=function(e,t){n.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,e),t||(t=n.ShapeLink),n.Util.isTypeOf(t,n.ShapeLink)?this.linkFunction=function(e,r,i){var s=new t;return s instanceof n.ShapeLink&&(s.setFromNode(e),s.setToNode(r),i&&s.setPoints(i)),s}:this.linkFunction=t},r.ext("twaver.canvas.interaction.CreateShapeLinkInteraction",n.canvas.interaction.CreateLinkInteraction,{clear:function(){this.points=null,n.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(e){if(e.button!==0)return;var t=this.network.getLogicalPoint(e);if(!t)return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var r=this.createLink();r&&this.network.addElementByInteraction(r),this.clear()}else{this.points||(this.points=new n.List);if(this.points.size()>0){var i=this.points.get(this.points.size()-1);if(i.x===t.x&&i.y===t.y)return}this.points.add(t)}}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()},paintLine:function(e){if(this.currentPoint){var t=new n.List,r;r=this.convertPointFromView(this.fromNode.getCenterLocation()),t.add(r,0);if(this.points&&this.points.size()>0){var i=this.points.size();for(var s=0;s<i;s++)r=this.convertPointFromView(this.points.get(s)),t.add(r)}r=this.currentPoint,t.add(r),e.lineWidth=this.network.getEditLineWidth(),e.strokeStyle=this.network.getEditLineColor(),e.beginPath(),w.drawLinePoints(e,t),e.stroke()}}}),n.canvas.interaction.CreateShapeNodeInteraction=function(e,t){t||(t=n.ShapeNode),n.Util.isTypeOf(t,n.ShapeNode)?this.shapeNodeFunction=function(e){var r=new t;return r instanceof n.ShapeNode&&e&&r.setPoints(e),r}:this.shapeNodeFunction=t,n.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,e),this.timeStamp=-1},r.ext("twaver.canvas.interaction.CreateShapeNodeInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(e){if(this.points&&this.points.size()>0&&this.currentPoint){var t=new n.List,r=this.points.size(),i;for(var s=0;s<r;s++)i=this.convertPointFromView(this.points.get(s)),t.add(i);i=this.convertPointFromView(this.currentPoint),t.add(i),e.lineWidth=this.network.getEditLineWidth(),e.strokeStyle=this.network.getEditLineColor(),e.beginPath(),w.drawLinePoints(e,t),e.stroke()}},handle_mousedown:function(e){if(e.button!==0)return;var t=this.network.getLogicalPoint(e);if(!t)return;if(e.detail===2||e.timeStamp-this.timeStamp<300){if(this.points){var r=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(r),this.clear();var i=this;setTimeout(function(){i.network.setEditingElement(!1)},0)}}else{this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new n.List);if(this.points.size()>0){var s=this.points.get(this.points.size()-1);if(s.x===t.x&&s.y===t.y)return}this.points.add(t)}this.timeStamp=e.timeStamp,this.repaint()},handle_mousemove:function(e){this.points&&(this.currentPoint=this.network.getLogicalPoint(e),this.repaint())}}),n.canvas.interaction.MagnifyInteraction=function(e,t,r,i,s){n.canvas.interaction.MagnifyInteraction.superClass.constructor.call(this,e),this.zoom=t||2,this.xRadius=r||100,this.yRadius=i||100,this.shape=s||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=b.createCanvas()},r.ext("twaver.canvas.interaction.MagnifyInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.network.removeMarker(this)},paint:function(e){if(!this.point)return;var t=this.network._zoom,n=this.zoom*t,r=this.point.x*t-this.network.viewRect.x-this.xRadius,i=this.point.y*t-this.network.viewRect.y-this.yRadius,s=this.xRadius*2,o=this.yRadius*2,u={x:this.point.x-this.xRadius/n,y:this.point.y-this.yRadius/n,width:s/n,height:o/n},a=this.borderWidth,f=b.createCanvas();f.width=s,f.height=o,this.network.toCanvasByRegion(u,n,f),e.save(),e.beginPath(),w.drawVector(e,this.shape,null,r,i,s,o),e.clip(),e.fillStyle=this.backgroundColor,e.beginPath(),e.rect(r,i,s,o),e.fill(),e.drawImage(f,r,i),e.restore(),e.beginPath(),e.lineWidth=a,w.drawVector(e,this.shape,null,r+a/2,i+a/2,s-a,o-a),e.strokeStyle=this.borderColor,e.stroke()},handle_mousemove:function(e){this.point=this.network.getLogicalPoint(e);if(!this.point)return;this.repaint()},getZoom:function(){return this.zoom},setZoom:function(e){this.zoom=e,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(e){this.shape=e,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(e){this.xRadius=e,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(e){this.yRadius=e,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(e){this.borderColor=e,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(e){this.borderWidth=e,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(e){this.backgroundColor=e,this.network.repaintTopCanvas()}}),n.canvas.interaction.TouchInteraction=function(e){n.canvas.interaction.TouchInteraction.superClass.constructor.call(this,e)},r.ext("twaver.canvas.interaction.TouchInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){var e=this.network.getView();b.addEventListener("touchstart","handleTouchstart",e,this),b.addEventListener("touchmove","handleTouchmove",e,this),b.addEventListener("touchend","handleTouchend",e,this),b.addEventListener("touchcancel","handleTouchend",e,this),this.network.addMarker(this)},tearDown:function(){var e=this.network.getView();b.removeEventListener("touchstart",this.network.getView(),this),b.removeEventListener("touchmove",e,this),b.removeEventListener("touchend",e,this),b.removeEventListener("touchcancel",e,this),this.network.removeMarker(this)},handleTouchstart:function(e){b.preventDefault(e);if(e.touches&&e.touches.length==1){var t=this.network.getLogicalPoint(e),n=this.network.getElementAt(t);this._startTouchTime=new Date,this._startTouchPoint=t,this._startTouchClient=this.getMarkerPoint(e),n?(this._haveElementUnderTouch=!0,this._startTouchElement=n):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Or.handleLongClicked(self.network,e,n)},1e3)}else e.touches&&e.touches.length==2&&(this._distance=kr.getDistance(e),this._zoom=this.network.getZoom());this._touchCount=e.touches.length},handleTouchmove:function(e){b.preventDefault(e);if(this._touchCount==2&&e.touches&&e.touches.length==2){this.timer&&clearTimeout(this.timer);if(Math.abs(this._distance-kr.getDistance(e))>=$i.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var t=kr.getDistance(e)/this._distance;this.network.setTouchZoom(this._zoom*t,!1)}else{var n=this.getMarkerPoint(e),r=this._startTouchClient.x-n.x,i=this._startTouchClient.y-n.y;this.network.panByOffset(r,i),this._startTouchClient=n}}else if(this._touchCount==1&&e.touches&&e.touches.length==1)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var s=this.network.getLogicalPoint(e),o=this.network.getElementAt(s);if(this.network.isMovingElement()||this._startTouchElement!=null&&this._startTouchElement==o&&this.network.getMovableSelectedElements().contains(o)){var r=s.x-this._startTouchPoint.x,i=s.y-this._startTouchPoint.y;if(Math.abs(r)>=$i.TOUCH_MOVE_THRESHOLD||Math.abs(i)>=$i.TOUCH_MOVE_THRESHOLD)this._startTouchPoint=s,this.network.moveSelectedElements(r,i),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e}),this.timer&&clearTimeout(this.timer))}else{var r=s.x-this._startTouchPoint.x,i=s.y-this._startTouchPoint.y;(Math.abs(r)>=$i.TOUCH_MOVE_THRESHOLD||Math.abs(i)>=$i.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer);var n=this.getMarkerPoint(e),r=this._startTouchClient.x-n.x,i=this._startTouchClient.y-n.y;this.network.panByOffset(r,i),this._startTouchClient=n}}else{var u=this.network.getLogicalPoint(e);if(!u)return;var r=u.x-this._startTouchPoint.x,i=u.y-this._startTouchPoint.y;Math.abs(r)>=$i.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(i)>=$i.TOUCH_RECT_SELECT_THRESHOLD&&(this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:e}):(this.network.fireInteractionEvent({kind:"selectStart",event:e}),this.timer&&clearTimeout(this.timer)),this._moveTouchPoint=u,this.repaint())}},handleTouchend:function(e){b.preventDefault(e);if(this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e});else if(this.network.isSelectingElement()){var t=m.getRect([this._startTouchPoint,this._moveTouchPoint]),n=this.network.getElementsAtRect(t,this.getIntersectMode(),this.network.getRectSelectFilter());if(n&&n.size()>0){var r=this.network.getSelectionModel(),i=r.toSelection();n.forEach(function(e){r.contains(e)?i.remove(e):i.add(e)},this),r.setSelection(i)}this.network.fireInteractionEvent({kind:"selectEnd",event:e}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}else if(this._startTouchPoint){this._zoomFlag=!1;var s=new Date,o=this.network.getLogicalPoint(e),u=this.network.getElementAt(this._startTouchPoint);o&&s.getTime()-this._startTouchTime.getTime()<=500&&m.getDistance(this._startTouchPoint,o)<=20&&(u?this.network.getSelectionModel().contains(u)||this.network.getSelectionModel().setSelection(u):this.network.getSelectionModel().clearSelection(),Or.handleClicked(this.network,e,u),this.timer&&clearTimeout(this.timer),this._endTouchTime&&s.getTime()-this._endTouchTime.getTime()<=500&&m.getDistance(this._endTouchPoint,o)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Or.handleDoubleClicked(this.network,e,u)):(this._endTouchTime=s,this._endTouchPoint=o))}},paint:function(e){if(!this._startTouchPoint||!this._moveTouchPoint)return;var t=this.convertPointFromView(this._startTouchPoint),n=this.convertPointFromView(this._moveTouchPoint),r=t.x,i=t.y,s=n.x,o=n.y,u=m.getRect([{x:r,y:i},{x:s,y:o}]);if(u!=null){e.beginPath();var a=this.network.getSelectOutlineWidth(),f=this.getIntersectMode()?this.network.getSelectFillColor():null;e.strokeStyle=this.network.getSelectOutlineColor(),e.lineWidth=a,rs.rect(e,u.x,u.y,u.width,u.height,f,this.network.getSelectOutlineColor()),e.closePath()}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),n.canvas.interaction.MSTouchInteraction=function(e){n.canvas.interaction.MSTouchInteraction.superClass.constructor.call(this,e),this._pointerMap={},this._pointerIdArray=[]},r.ext("twaver.canvas.interaction.MSTouchInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){var e=this.network.getView();b.addEventListener("MSPointerDown","handleTouchstart",e,this),b.addEventListener("MSPointerMove","handleTouchmove",e,this),b.addEventListener("MSPointerUp","handleTouchend",e,this),b.addEventListener("MSPointerCancel","handleTouchend",e,this),this.network.addMarker(this)},tearDown:function(){var e=this.network.getView();b.removeEventListener("MSPointerDown",e,this),b.removeEventListener("MSPointerMove",e,this),b.removeEventListener("MSPointerUp",e,this),b.removeEventListener("MSPointerCancel",e,this),this.network.removeMarker(this)},handleTouchstart:function(e){this.network.isFocusOnClick()&&n.Util.setFocus(this.network._view);if(this.network.isSelectingElement()&&e.pointerType==e.MSPOINTER_TYPE_MOUSE)return;var t=this.network.getLogicalPoint(e),i=new Date;e.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(e),this._pointerMap[e.pointerId]||(this._pointerIdArray.push(e.pointerId),this._pointerMap[e.pointerId]=e);if(this._pointerIdArray.length==1){var s=this.network.getElementAt(t);this._startTouchElement=s,this._startClientPoint={x:e.clientX,y:e.clientY},Or.handleClicked(this.network,e,s),this._startTouchTime&&this._startTouchPoint&&i.getTime()-this._startTouchTime.getTime()<=500&&m.getDistance(this._startTouchPoint,t)<=20?(Or.handleDoubleClicked(this.network,e,s),this._doubleClick=!0):(b.handle_mousedown(this,e),this._startTouchPoint=t,this._startTouchTime=i);var o=this.network.getSelectionModel();s?r.isCtrlDown(e)?o.contains(s)?o.removeSelection(s):o.appendSelection(s):o.contains(s)||o.setSelection(s):r.isCtrlDown(e)||o.clearSelection()}else this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(e){if(this._startTouchPoint==null||this._pointerIdArray.length==0||!this._pointerMap[e.pointerId]||m.getDistance({x:this._pointerMap[e.pointerId].pageX,y:this._pointerMap[e.pointerId].pageY},{x:e.pageX,y:e.pageY})<=10)return;this._pointerMap[e.pointerId]=e;if(this._pointerIdArray.length==2){var t=this._getDistance()/this._distance;this.network.setZoom(this._zoom*t,!1)}},handleTouchend:function(e){this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e}));if(this.network.isSelectingElement()){var t=m.getRect([this._startTouchPoint,this._moveTouchPoint]),n=this.network.getElementsAtRect(t,this.getIntersectMode(),this.network.getRectSelectFilter());if(n&&n.size()>0){var r=this.network.getSelectionModel(),i=r.toSelection();n.forEach(function(e){r.contains(e)?i.remove(e):i.add(e)},this),r.setSelection(i)}this.network.fireInteractionEvent({kind:"selectEnd",event:e}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);var s=-1;for(var o=0;o<this._pointerIdArray.length;o++)if(this._pointerIdArray[o]==e.pointerId){s=o;break}s>=0&&this._pointerIdArray.splice(s,1),delete this._pointerMap[e.pointerId],this._startTouchPoint=null,this._moveTouchPoint=null},_getDistance:function(){return m.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(e){var t={x:e.clientX,y:e.clientY};if(m.getDistance(this._startClientPoint,t)<3)return;if(this._startTouchPoint&&this._pointerIdArray.length==1){this._moveTouchPoint={x:this._startTouchPoint.x+(t.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(t.y-this._startClientPoint.y)/this.network.getZoom()};if(this._startTouchElement==null&&this.network.isRectSelectEnabled()){var n=this.network.getLogicalPoint(e);if(!n)return;this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:e}):this.network.fireInteractionEvent({kind:"selectStart",event:e}),this.repaint()}else{var r=this.network.getElementAt(this._moveTouchPoint);if(this._startTouchElement==null&&!this.network.isRectSelectEnabled()){var i=this._startClientPoint.x-t.x,s=this._startClientPoint.y-t.y;this.network.panByOffset(i,s)}else if(this.network.isMovingElement()||this._startTouchElement!=null&&r==this._startTouchElement&&this.network.getMovableSelectedElements().contains(r)){var i=this._moveTouchPoint.x-this._startTouchPoint.x,s=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(i,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e}))}this._startClientPoint=t}}},handle_mouseup:function(e){this.handleTouchend(e),this._pointerIdArray=[],this._pointerMap={}},paint:function(e){if(!this._startTouchPoint||!this._moveTouchPoint||this._startTouchElement||!this.network.isRectSelectEnabled())return;var t=this.convertPointFromView(this._startTouchPoint),n=this.convertPointFromView(this._moveTouchPoint),r=t.x,i=t.y,s=n.x,o=n.y,u=m.getRect([{x:r,y:i},{x:s,y:o}]);if(u!=null){e.beginPath();var a=this.network.getSelectOutlineWidth(),f=this.getIntersectMode()?this.network.getSelectFillColor():null;e.strokeStyle=this.network.getSelectOutlineColor(),e.lineWidth=a,rs.rect(e,u.x,u.y,u.width,u.height,f,this.network.getSelectOutlineColor()),e.closePath()}}}),n.canvas.interaction.MoveLinkInteraction=function(e,t){n.canvas.interaction.MoveLinkInteraction.superClass.constructor.call(this,e),this.xoffset=0,this.yoffset=0},r.ext("twaver.canvas.interaction.MoveLinkInteraction",n.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this.oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown"),this.network.getView().style.cursor=this.oldCursor,this.end()},handle_mousedown:function(e){if(e.button!==0)return;if(this.network.isSelectingElement()||this.network.isEditingElement())return;var t=this.network.getElementAt(e);if(!(t instanceof n.Link))return;this.element=t,this.end(e),this._handle_mousedown(e)},handle_mouseup:function(e){this.end(e)},handle_mousemove:function(e){if(!this._startLogical||this.network.isSelectingElement()||this.network.isEditingElement()){this.end(e);return}
this._handle_mousemove(e),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y;if(this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:e,element:this.element});else{this.mark=b.createCanvas();var t;this.network.getMovableSelectedElements().forEach(function(e){var n=this.getElementUI(e);n&&(t=m.unionRect(t,n.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),b.setDiv(this.mark,t,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:e,element:this.element})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else{var r=new n.List([this.element.getFromNode(),this.element.getToNode()]);n.Util.moveElements(r,this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=b.getClientPoint(e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e,element:this.element}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e,element:this.element}))}},end:function(e){if(this._startLogical){if(this.lazyMode){if(this.mark){var t=this,r=function(){t.network.fireInteractionEvent({kind:"lazyMoveEnd",event:e,element:this.element}),t.mark&&(t.network.getTopDiv().removeChild(t.mark),t.mark=null,t.network.setMovingElement(!1))},i=new n.List([this.element.getFromNode(),this.element.getToNode()]);n.Util.moveElements(i,this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),r)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e,element:this.element}));this._handle_mouseup(e),delete this.element}}});var is=function(e,t){r.registerImage(e,t),ss[e]=1},ss={};is("node_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,23.5c0,0.276-0.224,0.5-0.5,0.5h-31C0.224,24,0,23.776,0,23.5v-2C0,21.224,0.224,21,0.5,21h31  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"15.9995",y1:"21",x2:"15.9995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,22.3c0-0.165-0.134-0.3-0.3-0.3H3.3C3.134,22,3,22.135,3,22.3V24h12V22.3z",gradient:{id:"SVGID_2_",type:"linear",x1:"9",y1:"22",x2:"9",y2:"25",stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"}]}},{shape:"path",data:"M31,20H1V1c0-0.553,0.448-1,1-1h28c0.553,0,1,0.447,1,1V20z",gradient:{id:"SVGID_3_",type:"linear",x1:"15.9995",y1:"-0.1221",x2:"15.9995",y2:"19.9471",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:1,w:28,h:18,fill:"#FFFFFF"},{shape:"rect",x:3,y:2,w:26,h:16,gradient:{id:"SVGID_4_",type:"linear",x1:"15.9995",y1:"2.0654",x2:"15.9995",y2:"17.3835",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"9.649,17.034 6.815,17.034 9.935,2.966 12.768,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"12.065,17.034 10.815,17.034 13.935,2.966 15.185,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"14.065,17.034 13.315,17.034 16.435,2.966 17.185,2.966 z",fill:"#FFFFFF"}]}),is("group_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,16.5c0,0.276-0.224,0.5-0.5,0.5h-24C7.224,17,7,16.776,7,16.5v-1C7,15.224,7.224,15,7.5,15h24   c0.276,0,0.5,0.224,0.5,0.5V16.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"19.5",y1:"15",x2:"19.5",y2:"17",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M19,16.5c0-0.277-0.224-0.5-0.5-0.5h-8c-0.276,0-0.5,0.223-0.5,0.5V17h9V16.5z",gradient:{id:"SVGID_2_",type:"linear",x1:"14.4995",y1:"15.9209",x2:"14.4995",y2:"17.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,14H8V1c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V14z",gradient:{id:"SVGID_3_",type:"linear",x1:"19.5",y1:"0",x2:"19.5",y2:"14.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:1,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:10,y:2,w:19,h:10,gradient:{id:"SVGID_4_",type:"linear",x1:"19.5",y1:"1.9619",x2:"19.5",y2:"11.9744",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M25,23.5c0,0.276-0.224,0.5-0.5,0.5h-24C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h24   c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:"12.4995",y1:"22",x2:"12.4995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,23.5c0-0.277-0.224-0.5-0.5-0.5h-8C3.224,23,3,23.223,3,23.5V24h9V23.5z",gradient:{id:"SVGID_6_",type:"linear",x1:"7.5",y1:"22.9209",x2:"7.5",y2:"24.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M24,21H1V8c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V21z",gradient:{id:"SVGID_7_",type:"linear",x1:"12.4995",y1:"7",x2:"12.4995",y2:"21.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:8,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:3,y:9,w:19,h:10,gradient:{id:"SVGID_8_",type:"linear",x1:"12.4995",y1:"8.9619",x2:"12.4995",y2:"18.9749",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}}]}),is("subnetwork_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,14.499c0,0.276-0.224,0.5-0.5,0.5h-20c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h20c0.276,0,0.5,0.224,0.5,0.5V14.499z",gradient:{id:"SVGID_1_",type:"linear",x1:21.5,y1:12.999,x2:21.5,y2:14.9995,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M22,14.499c0-0.277-0.224-0.5-0.5-0.5h-7c-0.276,0-0.5,0.223-0.5,0.5v0.5h8V14.499z",gradient:{id:"SVGID_2_",type:"linear",x1:18,y1:13.9199,x2:18,y2:15.0449,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,11.499c0,0.276-0.224,0.5-0.5,0.5h-18c-0.276,0-0.5-0.224-0.5-0.5v-11c0-0.276,0.224-0.5,0.5-0.5  h18c0.276,0,0.5,0.224,0.5,0.5V11.499z",gradient:{id:"SVGID_3_",type:"linear",x1:21.5,y1:-0.9502,x2:21.5,y2:12.5498,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:13,y:.999,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:14,y:1.999,w:15,h:8,gradient:{id:"SVGID_4_",type:"linear",x1:21.5,y1:1.9312,x2:21.5,y2:9.6537,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M21,23.5c0,0.276-0.224,0.5-0.5,0.5h-20C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h20  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:10.4995,y1:22,x2:10.4995,y2:24,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:22,y:20.5,w:3,h:1.999,gradient:{id:"SVGID_6_",type:"linear",x1:-464.9424,y1:-722.2754,x2:-462.9424,y2:-722.2754,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:28,y:16,w:2,h:3,gradient:{id:"SVGID_7_",type:"linear",x1:29,y1:16,x2:29,y2:19,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M11,23.5c0-0.277-0.224-0.5-0.5-0.5h-7C3.224,23,3,23.223,3,23.5V24h8V23.5z",gradient:{id:"SVGID_8_",type:"linear",x1:7,y1:22.9209,x2:7,y2:24.0459,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M20,20.5c0,0.276-0.224,0.5-0.5,0.5h-18C1.224,21,1,20.776,1,20.5v-11C1,9.224,1.224,9,1.5,9h18  C19.776,9,20,9.224,20,9.5V20.5z",gradient:{id:"SVGID_9_",type:"linear",x1:10.4995,y1:8.0508,x2:10.4995,y2:21.5513,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:10,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:3,y:11,w:15,h:8,gradient:{id:"SVGID_10_",type:"linear",x1:10.4995,y1:10.9321,x2:10.4995,y2:18.6551,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"M32,22.7c0,0.165-0.135,0.3-0.301,0.3h-5.4C26.134,23,26,22.865,26,22.7v-2.4  c0-0.165,0.134-0.3,0.299-0.3h5.4C31.865,20,32,20.135,32,20.3V22.7z",gradient:{id:"SVGID_11_",type:"linear",x1:29,y1:20,x2:29,y2:23,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),is("bus_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:4,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M7,4c0,0.552-0.448,1-1,1H3C2.448,5,2,4.552,2,4V3c0-0.552,0.448-1,1-1h3c0.552,0,1,0.448,1,1V4z",gradient:{id:"SVGID_1_",type:"linear",x1:4.5,y1:2,x2:4.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M6,5.5C6,5.776,5.776,6,5.5,6h-2C3.224,6,3,5.776,3,5.5l0,0C3,5.224,3.224,5,3.5,5h2  C5.776,5,6,5.224,6,5.5L6,5.5z",gradient:{id:"SVGID_2_",type:"linear",x1:4.5,y1:6,x2:4.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:12,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M15,4c0,0.552-0.447,1-1,1h-3c-0.553,0-1-0.448-1-1V3c0-0.552,0.447-1,1-1h3c0.553,0,1,0.448,1,1V4z",gradient:{id:"SVGID_3_",type:"linear",x1:12.5,y1:2,x2:12.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M14,5.5C14,5.776,13.777,6,13.5,6h-2C11.225,6,11,5.776,11,5.5l0,0C11,5.224,11.225,5,11.5,5h2  C13.777,5,14,5.224,14,5.5L14,5.5z",gradient:{id:"SVGID_4_",type:"linear",x1:12.5,y1:6,x2:12.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:10,w:1,h:1,fill:"#232424"},{shape:"path",data:"M6,13c0-0.553,0.448-1,1-1h3c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V13z",gradient:{id:"SVGID_5_",type:"linear",x1:-1428.3853,y1:-571.5747,x2:-1428.3853,y2:-568.5747,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#232424"},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M7,11.5C7,11.223,7.224,11,7.5,11h2c0.277,0,0.5,0.223,0.5,0.5l0,0c0,0.275-0.223,0.5-0.5,0.5h-2  C7.224,12,7,11.775,7,11.5L7,11.5z",gradient:{id:"SVGID_6_",type:"linear",x1:-1428.3862,y1:-567.5737,x2:-1428.3862,y2:-568.5737,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,7.5C15,7.776,14.777,8,14.5,8h-12C2.224,8,2,7.776,2,7.5l0,0C2,7.224,2.224,7,2.5,7h12  C14.777,7,15,7.224,15,7.5L15,7.5z",gradient:{id:"SVGID_7_",type:"linear",x1:8.4995,y1:6.1152,x2:8.4995,y2:7.5558,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,9.5c0,0.275-0.223,0.5-0.5,0.5h-12C2.224,10,2,9.775,2,9.5l0,0C2,9.223,2.224,9,2.5,9h12  C14.777,9,15,9.223,15,9.5L15,9.5z",gradient:{id:"SVGID_8_",type:"linear",x1:8.4995,y1:8.1147,x2:8.4995,y2:9.556,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),is("data_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,12c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12   z",gradient:{id:"SVGID_1_",type:"linear",x1:10.5,y1:6.959,x2:10.5,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:8,y:9,w:5,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:10.5,y1:8.6997,x2:10.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,14.5c0,0.275-0.225,0.5-0.5,0.5h-8C6.224,15,6,14.775,6,14.5l0,0C6,14.223,6.224,14,6.5,14h8   C14.775,14,15,14.223,15,14.5L15,14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:10.5,y1:13.125,x2:10.5,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:14,w:1,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:14.0049,x2:8.4995,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,4H6c0,0-0.152-0.275-0.5-1C5.021,2,5.021,2,4,2C3.057,2,2,2,2,2C1.448,2,1,2.448,1,3v8  c0,0.553,0.448,1,1,1h3v-1H2V3h2.387l1.024,1.998L12,5v1h1V5C13,4.448,12.553,4,12,4z",gradient:{id:"SVGID_5_",type:"linear",x1:6.9995,y1:2.0527,x2:6.9995,y2:11.4757,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,5L5.411,4.998L4.387,3H2v8h3v-0.645V7.254V7c0-0.552,0.448-1,1-1h0.324h3.032H12V5z",gradient:{id:"SVGID_6_",type:"linear",x1:6.9995,y1:2.9902,x2:6.9995,y2:11.0032,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),is("grid_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,14c0,0.553-0.447,1-1,1H3c-0.552,0-1-0.447-1-1V3c0-0.552,0.448-1,1-1h11c0.553,0,1,0.448,1,1V14  z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:2.1255,x2:8.4995,y2:14.909,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:11,h:11,fill:"#FFFFFF"},{shape:"rect",x:3,y:5,w:11,h:1,gradient:{id:"SVGID_2_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:8,w:11,h:1,gradient:{id:"SVGID_3_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:11,w:11,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:3.2095,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:11,y:3,w:1,h:11,gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:3.209,x2:11.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:3,w:1,h:11,gradient:{id:"SVGID_6_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:5,y:3,w:1,h:11,gradient:{id:"SVGID_7_",type:"linear",x1:5.5,y1:3.209,x2:5.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),is("databox_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,6h-12H2v0.5v7C2,13.776,2.224,14,2.5,14h12c0.276,0,0.5-0.224,0.5-0.5v-7V6H14.5z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:6.0625,x2:8.4995,y2:14.063,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M14.776,5.553l-1.553-3.105C13.101,2.201,12.775,2,12.5,2h-8C4.225,2,3.899,2.201,3.776,2.447  L2.224,5.553L2,6h0.5h12H15L14.776,5.553z",gradient:{id:"SVGID_2_",type:"linear",x1:8.5005,y1:3.104,x2:8.5005,y2:-5.6467,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"12,2 9.5,2 7.5,2 5,2 3,6 7.5,6 9.5,6 14,6 z",gradient:{id:"SVGID_3_",type:"linear",x1:8.5005,y1:9.2295,x2:8.5005,y2:5.4586,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M11.5,9c0,0.276-0.224,0.5-0.5,0.5H6C5.724,9.5,5.5,9.276,5.5,9l0,0c0-0.276,0.224-0.5,0.5-0.5h5  C11.276,8.5,11.5,8.724,11.5,9L11.5,9z",fill:"#FFFFFF"}]}),is("group_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,8.5C15,8.776,14.776,9,14.5,9h-10C4.224,9,4,8.776,4,8.5v-7C4,1.224,4.224,1,4.5,1h10    C14.776,1,15,1.224,15,1.5V8.5z",gradient:{id:"SVGID_1_",type:"linear",x1:9.5,y1:.9512,x2:9.5,y2:8.9787,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:5,y:2,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:6,y:3,w:7,h:4,gradient:{id:"SVGID_2_",type:"linear",x1:9.5,y1:3.02,x2:9.5,y2:6.9606,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,10.5c0,0.276-0.224,0.5-0.5,0.5h-12C3.224,11,3,10.776,3,10.5l0,0C3,10.224,3.224,10,3.5,10h12    C15.776,10,16,10.224,16,10.5L16,10.5z",gradient:{id:"SVGID_3_",type:"linear",x1:9.5,y1:9.9941,x2:9.5,y2:10.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:6,y:10.001,w:2,h:.999,gradient:{id:"SVGID_4_",type:"linear",x1:7,y1:10.0059,x2:7,y2:10.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,12.5c0,0.276-0.224,0.5-0.5,0.5h-10C1.224,13,1,12.776,1,12.5v-7C1,5.224,1.224,5,1.5,5h10    C11.776,5,12,5.224,12,5.5V12.5z",gradient:{id:"SVGID_5_",type:"linear",x1:6.4995,y1:4.9512,x2:6.4995,y2:12.9792,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:6,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:3,y:7,w:7,h:4,gradient:{id:"SVGID_6_",type:"linear",x1:6.4995,y1:7.02,x2:6.4995,y2:10.9611,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M13,14.5c0,0.276-0.224,0.5-0.5,0.5h-12C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h12    C12.776,14,13,14.224,13,14.5L13,14.5z",gradient:{id:"SVGID_7_",type:"linear",x1:6.4995,y1:13.9941,x2:6.4995,y2:14.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:14.001,w:2,h:.999,gradient:{id:"SVGID_8_",type:"linear",x1:4,y1:14.0059,x2:4,y2:14.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),is("link_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:2.5,y:2.5},p2:{x:13.5,y:13.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:11.5371,y1:11.5371,x2:14.2155,y2:14.2155,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:3,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:1.4956,y1:1.4956,x2:4.1473,y2:4.1473,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:3,cy:3,rx:1,ry:1,fill:"#FFFFFF"}]}),is("linksubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,7.661c0-1.202-0.642-2.247-1.596-2.835C12.848,3.188,11.314,2,9.486,2  c-1.587,0-2.95,0.902-3.649,2.211C4.573,4.22,3.548,5.194,3.438,6.432C3.389,6.429,3.342,6.417,3.292,6.417  C2.026,6.417,1,7.443,1,8.708C1,9.975,2.026,11,3.292,11h8.371l0,0C13.506,11,15,9.506,15,7.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.959,x2:7.9995,y2:11.0921,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,10C2.58,10,2,9.42,2,8.708c0-0.712,0.58-1.292,1.292-1.292C3.286,7.422,3.332,7.427,3.379,7.43  l0.969,0.058L4.435,6.52C4.5,5.779,5.106,5.216,5.844,5.211l0.595-0.004l0.28-0.524C7.273,3.645,8.334,3,9.486,3  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,6.11,14,6.851,14,7.661C14,8.951,12.951,10,11.661,10H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.292,10h8.37c1.11,0,2.04-0.781,2.276-1.821c-0.131-0.615-0.5-1.158-1.058-1.501l-0.307-0.189  l-0.116-0.341C12.021,4.863,10.828,4,9.486,4C8.334,4,7.273,4.645,6.719,5.682l-0.28,0.524L5.844,6.211  C5.106,6.216,4.5,6.779,4.435,7.52L4.349,8.487L3.379,8.43C3.332,8.427,3.286,8.422,3.292,8.417c-0.535,0-0.994,0.328-1.19,0.792  C2.297,9.672,2.757,10,3.292,10z",gradient:{id:"SVGID_2_",type:"linear",x1:8.019,y1:4.084,x2:8.019,y2:9.8062,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"line",p1:{x:8.01,y:8.01},p2:{x:13.186,y:13.186},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:8,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:6.7881,y1:6.7881,x2:9.9924,y2:9.9924,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:8,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:11.5791,y1:11.5791,x2:14.3132,y2:14.3132,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),is("node_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,11.5c0,0.276-0.224,0.5-0.5,0.5h-13C1.224,12,1,11.776,1,11.5v-9C1,2.224,1.224,2,1.5,2h13  C14.776,2,15,2.224,15,2.5V11.5z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.939,x2:7.9995,y2:11.9739,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:3,w:12,h:8,fill:"#FFFFFF"},{shape:"rect",x:3,y:4,w:10,h:6,gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:4.0513,x2:7.9995,y2:9.865,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.5c0,0.276-0.224,0.5-0.5,0.5h-15C0.224,15,0,14.776,0,14.5v-1C0,13.224,0.224,13,0.5,13h15  c0.276,0,0.5,0.224,0.5,0.5V14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:7.9995,y1:13.0508,x2:7.9995,y2:14.9258,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M9,14.5C9,14.224,8.776,14,8.5,14h-5C3.224,14,3,14.224,3,14.5V15h6V14.5z",gradient:{id:"SVGID_4_",type:"linear",x1:5.9995,y1:14.0508,x2:5.9995,y2:15.9258,stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"},{offset:"0.4637",color:"#449981"},{offset:"0.7764",color:"#2C8E73"},{offset:"1",color:"#218A6E"}]}}]}),is("shapelink_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:7.5,y:2.5},p2:{x:2.5,y:7.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"line",p1:{x:2.5,y:7.5},p2:{x:8.5,y:13.5},lineColor:"url(#SVGID_2_)",lineWidth:1},{shape:"line",p1:{x:9,y:13.186},p2:{x:13.5,y:6.5},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:7,cy:3,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:5.5864,y1:1.5864,x2:8.4149,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:7,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5864,y1:6.5864,x2:3.4142,y2:9.4142,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:8,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:6.5869,y1:11.5869,x2:9.4147,y2:14.4147,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:8,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:7,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:11.5859,y1:5.5859,x2:14.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:7,rx:1,ry:1,fill:"#FFFFFF"}]}),is("shapenode_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,3h-9l-4,4v7h13L9,8.5L14.5,3z M12.086,13H2.5V7.414L5.914,4h6.172l-4.5,4.5L12.086,13z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:3.209,x2:7.9995,y2:13.6621,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:6,cy:3,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:4.5859,y1:1.5859,x2:7.4151,y2:4.4151,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:6,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:11.5869,y1:1.5864,x2:14.4153,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:9,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:7.5864,y1:6.5864,x2:10.4149,y2:9.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:9,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:7,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5859,y1:5.5859,x2:3.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:7,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12.825,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:11.4111,y1:11.5869,x2:14.2396,y2:14.4153,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:12.825,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),is("shapesubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,6.661c0-1.202-0.642-2.247-1.596-2.835C12.848,2.188,11.314,1,9.486,1  c-1.587,0-2.95,0.902-3.649,2.211C4.573,3.22,3.548,4.194,3.438,5.432C3.389,5.429,3.342,5.417,3.292,5.417  C2.026,5.417,1,6.443,1,7.708S2.026,10,3.292,10h8.371l0,0C13.506,10,15,8.505,15,6.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.3755,x2:7.9995,y2:9.733,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,9C2.58,9,2,8.42,2,7.708s0.58-1.292,1.292-1.292C3.286,6.422,3.332,6.427,3.379,6.43l0.969,0.058  L4.435,5.52C4.5,4.779,5.106,4.216,5.844,4.211l0.595-0.004l0.28-0.524C7.273,2.645,8.334,2,9.486,2  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,5.11,14,5.851,14,6.661C14,7.951,12.951,9,11.661,9H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.272,9h8.37c1.11,0,2.039-0.689,2.275-1.729c-0.131-0.615-0.499-1.249-1.057-1.593l-0.307-0.189  l-0.116-0.341C12.002,3.863,10.809,3,9.468,3C8.314,3,7.254,3.645,6.7,4.682L6.42,5.207L5.825,5.211  C5.087,5.216,4.481,5.779,4.416,6.52L4.33,7.487L3.36,7.43C3.313,7.427,3.267,7.422,3.272,7.417c-0.535,0-0.994,0.327-1.19,0.792  C2.278,8.672,2.738,9,3.272,9z",gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:3.459,x2:7.9995,y2:8.4597,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M11.516,7.102h-8l2.469,6h8.5L11.516,7.102z M5.024,8.123h5.905l1.938,3.979H6.662L5.024,8.123z",gradient:{id:"SVGID_3_",type:"linear",x1:7.4443,y1:7.1724,x2:10.1111,y2:12.8383,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"5,8.112 10.904,8.112 12.842,12.092 6.638,12.092 z",fill:"#FFFFFF"},{shape:"ellipse",cx:5,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:3,y1:8,x2:7,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:5,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:10,y1:8,x2:14,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:12,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:7,cy:12,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:5,y1:12,x2:9,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:7,cy:12,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:14,cy:12,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:12,y1:12,x2:16,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:14,cy:12,rx:1,ry:1,fill:"#FFFFFF"}]}),is("subnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:10,y:14.001,w:2,h:1,gradient:{id:"SVGID_1_",type:"linear",x1:11,y1:14.0059,x2:11,y2:14.9481,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:14,y:10.001,w:1,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:14.5,y1:10.0117,x2:14.5,y2:11.8962,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,6.001c0,0.552-0.447,1-1,1H8c-0.552,0-1-0.448-1-1v-4c0-0.552,0.448-1,1-1h7   c0.553,0,1,0.448,1,1V6.001z",gradient:{id:"SVGID_3_",type:"linear",x1:11.5,y1:.96,x2:11.5,y2:6.2265,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:2.001,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:9,y:3.001,w:5,h:2,gradient:{id:"SVGID_4_",type:"linear",x1:11.5,y1:2.7007,x2:11.5,y2:5.0337,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,8.501c0,0.276-0.225,0.5-0.5,0.5h-8c-0.276,0-0.5-0.224-0.5-0.5l0,0c0-0.276,0.224-0.5,0.5-0.5   h8C15.775,8.001,16,8.225,16,8.501L16,8.501z",gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:7.126,x2:11.5,y2:8.5535,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:8.001,w:1,h:.999,gradient:{id:"SVGID_6_",type:"linear",x1:9.5,y1:8.0063,x2:9.5,y2:8.9477,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M9,12c0,0.553-0.447,1-1,1H1c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12z   ",gradient:{id:"SVGID_7_",type:"linear",x1:4.4995,y1:6.959,x2:4.4995,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:1,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:2,y:9,w:5,h:2,gradient:{id:"SVGID_8_",type:"linear",x1:4.5,y1:8.6997,x2:4.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M9,14.5C9,14.776,8.775,15,8.5,15h-8C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h8   C8.775,14,9,14.224,9,14.5L9,14.5z",gradient:{id:"SVGID_9_",type:"linear",x1:4.4995,y1:13.125,x2:4.4995,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:14,w:1,h:1,gradient:{id:"SVGID_10_",type:"linear",x1:2.5,y1:14.0049,x2:2.5,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.501c0,0.276-0.224,0.5-0.5,0.5h-2c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h2c0.276,0,0.5,0.224,0.5,0.5V14.501z",gradient:{id:"SVGID_11_",type:"linear",x1:14.5,y1:13.0117,x2:14.5,y2:14.8962,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]});var rs={_hitCanvas:null,getHitCanvas:function(e,t){this._hitCanvas==null&&(this._hitCanvas=b.createCanvas()),arguments.length==0&&(e=2,t=2),this._hitCanvas.setAttribute("width",""+e-1),this._hitCanvas.setAttribute("height",""+t-1),this._hitCanvas.setAttribute("width",""+e),this._hitCanvas.setAttribute("height",""+t);var n=this.getCtx(this._hitCanvas);return n.clearRect(0,0,e,t),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(e){return e.getContext("2d")},render:function(e,n,r){n!=t&&(e.fillStyle=n,e.fill()),r!=t&&(e.strokeStyle=r,e.stroke())},text:function(e,t,n,r,i,s){e.textAlign="center",e.textBaseline="middle",i!=null&&(e.fillStyle=i,e.fillText(t,n,r)),s&&(e.strokeStyle=s,e.strokeText(t,n,r))},circle:function(e,t,n,r,i,s){e.arc(t,n,r,0,2*Math.PI,!0),e.closePath(),this.render(e,i,s)},rect:function(e,t,n,r,i,s,o){e.rect(t,n,r,i),e.closePath(),this.render(e,s,o)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(e,t,n,r,i,s){var o=0;return i<=0?o|=this.OUT_LEFT|this.OUT_RIGHT:e<n?o|=this.OUT_LEFT:e>n+i&&(o|=this.OUT_RIGHT),s<=0?o|=this.OUT_TOP|this.OUT_BOTTOM:t<r?o|=this.OUT_TOP:t>r+s&&(o|=this.OUT_BOTTOM),o},intersectsLine:function(e,t,n,r,i,s,o,u){var a,f;if((f=this.outcode(n,r,i,s,o,u))==0)return!0;while((a=this.outcode(e,t,i,s,o,u))!=0){if((a&f)!=0)return!1;if((a&(this.OUT_LEFT|this.OUT_RIGHT))!=0){var l=i;(a&this.OUT_RIGHT)!=0&&(l+=o),t+=(l-e)*(r-t)/(n-e),e=l}else{var c=s;(a&this.OUT_BOTTOM)!=0&&(c+=u),e+=(c-t)*(n-e)/(r-t),t=c}}return!0}};n.vector={},n.vector.interaction={},n.vector.Network=function(e){n.vector.Network.superClass.constructor.apply(this,arguments),this.zoomManager=new n.vector.PhysicalZoomManager(this),this._view=b.createView("hidden"),this._rootCanvas=b.createCanvas(),this._topCanvas=b.createCanvas(),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._zoomMap={},this._viewRectMap={},this.viewRect={x:0,y:0,width:0,height:0},this.state={zooming:!1,panning:!1,autoLayout:!1},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new n.List,this._topAttachmentList=new n.List,this._hitTestTopAttachmentList=new n.List,this.setElementBox(e?e:new n.ElementBox),h.isTouchable?h.isMSTouchable?this.setDefaultInteractions(!1,!1):this.setTouchInteractions():this.setDefaultInteractions(!1,!1);var t=this;this._flowLink=function(){if(t.isMovingElement()||t.isSelectingElement()||t.isEditingElement()||t._box._layoutMovingElements)return;t._flowLinkQuickFinder||(t._flowLinkQuickFinder=new n.QuickFinder(t._box,"link.flow","style"));var e=t._flowLinkQuickFinder.find(!0);e.forEach(function(e){e._styleMap["link.flow.offset"]=t.getLinkFlowOffset(e),t.invalidateElementUI(e)})},this.setToolTipEnabled(n.Defaults.NETWORK_TOOLTIP_ENABLED),this._paintAll=!0,this._dirtyRects=new Oi,this._invalidateMap={},this._invalidateAll=!0,t._count=0,t._invalidate=!0,function r(e){t._loopId=requestAnimationFrame(r),t._invalidate&&(t._count++,t._now=e,t.validate())}(0),n.imageUtil.addEventListener(this.invalidateElementUIs,this),b.addEventListener("mousemove","handle_mousemove",this._view,this)},r.ext("twaver.vector.Network",n.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand"
,"scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","edgeDetect","dragToPan","wheelToZoom","asyncZoomAndViewRect","debug","zoomDivVisible","showShadowInEdit","showAttachOnChg"],_currentSubNetwork:null,_subNetworkAnimate:n.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!1,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:n.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:n.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:n.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:$i.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:n.Defaults.VECTORUI_FUNCTION,_doubleClickToUpSubNetwork:n.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:n.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:n.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:n.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:n.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:n.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:n.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:n.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:n.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:n.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:n.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:n.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:n.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:n.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:n.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:n.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:n.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:n.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:n.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:n.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:n.Defaults.NETWORK_RESIZE_ANIMATE,_rotatePointSize:n.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:n.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:n.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:n.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:n.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:$i.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:$i.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:$i.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:$i.NETWORK_ROTATE_SCALE_FONT_COLOR,_editPointSize:n.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:n.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:n.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:n.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:n.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:n.Defaults.NETWORK_EDIT_LINE_WIDTH,_limitElementInPositiveLocation:!1,_linkFlowInterval:$i.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:$i.NETWORK_SELECTION_TOLERANCE,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:n.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_edgeDetect:!1,_dragToPan:!0,_wheelToZoom:!0,_asyncZoomAndViewRect:!1,_debug:!1,_zoomDivVisible:!0,_showShadowInEdit:!1,_showAttachOnChg:!0,adjustBounds:function(e){var t=!1,r=this._view.style;r.left==e.x+"px"&&r.top==e.y+"px"&&r.width==e.width+"px"&&r.height==e.height+"px"&&(t=!0),n.vector.Network.superClass.adjustBounds.apply(this,arguments);if(t==1)return;var i=this._view.offsetWidth,s=this._view.offsetHeight;this._rootCanvas.setAttribute("width",i),this._rootCanvas.setAttribute("height",s),this._topCanvas.setAttribute("width",i),this._topCanvas.setAttribute("height",s),this.setViewRect(this.viewRect.x,this.viewRect.y,i,s),typeof n.gis=="undefined"&&(n.Util.makeHighRes(this._rootCanvas),n.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()},getLabel:function(e){return e.getStyle("network.label")||e.getName()},getLabel2:function(e){return e.getStyle("network.label")||e.getName2()},setZoomManager:function(e){var t=this.zoomManager;if(t==e)return;this.zoomManager=e,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.invalidateElementUIs(),this.firePropertyChange("zoomManager",t,e)},getZoomManager:function(){return this.zoomManager},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){lr.twm(this);var e=this.getElementBox().getDatas()._as,t=e.length,n={},i,s,o,u,a=this._visibleFunction,f=this._box._layerBox.size()===1?this._box._layerBox._defaultLayer:null;for(i=0;i<t;i++)o=e[i],n[o._id]=this.isVisible(o,a,f);var l=this.getGraphicsZoom(),c=null,h={x:this.viewRect.x/l,y:this.viewRect.y/l,width:this.viewRect.width/l,height:this.viewRect.height/l};if(this._invalidateAll){if(this._visibleMap)for(i=0;i<t;i++)o=e[i],n[o._id]!==this._visibleMap[o._id]&&(u=this._elementUIMap[o._id],u&&u.invalidate());for(i=0;i<t;i++)o=e[i],u=this._elementUIMap[o._id],u&&u.validate();this._paintAll=!0}else if(this._paintAll){for(s in this._invalidateMap)u=this._elementUIMap[s],u&&u.invalidate();for(s in this._invalidateMap)u=this._elementUIMap[s],u&&u.validate()}else{for(s in this._invalidateMap)u=this._elementUIMap[s],u&&(this._dirtyRects.add(u.getZoomViewRect(!1)),u.invalidate());for(s in this._invalidateMap)u=this._elementUIMap[s],u&&(u.validate(),this._dirtyRects.add(u.getZoomViewRect(!0)))}this._paintAll?c=h:(this._dirtyRects.forEach(function(e){c==null?c=r.cloneRect(e):c=m.unionRect(c,e)}),c?(m.grow(c,2,2),c=m.intersection(c,h)):c=h),this._visibleMap=n,c&&this.paintRoot(c),this.validateCanvasSize(),this._repaintTopFlag==1&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(e){e?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(e){var t=this._linkFlowInterval;this._linkFlowInterval=e,this.firePropertyChange("linkFlowInterval",t,e),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(e){if(!e)throw"ElementBox can not be null";if(this._box===e)return;var t=this._box;t&&(t.removeDataBoxChangeListener(this.handleElementBoxChange,this),t.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),t.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),t.removeIndexChangeListener(this.handleIndexChange,this),t.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),t.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),t.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||t.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=e,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new n.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(e):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",t,this._box)},handleElementBoxChange:function(e){var t=e.data;if(e.kind==="add")this.createElementUI(t),this.invalidateBundleLink(t);else if(e.kind==="remove"){var n=this.getElementUI(t);n&&(this._dirtyRects.add(n.getZoomViewRect()),n.dispose(),delete this._elementUIMap[t.getId()]),t===this._currentSubNetwork&&this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null),delete this._invalidateMap[t._id]}else if(e.kind==="clear"){for(var r in this._elementUIMap)this._elementUIMap[r]&&this._elementUIMap[r].dispose&&this._elementUIMap[r].dispose();this._elementUIMap={},this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null),this._paintAll=!0}else e.kind==="layoutEnd"?this.state.layouting=!1:e.kind==="layouting"&&(this.state.layouting=!0);this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(e){var t=e.source,n=this.getElementUI(t);n&&(this.invalidateElementUI(t),n.handlePropertyChange(e)),this.invalidateBundleLink(t),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(e){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(e){e.property==="editable"&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(e){var t=this.getSelectionModel().getLastData();t&&(e.kind==="append"||e.kind==="set")&&(this.isMakeVisibleOnSelected()&&this.makeVisible(t),this.isSendToTopOnSelected()&&this.sendToTop(t)),e.datas.forEach(function(t){var n=this.getElementUI(t);n&&n.handleSelectionChange(e),this.invalidateElementUI(t)},this),this.invalidateElementVisibility()},sendToTop:function(e){if(!this._box.contains(e))return;var t=e;while(t._parent&&this.isVisible(t._parent)){t=t._parent;if(!t)break}t!==e&&this._box.adjustElementIndex(t),this._box.adjustElementIndex(e)},getScopeRect:function(e){var t=this.getGraphicsZoom(),n=this.zoomManager;if(e==="viewsize")return{x:this._unionBounds.x-this.viewRect.x,y:this._unionBounds.y-this.viewRect.y,width:this._unionBounds.width,height:this._unionBounds.height};if(e==="viewport"){if(this.viewRect)return r.cloneRect(this.viewRect)}else if(e==="rootcanvas")return{x:this.viewRect.x,y:this.viewRect.y,width:(Math.abs(this.viewRect.x-this._unionBounds.x)+this._unionBounds.width)*t,height:(Math.abs(this.viewRect.y-this._unionBounds.y)+this._unionBounds.height)*t};return{x:0,y:0,width:0,height:0}},getViewRect:function(){return this.viewRect?r.cloneRect(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(e,t){var n=this.viewRect.x,r=this.viewRect.y,i=this.viewRect.width,s=this.viewRect.height;this.setViewRect(n+e,r+t,i,s)},setViewRect:function(e,t,n,r){this.isLimitViewInCanvas()==1&&(e<0&&(e=0),n>this.realWidth?e=0:e+n>this.realWidth&&(e=this.realWidth-n),t<0&&(t=0),r>this.realHeight?t=0:t+r>this.realHeight&&(t=this.realHeight-r));var i=this.viewRect;if(this.viewRect!=null&&e==this.viewRect.x&&t==this.viewRect.y&&n==this.viewRect.width&&r==this.viewRect.height)return;this.viewRect={x:e,y:t,width:n,height:r},this.firePropertyChange("viewRect",i,this.viewRect),this.invalidateElementVisibility(),this._paintAll=!0},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(e){this.hScrollBarVisible=e},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(e){this.vScrollBarVisible=e},setZoomVisibilityThresholds:function(e){var t=this._visibilityThresholds;this._zoomVisibilityThresholds=e,this.firePropertyChange("zoomVisibilityThresholds",t,e),this.invalidateElementVisibility()},getZoomVisibilityThresholds:function(){return this._zoomVisibilityThresholds||{}},invalidateElementVisibility:function(){this.invalidate()},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(e){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){if(this._invalidateCanvasSizeFlag==0)return;this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize()},_validateCanvasSize:function(){if(this.isAutoValidateCanvasSize()==0){this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};return}var e=this.getElementBox().getDatas(),t=e.size(),n;if(t>0){for(var i=0;i<t;i++){var s=e.get(i);if(this._visibleMap[s._id]){var o=this._elementUIMap[s._id];o&&(n?n=m.unionRect(n,o.getZoomViewRect(!0)):n=r.cloneRect(o.getZoomViewRect(!0)))}}n==null&&(n={x:0,y:0,width:0,height:0});var u=this.getGraphicsZoom();this._unionBounds={x:n.x*u,y:n.y*u,width:n.width*u,height:n.height*u};if(this.realWidth==(n.x+n.width)*u&&this.realHeight==(n.y+n.height)*u)return;this.realWidth=(n.x+n.width)*u,this.realHeight=(n.y+n.height)*u}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)},getElementUI:function(e){return e==null?null:this._elementUIMap[e._id]},getUnionBounds:function(){return this._unionBounds},getZoomBodyRect:function(e){var t=this.getElementUI(e);return t?t.getZoomBodyRect():null},getShapeNodeZoomPoints:function(e,t){if(e._points){var n=this.getElementUI(e);if(n)return n._getZoomPoints()}return null},createElementUI:function(e){var t=this._elementUIMap[e.getId()];if(!t){t=this._elementUIFunction(this,e);if(!t){var r=e.getClassName(),i=r.substr(r.indexOf(".")+1)+"UI",s=n.vector[i];s&&(t=new s(this,e))}t&&(this._elementUIMap[e.getId()]=t)}return this._invalidateMap&&(this._invalidateMap[e._id]=e),t},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(e){if(!e)throw"ElementUIFunction can not be null";if(this._elementUIFunction===e)return;var t=this._elementUIFunction;this._elementUIFunction=e,this.firePropertyChange("elementUIFunction",t,e),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())},invalidateElementUI:function(e,t){if(this._invalidateAll)return;this._invalidateMap[e._id]=e;var r=this.getElementUI(e);if(e instanceof es){var i=e.getAgentLinks();i!=null&&i.forEach(this.invalidateElementUI,this);var s=e.getParent();s instanceof n.Group&&this.invalidateElementUI(s)}this.invalidateElementVisibility()},invalidateElementUIs:function(e){this._invalidateAll=!0,this._invalidateMap={},this._visibleMap={},this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.invalidate()},invalidateSelectedElementUIs:function(e){this.getSelectionModel().getSelection().forEach(function(t){this.invalidateElementUI(t,e)},this)},invalidateBundleLink:function(e){if(e instanceof n.Link&&e._bundleLinks){var t=this._elementUIMap;e._bundleLinks.forEachSiblingLink(function(n){if(n!==e){var r=t[n._id];r&&r.invalidate(!1)}},this)}},paintRoot:function(e){var i=this._rootCanvas.getContext("2d");i.save();var s=this.getGraphicsZoom();i.beginPath(),i.rect(Math.round(e.x*s-this.viewRect.x),Math.round(e.y*s-this.viewRect.y),Math.round(e.width*s),Math.round(e.height*s)),i.clip(),i.clearRect(Math.round(e.x*s-this.viewRect.x),Math.round(e.y*s-this.viewRect.y),Math.round(e.width*s),Math.round(e.height*s)),this.visibleList=new n.List,this._topAttachmentList=new n.List,Li.draw(i,this);var o=this.getElementBox().getDatas()._as,u=o.length,a=this.zoomManager;a._zoomGraphicsBegin(i),this.paintBottom(i,e);var f=this._box._layerBox,l,c,h,p,s=this.getGraphicsZoom(),d={x:this.viewRect.x/s,y:this.viewRect.y/s,width:this.viewRect.width/s,height:this.viewRect.height/s};this.adjustLinkIndex();if(f.size()===1)for(l=0;l<u;l++)c=o[l],this._visibleMap[c._id]?(h=this._elementUIMap[c._id],this._debug&&w.strokeRect(i,e,"red"),h!=null&&this._isInView(h,e)&&(h.paint(i),h.setAttachmentVisible&&h.setAttachmentVisible(!0)),h!=null&&m.intersects(d,h.getZoomViewRect())?h.setAttachmentVisible&&h.setAttachmentVisible(!0):h.setAttachmentVisible&&h.setAttachmentVisible(!1),this.visibleList.add(c)):(h=this._elementUIMap[c._id],h&&h.setAttachmentVisible&&h.setAttachmentVisible(!1));else f.forEachByDepthFirst(function(t){for(l=0;l<u;l++)c=o[l],f.getLayerByElement(c)===t&&this._visibleMap[c._id]?(h=this._elementUIMap[c._id],h!=null&&this._isInView(h,e)&&(h.paint(i),h.setAttachmentVisible&&h.setAttachmentVisible(!0)),h!=null&&m.intersects(d,h.getZoomViewRect())?h.setAttachmentVisible&&h.setAttachmentVisible(!0):h.setAttachmentVisible&&h.setAttachmentVisible(!1),h&&h.validateZIndex&&h.validateZIndex(f.getDatas().indexOf(t)),this.visibleList.add(c)):h=this._elementUIMap[c._id]},null,this);u=this._topAttachmentList.size();for(l=0;l<u;l++)p=this._topAttachmentList.get(l),p.getElementUI().paintAttachment(i,p);this.paintTop(i,e);if(this._xyz!==t){var v=this._xyz,g=v.markText,y=v.type,b=v.expired,E=v.innerHTML,S=0,x=0,u,T=1,N=this.viewRect;i.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),i.scale(1/this.getZoom(),1/this.getZoom());var s=this.getZoom();g!=t&&g!=null&&g!=""||y=="2"?(i.font="15px Arial sans-serif",u=r.g.getTextSize(i.font,E),i.fillStyle="red",S=N.width-u.width,x=N.height-20):(i.font="10px Arial sans-serif",u=r.g.getTextSize(i.font,E),S=N.width/2-u.width/2,x=N.height/2),i.fillText(E,S,x)}i.restore(),this._invalidateMap={},this._invalidateAll=!1,this._paintAll=!1,this._dirtyRects=new Oi},adjustLinkIndex:function(){var e=this._box.getDatas()._as,t=this.hasEditInteraction(),r,s;if(t){this._hasAdjustedLinks=!1;for(i=e.length-1;i>-1;i--){r=e[i];if(r instanceof n.Link)if(this.isEditable(r)&&this.getElementUI(r).isEditable()&&this.isSelected(r))s=this._box.getDatas().indexOf(r),this._box.getDatas().removeAt(s),this._box.getDatas().add(r),this._hasAdjustedLinks=!0;else{var o=r.getToNode();s=this._box.getDatas().indexOf(o),this._box.getDatas().removeAt(s),this._box.getDatas().add(o);var u=r.getFromNode();s=this._box.getDatas().indexOf(u),this._box.getDatas().removeAt(s),this._box.getDatas().add(u)}}}else if(this._hasAdjustedLinks){for(i=e.length-1;i>-1;i--){r=e[i];if(r instanceof n.Link){var o=r.getToNode();s=this._box.getDatas().indexOf(o),this._box.getDatas().removeAt(s),this._box.getDatas().add(o);var u=r.getFromNode();s=this._box.getDatas().indexOf(u),this._box.getDatas().removeAt(s),this._box.getDatas().add(u)}}this._hasAdjustedLinks=!1}},paintBottom:function(e,t){},paintTop:function(e,t){},_isInView:function(e,t){return m.intersects(t,e.getZoomViewRect())},paintTopCanvas:function(){var e=this._topCanvas.getContext("2d");e.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(e)},paintMarker:function(e){var t=this.markerList.size();for(var n=0;n<t;n++){var r=this.markerList.get(n);r.paint(e)}},getLayerByElement:function(e){return this._box.getLayerBox().getLayerByElement(e)},getLogicalPoint2:function(e){return this.zoomManager._getLogicalPoint(e)},getLogicalPoint:function(e){return this.zoomManager._getLogicalPoint(e,!0)},getElementAt:function(e){if(this.visibleList==null)return null;var t;e.target?t=this.getLogicalPoint2(e):e.event?e.event.target&&(t=this.getLogicalPoint2(e.event)):t=e;if(this._hitTestTopAttachmentList!=null){var n=this._hitTestTopAttachmentList.size();for(var r=n-1;r>=0;r--){var i=this._hitTestTopAttachmentList.get(r);if(i.hit(t.x,t.y))return i.getElement()}}if(this.visibleList!=null){var s=this.visibleList.size();for(var o=s-1;o>=0;o--){var u=this.visibleList.get(o),a=this.getElementUI(u);if(a&&a.hit(t.x,t.y))return u}}return null},getElementsAt:function(e){var t=new n.List;if(this.visibleList==null)return null;var r;e.target?r=this.getLogicalPoint2(e):e.event?e.event.target&&(r=this.getLogicalPoint2(e.event)):r=e;if(this._hitTestTopAttachmentList!=null){var i=this._hitTestTopAttachmentList.size();for(var s=i-1;s>=0;s--){var o=this._hitTestTopAttachmentList.get(s);o.hit(r.x,r.y)&&t.add(o.getElement())}}if(this.visibleList!=null){var u=this.visibleList.size();for(var a=u-1;a>=0;a--){var f=this.visibleList.get(a),l=this.getElementUI(f);l&&l.hit(r.x,r.y)&&t.add(f)}}return t},hitTest:function(e){var t=this.getElementAt(e);if(!t)return null;var n=this.getElementUI(t);if(!n)return null;var r;return e.target?r=this.getLogicalPoint2(e):e.event?r=this.getLogicalPoint2(e.event):r=e,n.hitTest(r.x,r.y)},getElementsAtRect:function(e,r,i,s){var o=new n.List;if(this.visibleList==null)return o;s=s===t?!0:s;var u=this.visibleList.size();for(var a=u-1;a>=0;a--){var f=this.visibleList.get(a),l=this.getElementUI(f);l&&(!i||i(l._element))&&(s&&this.isSelectable(l._element)||!s)&&(r?l.intersects(e)&&o.add(f):m.contains(e,l.getZoomViewRect(Rn))&&o.add(f))}return o},getPosition:function(e,t,r,i,s,o){var u,a=t instanceof n.vector.ElementUI?t:this.getElementUI(t);if(a)if(e==="from"||e==="to"){if(a.getFromPosition){u=e==="from"?a.getFromPosition(i,s):a.getToPosition(i,s);if(u)return r?{x:u.x-r.width/2,y:u.y-r.height/2}:u}}else e==="hotspot"?u=o?a.getZoomHotSpot(this.zoomManager):a.getHotSpot():u=y.get(e,o?a.getZoomBodyRect():a.getBodyRect(),r);!u&&t.getRect&&(u=y.get(e,t.getRect(),r));if(u)return{x:u.x+i,y:u.y+s};throw"position '"+e+"' object '"+t+"'"},isValidEvent:function(e){if(!e)return!1;var t,n;if(e.currentTarget===this._view){h.isFirefox?(t=e.layerX,n=e.layerY):(t=e.offsetX,n=e.offsetY);if(this.isHScrollBarVisible()==1&&n>=this.viewRect.height-this.getScrollBarWidth())return!1;if(this.isVScrollBarVisible()==1&&t>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(e){this.markerList.add(e),this.repaintTopCanvas()},removeMarker:function(e){this.markerList.remove(e),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(e){return this._box.contains(e)?e.isMovable()?this._movableFunction&&!this._movableFunction(e)?!1:this.getLayerByElement(e).isMovable():!1:!1},hasMovableSelectedElements:function(){var e=this.getSelectionModel().getSelection();for(var t=0;t<e.size();t++){var n=e.get(t);if(this.isMovable(n))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(e){return this.isMovable(e)},this)},moveSelectedElements:function(e,t,r,i){if(e===0&&t===0)return;var s=this.getMovableSelectedElementsRect();if(s==null)return;this._limitElementInPositiveLocation&&(s.x+e<0&&(e=-s.x),s.y+t<0&&(t=-s.y)),n.Util.moveElements(this.getMovableSelectedElements(),e,t,r,i,this)},getMovableSelectedElementsRect:function(){var e=this.getMovableSelectedElements();if(e.size()===0)return null;var t=null;for(var n=0,r=e.size();n<r;n++){var i=e.get(n);if(i instanceof es){var s=this.getElementUI(i);s&&(t=m.unionRect(t,s.getViewRect()))}}return t},isVisibleAttachment:function(e){return!this.state.zooming&&!this.state.panning&&!this.state.layouting},isVisible:function(e,t,r){if(!this._box.contains(e))return!1;if(!e.isVisible())return!1;arguments.length!==3&&(t=this._visibleFunction);if(t&&!t(e))return!1;if(!(r||this._box._layerBox.getLayerByElement(e))._visible)return!1;if(xr.getSubNetwork(e)!==this._currentSubNetwork)return!1;if(!this.zoomManager.isElementVisible(e))return!1;if(e instanceof n.Link){if(!this._noAgentLinkVisible){if(!e._fromAgent||!e._toAgent)return!1;if(!this.isVisible(e._fromAgent,t,r)||!this.isVisible(e._toAgent,t,r))return!1}if(e.getBundleIndex()>0&&e.getBundleCount()>1&&!e.getStyle("link.bundle.expanded"))return!1}else{var i=e._parent;while(i&&!i.ISubNetwork){if(i instanceof n.Group)if(!i.isExpanded()||!this.isVisible(i,t,r))return!1;i=i._parent}}return e.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(e){var t=this._visibleFunction;this._visibleFunction=e,this.firePropertyChange("visibleFunction",t,e),this.invalidateElementVisibility()},isEditable:function(e){return this._box.contains(e)?this._editableFunction&&!this._editableFunction(e)?!1:this.getLayerByElement(e).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(e){var t=this._editableFunction;this._editableFunction=e,this.firePropertyChange("editableFunction",t,e),this.invalidateSelectedElementUIs(!0)},isRotatable:function(e){return this._rotatableFunction&&!this._rotatableFunction(e)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(e){var t=this._rotatableFunction;this._rotatableFunction=e,this.firePropertyChange("rotatableFunction",t,e),this.invalidateSelectedElementUIs(!0)},isLinkable:function(e,t){return this._linkableFunction==null||this._linkableFunction(e,t)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(e){var t=this._linkableFunction;this._linkableFunction=e,this.firePropertyChange("linkableFunction",t,e),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(e){var t=e.getStyle("shadow.color");return!t&&this.isSelected(e)&&e.getStyle("select.style")==="shadow"?e.getStyle("select.color"):t},getSelectColor:function(e){return e.getStyle("select.color")},getAlarmLabel:function(e){var t=e.getAlarmState().getHighestNewAlarmSeverity();if(t){var n=e.getAlarmState().getNewAlarmCount(t)+t.nickName;return e.getAlarmState().hasLessSevereNewAlarms()&&(n+="+"),n}return null},getLinkHandlerLabel:function(e){return e.isBundleAgent()?"+("+e.getBundleCount()+")":null},setInteractions:function(e){var t=this._interactions;t&&t.forEach(function(e){e.tearDown()}),this._interactions=e,e&&e.forEach(function(e){e.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",t,e)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(e,t){var r=[new n.vector.interaction.DefaultInteraction(this,e)];t&&r.push(new n.vector.interaction.MoveLinkInteraction(this,e)),this.setInteractions(r)},setTouchInteractions:function(){this.setInteractions([new n.vector.interaction.DefaultInteraction(this,!1),new n.vector.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new n.vector.interaction.MSTouchInteraction(this)])},setEditInteractions:function(e,t){var r=[new n.vector.interaction.EditInteraction(this,e),new n.vector.interaction.DefaultInteraction(this)];t&&r.push(new n.vector.interaction.MoveLinkInteraction(this,e)),this.setInteractions(r)},setCreateElementInteractions:function(e){this.setInteractions([new n.vector.interaction.CreateElementInteraction(this,e),new n.vector.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(e){this.setInteractions([new n.vector.interaction.CreateLinkInteraction(this,e),new n.vector.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(e){this.setInteractions([new n.vector.interaction.CreateShapeLinkInteraction(this,e),new n.vector.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(e){this.setInteractions([new n.vector.interaction.CreateShapeNodeInteraction(this,e),new n.vector.interaction.DefaultInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new n.vector.interaction.DefaultInteraction(this),new n.vector.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(e){var t=this._hasEditInteraction;this._hasEditInteraction=e,this.firePropertyChange("hasEditInteraction",t,e)},addElementByInteraction:function(e){e.getParent()||e.setParent(this._currentSubNetwork),this._box.add(e),this.getSelectionModel().setSelection(e),this.fireInteractionEvent({kind:"createElement",element:e})},getToolTip:function(e){if(e){var t=e.getToolTip();return t?t:e.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(e){this._toolTipEnabled=e;if(e){if(!this._toolTipListener){var t=this;this._toolTipListener=function(e){if(t.isMovingElement()){Ar.hideToolTip();return}var n=t.getElementAt(e);if(t._preElement===n)return;t._preElement=n;if(n){var r=t.getToolTip(n);Ar.showToolTip({x:e.pageX,y:e.pageY},r,function(e){var n=t._view.getBoundingClientRect(),r=e.getBoundingClientRect();r.width+r.left>n.width+n.left&&(e.style.left=n.width+n.left-r.width+(l.documentElement.scrollLeft||l.body.scrollLeft)+"px"),r.height+r.top>n.height+n.top&&(e.style.top=n.height+n.top-r.height+(l.documentElement.scrollTop||l.body.scrollTop)+"px")});return}Ar.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ar.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(e,t){e=this.checkZoom(e);if(this.isAsyncZoomAndViewRect())var n=this._zoomMap[this._currentSubNetwork].zoom;else var n=this._zoom;if(e==n)return;var r=this.getViewRect();t||(t={x:r.width/2,y:r.height/2});var i=this.viewRect,s=t.x-(t.x+i.x)*e/n,o=t.y-(t.y+i.y)*e/n;this.isAsyncZoomAndViewRect()?this._zoomMap[this._currentSubNetwork].zoom=e:this._zoom=e,this._paintAll=!0,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.zoomManager._invalidateZoom(),this.setViewRect(-s,-o,this.viewRect.width,this.viewRect.height),this._asyncZoomAndViewRect?this.firePropertyChange("zoom",n,this._zoomMap[this._currentSubNetwork].zoom):this.firePropertyChange("zoom",n,this._zoom),this.state.zooming=!0;var u=null,a=this;u?clearTimeout(u):u=setTimeout(function(){u=null,a.state.zooming=!1,a.invalidateElementUIs(!0)},100)},getZoom:function(){if(this.isAsyncZoomAndViewRect()){var e=this._zoomMap[this._currentSubNetwork];return e||(this._zoomMap[this._currentSubNetwork]={zoom:1}),this._zoomMap[this._currentSubNetwork].zoom}return this._zoom},getSizeZoom:function(e){return this.zoomManager.getSizeZoom(e)},getLocationZoom:function(){return this.zoomManager.getLocationZoom()},getGraphicsZoom:function(){return this.zoomManager.getGraphicsZoom()},zoomOverview:function(e){if(this._unionBounds.width<=0||this._unionBounds.width<=0)return;var t=this.getZoom(),n=this._unionBounds,r=n.width/t,i=n.height/t,s=this.viewRect.width/r,o=this.viewRect.height/i,u=Math.min(s,o);this.setZoom(u);var a=this.getZoom(),f=this.viewRect.width/2-this._unionBounds.width/2*a/t,l=this.viewRect.height/2-this._unionBounds.height/2*a/t;this.setViewRect(this._unionBounds.x*a/t-f,this._unionBounds.y*a/t-l,this.viewRect.width,this.viewRect.height);if(this.getLocationZoom()!=1){var c=arguments[1]==null?5:arguments[1];if(c>0){c--;var h=this;setTimeout(function(){h.zoomOverview(e,c)},25)}}},zoomReset:function(e){this.setZoom(1,e)},zoomIn:function(e){this.setZoom(this.getZoom()*1.2,e)},zoomOut:function(e){this.setZoom(this.getZoom()/1.2,e)},upSubNetwork:function(e,t){this._currentSubNetwork&&this.setCurrentSubNetwork(xr.getSubNetwork(this._currentSubNetwork),e,t)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(e,t,r){n.animate.AnimateManager.endAnimate();if(t){if(this._currentSubNetwork===e)return;if(e&&!this._box.contains(e))throw e+" is not contained in this network's elementBox";var i=new n.animate.AnimateSubNetwork(this,e,r);n.animate.AnimateManager.start(i)}else this._setCurrentSubNetwork(e),r&&r()},_setCurrentSubNetwork:function(e){if(this._currentSubNetwork===e)return;if(e&&!this._box.contains(e))throw e+" is not contained in this network's elementBox";if(this.isAsyncZoomAndViewRect()){var t=this._viewRectMap[this._currentSubNetwork];t?this._viewRectMap[this._currentSubNetwork]=this.viewRect
:this._viewRectMap[this._currentSubNetwork]=this.viewRect?this.viewRect:{x:0,y:0,width:this.viewRect.width,height:this.viewRect.height}}var n=this._currentSubNetwork;this._currentSubNetwork=e,this.firePropertyChange("currentSubNetwork",n,e);if(this.isAsyncZoomAndViewRect()){this._viewRectMap[this._currentSubNetwork]||(this._viewRectMap[this._currentSubNetwork]={x:0,y:0,width:this.viewRect.width,height:this.viewRect.height});var t=this._viewRectMap[this._currentSubNetwork];this.setViewRect(t.x,t.y,t.width,t.height),this.invalidateElementUIs()}this.invalidateElementVisibility(),this.invalidateCanvasSize(),this._paintAll=!0},makeVisible:function(e){var t=this.getElementUI(e);if(!t)return;var i=xr.getSubNetwork(e);if(i!==this._currentSubNetwork){var s=this;this.setCurrentSubNetwork(i,this.isSubNetworkAnimate(),function(){r.callLater(s.makeVisible,s,[e])});return}var o=e;while((o=o.getParent())&&o!==i)o instanceof n.Group&&o.setExpanded(!0);var u=t.getViewRect();if(!u)return;var a=t.getZoomViewRect(this.zoomManager),f;u.x==a.x&&u.y==a.y&&u.width==a.width&&u.height==a.height?f={x:u.x*this.getGraphicsZoom(),y:u.y*this.getGraphicsZoom(),width:u.width*this.getGraphicsZoom(),height:u.height*this.getGraphicsZoom()}:f=a,m.intersects(this.viewRect,f)||this.isVisible(e)&&r.callLater(this.centerByLogicalPoint,this,[f.x+f.width/2,f.y+f.height/2])},centerByLogicalPoint:function(e,t,n){var r=e-this.viewRect.width/2,i=t-this.viewRect.height/2;this.setViewRect(r,i,this.viewRect.width,this.viewRect.height)},panByOffset:function(e,t){this.setViewOffSet(e,t)},getIconsNames:function(e){return e.getStyle("icons.names")},getIconsColors:function(e){return e.getStyle("icons.colors")},getLinkFlowStepping:function(e){var t=parseInt(e.getStyle("link.flow.stepping"));return t||(t=$i.NETWORK_LINK_FLOW_STEPPING),t},getLinkFlowOffset:function(e){var t=e.getStyle("link.flow.offset");return isNaN(t)&&(t=0),t+this.getLinkFlowStepping(e)},toCanvas:function(e,t,r,i,s,o){r||(r=b.createCanvas()),r.setAttribute("width",e),r.setAttribute("height",t),r._viewRect?(r._viewRect.width=e,r._viewRect.height=t):r._viewRect={x:0,y:0,width:e,height:t};var u=r.getContext("2d");u.translate(-s,-o),u.clearRect(0,0,e,t),Li.draw(u,this);if(this._view.clientWidth===0||this._view.clientHeight===0)return r;var a=e/this.realWidth*this.getGraphicsZoom(),f=t/this.realHeight*this.getGraphicsZoom();u.scale(i,i);var l=this.getElementBox().getDatas()._as,c=l.length;this._topAttachmentList=new n.List;var h=this.getElementBox().getLayerBox(),p=h.getRoots(),d=p.size(),v,m,g,y,w,E;this.adjustLinkIndex();if(d===1)for(g=0;g<c;g++)y=l[g],this._visibleMap[y._id]&&(w=this._elementUIMap[y._id],w!=null&&w.paint(u));else for(v=0;v<d;v++){m=p.get(v);for(g=0;g<c;g++)y=l[g],h.getLayerByElement(y)===m&&this._visibleMap[y._id]&&(w=this._elementUIMap[y._id],w!=null&&w.paint(u))}c=this._topAttachmentList.size();for(g=0;g<c;g++)E=this._topAttachmentList.get(g),E.getElementUI().paintAttachment(u,E);return r},toCanvasByRegion:function(e,t,r){r||(r=b.createCanvas());var i=e.width*t,s=e.height*t;r.setAttribute("width",i),r.setAttribute("height",s),r._viewRect?(r._viewRect.width=i,r._viewRect.height=s):r._viewRect={x:0,y:0,width:i,height:s};var o=r.getContext("2d");o.clearRect(0,0,i,s),Li.draw(o,this);if(this._view.clientWidth===0||this._view.clientHeight===0)return r;o.save(),o.scale(t,t),o.beginPath(),o.translate(-e.x,-e.y);var u=this.getElementBox().getDatas()._as,a=u.length;this._topAttachmentList=new n.List;var f=this.getElementBox().getLayerBox(),l=f.getRoots(),c=l.size(),h,p,d,v,g,y;this.adjustLinkIndex();if(c===1)for(d=0;d<a;d++)v=u[d],this._visibleMap[v._id]&&(g=this._elementUIMap[v._id],g!=null&&m.intersects(e,g.getZoomViewRect())&&g.paint(o));else for(h=0;h<c;h++){p=l.get(h);for(d=0;d<a;d++)v=u[d],f.getLayerByElement(v)===p&&this._visibleMap[v._id]&&(g=this._elementUIMap[v._id],g!=null&&m.intersects(e,g.getZoomViewRect())&&g.paint(o))}a=this._topAttachmentList.size();for(d=0;d<a;d++)y=this._topAttachmentList.get(d),y.getElementUI().paintAttachment(o,y);return o.restore(),r},getGroupChildrenRects:function(e){return this.zoomManager._getGroupChildrenRects(e)},convertPointFromView:function(e){return this.zoomManager._convertPointFromView(e)},getOffset:function(e,t){return this.zoomManager._getOffset(e,t)},panToCenter:function(){this.setViewRect((this.realWidth-this.viewRect.width)/2,(this.realHeight-this.viewRect.height)/2,this.viewRect.width,this.viewRect.height)},moveElementsToCenter:function(){if(this._limitViewInCanvas){var e=this.viewRect,t=this._unionBounds,r=e.x+e.width/2-t.x-t.width/2,i=e.y+e.height/2-t.y-t.height/2;n.Util.moveElements(this._box.toDatas(),r,i)}else{var r=this.viewRect.width/2-this._unionBounds.width/2,i=this.viewRect.height/2-this._unionBounds.height/2;this.setViewRect(this._unionBounds.x-r,this._unionBounds.y-i,this.viewRect.width,this.viewRect.height)}},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(e){var t=this._linkPathFunction;this._linkPathFunction=e,this.firePropertyChange("linkPathFunction",t,e),this.invalidateElementUIs()},invalidate:function(){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}))},validate:function(){if(!this._invalidate)return;if(!a&&this._view.offsetWidth===0&&this._view.offsetHeight===0)return;this._invalidate=!1,this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),this._isValidating=!1},onClickElement:function(e,t){},onClickBackground:function(e){},onDoubleClickElement:function(e,t){},onDoubleClickBackground:function(e){},onLongClickElement:function(e,t){},onLongClickBackground:function(e){},onMouseMove:function(e,t){},onMouseEnter:function(e,t){},onMouseLeave:function(e,t){},setMovingElement:function(e){if(e==this._movingElement)return;var t=this._movingElement;this._movingElement=e,this.firePropertyChange("movingElement",t,e),this._box._undoManager._enabled&&(e?this._box._undoManager.startBatch():this._box._undoManager.endBatch())},setEditingElement:function(e){if(e==this._editingElement)return;var t=this._editingElement;this._editingElement=e,this.firePropertyChange("editingElement",t,e),this._box._undoManager._enabled&&(e?this._box._undoManager.startBatch():this._box._undoManager.endBatch())},dispose:function(){n.imageUtil.removeEventListener(this.invalidateElementUIs,this),this.setInteractions(null),cancelAnimationFrame(this._loopId)},handle_mousemove:function(e){var t=this.getElementAt(e),n=this.__preElement,r=Mr(n),i=Mr(t);n!==t&&(n&&(r&&r.onMouseLeave&&r.onMouseLeave(n,this),this.onMouseLeave(n,e)),t&&(i&&i.onMouseEnter&&i.onMouseEnter(t,this),this.onMouseEnter(t,e))),t&&i&&i.onMouseMove&&i.onMouseMove(t,this),this.onMouseMove(t,e),this.__preElement=t}}),n.vector.Overview=function(e){n.vector.Overview.superClass.constructor.apply(this,e),this._view=b.createView(),this._rootDiv=b.createDiv(),this._imageCanvas=b.createCanvas(),this._imageDiv=b.createDiv(),this._maskCanvas=b.createCanvas(),this._selectDiv=b.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,b.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=b.createCanvas(),this._imageCtx=this._imageCanvas.getContext("2d"),this.setNetwork(e),h.isTouchable?h.isMSTouchable?new n.vector.OverviewMSTouchInteraction(this):(new n.vector.OverviewTouchInteraction(this),new n.vector.OverviewInteraction(this)):new n.vector.OverviewInteraction(this)},r.ext("twaver.vector.Overview",n.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:$i.OVERVIEW_FILL_COLOR,_outlineColor:$i.OVERVIEW_OUTLINE_COLOR,_outlineWidth:$i.OVERVIEW_OUTLINE_WIDTH,_selectColor:$i.OVERVIEW_SELECT_COLOR,_selectWidth:$i.OVERVIEW_SELECT_WIDTH,_padding:$i.OVERVIEW_PADDING,_animate:$i.OVERVIEW_ANIMATE,_maxPackingWidth:$i.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:$i.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(e){this._invalidateMask()},setNetwork:function(e){if(e===this._network)return;this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),b.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=e,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),b.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate()},_handleNetworkPropertyChange:function(e){(e.property==="zoom"||e.property==="currentSubNetwork"||e.property==="elementBox"||e.property==="dataBox"||e.property==="canvasSizeChange")&&this.invalidate()},_handleNetworkViewChange:function(e){e.kind==="validateEnd"&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(e){if(!this._isNetworkDirty||!this._isMaskDirty)this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),r.callLater(this.validate,this,null,e)},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,r.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&this._network.getViewRect().width!==0&&this._network.getViewRect().height!==0&&!this._network._invalidate){var e=this._maxPackingWidth>0&&this._maxPackingHeight>0,t;e?t={x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:t={x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},m.grow(t,-this._padding,-this._padding),e&&(b.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var n=this._network.getGraphicsZoom(),r=this._network._unionBounds;r=m.unionRect(r,{x:0,y:0,width:r.x,height:r.y}),r={x:r.x/n,y:r.y/n,width:r.width/n,height:r.height/n};var i={x:this._network.viewRect.x/n,y:this._network.viewRect.y/n,width:this._network.viewRect.width/n,height:this._network.viewRect.height/n},s=m.unionRect(r,i),o=Math.min(t.width/s.width,t.height/s.height),u=s.width*o,a=s.height*o,f=s.width*o,l=s.height*o,c=t.x+(t.width-f)/2,h=t.y+(t.height-l)/2;if(this._isNetworkDirty){var p={x:c,y:h,width:f,height:l};this._network.toCanvas(u,a,this._exportImageCanvas,o,s.x*o,s.y*o),this._imageCanvas.setAttribute("width",f),this._imageCanvas.setAttribute("height",l),this._imageCtx.drawImage(this._exportImageCanvas,0,0,u,a),b.setDiv(this._imageDiv,p,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var d={x:(i.x-s.x)*o,y:(i.y-s.y)*o,width:i.width*o,height:i.height*o},v=b.setCanvas(this._maskCanvas,c,h,f,l);v.lineWidth=0,v.fillStyle=this._fillColor,w.drawVector(v,"rectangle",null,c,h,f,l),v.closePath(),v.fill(),v.stroke(),v.clearRect(c+d.x,h+d.y,d.width,d.height),v.lineWidth=this._outlineWidth,v.strokeStyle=this._outlineColor;var g=d.width-this._outlineWidth*2,y=d.height-this._outlineWidth*2;g=Math.min(g,f-2-d.x-this._outlineWidth),y=Math.min(y,l-2-d.y-this._outlineWidth),w.drawVector(v,"rectangle",null,c+d.x+this._outlineWidth,h+d.y+this._outlineWidth,g,y),v.closePath(),v.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(e){return b.getLogicalPoint(this._view,e,1,this._rootDiv)},centerNetwork:function(e,t){var n=this._imageDiv._viewRect;if(m.containsPoint(n,e)){var r=this._network.getGraphicsZoom(),i=this._network._unionBounds;i=m.unionRect(i,{x:0,y:0,width:i.x,height:i.y}),i={x:i.x/r,y:i.y/r,width:i.width/r,height:i.height/r};var s={x:this._network.viewRect.x/r,y:this._network.viewRect.y/r,width:this._network.viewRect.width/r,height:this._network.viewRect.height/r},o=m.unionRect(i,s);this._network.centerByLogicalPoint((o.x+(e.x-n.x)/n.width*o.width)*r,(o.y+(e.y-n.y)/n.height*o.height)*r,t),this._invalidateMask()}}}),n.vector.OverviewTouchInteraction=function(e){this.overview=e,this.network=e.getNetwork(),this.view=e._view,b.addEventListener("touchstart","handleTouchstart",this.view,this)},r.ext("twaver.vector.OverviewTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e),this.clear(),this.endPoint=this.overview.getLogicalPoint(e),kr.isMultiTouch(e)&&(this.distance=kr.getDistance(e),this.zoom=this.network.getZoom()),b.addEventListener("touchmove","handleTouchmove",this.view,this),b.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(e){this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(e);if(kr.isSingleTouch(e))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var t=kr.getDistance(e)/this.distance;this.network.setZoom(this.zoom*t,!1)}},handleTouchend:function(e){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(e);var t=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;t?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),t?r.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,b.removeEventListener("touchmove",this.view,this),b.removeEventListener("touchend",this.view,this)),this.moved=!1}}),n.vector.OverviewMSTouchInteraction=function(e){this.overview=e,this.network=e.getNetwork(),this.view=e._view,this._pointerMap={},this._pointerIdArray=[],b.addEventListener("MSPointerDown","handleTouchstart",this.view,this),b.addEventListener("MSPointerMove","handleTouchmove",this.view,this),b.addEventListener("MSPointerUp","handleTouchend",this.view,this),b.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},r.ext("twaver.vector.OverviewMSTouchInteraction",Object,{handleTouchstart:function(e){b.preventDefault(e),e.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[e.pointerId]&&this.overview.getLogicalPoint(e)&&(this._pointerIdArray.push(e.pointerId),this._pointerMap[e.pointerId]=e),this._pointerIdArray.length==1?(this._startTouchPoint=this.overview.getLogicalPoint(e),this._startTouchTime=new Date):this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(e){if(this._pointerIdArray.length==0||!this._pointerMap[e.pointerId]||m.getDistance({x:this._pointerMap[e.pointerId].pageX,y:this._pointerMap[e.pointerId].pageY},{x:e.pageX,y:e.pageY})<=10)return;this._pointerMap[e.pointerId]=e;if(this._pointerIdArray.length==2){var t=this._getDistance()/this._distance;this.network.setZoom(this._zoom*t,!1)}else if(this._pointerIdArray.length==1&&this._startTouchPoint){var n=this.overview.getLogicalPoint(e);if(n==null)return;this._startTouchPoint=n,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(e){var t=this.overview.getLogicalPoint(e);if(this._pointerIdArray.length==1&&t){var n=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&m.getDistance(this._endTouchPoint,t)<=10;n?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=t,this._endTouchTime=new Date),n?r.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return m.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),n.vector.OverviewInteraction=function(e){this.overview=e,this.network=e.getNetwork(),this.view=e._view,b.addEventListener("mousedown","handleMousedown",this.view,this)},r.ext("twaver.vector.OverviewInteraction",Object,{handleMousedown:function(e){this.clear(),this.endPoint=this.overview.getLogicalPoint(e),r.isCtrlDown(e)&&(this.startPoint=this.endPoint,b.setVisible(this.overview._selectDiv,!0)),b.addEventListener("mousemove","handleMousemove",this.view,this),b.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(e){this.endPoint=this.overview.getLogicalPoint(e);if("detail"in e&&e.detail===2)r.callLater(this.network.zoomReset,this.network,[this.endPoint,this.overview._animate]);else if(b.isVisible(this.overview._selectDiv)&&this.startPoint){var t=this.overview._imageDiv._viewRect,n=this.overview._selectDiv._viewRect.x,i=this.overview._selectDiv._viewRect.y,s=t.width/this.overview._selectDiv._viewRect.width,o=t.height/this.overview._selectDiv._viewRect.height,u=Math.min(s,o);this.network.setZoom(u*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var a=this.network.getCanvasSize().width*((n-t.x+this.overview._selectDiv._viewRect.width/2)/t.width),f=this.network.getCanvasSize().height*((i-t.y+this.overview._selectDiv._viewRect.height/2)/t.height);r.callLater(this.network.centerByLogicalPoint,this.network,[a,f,this.overview._animate]),b.setVisible(this.overview._selectDiv,!1),b.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(e){var t=this.overview.getLogicalPoint(e);this.endPoint=t;if(b.isVisible(this.overview._selectDiv)&&this.startPoint){var n=t.x>this.startPoint.x?this.startPoint.x:t.x,r=t.x>this.startPoint.x?this.startPoint.y:t.y;t.x>this.startPoint.x&&t.y<this.startPoint.y&&(r=t.y),t.x<this.startPoint.x&&t.y>this.startPoint.y&&(r=this.startPoint.y);var i=this.overview._imageDiv._viewRect;n<i.x&&(n=i.x),n>i.x+i.width&&(n=i.x+i.width),r<i.y&&(r=i.y),r>i.y+i.height&&(r=i.y+i.height);var s=Math.abs(t.x-this.startPoint.x),o=Math.abs(t.y-this.startPoint.y);n+s>i.x+i.width&&(s=i.x+i.width-n),r+o>i.y+i.height&&(o=i.y+i.height-r),b.setDiv(this.overview._selectDiv,{x:n,y:r,width:s,height:o},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(t,!1)},clear:function(){this.endPoint&&(this.endPoint=null,b.removeEventListener("mousemove",this.view,this),b.removeEventListener("mouseup",this.view,this))}}),n.vector.ElementUI=function(e,t){this._network=e,this._element=t,this._attachments=new n.List,this._bodyBounds=new n.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},r.ext("twaver.vector.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(e){},handleSelectionChange:function(e){},invalidate:function(e){e===t&&(e=!0),e&&(this._invalidateAttachmentsFlag=!0);if(this._invalidateFlag)return;this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this.invalidateZoom(),this.setAttachmentVisible&&this.setAttachmentVisible(!1)},invalidateZoom:function(){this._zoomBodyRect=null,this._zoomViewRect=null,this._zoomHotSpot=null},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._glowBlur=this._element.getStyle("glow.blur"),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){var e=this;if(this._invalidateFlag==0)return;this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(e){e.validate()});var t;this._bodyBounds.forEach(function(e){t=m.unionRect(t,e)}),t==null&&(t=r.cloneRect(this._element.getLocation()),t.width=0,t.height=0),this._unionBodyBounds={x:t.x,y:t.y,width:t.width,height:t.height},this._attachments.forEach(function(r){r instanceof n.vector.EditAttachment?r.getElementUI()instanceof n.vector.LinkUI?t=m.unionRect(t,r._viewRect):t=m.unionRect(t,e._network.zoomManager._reverseElementZoomRect(e,r._viewRect)):r.getElementUI()instanceof n.vector.LinkUI?t=m.unionRect(t,e._network.zoomManager._getAttachmentZoomOutLineRect(r,r._viewRect)):r.getElementUI()instanceof n.vector.GroupUI&&r.getElementUI()._shapeRect?r instanceof n.vector.IconsAttachment?t=m.unionRect(t,r._viewRect):t=m.unionRect(t,e._network.zoomManager._getAttachmentZoomOutLineRect(r,r._viewRect)):t=m.unionRect(t,r._viewRect)}),this._viewRect=t},validateImpl:function(){},setGlow:function(e,t){this._element.getStyle("outer.style")==="glow"&&(t.shadowColor=this._outerColor,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=this._glowBlur)},clearGlow:function(e){if(e.shadowOffsetX!=0||e.shadowOffsetY!=0||e.shadowBlur!=0)e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0},setShadow:function(e,t){var n=this._network.zoomManager,r=e.isShadowable()&&this._shadowColor&&!this._editAttachment;if(t.shadowOffsetX===this._shadowXOffset&&t.shadowOffsetY===this._shadowYOffset&&t.shadowBlur===this._shadowBlur)return t;if(r||this._network._showShadowInEdit){var i=n.getGraphicsZoom(),s=n.getSizeZoom();i*=s,i>1&&(i=1),t.shadowOffsetX=this._shadowXOffset*i,t.shadowOffsetY=this._shadowYOffset*i,t.shadowBlur=this._shadowBlur*i,t.shadowColor=this._shadowColor}return t},clearShadow:function(e){if(e.shadowOffsetX!=0||e.shadowOffsetY!=0||e.shadowBlur!=0)e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0},appendShadowBound:function(e,t){var n=e.isShadowable()&&this._shadowColor&&!this._editAttachment;if(n){var r=this._network.zoomManager,i=r.getGraphicsZoom(),s=r.getSizeZoom();i*=s,i>1&&(i=1),this._shadowXOffset>0?t.width+=this._shadowXOffset:(t.x+=this._shadowXOffset,t.width+=-this._shadowXOffset),this._shadowYOffset>0?t.height+=this._shadowYOffset:(t.y+=this._shadowYOffset,t.height+=-this._shadowYOffset);var o=this._shadowBlur;o=Math.ceil(o/i),m.grow(t,o+1,o+1)}return t},appendGlowBound:function(e,t){if(this._element.getStyle("outer.style")==="glow"){var n=this._network.zoomManager,r=n.getGraphicsZoom(),i=n.getSizeZoom();r*=i,r>1&&(r=1);var s=this._glowBlur;s=Math.ceil(s/r),m.grow(t,s+1,s+1)}},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&this._element.getStyle("select.style")==="shadow"?!0:!1},addAttachment:function(e){this._attachments.add(e),this.invalidate(!1)},removeAttachment:function(e){this._attachments.remove(e),this.invalidate(!1)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkLabel2Attachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var e=this._network.getLabel(this._element);e!=null&&e!==""?this._labelAttachment||(this._labelAttachment=new n.vector.LabelAttachment(this,$i.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var e=this._network.getLabel2(this._element);e!=null&&e!==""?this._label2Attachment||(this._label2Attachment=new n.vector.Label2Attachment(this,$i.SHOW_LABEL2_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var e=this._network.getAlarmLabel(this._element);e!=null&&e!==""?this._alarmAttachment||(this._alarmAttachment=new n.vector.AlarmAttachment(this,$i.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var e=this._network.getIconsNames(this._element);e&&e.length>0?this._iconsAttachment||(this._iconsAttachment=new n.vector.IconsAttachment(this,$i.SHOW_ICON_IN_ATTACHMENT_DIV),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new n.vector.EditAttachment(this,$i.SHOW_EDIT_IN_ATTACHMENT_DIV),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(e){return this._innerColor?this._innerColor:this.getStyle(e)},getStyle:function(e){return this._element.getStyle(e)},getFont:function(e){var t=this._element.getStyle(e);return t?t:n.Defaults.FONT},paint:function(e){e.save(),e.globalAlpha=this._wholeAlpha,e.beginPath(),this.paintBody(e),this.clearShadow(e),this.clearGlow(e),e.closePath(),e.beginPath(),this.paintAttachments(e),e.closePath(),e.restore(),this._network._debug&&w.strokeRect(e,this.getZoomBodyRect(),"orange")},paintBody:function(e){},getZoomBodyRect:function(e){return this._network.zoomManager._getElementZoomRect(this,this.getBodyRect())},getZoomHotSpot:function(){return this._zoomHotSpot||(this._zoomHotSpot=this._network.zoomManager._getZoomHotSpot(this,this._hotSpot)),r.clone(this._zoomHotSpot)},getZoomPointers:function(e,t){return this._network.zoomManager._getZoomPointers(e,this,t)},_getZoomViewRect:function(e,t,n){var i=this._network.zoomManager;if(t){var s=r.cloneRect(i._getAttachmentZoomRect(t,e));return s}var o=i.getLocationZoom(),u=i.getSizeZoom(this),a=this._bodyRect?this._bodyRect:this.getBodyRect();e=e||{x:a.x,y:a.y,width:0,height:0};var f=a.x+a.width/2,l=a.y+a.height/2;return{x:f*o+(e.x-f)*u,y:l*o+(e.y-l)*u,width:e.width*u,height:e.height*u}},getZoomViewRect:function(e){var t=this._network.zoomManager,i=t.getLocationZoom(),s=t.getGraphicsZoom();if(i==1)return r.cloneRect(this._viewRect);if(!this._zoomViewRect||e){var o=this._getZoomViewRect(r.cloneRect(this._unionBodyBounds),!1),u;u=m.unionRect(u,o);var a=this;this._attachments.forEach(function(e){e instanceof n.vector.EditAttachment?u=m.unionRect(u,e._viewRect):u=m.unionRect(u,e.getZoomViewRect())}),this._zoomViewRect=u}return r.cloneRect(this._zoomViewRect)},paintAttachments:function(e){var t=this;e.beginPath();var n=this._attachments.size();for(var r=0;r<n;r++){var i=this._attachments.get(r);if(!this._network.isShowAttachOnChg()&&!this._network.isVisibleAttachment(i))continue;this._hitTest==1&&i.isShowOnTop()==0&&this.paintAttachment(e,i),this._intersectTest==1&&this.paintAttachment(e,i),this._hitTest==0&&this._intersectTest==0&&(i.isShowOnTop()?this._network._topAttachmentList.add(i):this.paintAttachment(e,i))}},paintAttachment:function(e,t){var n=this._network.zoomManager;if(!n.isAttachmentVisible(this._element))return;if((t==this._labelAttachment||t==this._label2Attachment)&&!n.isLabelVisible(this._element))return;if(t==this._alarmAttachment&&!n.isAlarmBalloonVisible(this._element))return;e.beginPath(),t.paint(e),this.clearShadow(e)},getViewRect:function(){return r.cloneRect(this._viewRect)},getUnionBodyBounds:function(){return r.cloneRect(this._unionBodyBounds)},addBodyBounds:function(e){e&&this._bodyBounds.add(e)},getBodyRect:function(e){return e==t&&(e=!0),this._bodyRect||(this._bodyRect=this.createBodyRect()),e?r.cloneRect(this._bodyRect):this._bodyRect},getHotSpot:function(){return this._hotSpot?r.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(e){this._hotSpot=e},hit:function(e,t){return!1},intersects:function(e){return m.contains(e,this.getZoomViewRect())?!0:!1},hitCanvasRectAtBody:function(e){var t=rs.getHitCanvas(e.width,e.height),n=rs.getCtx(t);n.save(),n.translate(-e.x,-e.y);if(this._element.getImage){var i=r.getImageAsset(this._element.getImage());if(i&&i.getImage()instanceof Qi)return 1}this.paintBody(n);try{var s=n.getImageData(0,0,e.width,e.height),o=s.data;for(var u=0;u<s.width;u++)for(var a=0;a<s.height;a++){var f=4*(a*s.width+u),l=o[f+3];if(l!==0)return n.restore(),1}}catch(c){rs.disposeHitCanvas();if(m.contains(this.getUnionBodyBounds(),e))return 0}return n.restore(),-1},hitCanvasRectAtAttachments:function(e){var t=rs.getHitCanvas(e.width,e.height),n=rs.getCtx(t);n.save(),n.translate(-e.x,-e.y),this.paintAttachments(n);try{var r=n.getImageData(0,0,e.width,e.height),i=r.data;for(var s=0;s<r.width;s++)for(var o=0;o<r.height;o++){var u=4*(o*r.width+s),a=i[u+3];if(a!==0)return n.restore(),1}}catch(f){rs.disposeHitCanvas()}return n.restore(),-1},hitCanvasRect:function(e){this._intersectTest=!0,this._hitTest==1&&(this._intersectTest=!1);var t=m.intersection(e,this.getZoomViewRect()),n=this.hitCanvasRectAtBody(t);if(n==1)return this._intersectTest=!1,!0;var r=this.hitCanvasRectAtAttachments(t);return r==1?(this._intersectTest=!1,!0):(this._intersectTest=!1,n==0)},hitCanvasPoint:function(e,t){var n={x:e,y:t,width:0,height:0},r=this._network.getSelectionTolerance();r&&r>0&&m.grow(n,r,r);if(!m.intersects(this.getZoomViewRect(),n))return!1;this._hitTest=!0;var i=this.hitCanvasRect(n);return this._hitTest=!1,i},hitTest:function(e,t){var n={x:e,y:t,width:0,height:0},r=this._network.getSelectionTolerance();r&&r>0&&m.grow(n,r,r);if(!m.intersects(this.getZoomViewRect(),n))return null;var i=m.intersection(n,this.getZoomViewRect()),s=this._attachments.size();for(var o=0;o<s;o++){var u=this._attachments.get(o);if(u.hit(e,t))return u}var a=this.hitCanvasRectAtBody(i);return a==1?this:a==0?this:null},dispose:function(){this._attachments.forEach(function(e){e.dispose()}),this._attachments.clear()}}),n.vector.NodeUI=function(e,t){n.vector.NodeUI.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.NodeUI",n.vector.ElementUI,{invalidate:function(e){this.curInterval&&clearInterval(this.curInterval),n.vector.NodeUI.superClass.invalidate.call(this,e)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){n.vector.NodeUI.superClass.validateImpl.call(this);var e=this.getStyle("vector.shape"),t=this.getBodyRect();this._hotSpot=m.getHotSpot(t.x,t.y,t.width,t.height,e),this.validateBodyBounds()},validate:function(){if(this._invalidateFlag==0)return;n.vector.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var e=this.getStyle("body.type");e==="default"?this.addBodyBounds(this.getDefaultBodyRect()):e==="vector"?this.addBodyBounds(this.getVectorBody()):e==="default.vector"?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):e==="vector.default"&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.getStyle("outer.style")==="border"&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var e=this._element,t=this.getBodyRect();if(!e.getImage()||typeof e.getImage()=="string"&&!r.getImageAsset(e.getImage()))return t;m.addPadding(t,this._element,"image.padding",1);var n=r.cloneRect(t);return this.appendGlowBound(this,n),this.appendShadowBound(this,n),t=n,t},getVectorBody:function(){var e=this.getPathRect("vector");return e},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect
("select")},_getBorderRect:function(e){var t=this._element,n=t.getStyle(e+".width"),i=t.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();if(n>0){n=e==="select"?n/i:n;var s=this.getBodyRect();m.addPadding(s,t,e+".padding",e==="select"?1/i:1);var o=r.cloneRect(s);return m.grow(o,n*2,n*2),o}return null},getPathRect:function(e,t){var n=this._element,i=this.getBodyRect(),s=this._network.zoomManager.getSizeZoom();t&&m.addPadding(i,n,e+".padding",1);var o=r.cloneRect(i),u=n.getStyle(e+".outline.width");if(u>0)if(this._getZoomPoints){var a=this._element._points,f=a.size(),l=0;for(var c=0;c<f;c++){if(c==0)var h=a.get(c),p=a.get(f-1),d=a.get(c+1);else if(c==f-1)var h=a.get(c),p=a.get(c-1),d=a.get(0);else var h=a.get(c),p=a.get(c-1),d=a.get(c+1);var v=m.getCenterPoint(p,d),g=m.getAngle(v,h),y=Math.abs(5*(u+1)*Math.sin(g));l=l<y?y:l,y=Math.abs(5*(u+1)*Math.cos(g)),l=l<y?y:l}m.grow(o,l,l)}else m.grow(o,u/2,u/2);return this.appendGlowBound(this,o),this.appendShadowBound(this,o),o},getZoomPathRect:function(e,t){var n=this._element,i=this.getZoomBodyRect(),s=this._network.zoomManager.getSizeZoom();t&&m.addPadding(i,n,e+".padding",1);var o=r.cloneRect(i),u=n.getStyle(e+".outline.width");if(u>0)if(this._getZoomPoints){var a=this._getZoomPoints(),f=a.size(),l=0;for(var c=0;c<f;c++){if(c==0)var h=a.get(c),p=a.get(f-1),d=a.get(c+1);else if(c==f-1)var h=a.get(c),p=a.get(c-1),d=a.get(0);else var h=a.get(c),p=a.get(c-1),d=a.get(c+1);var v=m.getCenterPoint(p,d),g=m.getAngle(v,h),y=Math.abs(5*(u+1)*Math.sin(g));l=l<y?y:l,y=Math.abs(5*(u+1)*Math.cos(g)),l=l<y?y:l}m.grow(o,l,l)}else m.grow(o,u/2,u/2);return this.appendGlowBound(this,o),this.appendShadowBound(this,o),o},paintBody:function(e){this.curInterval&&clearInterval(this.curInterval);var t=this.getStyle("body.type");t==="default"?this.drawDefaultBody(e):t==="vector"?this.drawVectorBody(e):t==="default.vector"?(this.drawVectorBody(e),this.drawDefaultBody(e)):t==="vector.default"&&(this.drawDefaultBody(e),this.drawVectorBody(e)),this._outerColor&&this.getStyle("outer.style")==="border"&&this.drawOuterBorder(e),this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.drawSelectBorder(e)},drawOuterBorder:function(e){var t=this._element,n=t.getStyle("outer.width");if(n>0){var r=this.getZoomBodyRect();m.addPadding(r,t,"outer.padding",1),e.lineWidth=n,e.lineCap=t.getStyle("outer.cap"),e.lineJoin=t.getStyle("outer.join"),e.strokeStyle=this._outerColor,w.drawVector(e,t.getStyle("outer.shape"),null,r),e.stroke()}},drawDefaultBody:function(e){var t=this._element,i;if(!t.getImage()||typeof t.getImage()=="string"&&!(i=r.getImageAsset(t.getImage())))return;if(this._shapeRect&&(!t.getStyle("group.expend.image")||typeof t.getStyle("group.expend.image")=="string"&&!(i=r.getImageAsset(t.getStyle("group.expend.image")))))return;var s=this.getZoomBodyRect();m.addPadding(s,this._element,"image.padding",1),t.getAngle()!=0&&(e.save(),s=t.getOriginalRect(),s=this._network.zoomManager._getElementZoomRect(this,s),n.Util.rotateCanvas(e,s,t.getAngle())),this.setGlow(this,e),this.setShadow(this,e);var o=this;if(i&&i.getImage()instanceof Qi){var u=i.getImage().frames,a=i.getImage().size,f=0,l;l=Yi(u,a,0),e.drawImage(l,s.x,s.y,s.width,s.height),this.curInterval=setInterval(function(){f=(f+u.length)%u.length,l=Yi(u,a,f),e.drawImage(l,s.x,s.y,s.width,s.height),f++},100)}else this._shapeRect?Rr(e,t.getStyle("group.expend.image"),this.getInnerColor(),s,t,this._network):Rr(e,t.getImage(),this.getInnerColor(),s,t,this._network);t.getAngle()!=0&&e.restore()},drawSelectBorder:function(e){this.clearGlow(e);var t=this._element,n=t.getStyle("select.width");if(n>0){var i=this.getZoomBodyRect();i=r.cloneRect(i);var s=t.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();m.addPadding(i,t,"select.padding",1/s),m.grow(i,n/2/s,n/2/s),e.lineWidth=n/s,e.lineCap=t.getStyle("select.cap"),e.lineJoin=t.getStyle("select.join"),e.strokeStyle=t.getStyle("select.color"),w.drawVector(e,t.getStyle("select.shape"),null,i),e.stroke()}},drawVectorBody:function(e){this.drawPath(e,"vector",!0,this._element.getStyle("vector.outline.pattern"));var t=this.getStyle("vector.deep"),r=this.getStyle("vector.fill.color");if(t!==0&&r&&this.getStyle("vector.shape")==="rectangle"){var i=this.getZoomBodyRect(),s=this._element.getAngle();if(s!=0){e.save();var o=this._element.getOriginalRect();o=this._network.zoomManager._getElementZoomRect(this,o),n.Util.rotateCanvas(e,o,s)}w.draw3DRect(e,r,t,i),s!=0&&e.restore()}},drawPath:function(e,t,r,i,s,o,u){var a=this._network.zoomManager,f=this._element,l=null;t=="group"?l=this._shapeRect:l=this.getZoomBodyRect(),r&&m.addPadding(l,f,t+".padding",1);var c=f.getStyle(t+".outline.width");this.setGlow(this,e),this.setShadow(this,e),f.getAngle()!=0&&(f instanceof ns||(l=f.getOriginalRect(),l=a._getElementZoomRect(this,l)),e.save(),n.Util.rotateCanvas(e,l,f.getAngle()));var h=f.getStyle(t+".fill"),p;if(h){this._innerColor&&!xr.hasDefault(this._element)?p=this._innerColor:p=f.getStyle(t+".fill.color");var d=f.getStyle(t+".gradient");d?w.fill(e,p,d,f.getStyle(t+".gradient.color"),l):e.fillStyle=p}var v=f.getStyle(t+".shape"),g=f.getStyle("group.shape.roundrect.radius");g<0&&(g=10),h&&(e.beginPath(),s?w.drawLinePoints(e,s,null,o,u):v==="roundrect"&&t==="group"?w.drawVector(e,v,null,l,g):w.drawVector(e,v,null,l),e.fill()),c>0&&(e.lineWidth=c,e.lineCap=f.getStyle(t+".cap"),e.lineJoin=f.getStyle(t+".join"),e.strokeStyle=f.getStyle(t+".outline.color"),e.beginPath(),s?w.drawLinePoints(e,s,i,o,u):v==="roundrect"&&t==="group"?w.drawVector(e,v,i,l,g):w.drawVector(e,v,i,l),e.stroke()),f.getAngle()!=0&&e.restore()},hit:function(e,t){var n={x:e,y:t,width:0,height:0},i=this._network.getSelectionTolerance();i&&i>0&&m.grow(n,i,i);if(this._network._transparentSelectionEnable){var s=this.getBodyRect();if(r.math.intersects(s,n))return!0}return m.intersects(this.getZoomViewRect(),n)?this.hitCanvasPoint(e,t):!1},intersects:function(e){var t=n.vector.NodeUI.superClass.intersects.apply(this,arguments);if(t==1)return!0;if(this._network._transparentSelectionEnable){var i=this.getBodyRect();if(r.math.intersects(i,e))return!0}return m.intersects(e,this.getZoomViewRect())?this.hitCanvasRect(e):!1}}),n.vector.LinkUI=function(e,t){n.vector.LinkUI.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.LinkUI",n.vector.ElementUI,{isEditable:function(){return!0},invalidate:function(e){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,n.vector.LinkUI.superClass.invalidate.call(this,e)},invalidateZoom:function(){this._fromPoint=null,this._toPoint=null,this._linkPoints=null,n.vector.LinkUI.superClass.invalidateZoom.call(this)},validateImpl:function(){this.validateBodyBounds(),n.vector.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var e=this.getLinkPoints();if(!e||e.size()<2)return;var t=this._element,n=m.getLineRect(e),r=t.getStyle("link.width"),i=r;if(this._outerColor){var s=t.getStyle("outer.width");i+=s*2}var o=!this._editAttachment&&t.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(o){var u=t.getStyle("select.width");i+=u*2}m.grow(n,i/2,i/2),t.getStyle("arrow.from")&&(this._network._edgeDetect?(this._network._debug&&(this._arrowFromRect=Mi.getArrowRect(this,e,!0,t.getStyle("arrow.from.shape"),t.getStyle("arrow.from.width"),t.getStyle("arrow.from.height"),0,0,this._network.zoomManager)),n=m.unionRect(n,Mi.getArrowRect(this,e,!0,t.getStyle("arrow.from.shape"),t.getStyle("arrow.from.width"),t.getStyle("arrow.from.height"),0,0,this._network.zoomManager))):(this._network._debug&&(this._arrowFromRect=Mi.getArrowRect(this,e,!0,t.getStyle("arrow.from.shape"),t.getStyle("arrow.from.width"),t.getStyle("arrow.from.height"),t.getStyle("arrow.from.xoffset"),t.getStyle("arrow.from.yoffset"),this._network.zoomManager)),n=m.unionRect(n,Mi.getArrowRect(this,e,!0,t.getStyle("arrow.from.shape"),t.getStyle("arrow.from.width"),t.getStyle("arrow.from.height"),t.getStyle("arrow.from.xoffset"),t.getStyle("arrow.from.yoffset"),this._network.zoomManager)))),t.getStyle("arrow.to")&&(this._network._edgeDetect?(this._network._debug&&(this._arrowToRect=Mi.getArrowRect(this,e,!1,t.getStyle("arrow.to.shape"),t.getStyle("arrow.to.width"),t.getStyle("arrow.to.height"),0,0,this._network.zoomManager)),n=m.unionRect(n,Mi.getArrowRect(this,e,!1,t.getStyle("arrow.to.shape"),t.getStyle("arrow.to.width"),t.getStyle("arrow.to.height"),0,0,this._network.zoomManager))):(this._network._debug&&(this._arrowToRect=Mi.getArrowRect(this,e,!1,t.getStyle("arrow.to.shape"),t.getStyle("arrow.to.width"),t.getStyle("arrow.to.height"),t.getStyle("arrow.to.xoffset"),t.getStyle("arrow.to.yoffset"),this._network.zoomManager)),n=m.unionRect(n,Mi.getArrowRect(this,e,!1,t.getStyle("arrow.to.shape"),t.getStyle("arrow.to.width"),t.getStyle("arrow.to.height"),t.getStyle("arrow.to.xoffset"),t.getStyle("arrow.to.yoffset"),this._network.zoomManager)))),this.appendShadowBound(this,n),this.addBodyBounds(n),this._growLinkJoinBounds(n,i)},_growLinkJoinBounds:function(e,t){},createBodyRect:function(){var e=this.getHotSpot();return e?{x:e.x-1,y:e.y-1,width:2,height:2}:null},paintBody:function(e){var t=this.getLinkPoints();if(!t||t.size()<2)return;var r=this._element,i=r.isBundleAgent()&&r.getStyle("link.agent"),s=i?r.getStyle("link.agent.width"):r.getStyle("link.width"),o=s;if(this._outerColor&&this.getStyle("outer.style")==="border"){var u=r.getStyle("outer.width");o+=u*2}var a=!this._editAttachment&&r.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(a){var f=r.getStyle("select.width");o+=f*2}this.setGlow(this,e),this.setShadow(this,e),e.lineCap=i?r.getStyle("link.agent.cap"):r.getStyle("link.cap"),e.lineJoin=i?r.getStyle("link.agent.join"):r.getStyle("link.join");var l=i?r.getStyle("link.agent.pattern"):r.getStyle("link.pattern");a&&this.drawLinePoints(e,t,o,r.getStyle("select.color"),l),this._outerColor&&this.getStyle("outer.style")==="border"&&this.drawLinePoints(e,t,s+u*2,this._outerColor,l),this.drawLinePoints(e,t,s,this._innerColor||(i?r.getStyle("link.agent.color"):r.getStyle("link.color")),l),Mi.drawLinkArrow(this,e,t,this._network.zoomManager),this._network._debug&&(w.strokeRect(e,this._arrowToRect,n.Util.randomColor()),w.strokeRect(e,this._arrowFromRect,n.Util.randomColor()))},drawLinePoints:function(e,t,n,r,i){e.lineWidth=n,e.strokeStyle=r;var s=this._element.isBundleAgent()&&this._element.getStyle("link.agent");if(this._element.getStyle(s?"link.agent.flow":"link.flow")===!0&&i&&i.length>1){var o=new Sr(e,i[0],i[1]),u=this._element.getStyle(s?"link.agent.flow.offset":"link.flow.offset"),a=Math.floor(u/(i[0]+i[1]));a>2&&(u-=(i[0]+i[1])*a),this._element.getStyle(s?"link.agent.flow.converse":"link.flow.converse")?u<i[0]?o.overflow=i[0]-u:u>=i[0]&&u<=i[0]+i[1]?(o.overflow=i[1]-(u-i[0]),o.overflow&&(o.isLine=!1)):(u-=i[0]+i[1],o.overflow=i[0]-u):u<=i[1]?(o.overflow=u,u&&(o.isLine=!1)):u>i[1]&&u<=i[0]+i[1]?o.overflow=u-i[1]:(u-=i[0]+i[1],u&&(o.isLine=!1),o.overflow=u),this._element._styleMap[s?"link.agent.flow.offset":"link.flow.offset"]=u,e.beginPath(),w._drawLine(t,e),e.stroke(),e.shadowColor="transparent",e.beginPath();var f=this._element.getStyle(s?"link.agent.flow.color":"link.flow.color");f=f?f:$i.NETWORK_LINK_FLOW_COLOR,e.strokeStyle=f,w._drawLine(t,o),e.stroke(),e.shadowColor=this._shadowColor}else e.beginPath(),w.drawLinePoints(e,t,i),e.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=m.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(e,t){var n=this.getFromPoint();return n?{x:n.x+e,y:n.y+t}:null},getToPosition:function(e,t){var n=this.getToPoint();return n?{x:n.x+e,y:n.y+t}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=Nr.createFromPoint(this,this._network.zoomManager)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=Nr.createToPoint(this,this._network.zoomManager)),this._toPoint},getZoomBodyRect:function(){return this.getBodyRect()},getZoomViewRect:function(){return this._viewRect},createLinkPoints:function(){var e=this._network.zoomManager,t=this.getStyle("link.type"),r=new n.List;if(Nr.isOrthogonalOrFlexionalLink(this._element))r=Nr.orthogonalAndFlexional(this,t,e);else if(this._element.isLooped()){var i=this._network.getElementUI(this._element.getFromAgent());i!=null&&(this._hotSpot=Nr.fillLoopedPoints(this,i.getZoomBodyRect(),r))}else{if(t!=="arc"&&t!=="triangle"&&t!=="parallel")throw"Can not resolve link type '"+t+"'";var s=this.getFromPoint(),o=this.getToPoint();this._hotSpot=Nr.fillBundlePoints(this,t,s,o,r,e)}if(this._network._linkPathFunction){var u=this._network._linkPathFunction(this,r);u&&(r=u)}return r},checkAttachments:function(){n.vector.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var e=this._network.getLinkHandlerLabel(this._element);e!=null&&e!==""?this._linkHandlerAttachment||(this._linkHandlerAttachment=new n.vector.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return Nr.getControlPoint(this._element,this,this._network.zoomManager)},setControlPoint:function(e){if(!e)return;var t=this.getStyle("link.type");if(!Nr.hasControlPoint(t))return;var n=Nr.getLinkSourceBounds(this,this._network.zoomManager),r=Nr.getLinkTargetBounds(this,this._network.zoomManager);Nr.setParamsByControlPoint(e,n,r,t,this._element)},getLineLength:function(){return this._lineLength},hit:function(e,t){var n={x:e,y:t,width:0,height:0},r=this._network.getSelectionTolerance();return r&&r>0&&m.grow(n,r,r),m.intersects(this._viewRect,n)?this.hitCanvasPoint(e,t):!1},intersects:function(e){var t=n.vector.NodeUI.superClass.intersects.apply(this,arguments);if(t==1)return!0;if(m.intersects(e,this._viewRect)==0)return!1;var r=this.getLinkPoints(),i=r.size();if(i==2)for(var s=0;s<i;s+=2){var o=r.get(s);if(s+1<i){var u=r.get(s+1);if(rs.intersectsLine(o.x,o.y,u.x,u.y,e.x,e.y,e.width,e.height))return!0}}return this.hitCanvasRect(e)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=m.getAngle(this._fromPoint,this._toPoint)),this._angle||0},getAbsoluteAngle:function(){var e={x:10,y:0},t=this._fromPoint,n=this._toPoint,r={x:n.x-t.x,y:n.y-t.y},i=Math.acos((r.x*e.x+r.y*e.y)/(Math.sqrt(e.x*e.x+e.y*e.y)*Math.sqrt(r.x*r.x+r.y*r.y)))*180/Math.PI;return t.y<=n.y?i=i:i=360-i,i=i%360*Math.PI/180,i},appendShadowBound:function(e,t){var n=e.isShadowable()&&this._shadowColor&&!this._editAttachment;if(n){this._shadowXOffset>0?t.width+=this._shadowXOffset:(t.x+=this._shadowXOffset,t.width+=-this._shadowXOffset),this._shadowYOffset>0?t.height+=this._shadowYOffset:(t.y+=this._shadowYOffset,t.height+=-this._shadowYOffset);var r=this._shadowBlur;m.grow(t,r+1,r+1)}return t}}),n.vector.GroupUI=function(e,t){n.vector.GroupUI.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.GroupUI",n.vector.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(e){this._shapeRect?this._element.getStyle("group.expend.image")?(n.vector.GroupUI.superClass.paintBody.apply(this,arguments),this._element.getStyle("group.expend.image.vector")&&this.drawExpandedGroup(e)):this.drawExpandedGroup(e):n.vector.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect();if(this._shapeRect){var e=this.getPathRect("group",!1),t=this.getStyle("group.deep");m.grow(e,t+1,t+1),this.addBodyBounds(e)}else n.vector.GroupUI.superClass.validateBodyBounds.call(this)},getZoomBodyRect:function(){return this._element.isExpanded()?this.getBodyRect():n.vector.GroupUI.superClass.getZoomBodyRect.call(this)},getZoomViewRect:function(){return this._element.isExpanded()?this.getViewRect():n.vector.GroupUI.superClass.getZoomViewRect.call(this)},drawExpandedGroup:function(e){this.drawPath(e,"group",!1,this._element.getStyle("vector.outline.pattern"));var t=this.getStyle("group.deep"),n=this.getStyle("group.fill.color");t!==0&&n&&this.getStyle("group.shape")==="rectangle"&&w.draw3DRect(e,n,t,this._shapeRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var e=this._element,t=this._network;if(e.isExpanded()){e.getChildren().forEach(function(e){var n=t.getElementUI(e);n&&n.validate()});var r=this.getChildrenRects();if(!r.isEmpty()){var i=e.getStyle("group.shape"),s=g[i];if(!s)throw"Can not resolve group shape '"+i+"'";this._shapeRect=s(r)}}return this._shapeRect?(m.addPadding(this._shapeRect,e,"group.padding",1),this._shapeRect):n.vector.GroupUI.superClass.createBodyRect.call(this)},appendShadowBound:function(e,t){var n=e.isShadowable()&&this._shadowColor&&!this._editAttachment;if(n){this._shadowXOffset>0?t.width+=this._shadowXOffset:(t.x+=this._shadowXOffset,t.width+=-this._shadowXOffset),this._shadowYOffset>0?t.height+=this._shadowYOffset:(t.y+=this._shadowYOffset,t.height+=-this._shadowYOffset);var r=this._shadowBlur;m.grow(t,r+1,r+1)}return t}}),n.vector.ShapeNodeUI=function(e,t){n.vector.ShapeNodeUI.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.ShapeNodeUI",n.vector.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this._reverseZoomPathRect()},drawDefaultBody:function(e){if(this._element._points.size()<2)return;this.drawPath(e,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._getZoomPoints(),this._element._segments,this._element.getStyle("shapenode.closed")),Mi.drawLinkArrow(this,e,m.getPointObject(this._element._points,this._element._segments))},invalidateZoom:function(){this._zoomPoints=null,n.vector.LinkUI.superClass.invalidateZoom.call(this)},_getZoomPoints:function(){return this._zoomPoints=this._network.zoomManager._getShapeNodeZoomPoints(this,this._element._points),this._zoomPoints},_reverseZoomPathRect:function(){return this._network.zoomManager._reverseElementZoomRect(this,this.getZoomPathRect("vector",!0))}}),n.vector.ShapeLinkUI=function(e,t){n.vector.ShapeLinkUI.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.ShapeLinkUI",n.vector.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var e=this.getFromPoint(),t=this.getToPoint(),i=new n.List,s=this.getStyle("shapelink.type");i.add(e),this._element._points!=null&&i.addAll(this._network.zoomManager._getShapeLinkZoomPoints(this._element._points)),i.add(t);var o,u,a;if(s!=="lineto")if(s==="quadto"){o=new n.List(i.get(0));for(u=1,pointCount=i.size();u<pointCount;u++)u<pointCount-1?o.add(new n.List([i.get(u++),i.get(u)])):o.add(i.get(u));i=o}else if(s==="cubicto"){o=new n.List(i.get(0));for(u=1,pointCount=i.size();u<pointCount;u++)u<pointCount-2?o.add(new n.List([i.get(u++),i.get(u++),i.get(u)])):u<pointCount-1?o.add(new n.List([i.get(u++),i.get(u)])):o.add(i.get(u));i=o}else{if(s!=="orthogonalto")throw"Can not resolve shapelink type '"+s+"'";a=i.get(0),o=new n.List(a);for(u=1,pointCount=i.size();u<pointCount;u++)if(u<pointCount-1){var f=r.clone(i.get(u)),l=f.x,c=f.y,h=l-a.x,p=c-a.y;Math.abs(h)>Math.abs(p)?(f.x=l,f.y=a.y):(f.x=a.x,f.y=c),a=f,o.add(a)}else o.add(i.get(u));i=o}var d=m.calculateLineLength(i)/2,v,g=i.size(),y,b,f,w,h,p,E=0,S=0;for(v=0;v<g;v++){f=i.get(v);if(v==0){y=f;continue}b=f,b instanceof Oi&&(b=b._as),b instanceof Array?(w=m.calculateCurveLength(y,b,1),y=b[b.length-1]):(p=f.y-y.y,h=f.x-y.x,w=Math.sqrt(h*h+p*p),y=b),S+=w;if(E<=d&&S>=d){var x=d-E,T=i.get(v-1);T instanceof Oi&&(T=T._as,T instanceof Array&&(T=T[T.length-1]));var N=i.get(v),C=m.getPathInfo(N,T,x,0,-1).point;this._hotSpot=r.clone(C)}E=S}return i},_growLinkJoinBounds:function(e,t){m.grow(e,t*3,t*3)}}),n.vector.GridUI=function(e,t){n.vector.GridUI.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.GridUI",n.vector.NodeUI,{drawDefaultBody:function(e){this._element.getImage()?n.vector.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(e)},validateBodyBounds:function(){if(this._element.getImage())n.vector.GridUI.superClass.validateBodyBounds.call(this);else{var e=this.getBodyRect(),t=r.clone(e),i=this._element.getStyle("outer.width");m.grow(t,i,i),this.appendShadowBound(this,t),this.addBodyBounds(t)}},_getZoomCellRect:function(e,t){var n=this._element.getCellRect(e,t),r=this._element.getRect(),i=r.x+r.width/2,s=r.y+r.height/2,o=this.getZoomBodyRect(),u=o.width/r.width,a=o.x+o.width/2,f=i==0?1:a/i;return{x:i*f+(n.x-i)*u,y:s*f+(n.y-s)*u,width:n.width*u,height:n.height*u}},drawGridBody:function(e){var t=this.getStyle("grid.fill"),n=this.getStyle("grid.deep"),r=this.getStyle("grid.cell.deep");if(!t&&n===0&&r===0)return;e.beginPath();var i=this.getZoomBodyRect(),s=this.getDyeColor("grid.fill.color");this.setGlow(this,e),this.setShadow(this,e),t&&(e.fillStyle=s,e.rect(i.x,i.y,i.width,i.height),e.fill()),e.closePath(),this.clearShadow(e),e.beginPath(),n!=0&&w.draw3DRect(e,s,n,i.x,i.y,i.width,i.height),e.closePath();if(r!=0){var o=this.getStyle("grid.row.count"),u=this.getStyle("grid.column.count");for(var a=0;a<o;a++)for(var f=0;f<u;f++){var l=this._getZoomCellRect(a,f);l!=null&&(e.beginPath(),w.draw3DRect(e,s,r,l.x,l.y,l.width,l.height),e.closePath())}}}}),n.vector.RotatableNodeUI=function(e,t){n.vector.RotatableNodeUI.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.RotatableNodeUI",n.vector.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var e=this._element,t=r.getImageAsset(e.getImage()),n=this.getBodyRect();return t?(m.addPadding(n,this._element,"image.padding",1),n):n},drawDefaultBody:function(e){var t=this._element,n=r.getImageAsset(t.getImage());if(!n)return;var i=this.getBodyRect();m.addPadding(i,this._element,"image.padding",1);if(n.getImage()){var s=this._element._getOrignalWidth(),o=this._element._getOrignalHeight(),u=this._element._getRotateRect();e.save(),e.translate(i.x-u.x+s/2,i.y-u.y+o/2),e.rotate(this._element._angle*Math.PI/180),e.drawImage(n.getImage(this._innerColor),-s/2,-o/2,s,o),e.restore()}else if(!n.getSrc()&&!n.getFunction())throw"ImageAsset '"+t.getImage()+" ' is empty"}}),n.vector.HTMLNodeUI=function(e,t){n.vector.HTMLNodeUI.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.HTMLNodeUI",n.vector.NodeUI,{checkAttachments:function(){n.vector.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var e=this._element.getStyle("attachment.label.style");if(e&&e==="none"){n.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this);return}var t=this._network.getLabel(this._element);t!=null&&t!==""?this._labelAttachment||(this._labelAttachment=new n.vector.HTMLLabelAttachment(this,$i.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var e=this._element.getStyle("attachment.label2.style");if(e&&e==="none"){n.vector.HTMLNodeUI.superClass.checkLabel2Attachment.call(this);return}var t=this._network.getLabel2(this._element);t!=null&&t!==""?this._label2Attachment||(this._label2Attachment=new n.vector.HTMLLabel2Attachment(this,$i.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var e=this._element.getStyle("attachment.alarm.style");if(e&&e==="none"){n.vector.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);return}var t=this._network.getAlarmLabel(this._element);t!=null&&t!==""?this._alarmAttachment||(this._alarmAttachment=new n.vector.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(e){e?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._label2Attachment&&this._label2Attachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._label2Attachment&&this._label2Attachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))},validateZIndex:function(e){this._labelAttachment&&this._labelAttachment.validateZIndex(e)}}),n.vector.HTMLLinkUI=function(e,t){n.vector.HTMLLinkUI.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.HTMLLinkUI",n.vector.LinkUI,{checkAttachments:function(){n.vector.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var e=this._element.getStyle("attachment.label.style");if(e&&e==="none"){n.vector.HTMLLinkUI.superClass.checkLabelAttachment.call(this);return}var t=this._network.getLabel(this._element);t!=null&&t!==""?this._labelAttachment||(this._labelAttachment=new n.vector.HTMLLabelAttachment(this,$i.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var e=this._element.getStyle("attachment.label2.style");if(e&&e==="none"){n.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this);return}var t=this._network.getLabel2(this._element);t!=null&&t!==""?this._label2Attachment||(this._label2Attachment=new n.vector.HTMLLabel2Attachment(this,$i.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var e=this._element.getStyle("attachment.alarm.style");if(e&&e==="none"){n.vector.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);return}var t=this._network.getAlarmLabel(this._element);t!=null&&t!==""?this._alarmAttachment||(this._alarmAttachment=new n.vector.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(e){e?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._label2Attachment&&this._label2Attachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._label2Attachment&&this._label2Attachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),n.vector.Attachment=function(e,t){this._ui=e,this._element=this._ui.getElement(),this._network=e.getNetwork(),this._showOnTop=t,t&&this._network._hitTestTopAttachmentList.add(this)},r.ext("twaver.vector.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(e){this._showOnTop=e},getStyle:function(e){return this._ui.getStyle(e)},getFont:function(e){return this._ui.getFont(e)},getViewRect:function(){return r.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(e){},getZoomViewRect:function(){var e=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._viewRect);return e},hit:function(e,t){return m.containsPoint(this.getZoomViewRect(),e,t)?this.hitCanvasRect({x:e-1,y:t-1,width:2,height:2}):!1},hitCanvasRect:function(e){var t=rs.getHitCanvas(e.width,e.height),n=rs.getCtx(t);n.save(),n.translate(-e.x,-e.y),this.paint(n);try{var r=n.getImageData(0,0,e.width,e.height),i=r.data;for(var s=0;s<r.width;s++)for(var o=0;o<r.height;o++){var u=4*(o*r.width+s),a=i[u+3];if(a!==0)return n.restore(),!0}}catch(f){rs.disposeHitCanvas()}return n.restore(),!1},dispose:function(){this._network._hitTestTopAttachmentList.remove(this)},_rotatePoint:function(e,t,n){var r=m.createMatrix(t*Math.PI/180,n.x+n.width/2,n.y+n.height/2),i=r.transform(e);return i},_rotatePointList:function(e,t,r){var i=this,s=new n.List;return e.forEach(function(e){s.add(i._rotatePoint(e,t,r))}),s}}),n.vector.BasicAttachment=function(e,t){n.vector.BasicAttachment.superClass.constructor.call(this,e,t),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},r.ext("twaver.vector.BasicAttachment",n.vector.Attachment,{paint:function(e){n.vector.BasicAttachment.superClass.paint.apply(this,arguments);var t=this.isFill(),r=this.getOutlineWidth(),i=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._roundRect);this.getElementUI().setGlow(this,e),this.getElementUI().setShadow(this,e);if(r>0||t){w.drawRoundRect(e,i.x,i.y,i.width,i.height,this.getCornerRadius()),this._network._debug&&w.strokeRect(e,i,"#C71585");if(this._pointers){var s=this._ui.getZoomPointers(this,this._pointers);e.moveTo(s[0].x,s[0].y),e.lineTo(s[1].x,s[1].y),e.lineTo(s[2].x,s[2].y)}e.closePath(),r>0&&(e.lineWidth=r,e.strokeStyle=this.getOutlineColor(),e.lineCap=this.getCap(),e.lineJoin=this.getJoin(),e.stroke());if(t){var o=this.getFillColor(),u=this.getGradient();u?w.fill(e,o,u,this.getGradientColor(),this._viewRect):e.fillStyle=o,e.fill()}}},validate:function(){n.vector.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var e=this.getOutlineWidth();if(e==null||e<=0)e=1;this._viewRect=m.getRect(this._pointers),this._viewRect=m.unionRect(this._viewRect,this._roundRect),e>0&&m.grow(this._viewRect,e*2,e*2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect);var t=this._element instanceof n.Link&&this._element.getStyle("link.label.rotatable");if(t){var r=this._viewRect.x+this._viewRect.width/2,i=this._viewRect.y+this._viewRect.height/2,s=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:r-s,y:i-s,width:s*2,height:s*2}}},calculateMeasure:function(){var e=this.getContentWidth(),t=this.getContentHeight(),r=this.getCornerRadius(),i=this.getPointerLength(),s=this.getPointerWidth(),o=this.getPosition(),u=this.getXOffset(),a=this.getYOffset(),f=this._roundRect;f.width=e+r,f.height=t;var l;if(this._ui._element instanceof n.Link){var c=this._ui.getLinkPoints(),h;this._ui.getLineLength?h=this._ui.getLineLength():h=this._ui._element.getLineLength(),Math.abs(u)>0&&Math.abs(u)<1?o==="from"?u*=h:o==="to"?u=h*(1-u):(u/=2,u+=.5,u*=h):o==="from"?u=u:o==="to"?u=h-u:u+=h/2;var p=m.calculatePointInfoAlongLine(c,!0,u,a),d=p.point,v=p.angle,g;o==="from"?g=this._ui.getFromPoint():o==="to"?g=this._ui.getToPoint():g=this._ui._hotSpot,u=d.x-g.x,a=d.y-g.y}if(i>0){var y=this.getDirection();l=this._network.getPosition(o,this._ui,null,u,a,!1);var b;if(y==="aboveleft")f.y=l.y-i-f.height,f.x=l.x-(f.width-r),b=Math.max(l.x-s,l.x-(f.width-r)+r/2),this._pointers=[l,{x:l.x,y:l.y-i},{x:b,y:l.y-i}];else if(y==="aboveright")f.y=l.y-i-f.height,f.x=l.x-r,b=Math.min(l.x+s,l.x-r+f.width-r/2),this._pointers=[l,{x:l.x,y:l.y-i},{x:b,y:l.y-i}];else if(y==="belowleft")f.y=l.y+i,f.x=l.x-(f.width-r),b=Math.max(l.x-s,l.x-(f.width-r)+r/2),this._pointers=[l,{x:l.x,y:l.y+i},{x:b,y:l.y+i}];else if(y==="belowright")f.y=l.y+i,f.x=l.x-r,b=Math.min(l.x+s,l.x-r+f.width-r/2),this._pointers=[l,{x:l.x,y:l.y+i},{x:b,y:l.y+i}];else if(y==="leftabove")f.y=l.y+r-f.height,f.x=l.x-i-f.width,b=Math.max(l.y-s,l.y+r-f.height+r/2),this._pointers=[l,{x:l.x-i,y:l.y},{x:l.x-i,y:b}];else if(y==="leftbelow")f.y=l.y-r,f.x=l.x-i-f.width,b=Math.min(l.y+s,l.y-r+f.height-r/2),this._pointers=[l,{x:l.x-i,y:l.y},{x:l.x-i,y:b}];else if(y==="rightabove")f.y=l.y+r-f.height,f.x=l.x+i,b=Math.max(l.y-s,l.y+r-f.height+r/2),this._pointers=[l,{x:l.x+i,y:l.y},{x:l.x+i,y:b}];else if(y==="rightbelow")f.y=l.y-r,f.x=l.x+i,b=Math.min(l.y+s,l.y-r+f.height-r/2),this._pointers=[l,{x:l.x+i,y:l.y},{x:l.x+i,y:b}];else if(y==="above")f.y=l.y-i-f.height,f.x=l.x-f.width/2,b=Math.min(e/2,s/2),this._pointers=[l,{x:l.x-b,y:l.y-i},{x:l.x+b,y:l.y-i}];else if(y==="below")f.y=l.y+i,f.x=l.x-f.width/2,b=Math.min(e/2,s/2),this._pointers=[l,{x:l.x-b,y:l.y+i},{x:l.x+b,y:l.y+i}];else if(y==="left")f.y=l.y-f.height/2,f.x=l.x-i-f.width,b=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-i,y:l.y+b},{x:l.x-i,y:l.y-b}];else{if(y!=="right")throw"Can not resolve '"+y+"' attachment direction";f.y=l.y-f.height/2,f.x=l.x+i,b=Math.min(t/2,s/2),this._pointers=[l,{x:l.x+i,y:l.y+b},{x:l.x+i,y:l.y-b}]}}else l=this._network.getPosition(o,this._ui,{width:f.width,height:f.height},u,a,!1),f.x=l.x,f.y=l.y,this._pointers=null;this._contentRect.x=f.x+(f.width-e)/2,this._contentRect.y=f.y+(f.height-
t)/2,this._contentRect.width=e,this._contentRect.height=t;var w=this.getPadding();w!=0&&m.grow(f,w,w),w=this.getPaddingLeft(),w!=0&&(f.x-=w,f.width+=w),w=this.getPaddingRight(),w!=0&&(f.width+=w),w=this.getPaddingTop(),w!=0&&(f.y-=w,f.height+=w),w=this.getPaddingBottom(),w!=0&&(f.height+=w),f.width<0&&(f.width=f.width,f.x-=f.width),f.height<0&&(f.height=-f.height,f.y-=f.height)},getContentWidth:function(){return n.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return n.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return n.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return n.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return n.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return n.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return n.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return n.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return n.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return n.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return n.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return n.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return n.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return n.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return n.Defaults.ATTACHMENT_FILL},getFillColor:function(){return n.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return n.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return n.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return n.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return n.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return n.Defaults.ATTACHMENT_CAP},getJoin:function(){return n.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return n.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return r.clone(this._roundRect)},getContentRect:function(){return r.clone(this._contentRect)}}),n.vector.LabelAttachment=function(e,t){n.vector.LabelAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.LabelAttachment",n.vector.BasicAttachment,{paint:function(e){var t=this._element instanceof n.Link&&this._element.getStyle("link.label.rotatable");if(t){e.save();var r=this.getZoomViewRect(),i=r.x+r.width/2,s=r.y+r.height/2;e.translate(i,s),e.rotate(this._network.getElementUI(this._element).getAngle()),e.translate(-i,-s)}n.vector.LabelAttachment.superClass.paint.apply(this,arguments);var o=this._network.zoomManager,u=o._getAttachmentZoomRect(this,this._contentRect),a=this._element.getStyle("label.align"),f=this._element&&this._element.getStyle("label.rotate.angle");f!==0&&(e.save(),n.Util.rotateCanvas(e,this._contentRect,f)),o._drawText(this,e,this.text,u,this.font,this.getStyle("label.color"),a),(t||f!==0)&&e.restore();if(this._network._debug){var l=this._viewRect;w.strokeRect(e,l,"#AAABBB")}},validate:function(){this.font=this.getFont("label.font");var e=this.getLabel(),t=r.g.getTextSize(this.font,e),i=this.getMaxLength();i!==0&&t.width>i?(this.text=r.g.getCollapseTextInLength(this.font,e,i),this._textSize=r.g.getTextSize(this.font,this.text)):(this.text=e,this._textSize=t),n.vector.LabelAttachment.superClass.validate.call(this);var s=this._viewRect,o=this._element&&this._element.getStyle("label.rotate.angle");if(o!==0){var u=new n.List;u.add({x:s.x,y:s.y}),u.add({x:s.x+s.width,y:s.y}),u.add({x:s.x+s.width,y:s.y+s.height}),u.add({x:s.x,y:s.y+s.height}),u=this._rotatePointList(u,o,s);var a=n.Util.getRect(u);this._viewRect=a}},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),n.vector.Label2Attachment=function(e,t){n.vector.Label2Attachment.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.Label2Attachment",n.vector.BasicAttachment,{paint:function(e){var t=this._element instanceof n.Link&&this._element.getStyle("link.label.rotatable");if(t){e.save();var r=this.getZoomViewRect(),i=r.x+r.width/2,s=r.y+r.height/2;e.translate(i,s),e.rotate(this._network.getElementUI(this._element).getAngle()),e.translate(-i,-s)}n.vector.Label2Attachment.superClass.paint.apply(this,arguments);var o=this._network.zoomManager,u=o._getAttachmentZoomRect(this,this._contentRect),a=this._element.getStyle("label.align"),f=this._element&&this._element.getStyle("label2.rotate.angle");f!==0&&(e.save(),n.Util.rotateCanvas(e,this._contentRect,f)),o._drawText(this,e,this.text,u,this.font,this.getStyle("label2.color"),a),(t||f!==0)&&e.restore();if(this._network._debug){var l=o.getAttachmentSizeZoom(this),c=u;c.width*=l,c.height*=l,w.strokeRect(e,c,"#AAABBB")}},validate:function(){this.font=this.getFont("label2.font");var e=this.getLabel(),t=r.g.getTextSize(this.font,e),i=this.getMaxLength();i!==0&&t.width>i?(this.text=r.g.getCollapseTextInLength(this.font,e,i),this._textSize=r.g.getTextSize(this.font,this.text)):(this.text=e,this._textSize=t),n.vector.LabelAttachment.superClass.validate.call(this);var s=this._viewRect,o=this._element&&this._element.getStyle("label2.rotate.angle");if(o!==0){var u=new n.List;u.add({x:s.x,y:s.y}),u.add({x:s.x+s.width,y:s.y}),u.add({x:s.x+s.width,y:s.y+s.height}),u.add({x:s.x,y:s.y+s.height}),u=this._rotatePointList(u,o,s);var a=n.Util.getRect(u);this._viewRect=a}},getLabel:function(){return this._network.getLabel2(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},getMaxLength:function(){return this.getStyle("label2.maxlength")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),n.vector.AlarmAttachment=function(e,t){n.vector.AlarmAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.AlarmAttachment",n.vector.BasicAttachment,{paint:function(e){n.vector.AlarmAttachment.superClass.paint.apply(this,arguments);var t=this._network.zoomManager,r=t._getAttachmentZoomRect(this,this._contentRect);t._drawText(this,e,this.text,r,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=w.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),n.vector.AlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return this._fillColor!=null},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),n.vector.LinkHandlerAttachment=function(e,t){n.vector.LinkHandlerAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.LinkHandlerAttachment",n.vector.BasicAttachment,{paint:function(e){var t=this._network.zoomManager;n.vector.LinkHandlerAttachment.superClass.paint.apply(this,arguments);var r=t._getAttachmentZoomRect(this,this._contentRect);t._drawText(this,e,this.linkHandlerLabel,r,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=w.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),n.vector.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),n.vector.IconsAttachment=function(e,t){n.vector.IconsAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.IconsAttachment",n.vector.Attachment,{isShadowable:function(){return n.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){n.vector.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element);if(!this.iconsNames||this.iconsNames.length==0)return;var e=this._makeGroup(this.iconsNames),t=this._makeGroup(this._network.getIconsColors(this._element)),r=this._network.zoomManager;len=e.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[],this.iconsOrientations=[];var s,o,u;for(i=0;i<len;i++){var a=e[i],u=this.iconsOrientation[i]||"right",f=this.iconsPosition[i]||"topleft.bottomright",l=this.iconsXgap[i]||1,c=this.iconsYgap[i]||1,h=this.iconsXoffset[i]||0,p=this.iconsYoffset[i]||0;if(this._ui._element instanceof n.Link){var d=this._ui.getLinkPoints(),v;this._ui.getLineLength?v=this._ui.getLineLength():v=this._ui._element.getLineLength(),Math.abs(h)>0&&Math.abs(h)<1?f==="from"?h*=v:f==="to"?h=v*(1-h):(h/=2,h+=.5,h*=v):f==="from"?h=h:f==="to"?h=v-h:h+=v/2;var g=m.calculatePointInfoAlongLine(d,!0,h,p),y=g.point,b=g.angle,w;f==="from"?w=this._ui.getFromPoint():f==="to"?w=this._ui.getToPoint():w=this._ui._hotSpot,h=y.x-w.x,p=y.y-w.y}o=null,s=this._getIconsSize(a,u,l,c,r),s&&(o=this._network.getPosition(f,this._ui,s,h,p),this._iconLocation=o,u==="top"?o.y+=s.height:u==="left"&&(o.x+=s.width)),this.locations.push(o),this.iconsSizes.push(s),this.iconsOrientations.push(u)}var E=null;for(i=0;i<this.locations.length;i++){o=this.locations[i],s=this.iconsSizes[i],u=this.iconsOrientations[i];if(o==null)continue;E==null?u==="top"?E={x:o.x,y:o.y-s.height,width:s.width,height:s.height}:u==="left"?E={x:o.x-s.width,y:o.y,width:s.width,height:s.height}:E={x:o.x,y:o.y,width:s.width,height:s.height}:u==="top"?E=m.unionRect(E,{x:o.x,y:o.y-s.height,width:s.width,height:s.height}):u==="left"?E=m.unionRect(E,{x:o.x-s.width,y:o.y,width:s.width,height:s.height}):E=m.unionRect(E,{x:o.x,y:o.y,width:s.width,height:s.height})}r?this._viewRect=E||this.getElementUI().getViewRect():this._viewRect=E||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=e,this.colorGroups=t;var S=this._element instanceof n.Link&&this._element.getStyle("link.icons.rotatable");for(i=0;i<len;i++)if(S instanceof Array&&S[i]&&this._viewRect){var x=this._viewRect.x+this._viewRect.width/2,T=this._viewRect.y+this._viewRect.height/2,N=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:x-N/2,y:T-N/2,width:N,height:N}}},_makeGroup:function(e){if(!Array.isArray(e))return[[e]];var t=[],n=!1,r,i=e.length,s,o;for(r=0;r<i;r++)s=e[r],Array.isArray(s)?(n=!0,t.push(s)):(o=[s],t.push(o));return n||(t.length=0,t.push(e)),t},_makeArray:function(e,t,n){if(Array.isArray(e))return e;var r=[];for(var i=0;i<t;i++)r.push(e||n);return r},paint:function(e){n.vector.IconsAttachment.superClass.paint.apply(this,arguments);if(!this.iconsNames||this.iconsNames.length==0||!this.locations)return;var t=this._network.zoomManager,i,s,o,u,a,f,l,c,h,p;for(i=0;i<this.iconsGroups.length;i++){s=this.locations[i];if(!s)continue;a=s.x,f=s.y,u=this.iconsGroups[i],l=this.colorGroups[i],c=this.iconsOrientation[i],h=this.iconsXgap[i]||1,p=this.iconsYgap[i]||1,o=0;for(var d in u){var v=null,m=null;l&&l.length>o&&(m=l[o++]);var g=r.getImageAsset(u[d]);if(g==null)continue;if(t&&this._ui instanceof n.vector.GroupUI&&this._ui._shapeRect){var y=t.getAttachmentSizeZoom(this),b=g.getWidth()*y,E=g.getHeight()*y;if(c==="right")v={x:a,y:f,width:b,height:E},a+=v.width+h;else if(c==="left")v={x:a-b,y:f,width:b,height:E},a-=v.width+h;else if(c==="top")v={x:a,y:f-E,width:b,height:E},f-=v.height+p;else{if(c!=="bottom")throw"Can not resolve '"+c+"' orientation";v={x:a,y:f,width:b,height:E},f+=v.height+p}}else{if(c==="right")v={x:a,y:f,width:g.getWidth(),height:g.getHeight()},a+=v.width+h;else if(c==="left")v={x:a-g.getWidth(),y:f,width:g.getWidth(),height:g.getHeight()},a-=v.width+h;else if(c==="top")v={x:a,y:f-g.getHeight(),width:g.getWidth(),height:g.getHeight()},f-=v.height+p;else{if(c!=="bottom")throw"Can not resolve '"+c+"' orientation";v={x:a,y:f,width:g.getWidth(),height:g.getHeight()},f+=v.height+p}v=t._getAttachmentZoomOutLineRect(this,v)}var S=this._element instanceof n.Link&&this._element.getStyle("link.icons.rotatable");if(S instanceof Array&&S[i]){e.save();var x=v,a=x.x+x.width/2,f=x.y+x.height/2;e.translate(a,f),e.rotate(this._network.getElementUI(this._element).getAbsoluteAngle()),e.translate(-a,-f),Rr(e,g.getImage(m,v.width,v.height),m,v,this._element,this._network),e.restore()}else Rr(e,g.getImage(m,v.width,v.height),m,v,this._element,this._network);if(this._network._debug){var v=this._viewRect;w.strokeRect(e,v,"#FCFC00",1),w.strokeRect(e,v,"#FCFC00",1)}}}},_getIconsSize:function(e,t,i,s,o){var u=0,a=0,f=null,l=null,c=null;for(var h in e){l=r.getImageAsset(e[h]);if(!l)continue;if(t==="right")f={x:u,y:a,width:l.getWidth(),height:l.getHeight()},u+=f.width+i;else if(t==="left")f={x:u-l.getWidth(),y:a,width:l.getWidth(),height:l.getHeight()},u-=f.width+i;else if(t==="top")f={x:u,y:a-l.getHeight(),width:l.getWidth(),height:l.getHeight()},a-=f.height+s;else{if(t!=="bottom")throw"Can not resolve '"+t+"' orientation";f={x:u,y:a,width:l.getWidth(),height:l.getHeight()},a+=f.height+s}c==null?c=r.clone(f):c=m.unionRect(c,f)}return c?o&&this._ui instanceof n.vector.GroupUI&&this._ui._shapeRect?{width:Math.abs(c.width)*o.getAttachmentSizeZoom(this),height:Math.abs(c.height)*o.getAttachmentSizeZoom(this)}:{width:Math.abs(c.width),height:Math.abs(c.height)}:null}}),n.vector.EditAttachment=function(e,t){n.vector.EditAttachment.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.EditAttachment",n.vector.Attachment,{paint:function(e){n.vector.EditAttachment.superClass.paint.apply(this,arguments),this.paintResizingPoints(e),this.paintEditPoints(e),this.paintRotatePoints(e)},paintResizingPoints:function(e){var t=this.resizingPoints.size();if(t<=0)return;var r=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),i=this.resizePointSize/r,s=i*2,o=i*2,u=this._network.getResizePointFillColor(),a=this._network.getResizePointOutlineWidth()/r,f=this._network.getResizePointOutlineColor(),l=this._element.getAngle(),c=this._network.zoomManager,h=c._getElementZoomRect(this.getElementUI(),this._element.getOriginalRect());e.lineWidth=a;var p=this.resizingPoints;for(var d=0;d<t;d++){var v=p.get(d),m={x:v.x-i,y:v.y-i,width:i*2,height:i*2},g=this._getRotateRect(m,l,{x:h.x+h.width/2,y:h.y+h.height/2});e.save(),n.Util.rotateCanvas(e,g,l),rs.rect(e,g.x,g.y,s,o),e.restore()}e.fillStyle=u,e.strokeStyle=f,e.fill(),e.stroke();if(this._network._debug){var y=this.getViewRect("resize");w.strokeRect(e,y,"#CCDDCC");var y=c._getElementZoomRect(this.getElementUI(),this.getElementUI()._viewRect);w.strokeRect(e,y,"#FD7766")}},paintEditPoints:function(e){var t=this.editPoints.size();if(t<=0)return;var n=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),r=this._network.getEditPointOutlineColor(),i=this._network.getEditPointFillColor(),s=this._network.getEditPointOutlineWidth()/n;e.beginPath(),e.lineWidth=s;var o=this.editPoints;for(var u=0;u<t;u++){var a=o.get(u);e.beginPath(),rs.circle(e,a.x,a.y,this.editPointSize,i,r),e.closePath()}if(this._network._debug){var f=this.getViewRect("edit");w.strokeRect(e,f,"#AAABBC")}},paintRotatePoints:function(e){var t=this.rotatePoints.size();if(t<=0)return;var n=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),r=this._network.getRotatePointOutlineColor(),i=this._network.getRotatePointFillColor(),s=this._network.getRotatePointOutlineWidth()/n;e.beginPath(),e.lineWidth=s;var o=this.rotatePoints;for(var u=0;u<t;u++){var a=o.get(u);e.beginPath(),rs.circle(e,a.x,a.y,this.rotatePointSize/n,i,r),e.closePath(),e.beginPath()}if(this._network._debug){var f=this.getViewRect("rotate");w.strokeRect(e,f,"green")}},getViewRect:function(e){if(e){if(e==="resize")return this._resizeRect;if(e==="rotate")return this._rotateRect;if(e==="edit")return this._editRect}return this._viewRect||{x:0,y:0,width:0,height:0}},validate:function(){n.vector.EditAttachment.superClass.validate.call(this);var e=this._network.getGraphicsZoom();this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new n.List,this.editPoints=new n.List,this.rotatePoints=new n.List,this._element instanceof n.Node&&this._addResizingPoint(this._element),this._network.isRotatable(this._element)&&this._element instanceof es&&!(this._element instanceof n.ShapeNode)&&!(this._element instanceof n.Grid)&&!(this._element instanceof n.Group)&&this._addRotatePoint(this._element),this._element instanceof n.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof n.vector.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof n.vector.LinkUI&&this._addLinkControlPoint(this._ui);var t=this._network.getResizePointOutlineWidth()/e,r=this.getElementUI().getZoomBodyRect(),i=2*Math.sqrt(2);this._resizeOffset=(this.resizePointSize+t+1)*i,m.grow(r,this._resizeOffset,this._resizeOffset),this._resizeRect=r,t=this._network.getEditPointOutlineWidth()/e;if(this.editPoints.size()>0){var s=m.getRect(this.editPoints);m.grow(s,this.editPointSize*2+t*2),r=m.unionRect(r,s)}this._editRect=s,t=this._network.getRotatePointOutlineWidth()/e;var o=this.rotatePointSize;if(this.rotatePoints.size()>0){var u=this.rotatePoints.get(0),a={x:u.x-o-t-1,y:u.y-o-t-1,width:o*2+t*2+2,height:o*2+t*2+2};r=m.unionRect(r,a),this._rotateRect=a}this._viewRect=r},_addResizingPoint:function(e){var t=this._network.zoomManager._getElementZoomRect(this.getElementUI(),e.getOriginalRect());if(!t)return;var n=this._network.getResizePointSize();if(n<=0)return;var r=new Oi([{x:t.x,y:t.y},{x:t.x+t.width/2,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x,y:t.y+t.height/2},{x:t.x+t.width,y:t.y+t.height/2},{x:t.x,y:t.y+t.height},{x:t.x+t.width/2,y:t.y+t.height},{x:t.x+t.width,y:t.y+t.height}]),i=this._network.getResizePointOutlineWidth(),s=this._network.getResizePointOutlineColor(),o=this._network.getResizePointFillColor();this._addPoints(e.getRect(),r,i,s,o,!0)},_addRotatePoint:function(e){var t=this._network.zoomManager._getElementZoomRect(this.getElementUI(),e.getOriginalRect());if(!t)return;var r=this._network.getRotatePointSize()/this._network.getGraphicsZoom();if(r<=0)return;var i=r*2,s=new n.List([{x:t.x+t.width/2,y:t.y-this._network.getRotatePointOffset()/this._network.getGraphicsZoom()-r}]),o=e.getAngle();o!=0&&(s=this._rotatePointList(s,o,t));var u=s.get(0),a={x:u.x-i/2,y:u.y-i/2,width:i,height:i},f=this._network.getRotatePointOutlineWidth(),l=this.rotatePointSize+f;m.grow(t,l,l);var c=m.unionRect(e.getRect(),a);this.rotatePoints=s},_addShapeNodePoint:function(e){var t=this._network.zoomManager._getShapeNodeZoomPoints(this.getElementUI(),e.getPoints());this._addEditPoints(t)},_addShapeLinkPoints:function(e){var t=this._network.zoomManager._getShapeLinkZoomPoints(e.getPoints());this._addEditPoints(t)},_addLinkControlPoint:function(e){var t=new n.List,r=e._element.getFromAgent(),i;r?i=e._element.getFromAgent():i=e._element.getFromNode();var s=e._element.getStyle("link.from.xoffset"),o=e._element.getStyle("link.from.yoffset"),u=this._network.getElementUI(i),a=u.getZoomBodyRect(),f={x:a.x+a.width/2,y:a.y+a.height/2},l={x:f.x+s,y:f.y+o};t.add(l);var c=e._element.getToAgent(),h;c?h=e._element.getToAgent():h=e._element.getToNode();var p=e._element.getStyle("link.to.xoffset"),d=e._element.getStyle("link.to.yoffset"),v=this._network.getElementUI(h),m=v.getZoomBodyRect(),g={x:m.x+m.width/2,y:m.y+m.height/2},y={x:g.x+p,y:g.y+d};t.add(y);if(Nr.isOrthogonalLink(e._element)&&e.getControlPoint()){var b=e.getControlPoint();b&&t.add(b)}var w=this.editPoints.size();if(w>0)for(var E=0;E<w;E++)t.add(this.editPoints.get(E));this._addEditPoints(t)},_addEditPoints:function(e){var t=m.getRect(e);if(!t)return;var n=this._network.getEditPointSize();if(n<=0)return;var r=this._network.getEditPointOutlineWidth();this._addPoints(t,e,r,!1)},_addPoints:function(e,t,n,r,i,s){var o=s?this._network.getResizePointSize():this._network.getEditPointSize();if(o<0)return;var u=o+n;m.grow(e,u,u),s==1?this.resizingPoints=t:this.editPoints=t},_rotatePoint:function(e,t,n){var r=m.createMatrix(t*Math.PI/180,n.x+n.width/2,n.y+n.height/2),i=r.transform(e);return i},_rotatePointList:function(e,t,r){var i=this,s=new n.List;return e.forEach(function(e){s.add(i._rotatePoint(e,t,r))}),s},_getRotateRect:function(e,t,r){var i=m.createMatrix(t*Math.PI/180,r.x,r.y),s={x:e.x+e.width/2,y:e.y+e.height/2},o=i.transform(s),u=new n.List([{x:o.x-e.width/2,y:o.y-e.height/2},{x:o.x+e.width/2,y:o.y-e.height/2},{x:o.x+e.width/2,y:o.y+e.height/2},{x:o.x-e.width/2,y:o.y+e.height/2}]);return m.getRect(u)}}),n.vector.HTMLLabelAttachment=function(e,t){n.vector.HTMLLabelAttachment.superClass.constructor.call(this,e,t),this._triangleDiv=n.Util.createDiv(),this._roundDiv=n.Util.createDiv(),this._contentDiv=n.Util.createDiv();var r=this;this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},r.ext("twaver.vector.HTMLLabelAttachment",n.vector.LabelAttachment,{validate:function(){this.validateZIndex(0);var t=this._element.getStyle("attachment.htmllabel.hyperlink");t?(n.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),n.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(n.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),n.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),n.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),n.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var r=this.getFont("label.font"),i=this.getLabel();i!==this.text&&(this.text&&(typeof this.text=="object"?e.jquery?e.jquery(this.text).remove():this._contentDiv.removeChild(this.text):this._contentDiv.innerHTML=""),i&&(typeof i=="object"?e.jquery?e.jquery(this._contentDiv).append(i):this._contentDiv.appendChild(i):this._contentDiv.innerHTML=i),this.text=i),this._contentDiv.style.visibility="hidden",n.vector.HTMLLabelAttachment.superClass.validate.call(this)},validateZIndex:function(e){this._roundDiv.style.zIndex=e*1e5+this._network.getElementBox().getDatas().indexOf(this._element)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(e){var t=this.isFill(),r=this.getOutlineWidth(),i=this._contentRect;this.getElementUI().setGlow(this,e),this.getElementUI().setShadow(this,e);if(r>0||t){w.drawRoundRect(e,i.x,i.y,i.width,i.height,this.getCornerRadius());if(this._pointers){var s=this._ui.getZoomPointers(this,this._pointers);e.moveTo(s[0].x,s[0].y),e.lineTo(s[1].x,s[1].y),e.lineTo(s[2].x,s[2].y)}e.closePath(),r>0&&(e.lineWidth=r,e.strokeStyle=this.getOutlineColor(),e.lineCap=this.getCap(),e.lineJoin=this.getJoin(),e.stroke());if(t){var o=this.getFillColor(),u=this.getGradient();u?w.fill(e,o,u,this.getGradientColor(),this._viewRect):e.fillStyle=o,e.fill()}}var a=this.getFont("label.font"),f=this.getLabel(),l=this._network.getViewRect().x,c=this._network.getViewRect().y,p=this._network.getZoom(),d={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},v=d.x*p-l-this._contentDiv.offsetWidth/2*p+"px",m=d.y*p-c-this._contentDiv.offsetHeight/2*p+"px";this._contentDiv.style.left=v,this._contentDiv.style.top=m,h.isFirefox?(n.Util.setCSSStyle(this._contentDiv,"-moz-transform","scale("+p+")"),n.Util.setCSSStyle(this._contentDiv,"-moz-transform-origin","0 0")):h.isOpera?(n.Util.setCSSStyle(this._contentDiv,"-o-transform","scale("+p+")"),n.Util.setCSSStyle(this._contentDiv,"-o-transform-origin","0 0")):h.isChrome||h.isSafari?(n.Util.setCSSStyle(this._contentDiv,"-webkit-transform","scale("+p+")"),n.Util.setCSSStyle(this._contentDiv,"-webkit-transform-origin","0 0")):h.isIE?(n.Util.setCSSStyle(this._contentDiv,"-ms-transform","scale("+p+")"),n.Util.setCSSStyle(this._contentDiv,"-ms-transform-origin","0 0")):(n.Util.setCSSStyle(this._contentDiv,"transform","scale("+p+")"),n.Util.setCSSStyle(this._contentDiv,"transform-origin","0 0")),this._network._debug&&(w.strokeRect(e,this._contentRect,"blue"),w.strokeRect(e,this._roundRect,"red"),w.strokeRect(e,this._viewRect,"green"));var g=this._element instanceof n.Link&&this._element.getStyle("link.label.rotatable");if(g){var y=this.getZoomViewRect(),b=y.x+y.width/2,E=y.y+y.height/2,S=this._network.getElementUI(this._element).getAbsoluteAngle()*180/Math.PI,x=this._contentDiv.offsetWidth/2*p,T=this._contentDiv.offsetHeight/2*p;h.isFirefox?n.Util.setCSSStyle(this._contentDiv,"-moz-transform","translate(0px,0px) rotate("+S+"deg) scale("+p+")"):h.isOpera?n.Util.setCSSStyle(this._contentDiv,"-o-transform","translate(0px,0px) rotate("+S+"deg) scale("+p+")"):h.isChrome||h.isSafari?n.Util.setCSSStyle(this._contentDiv,"-webkit-transform","translate(0px, 0px) rotate("+S+"deg) scale("+p+")"):h.isIE?n.Util.setCSSStyle(this._contentDiv,"-ms-transform","translate(0px,0px) rotate("+S+"deg) scale("+p+")"):n.Util.setCSSStyle(this._contentDiv,"transform","translate(0px,0px) rotate("+S+"deg) scale("+p+")")}},setVisibility:function(e){this._contentDiv.style.visibility=e},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),n.vector.HTMLLabel2Attachment=function(e,t){n.vector.HTMLLabel2Attachment.superClass.constructor.call(this,e,t),this._triangleDiv=n.Util.createDiv(),this._roundDiv=n.Util.createDiv(),this._contentDiv=n.Util.createDiv();var r=this;this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},r.ext("twaver.vector.HTMLLabel2Attachment",n.vector.LabelAttachment,{validate:function(){this.validateZIndex(0);var t=this._element.getStyle("attachment.htmllabel2.hyperlink");t?(n.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),n.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(n.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),n.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),n.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),n.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var r=this.getFont("label2.font"),i=this.getLabel();i!==this.text&&(this.text&&(typeof this.text=="object"?e.jquery?e.jquery(this.text).remove():this._contentDiv.removeChild
(this.text):this._contentDiv.innerHTML=""),i&&(typeof i=="object"?e.jquery?e.jquery(this._contentDiv).append(i):this._contentDiv.appendChild(i):this._contentDiv.innerHTML=i),this.text=i),this._contentDiv.style.visibility="hidden",n.vector.HTMLLabelAttachment.superClass.validate.call(this)},validateZIndex:function(e){this._roundDiv.style.zIndex=e*1e5+this._network.getElementBox().getDatas().indexOf(this._element)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(e){var t=this.isFill(),r=this.getOutlineWidth(),i=this._contentRect;this.getElementUI().setGlow(this,e),this.getElementUI().setShadow(this,e);if(r>0||t){w.drawRoundRect(e,i.x,i.y,i.width,i.height,this.getCornerRadius());if(this._pointers){var s=this._ui.getZoomPointers(this,this._pointers);e.moveTo(s[0].x,s[0].y),e.lineTo(s[1].x,s[1].y),e.lineTo(s[2].x,s[2].y)}e.closePath(),r>0&&(e.lineWidth=r,e.strokeStyle=this.getOutlineColor(),e.lineCap=this.getCap(),e.lineJoin=this.getJoin(),e.stroke());if(t){var o=this.getFillColor(),u=this.getGradient();u?w.fill(e,o,u,this.getGradientColor(),this._viewRect):e.fillStyle=o,e.fill()}}var a=this.getFont("label2.font"),f=this.getLabel(),l=this._network.getViewRect().x,c=this._network.getViewRect().y,p=this._network.getZoom(),d={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},v=d.x*p-l-this._contentDiv.offsetWidth/2*p+"px",m=d.y*p-c-this._contentDiv.offsetHeight/2*p+"px";this._contentDiv.style.left=v,this._contentDiv.style.top=m,this._contentDiv.style.setProperty("-webkit-transform","scale("+p+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&(w.strokeRect(e,this._contentRect,"blue"),w.strokeRect(e,this._roundRect,"red"),w.strokeRect(e,this._viewRect,"green"));var g=this._element instanceof n.Link&&this._element.getStyle("link.label2.rotatable");if(g){var y=this.getZoomViewRect(),b=y.x+y.width/2,E=y.y+y.height/2,S=this._network.getElementUI(this._element).getAbsoluteAngle()*180/Math.PI,x=this._contentDiv.offsetWidth/2*p,T=this._contentDiv.offsetHeight/2*p;h.isFirefox?n.Util.setCSSStyle(this._contentDiv,"-moz-transform","translate(0px,0px) rotate("+S+"deg) scale("+p+")"):h.isOpera?n.Util.setCSSStyle(this._contentDiv,"-o-transform","translate(0px,0px) rotate("+S+"deg) scale("+p+")"):h.isChrome||h.isSafari?n.Util.setCSSStyle(this._contentDiv,"-webkit-transform","translate(0px, 0px) rotate("+S+"deg) scale("+p+")"):h.isIE?n.Util.setCSSStyle(this._contentDiv,"-ms-transform","translate(0px,0px) rotate("+S+"deg) scale("+p+")"):n.Util.setCSSStyle(this._contentDiv,"transform","translate(0px,0px) rotate("+S+"deg) scale("+p+")")}},setVisibility:function(e){this._contentDiv.style.visibility=e},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv},getLabel:function(){return this._network.getLabel2(this._element)},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),n.vector.HTMLAlarmAttachment=function(e,t){n.vector.HTMLAlarmAttachment.superClass.constructor.call(this,e,t),this._triangleDiv=n.Util.createDiv(),this._roundDiv=n.Util.createDiv(),this._contentDiv=n.Util.createDiv(),n.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),n.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),n.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),n.Util.setCSSStyle(this._contentDiv,"pointer-events","none");var r=this;this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},r.ext("twaver.vector.HTMLAlarmAttachment",n.vector.AlarmAttachment,{validate:function(){var e=this.getFont("alarm.font"),t=this._network.getAlarmLabel(this._element);this._contentDiv.innerHTML=t,this._contentDiv.style.visibility="hidden",n.vector.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(n.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(e){var t=this.isFill(),r=this.getOutlineWidth(),i=this._contentRect;this.getElementUI().setShadow(this,e);if(r>0||t){w.drawRoundRect(e,i.x,i.y,i.width,i.height,this.getCornerRadius());if(this._pointers){var s=this._ui.getZoomPointers(this,this._pointers);e.moveTo(s[0].x,s[0].y),e.lineTo(s[1].x,s[1].y),e.lineTo(s[2].x,s[2].y)}e.closePath(),r>0&&(e.lineWidth=r,e.strokeStyle=this.getOutlineColor(),e.lineCap=this.getCap(),e.lineJoin=this.getJoin(),e.stroke());if(t){var o=this.getFillColor(),u=this.getGradient();u?w.fill(e,o,u,this.getGradientColor(),this._viewRect):e.fillStyle=o,e.fill()}}var a=this.getFont("alarm.font"),f=this._network.getAlarmLabel(this._element),l=this._network.getViewRect().x,c=this._network.getViewRect().y,h=this._network.getZoom(),p={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},d=p.x*h-l-this._contentDiv.offsetWidth/2*h+"px",v=p.y*h-c-this._contentDiv.offsetHeight/2*h+"px";this._contentDiv.style.left=d,this._contentDiv.style.top=v,this._contentDiv.style.setProperty("-webkit-transform","scale("+h+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&w.strokeRect(e,this._contentRect,"#DDDDDD"),n.vector.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(e){this._contentDiv.style.visibility=e},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),n.vector.BaseZoomManager=function(e){this.network=e,this.visibilityThresholds=e.visibilityThresholds},r.ext("twaver.vector.BaseZoomManager",Object,{getZoom:function(){return this.network.getZoom()},getGraphicsZoom:function(){return 1},getSizeZoom:function(e){return 1},getAttachmentSizeZoom:function(e){var t=e.getElementUI();return this.getSizeZoom(t)},getLocationZoom:function(e){return 1},_getZoomVisibilityThresholds:function(){return this.network.getZoomVisibilityThresholds()},_convertPointFromView:function(e){var t=e.x*this.getGraphicsZoom()-this.network.getViewRect().x,n=e.y*this.getGraphicsZoom()-this.network.getViewRect().y;return{x:t,y:n}},_getElementViewRect:function(e,t){var n=this.getLocationZoom(e),r=this.getSizeZoom(e);if(n==1&&r==1)return t;var i=this._getZoomPoint(e),s=i.x,o=i.y;return t==null&&console.log("View rect is null"),{x:s*n+(t.x-s)*r,y:o*n+(t.y-o)*r,width:t.width*r,height:t.height*r}},_invalidateZoom:function(){this.network.invalidateElementUIs()},_getGroupChildrenRects:function(e){var t=new Oi;return e.getChildren().forEach(function(e){if(e instanceof es){var n=this.network.getElementUI(e);if(n){var r=n.getZoomViewRect(this);r&&t.add(r)}}},this),t},_zoomGraphicsBegin:function(e){var t=this.network,n=this.getGraphicsZoom();e.scale(n,n),e.translate(-t.viewRect.x/n,-t.viewRect.y/n)},_getEditZoomPoints:function(e,t){var r=this.getLocationZoom(e),i=this.getSizeZoom(e);if(r==1&&i==1||e instanceof n.vector.LinkUI&&!(e instanceof n.vector.ShapeLinkUI))return t;var s;e instanceof n.vector.ShapeLinkUI?s=m.getCenterPoint(m.getRect(t)):s=this._getZoomPoint(e);var o=s.x,u=s.y;if(t.forEach){var a=new Oi,f;return t.forEach(function(e){e instanceof Oi?(f=new Oi,e.forEach(function(e){f.add({x:o*r+(e.x-o)*i,y:u*r+(e.y-u)*i})}),a.add(f)):a.add({x:o*r+(e.x-o)*i,y:u*r+(e.y-u)*i})}),a}if(t.x)return{x:o*r+(t.x-o)*i,y:u*r+(t.y-u)*i}},_getShapeNodeZoomPoints:function(e,t,n){var r=this.getLocationZoom(e),i=this.getSizeZoom(e);if(r==1&&i==1)return t;n&&(r=1/r,i=1/i);var s=m.getRect(t),o=s.x+s.width/2,u=s.y+s.height/2,a=new Oi,f;return t.forEach(function(e){e instanceof Oi?(f=new Oi,e.forEach(function(e){f.add({x:o*r+(e.x-o)*i,y:u*r+(e.y-u)*i})}),a.add(f)):a.add({x:o*r+(e.x-o)*i,y:u*r+(e.y-u)*i})}),a},_getShapeLinkZoomPoints:function(e,t){var n=this.getLocationZoom(),r=n;if(n==1&&r==1)return e;t&&(n=1/n,r=1/r);var i=m.getRect(e),s=i.x+i.width/2,o=i.y+i.height/2,u=new Oi,a;return e.forEach(function(e){e instanceof Oi?(a=new Oi,e.forEach(function(e){a.add({x:s*n+(e.x-s)*r,y:o*n+(e.y-o)*r})}),u.add(a)):u.add({x:s*n+(e.x-s)*r,y:o*n+(e.y-o)*r})}),u},_getLogicalPoint:function(e,t){var n=t?this.getZoom():this.getGraphicsZoom(),r,i=this.network;if(h.isTouchable&&e.changedTouches&&e.changedTouches.length>0){var s=i._view.getBoundingClientRect(),o=e.changedTouches[0],u=h.isAndroid?0:kr.scrollLeft(),a=h.isAndroid?0:kr.scrollTop();return r={x:(o.clientX+i.viewRect.x-s.left-u)/n,y:(o.clientY+i.viewRect.y-s.top-a)/n},r}return h.isFirefox?r={x:(e.layerX+i.viewRect.x)/n,y:(e.layerY+i.viewRect.y)/n}:r={x:(e.offsetX+i.viewRect.x)/n,y:(e.offsetY+i.viewRect.y)/n},r},_getVisibleRect:function(e){return e},_getElementZoomRect:function(e,t){var n=this.getLocationZoom(e),i=this.getSizeZoom(e);if(n==1&&i==1)return r.cloneRect(t);var s=e!=null?this._getZoomPoint(e):{x:t.x+t.width/2,y:t.y+t.height/2},o=s.x,u=s.y;return{x:o*n+(t.x-o)*i,y:u*n+(t.y-u)*i,width:t.width*i,height:t.height*i}},_reverseElementZoomRect:function(e,t){var n=this.getLocationZoom(e),i=this.getSizeZoom(e);if(n==1&&i==1)return r.cloneRect(t);var s=e!=null?this._getZoomPoint(e):{x:t.x+t.width/2,y:t.y+t.height/2},o=s.x,u=s.y;return{x:o+(t.x-o*n)/i,y:u+(t.y-u*n)/i,width:t.width/i,height:t.height/i}},_getZoomContentRect:function(e,r,i,s,o,u){var a=this.getSizeZoom(e.getElementUI()),f=this.getAttachmentSizeZoom(e),l=e.getElementUI();return u==t?l instanceof n.vector.GroupUI&&l._shapeRect?{x:s.x*o+(r.x-s.x)*1+(i.x-r.x)*f,y:s.y*o+(r.y-s.y)*1+(i.y-r.y)*f,width:i.width,height:i.height}:{x:s.x*o+(r.x-s.x)*a+(i.x-r.x)*f,y:s.y*o+(r.y-s.y)*a+(i.y-r.y)*f,width:i.width,height:i.height}:{x:s.x*o+(r.x-s.x)*a+(i.x-r.x)*f,y:s.y*o+(r.y-s.y)*a+(i.y-r.y)*f+u*(e.textHeight-4)*f,width:i.width,height:e.textHeight}},_getAttachmentZoomRect:function(e,r,i){var s=this.getLocationZoom(e.getElementUI()),o=e.getElementUI(),u=this.getSizeZoom(e.getElementUI()),a=this.getAttachmentSizeZoom(e),f=e._pointers;if(s==1&&a==1&&u==1)return i==t?r:{x:r.x,y:r.y+i*(e.textHeight-4),width:r.width,height:e.textHeight};var o=e.getElementUI(),l=this._getZoomPoint(o,e),c=l.x,h=l.y,p=e.getPosition?e.getPosition():"center",d=0,v=0,m=f?f[0]:os.get(p,r);return i==t?o instanceof n.vector.LinkUI||o instanceof n.vector.GroupUI&&o._shapeRect?this._getZoomContentRect(e,m,r,l,1):this._getZoomContentRect(e,m,r,l,s):this._getZoomContentRect(e,m,r,l,s,i)},_getZoomPoint:function(e,t){var r=e._element,i=0,s=0,o,u;if(r instanceof n.Follower&&r.getHost()&&r.getHost()instanceof n.Grid)return o=r.getHost(),u=o.getRect(),{x:u.x+u.width/2,y:u.y+u.height/2};u=e.getBodyRect();if(e instanceof n.vector.LinkUI&&t&&t.getPosition){var a=t.getXOffset(),f=t.getYOffset();if(t.getPosition()==="from")return e._fromPoint;if(t.getPosition()==="to")return e._toPoint}return{x:u.x+u.width/2,y:u.y+u.height/2}},_getZoomPointers:function(e,t,r){if(r){var i=this._getZoomPoint(t),s=this.getLocationZoom(t),o=this.getSizeZoom(t),u=this.getAttachmentSizeZoom(e),a=r[0];return t instanceof n.vector.LinkUI?[{x:i.x+(a.x-i.x)*o,y:i.y+(a.y-i.y)*o},{x:i.x+(a.x-i.x)*o+(r[1].x-a.x)*u,y:i.y+(a.y-i.y)*o+(r[1].y-a.y)*u},{x:i.x+(a.x-i.x)*o+(r[2].x-a.x)*u,y:i.y+(a.y-i.y)*o+(r[2].y-a.y)*u}]:t instanceof n.vector.GroupUI&&t._shapeRect?[{x:i.x+(a.x-i.x)*1,y:i.y+(a.y-i.y)*1},{x:i.x+(a.x-i.x)*1+(r[1].x-a.x)*u,y:i.y+(a.y-i.y)*1+(r[1].y-a.y)*u},{x:i.x+(a.x-i.x)*1+(r[2].x-a.x)*u,y:i.y+(a.y-i.y)*1+(r[2].y-a.y)*u}]:[{x:i.x*s+(a.x-i.x)*o,y:i.y*s+(a.y-i.y)*o},{x:i.x*s+(a.x-i.x)*o+(r[1].x-a.x)*u,y:i.y*s+(a.y-i.y)*o+(r[1].y-a.y)*u},{x:i.x*s+(a.x-i.x)*o+(r[2].x-a.x)*u,y:i.y*s+(a.y-i.y)*o+(r[2].y-a.y)*u}]}},_getZoomHotSpot:function(e,t){if(t){var n=this._getZoomPoint(e),r=this.getLocationZoom(e),i=this.getSizeZoom(e);return{x:n.x*r+(t.x-n.x)*i,y:n.y*r+(t.y-n.y)*i}}return null},limitZoom:function(e){return e},_isVisible:function(e){var t=this._getZoomVisibilityThresholds(),n=t[e],r;if(n!=null){var i=t.zoomName;i=="sizeZoom"?r=this.getSizeZoom():i=="locationZoom"?r=this.getLocationZoom():i=="graphicsZoom"?r=this.getGraphicsZoom():r=this.getZoom();if(r<n)return!1}return!0},isElementVisible:function(e){var t=this.getZoom(),r=this._isVisible("element",t);return r&&e instanceof n.Link?this.isLinkVisible(e):r},isLinkVisible:function(e){var t=this.getZoom();return this._isVisible("link",t)},isLabelVisible:function(e){var t=this.getZoom();return this._isVisible("label",t)},isAttachmentVisible:function(e){var t=this.getZoom();return this._isVisible("attachment",t)},isAlarmBalloonVisible:function(e){var t=this.getZoom();return this._isVisible("alarmBallon",t)},_getAttachmentOutLineWidth:function(e){return e.getOutlineWidth()},_getAttachmentZoomOutLineRect:function(e,t){var r=this.getLocationZoom(e.getElementUI()),i=this.getAttachmentSizeZoom(e);if(r==1&&i==1)return t;var s=this._getAttachmentZoomRect(e,t,null),o=e.getElement();return this.isAttachmentVisible(o)?(e instanceof n.vector.LabelAttachment||e instanceof n.vector.Label2Attachment)&&!this.isLabelVisible(o)?{x:s.x,y:s.x,width:0,height:0}:e instanceof n.vector.AlarmAttachment&&!this.isAlarmBalloonVisible(o)?{x:s.x,y:s.x,width:0,height:0}:{x:s.x,y:s.y,width:s.width*i,height:s.height*i}:{x:s.x,y:s.x,width:0,height:0}},_drawText:function(e,t,n,r,i,s,o){var u=this.getLocationZoom(e.getElementUI()),a=this.getAttachmentSizeZoom(e);u!=1&&a!=1?(t.translate(r.x,r.y),t.scale(a,a),w.drawText(t,n,{x:0,y:0,width:r.width,height:r.height},i,s,o),t.scale(1/a,1/a),t.translate(-r.x,-r.y)):w.drawText(t,n,r,i,s,o)},_getOffset:function(e,t){var n=this.getLocationZoom();return{x:(e.x-t.x)/n,y:(e.y-t.y)/n}}});var os={"topleft.topleft":function(e){return{x:e.x+e.width,y:e.y+e.height}},"topleft.topright":function(e){return{x:e.x,y:e.y+e.height}},"top.top":function(e){return{x:e.x+e.width/2,y:e.y+e.height}},"topright.topleft":function(e){return{x:e.x+e.width,y:e.y+e.height}},"topright.topright":function(e){return{x:e.x,y:e.y+e.height}},topleft:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},top:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},topright:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},"topleft.bottomleft":function(e){return{x:e.x+e.width,y:e.y}},"topleft.bottomright":function(e){return{x:e.x,y:e.y}},"top.bottom":function(e){return{x:e.x+e.width/2,y:e.y}},"topright.bottomleft":function(e){return{x:e.x+e.width,y:e.y}},"topright.bottomright":function(e){return{x:e.x,y:e.y}},"left.left":function(e){return{x:e.x+e.width,y:e.y+e.height/2}},left:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},"left.right":function(e){return{x:e.x,y:e.y+e.height/2}},center:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},"right.left":function(e){return{x:e.x+e.width,y:e.y+e.height/2}},right:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},"right.right":function(e){return{x:e.x,y:e.y+e.height/2}},"bottomleft.topleft":function(e){return{x:e.x+e.width,y:e.y+e.height}},"bottomleft.topright":function(e){return{x:e.x,y:e.y+e.height}},"bottom.top":function(e){return{x:e.x+e.width/2,y:e.y+e.height}},"bottomright.topleft":function(e){return{x:e.x+e.width,y:e.y+e.height}},"bottomright.topright":function(e){return{x:e.x,y:e.y+e.height}},bottomleft:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},bottom:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},bottomright:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},"bottomleft.bottomleft":function(e){return{x:e.x+e.width,y:e.y}},"bottomleft.bottomright":function(e){return{x:e.x,y:e.y}},"bottom.bottom":function(e){return{x:e.x+e.width/2,y:e.y}},"bottomright.bottomleft":function(e){return{x:e.x+e.width,y:e.y}},"bottomright.bottomright":function(e){return{x:e.x,y:e.y}},from:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},to:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},get:function(e,t){if(!t)throw"rect can not be null";var n=os[e];if(n)return n(t);throw"Can not resolve '"+e+"' position"}};n.vector.PhysicalZoomManager=function(e){n.vector.PhysicalZoomManager.superClass.constructor.apply(this,arguments)},r.ext("twaver.vector.PhysicalZoomManager",n.vector.BaseZoomManager,{getGraphicsZoom:function(){return this.getZoom()},_invalidateZoom:function(){}}),n.vector.LogicalZoomManager=function(e,t){n.vector.LogicalZoomManager.superClass.constructor.apply(this,arguments),this.sizeChange=t},r.ext("twaver.vector.LogicalZoomManager",n.vector.BaseZoomManager,{getLocationZoom:function(e){return this.getZoom()},getSizeZoom:function(e){return this.sizeChange?this.getZoom():1}}),n.vector.MixedZoomManager=function(e,t){n.vector.MixedZoomManager.superClass.constructor.call(this,e,t)},r.ext("twaver.vector.MixedZoomManager",n.vector.LogicalZoomManager,{}),function(){function o(e){i[e]=function(){return this.getZoom()>1?t[e].apply(this,arguments):r[e].apply(this,arguments)}}var t=n.vector.LogicalZoomManager.prototype,r=n.vector.PhysicalZoomManager.prototype,i=n.vector.MixedZoomManager.prototype;for(var s in r)typeof r[s]=="function"&&s!="constructor"&&(t.hasOwnProperty(s)||r.hasOwnProperty(s))&&o(s);i._invalidateZoom=function(){this.network.invalidateElementUIs()}}(),n.vector.interaction.BaseInteraction=function(e){this.network=e},r.ext("twaver.vector.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},getOffset:function(e,t){return this.network.getOffset(e,t)},convertPointFromView:function(e){return this.network.convertPointFromView(e)},convertFromUIToMarkerRect:function(e,t,n,r){var i=this.network.zoomManager,s=i.getLocationZoom(),o=i.getGraphicsZoom(),u=i.getSizeZoom(this.network.getElementUI(r));return{x:e.x*s*o-this.network.getViewRect().x+t*s*o,y:e.y*s*o-this.network.getViewRect().y+n*s*o,width:e.width*u*o,height:e.height*u*o}},getMarkerPoint:function(e){var t;if(h.isTouchable&&e.changedTouches&&e.changedTouches.length>0){var n=e.changedTouches[0];return t={x:n.clientX,y:n.clientY},t}return h.isFirefox?t={x:e.layerX,y:e.layerY}:t={x:e.offsetX,y:e.offsetY},t},paint:function(e){},addListener:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];b.addEventListener(t,"handle_"+t,this.network.getView(),this)}},removeListener:function(){for(var e=0;e<arguments.length;e++)b.removeEventListener(arguments[e],this.network.getView(),this)},_handle_mousedown:function(e){if(e.button!==0)return;this._startLogical=this.network.getLogicalPoint2(e),this._startClient=b.getClientPoint(e),this._startLogical&&b.handle_mousedown(this,e)},_handle_mousemove:function(e){this._endLogical={x:this._startLogical.x+(e.clientX-this._startClient.x)/this.network.getGraphicsZoom(),y:this._startLogical.y+(e.clientY-this._startClient.y)/this.network.getGraphicsZoom()}},_handle_mouseup:function(e){delete this._startClient,delete this._startLogical,delete this._endLogical}}),n.vector.interaction.DefaultInteraction=function(e,t){n.vector.interaction.DefaultInteraction.superClass.constructor.call(this,e),this.lazyMode=t},r.ext("twaver.vector.interaction.DefaultInteraction",n.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout","keydown"),h.isFirefox?b.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):b.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),b.addEventListener("mouseup","handle_mouseup",e,this),b.addEventListener("dblclick","handleDoubleClicked",this.network.getView(),this),b.addEventListener("blur","handle_blur",this.network.getView(),this),this._oldCursor=this.network.getView().style.cursor,this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this),this.network.getView().oncontextmenu=function(e){e.preventDefault()},this._createZoomDiv()},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout","keydown"),h.isFirefox?b.removeEventListener("DOMMouseScroll",this.network.getView(),this):b.removeEventListener("mousewheel",this.network.getView(),this),b.removeEventListener("mouseup",e,this),b.removeEventListener("dblclick",this.network.getView(),this),b.removeEventListener("blur",this.network.getView(),this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.end(),this.network.removeMarker(this),this._zoomDiv=null},_createZoomDiv:function(){if(this._zoomDiv==null){this._zoomDiv=l.createElement("div"),this._zoomLabel=l.createElement("span"),this._zoomLabel.style.display="block",this._zoomLabel.style.textAlign="center";var t=l.createElement("button");t.innerHTML="Reset to default",this._zoomDiv.appendChild(this._zoomLabel),this._zoomDiv.appendChild(t);var n=$i,r=this._zoomDiv.style;r.position="absolute",r.color=n.TOOLTIP_COLOR,r.background=n.TOOLTIP_BACKGROUND,r.fontSize=n.TOOLTIP_FONT_SIZE,r.padding=n.TOOLTIP_PADDING,r.border=n.TOOLTIP_BORDER,r.borderRadius=n.TOOLTIP_BORDER_RADIUS,r.boxShadow=n.TOOLTIP_BOX_SHADOW,r.zIndex=n.TOOLTIP_ZINDEX,r.setProperty&&r.setProperty("-webkit-box-shadow",n.TOOLTIP_BOX_SHADOW,null);var i=this;t.onclick=function(e){i.network.setZoom(1),i._setZoomDivVisible(!1)};var s=this._zoomDiv,o=function(){s.style.opacity=parseFloat(s.style.opacity)-.05;if(parseFloat(s.style.opacity)<=.05){i._setZoomDivVisible(!1),s._clearTimeout=null;return}s._clearTimeout=setTimeout(s._clearFunc,100)};s._clearFunc=o,s.onmouseover=function(t){t||(t=e.event);var n=t.relatedTarget?t.relatedTarget:t.fromElement;while(n&&n!=s)n=n.parentNode;n!=s&&(s._clearTimeout&&(clearTimeout(s._clearTimeout),s._clearTimeout=null),s.style.opacity=1)},s.onmouseout=function(t){t||(t=e.event);var n=t.relatedTarget?t.relatedTarget:t.toElement;while(n&&n!=s)n=n.parentNode;n!=s&&(s._clearTimeout=setTimeout(s._clearFunc,10))}}},_isZoomDivVisible:function(){return this._zoomDiv!=null&&this._zoomDiv.parentNode!=null},_getZoomDiv:function(){return this._zoomDiv||this._createZoomDiv(),this._zoomDiv},_setZoomDivVisible:function(e,t,n){var r=this._getZoomDiv();if(e){this._zoomLabel.innerHTML=n,r.style.opacity=1,this._isZoomDivVisible()||this.network.getView().appendChild(r),r.style.left=$i.TOOLTIP_XOFFSET+"px",r.style.top=$i.TOOLTIP_YOFFSET+"px";var i=this;r._clearTimeout&&(clearTimeout(r._clearTimeout),r._clearTimeout=null),r._clearTimeout=setTimeout(r._clearFunc,250)}else r.parentNode&&r.parentNode.removeChild(r)},handleViewRectChange:function(e){(e.property=="viewRect"||e.property=="canvasSizeChange")&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){this.hThumbRect=null,this.vThumbRect=null;if(this.network.isScrollBarVisible()==0){this.repaint();return}var e=this.network.getViewRect().height,t=this.network.getViewRect().width,n=this.network.getViewRect().x,r=this.network.getViewRect().y,i=this.network.getCanvasSize(),s=this.network._unionBounds,o=s.x,u=s.y,a=s.width,f=s.height,l=i.width,c=i.height,h=t,p=e,d=!1,v=!1;if(n>o||t+n<l)v=!0;if(r>u||r+e<c)d=!0;var m=0,g=0,y=0,b=0,w=h,E=p,S,x,T,N=this.getScrollBarWidth();v&&(d&&(w-=N),b=N,g=p-N,n>o&&n+t>l?(S=n-o,S=S*w/(S+h),m=S,y=w-S):n<o&&n+t<l?(S=l-(n+t),S=w*S/(S+h),m=0,y=w-S):(x=n-o,T=l-(n+t),x=w*x/a,T=w*T/a,m=x,y=h-x-T),this.hThumbRect={x:m,y:g,width:y,height:b}),m=0,g=0,y=0,b=0,w=h,E=p,d&&(v&&(E-=N),y=N,m=h-N,r>u&&r+e>c?(S=r-u,S=E*S/(S+p),g=S,b=E-S):r<u&&r+e<c?(S=c-(r+e),S=E*S/(S+p),g=0,b=E-S):(x=r-u,T=c-(r+e),x=E*x/f,T=E*T/f,g=x,b=E-x-T),this.vThumbRect={x:m,y:g,width:y,height:b}),this.network.setHScrollBarVisible(this.hThumbRect!=null),this.network.setVScrollBarVisible(this.vThumbRect!=null),this.repaint()},scrollXOffset:function(e){var t=this.network.getViewRect().height,n=this.network.getViewRect().width,r=this.network.getViewRect().x,i=this.network.getViewRect().y,s=30;e&&(s=-30),this.network.setViewRect(r+s,i,n,t)},scrollYOffset:function(e){var t=this.network.getViewRect().height,n=this.network.getViewRect().width,r=this.network.getViewRect().x,i=this.network.getViewRect().y,s=30;e&&(s=-30),this.network.setViewRect(r,i+s,n,t)},handle_mouseover:function(e){if(this.scrollBarVisible==1)return;this.scrollBarVisible=!0,this.repaint()},handle_mouseout:function(e){if(this.scrollBarVisible==0)return;this.vBarDownPoint==null&&this.hBarDownPoint==null&&(this.scrollBarVisible=!1,this.repaint(),this.end(e))},handle_keydown:function(e){this.currentKeyEvent=e,this.addListener("keyup"),Or.handleKeyDown(this.network,e)},handle_keyup:function(e){this.currentKeyEvent=null,this.removeListener("keyup")},start:function(t){this.end(t,!0),this.lastPoint=this.network.getLogicalPoint2(t),this.startPoint=this.network.getLogicalPoint2(t),this.lastPanPoint=this.getMarkerPoint(t),this.lazyMode&&(this.pressPoint=this.lastPoint),b.addEventListener("mousemove","handle_mousemove",e,this)},end:function(t,n){this.vBarDownPoint=null,this.hBarDownPoint=null,this.network.state.panning&&(this.network.state.panning=!1,this.network.invalidateElementUIs(!0)),n||(this.network.getView().style.cursor=this._oldCursor);if(this.isMoving){if(this.lazyMode){if(this.dragPoint!=null&&this.pressPoint!=null){var r=this,i=function(){r.network.fireInteractionEvent({kind:"lazyMoveEnd",event:t}),r.network.setMovingElement(!1)},s=this.getOffset(this.dragPoint,this.pressPoint),o=s.x,u=s.y;this.network.moveSelectedElements(o,u,this.network.isLazyMoveAnimate(),i)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t}));if(this.isParenting()){this.parent==null&&(this.parent=this.network.getCurrentSubNetwork());var r=this;this.network.getMovableSelectedElements().forEach(function(e){e.setParent(r.parent)},this.network)}this.parentProcess(t,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null,this.repaint()}if(this.isSelecting&&this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var a=m.getRect([this.startPoint,this.endPoint]),f=this.network.getElementsAtRect(a,this.getIntersectMode(),this.network.getRectSelectFilter());if(f&&f.size()>0){var l=this.network.getSelectionModel(),c=l.toSelection();f.forEach(function(e){l.contains(e)?c.remove(e):c.add(e)},this),l.setSelection(c)}this.network.fireInteractionEvent({kind:"selectEnd",event:t})}this.network.setSelectingElement(!1),this.startPoint=null,this.endPoint=null,this.repaint()}this.isMouseDown=!1,b.removeEventListener("mousemove",e,this)},_isDragToSelect:function(e){return!this.network._dragToPan},handle_mousedown:function(e){if(!h.isTouchable&&e.button!==0&&this.network.isSelectingElement()){this.end(e);return}var t=this.network;if(e.target!=t.getView()&&e.target!=t._topCanvas&&e.target!=t._rootCanvas)return;this.isMoving=!1,this.isSelecting=!1,this.hBarDownPoint=null,this.vBarDownPoint=null,this._setZoomDivVisible(!1);if(!this.network.isValidEvent(e)){var i=this.getMarkerPoint(e);this.start(e),this.vThumbRect!=null&&m.containsPoint(this.vThumbRect,i.x,i.y)&&(this.vBarDownPoint={x:e.screenX,y:e.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),this.hThumbRect!=null&&m.containsPoint(this.hThumbRect,i.x,i.y)&&(this.hBarDownPoint={x:e.screenX,y:e.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x);return}this.network.isFocusOnClick()&&n.Util.setFocus(this.network.getView());var s=this.network.getElementAt(e),o=this.network.getElementsAt(e);if(o&&o instanceof Oi)for(var u=0;u<o.size();u++){var a=o.get(u),f=this.network.getElementBox().getSelectionModel().isSelectable(a);if(f){s=a;break}}!this.network.isSelectingElement()&&!this.network.isEditingElement()&&s!=null&&(this.network.isMovable(s)&&this.network.getElementBox().getSelectionModel().isSelectable(s)?this.isMoving=!0:this.network.getView().style.cursor="pointer",this.start(e));if(!this.network.isSelectingElement()&&!this.network.isEditingElement()){var l=this.network.getSelectionModel();s==null||s&&!this.network.getElementBox().getSelectionModel().isSelectable(s)?(r.isCtrlDown(e)?this.isSelecting=!0:this._isDragToSelect(e)?(this.isSelecting=!0,l.clearSelection()):this.network.isRectSelectEnabled()&&(l.clearSelection(),this.network.getView().style.cursor="pointer"),this.start(e)):r.isCtrlDown(e)?l.contains(s)?l.removeSelection(s):l.appendSelection(s):l.contains(s)||l.setSelection(s)}this.handleClicked(e,s),this.isMouseDown=!0},handle_mousemove:function(e){this._setZoomDivVisible(!1);var t=this.network.getLogicalPoint2(e);if(!t)return;var n={x:e.screenX,y:e.screenY},i=this.network.getCanvasSize(),s=this.network.getViewRect().height,o=this.network.getViewRect().width,u=this.getScrollBarWidth();if(this.hBarDownPoint!=null){var a=n.x-this.hBarDownPoint.x;this.hBarDownPoint=n,this.network.setViewOffSet(a*i.width/(o-u),0);return}if(this.vBarDownPoint!=null){var f=n.y-this.vBarDownPoint.y;this.vBarDownPoint=n,this.network.setViewOffSet(0,f*i.height/(s-u));return}if(!this.network.isSelectingElement()&&!this.network.isEditingElement()&&this.isMoving&&this.isMouseDown&&!r.isCtrlDown(e)){var l=this.getOffset(t,this.lastPoint);this.xoffset=l.x,this.yoffset=l.y;if(Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1)return;this.lazyMode?this.dragPoint==null?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:e}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:e}):(this.lastPoint=t,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e})),this.network.moveSelectedElements(this.xoffset,this.yoffset)),this.parentProcess(e,!1),this.lazyMode&&(this.dragPoint=t),(this.lazyMode||this.isParenting())&&this.repaint()}else if(this.isSelecting&&(r.isCtrlDown(e)||this._isDragToSelect()))this.network.setSelectingElement(!0),this.endPoint==null?this.network.fireInteractionEvent({kind:"selectStart",event:e}):this.network.fireInteractionEvent({kind:"selectBetween",event:e}),this.endPoint=t,this.repaint();else if(!this.isMoving&&!this.isSelecting&&this.isMouseDown){if(!this.lastPanPoint||!this.network._dragToPan)return;var t=this.getMarkerPoint(e);if(!t)return;var c=t.x-this.lastPanPoint.x,h=t.y-this.lastPanPoint.y;this.network.panByOffset(-c,-h),this.network.fireInteractionEvent({kind:"panning",event:e}),this.network.state.panning=!0,this.lastPanPoint=t}else this.end(e)},handleMouseWheel:function(e){if(l.activeElement!==this.network.getView())return;if(!this.network._wheelToZoom){this._handleMouseWheelScroll(e);return}b.preventDefault(e);var t={x:e.offsetX||e.layerX,y:e.offsetY||e.layerY},n=this.network.getZoom();e.wheelDelta&&e.wheelDelta>0||e.detail&&e.detail<0?this.network.setZoom(n*1.1,t):this.network.setZoom(n/1.1,t),this._setZoomDivVisible(this.network.isZoomDivVisible(),e,"Zoom : "+parseFloat(this.network.getZoom().toFixed(4)))},_handleMouseWheelScroll:function(e){b.preventDefault(e);var t=!1,n=this._getVisibleScrollBar();n!=null&&(t=e.wheelDelta?e.wheelDelta>0:e.detail<0,n=="v"?this.scrollYOffset(t):this.scrollXOffset(t))},handle_mouseup:function(e){this.end
(e)},isParenting:function(){return this.pressPoint&&this.currentKeyEvent!=null&&this.currentKeyEvent.keyCode===80},parentProcess:function(e,t){var n=null;this.parent=null;var r=this;if(!t&&this.isParenting()){var i={},s=this.network.getLogicalPoint2(e);i.x=s.x-1,i.y=s.y-1,i.width=2,i.height=2;var o=this.network.getElementsAtRect(i,!0);if(o&&o.size()>0){var u=o.size();for(var a=0;a<u;a++){var f=o.get(a);if(!r.network.getElementBox().getSelectionModel().contains(f)){r.parent=f;break}}}}else this.parent=null;this.parent!=null&&(n=this.network.getElementUI(this.parent).getViewRect()),n!=null&&!t?this.parentRect=n:this.parentRect=null},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y},_getVisibleScrollBar:function(){return this.network.isScrollBarVisible()==0?null:this.vThumbRect!=null?"v":this.hThumbRect!=null?"h":null},paintScroll:function(e){if(this.network.isScrollBarVisible()==0)return;if(this.scrollBarVisible==0&&this.hBarDownPoint==null&&this.vBarDownPoint==null)return;var t=this.getScrollBarWidth(),n=this.network.getViewRect().height,r=this.network.getViewRect().width;e.save();var i,s=this.getScrollBarColor();this.hThumbRect!=null&&(i=e.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),i.addColorStop(0,s),i.addColorStop(1,"#666666"),this.paintRoundRect(e,this.getScrollBarColor(),.5,0,n-t,r-t,t,t/2),this.paintRoundRect(e,i,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,t/2)),this.vThumbRect!=null&&(i=e.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),i.addColorStop(0,s),i.addColorStop(1,"#666666"),this.paintRoundRect(e,this.getScrollBarColor(),.5,r-t,0,t,n-t,t/2),this.paintRoundRect(e,i,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,t/2)),e.restore()},paintRoundRect:function(e,t,n,r,i,s,o,u){e.beginPath(),e.globalAlpha=n,e.fillStyle=t,w.drawRoundRect(e,r,i,s,o,u),e.fill()},paint:function(e){this.paintScroll(e);if(this.network.isSelectingElement()){if(this.startPoint==null||this.endPoint==null)return;var t=this.convertPointFromView(this.startPoint),n=this.convertPointFromView(this.endPoint),r=t.x,i=t.y,s=n.x,o=n.y,u=m.getRect([{x:r,y:i},{x:s,y:o}]);if(u!=null){e.beginPath();var a=this.network.getSelectOutlineWidth(),f=this.getIntersectMode()?this.network.getSelectFillColor():null;e.strokeStyle=this.network.getSelectOutlineColor(),e.lineWidth=a,rs.rect(e,u.x,u.y,u.width,u.height,f,this.network.getSelectOutlineColor()),e.closePath()}}else{if(this.lazyMode){if(this.pressPoint==null||this.dragPoint==null)return;e.beginPath();var l=this.getOffset(this.dragPoint,this.pressPoint),c=l.x,h=l.y,p=this.network.getMovableSelectedElements(),d=p.size(),v=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,a=this.network.getLazyMoveOutlineWidth(),g=this.network.getLazyMoveOutlineColor();e.strokeStyle=g,e.lineWidth=a,e.fillStyle=v;for(var y=0;y<d;y++){var b=p.get(y),w=this.network.getElementUI(b);if(w){var E=this.convertFromUIToMarkerRect(w.getViewRect(),c,h);rs.rect(e,E.x,E.y,E.width,E.height)}}e.fill(),e.stroke()}if(this.parentRect){e.beginPath();var v=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,a=this.network.getLazyMoveOutlineWidth(),g=this.network.getLazyMoveOutlineColor();e.strokeStyle=g,e.lineWidth=a,e.fillStyle=v;var E=this.parentRect;rs.rect(e,E.x,E.y,E.width,E.height),e.fill(),e.stroke()}}},handleClicked:function(e,t){Or.handleClicked(this.network,e,t)},handleDoubleClicked:function(e){var t=this.network.getElementAt(e);Or.handleDoubleClicked(this.network,e,t)},handle_blur:function(e){this.end()}}),n.vector.interaction.CreateElementInteraction=function(e,t){t||(t=n.Node),n.Util.isTypeOf(t,n.Node)?this.elementFunction=function(e){var r=new t;return r instanceof n.Node&&r.setCenterLocation(e),r}:this.elementFunction=t,n.vector.interaction.CreateElementInteraction.superClass.constructor.call(this,e)},r.ext("twaver.vector.interaction.CreateElementInteraction",n.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(e){var t=this.network.getLogicalPoint2(e);if(t){var n=this.elementFunction(t);n&&this.network.addElementByInteraction(n)}}}),n.vector.interaction.EditInteraction=function(e,t){this.lazyMode=t,this.pointIndex=-1,this.linkPointsType=null,n.vector.interaction.EditInteraction.superClass.constructor.call(this,e)},r.ext("twaver.vector.interaction.EditInteraction",n.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(e){if(this.lazyMode==1&&this.resizingRect!=null){e.lineWidth=this.network.getResizeLineWidth();var t=this.convertFromUIToMarkerRect(this.resizingRect,0,0,this.node);e.save(),n.Util.rotateCanvas(e,t,this.node.getAngle()),e.beginPath(),rs.rect(e,t.x,t.y,t.width,t.height,null,this.network.getResizeLineColor()),e.restore()}this.isStartRotate&&this.showRotateScale(e)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(e){this.cursorID=e,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(e){if(e.button!==0)return;if(r.isAltDown(e)&&!this.network.isEditingElement()){var t=this.network.getElementAt(e),i=this.network.getLogicalPoint2(e);if(t instanceof n.ShapeNode){var s=this.getPointIndex(this.network.getShapeNodeZoomPoints(t),i,!0);s>0&&(this._handle_mousedown(e),this.pointIndex=s,this.shapeNode=t,t.addPoint(i,s),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:e,element:t,pointIndex:s}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:t,pointIndex:s}))}if(t instanceof n.ShapeLink){var o=new n.List(t.getPoints()),u=this.network.getElementUI(t);o.add(u.getFromPoint(),0),o.add(u.getToPoint());var s=this.getPointIndex(o,i)-1;s>0&&(this._handle_mousedown(e),this.pointIndex=s,this.shapeLink=t,t.addPoint(i,s),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:e,element:t,pointIndex:s}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:t,pointIndex:s}))}return}if(!this.network.isEditingElement()||this.isStart||this.isStartRotate)return;this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:e,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?r.isAltDown(e)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:e,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink?r.isAltDown(e)?this.pointIndex>=0&&(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:e,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(e))},handle_mouseup:function(e){if(this.isStart){var t=this.network.getLogicalPoint2(e);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var r=this,i=new n.animate.AnimateBounds(this.node,this.resizingRect,function(){r.network.fireInteractionEvent({kind:"lazyResizeEnd",event:e,element:r.node,resizeDirection:r.resizeDirection}),r.clear()});n.animate.AnimateManager.start(i)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:e,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:e,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&t?(this._resetShapeNodePoints(t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.shapeNode,pointIndex:this.pointIndex})):t&&(this.shapeLink||this.linkUI)&&(this.linkPointsType==="from"?this._setFromPoint(t):this.linkPointsType==="to"?this._setToPoint(t):this.linkPointsType==="shapeControl"?(this._resetShapeLinkPoints(t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkPointsType==="control"&&Nr.isOrthogonalLink(this.linkUI._element)&&this.linkUI.getControlPoint()&&(this._setLinkControlPoint(t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.linkUI._element})))}this._handle_mouseup(e),this.clear()},handle_mousemove:function(e){var t=this.network.getEditPointSize();if(!this.network.isValidEvent(e))return;if(this.isStartRotate&&this.node){this._handleRotateElement(e,this.node),this.network.isShowRotateScale()&&this.repaint();return}if(this.isStart){if(this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(e);return}if(this.node&&this.resizeDirection){this._handleResizing(e);return}if(this.shapeLink||this.linkUI)if(this.linkPointsType){if(this.linkPointsType==="from"){this._handleMovingFromPoint(e);return}if(this.linkPointsType==="to"){this._handleMovingToPoint(e);return}if(this.linkPointsType==="shapeControl"){this._handleMovingShapeLinkPoint(e);return}if(this.linkPointsType==="control"&&Nr.isOrthogonalLink(this.linkUI._element)&&this.linkUI.getControlPoint()){this._handleMovingLinkControlPoint(e);return}}}if(this.network.isSelectingElement()||this.network.isMovingElement()||this.network.getSelectionModel().size()===0){this.clear();return}var r=this.network.getElementAt(e),i=this.network.getElementUI(r);if(!i||!i.getEditAttachment()){this.clear();return}var s=this.network.getLogicalPoint2(e);if(r instanceof n.Node){this.node=r;if(this._isEditingShapeNode(s)||this._isResizingNode(s)){this.network.setEditingElement(!0);return}if(this._isRotatingElement(s)){this.network.setRotatingElement(!0),this.network.setEditingElement(!0);return}}else if(r instanceof n.Link){r instanceof n.ShapeLink?this.shapeLink=r:i instanceof n.vector.LinkUI&&(this.linkUI=i);var o=r.getFromAgent(),u;o?u=r.getFromAgent():u=r.getFromNode();var a=r.getStyle("link.from.xoffset"),f=r.getStyle("link.from.yoffset"),l=this.network.getElementUI(u),c=l.getZoomBodyRect(),h={x:c.x+c.width/2,y:c.y+c.height/2},p={x:h.x+a,y:h.y+f},d=r.getToAgent(),v;d?v=r.getToAgent():v=r.getToNode();var m=r.getStyle("link.to.xoffset"),g=r.getStyle("link.to.yoffset"),y=this.network.getElementUI(v),b=y.getZoomBodyRect(),w={x:b.x+b.width/2,y:b.y+b.height/2},E={x:w.x+m,y:w.y+g};if(p&&this._contains(s,p,t)){this.linkPointsType="from",this._setCrossCursor(),this.network.setEditingElement(!0);return}if(E&&this._contains(s,E,t)){this.linkPointsType="to",this._setCrossCursor(),this.network.setEditingElement(!0);return}if(r instanceof n.ShapeLink){if(this._isEditingShapeLink(s)){this.linkPointsType="shapeControl",this.network.setEditingElement(!0);return}}else if(i instanceof n.vector.LinkUI){if(Nr.isOrthogonalLink(i._element)){var S=this.linkUI.getControlPoint();if(S&&this._contains(s,S,t)){this.linkPointsType="control",this._setCrossCursor(),this.network.setEditingElement(!0);return}}this.linkPointsType=null;return}this.linkPointsType=null}this.clear()},_isRotatingElement:function(e){var t=this.network.getRotatePointSize();if(t<=0)return!1;var n=this.network.zoomManager,r=this.network.getElementUI(this.node),i=n.getSizeZoom(r),s=n._getElementZoomRect(r,this.node.getOriginalRect()),o=this.node.getAngle();return this._isRotating(e,"crosshair",s,o,i)},_isRotating:function(e,t,n,r,i){var s=this.network.getRotatePointSize()/this.network.getGraphicsZoom(),o={x:n.x+n.width/2,y:n.y-this.network.getRotatePointOffset()/this.network.getGraphicsZoom()-s},u=this._rotatePoint(o,r,n),a={x:u.x-s,y:u.y-s,width:s*2,height:s*2};return m.containsPoint(a,e)?(this._removeCursor(),this._setCursor(t),!0):!1},_handleRotateElement:function(e,t){this._handle_mousemove(e);var n=this._calculateAngle(this.network.getLogicalPoint2(e),t);t.setAngle(n)},_calculateAngle:function(e,t){var n=this.network.getZoomBodyRect(t),r=m.getCenterPoint(n);return Math.round(Math.atan2(r.x-e.x,e.y-r.y)*180/Math.PI+180)},_resetShapeNodePoints:function(e){var t=this.network.getShapeNodeZoomPoints(this.shapeNode);t.set(this.pointIndex,e);var n=this.network.getElementUI(this.shapeNode),r=this.network.zoomManager._getShapeNodeZoomPoints(n,t,!0);this.shapeNode.setPoints(r)},_handleMovingShapeNodePoint:function(e){var t=this.network.getLogicalPoint2(e);this._resetShapeNodePoints(t),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:e,element:this.shapeNode,pointIndex:this.pointIndex})},_resetShapeLinkPoints:function(e){var t=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink._points);t.set(this.pointIndex,e);var n=this.network.zoomManager._getShapeLinkZoomPoints(t,!0);this.shapeLink.setPoints(n)},_handleMovingShapeLinkPoint:function(e){var t=this.network.getLogicalPoint2(e);this._resetShapeLinkPoints(t),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:e,element:this.shapeLink,pointIndex:this.pointIndex})},_setLinkControlPoint:function(e){var t=this.linkUI.getControlPoint(),n=this.linkUI.getControlPoint(),r=this.network.zoomManager,i={x:e.x-n.x,y:e.y-n.y};t.x+=i.x,t.y+=i.y,this.linkUI.setControlPoint(t)},_handleMovingLinkControlPoint:function(e){var t=this.network.getLogicalPoint2(e);this._setLinkControlPoint(t),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:e,element:this.linkUI._element})},_setFromPoint:function(e){var t;if(this.linkUI)t=this.linkUI._element;else{if(!this.shapeLink)return;t=this.shapeLink}var n=t.getFromAgent(),r;n?r=t.getFromAgent():r=t.getFromNode();var i=this.network.getElementUI(r),s=i.getZoomBodyRect(),o={x:s.x+s.width/2,y:s.y+s.height/2},u={x:e.x-o.x,y:e.y-o.y};t.setStyle("link.from.xoffset",u.x),t.setStyle("link.from.yoffset",u.y)},_handleMovingFromPoint:function(e){var t=this.network.getLogicalPoint2(e);this._setFromPoint(t)},_setToPoint:function(e){var t;if(this.linkUI)t=this.linkUI._element;else{if(!this.shapeLink)return;t=this.shapeLink}var n=t.getToAgent(),r;n?r=t.getToAgent():r=t.getToNode();var i=this.network.getElementUI(r),s=i.getZoomBodyRect(),o={x:s.x+s.width/2,y:s.y+s.height/2},u={x:e.x-o.x,y:e.y-o.y};t.setStyle("link.to.xoffset",u.x),t.setStyle("link.to.yoffset",u.y)},_handleMovingToPoint:function(e){var t=this.network.getLogicalPoint2(e);this._setToPoint(t)},convertFromUIToMarkerRect:function(e,t,n,r){var i=this.network.zoomManager,s=i.getLocationZoom(),o=i.getGraphicsZoom(),u=this.network.getElementUI(r),a=i.getSizeZoom(u),f=e.x+e.width/2,l=e.y+e.height/2,c=f-e.x,h=l-e.y;return{x:f*s*o-this.network.getViewRect().x+t*s*o-c*a*o,y:l*s*o-this.network.getViewRect().y+n*s*o-h*a*o,width:e.width*a*o,height:e.height*a*o}},_getReverseZoomPoint:function(e,t,n){var r=this.network.zoomManager,i=r.getLocationZoom(),s=r.getSizeZoom(this.network.getElementUI(e));return t.x*=i,t.y*=i,{x:t.x/i+(n.x-t.x)/s,y:t.y/i+(n.y-t.y)/s}},_getReverseZoomRect:function(e,t){var n=this.network.zoomManager,r=n.getLocationZoom(),i=n.getSizeZoom(s);if(r==i)return e;var s=this.network.getElementUI(t),o=s.getBodyRect(),u=o.x+o.width/2,a=o.y+o.height/2,f={x:u*r+(e.x-u)*i,y:a*r+(e.y-a)*i,width:e.width*i,height:e.height*i};return u=f.x+f.width/2,a=f.y+f.height/2,{x:u/r+(f.x-u)*i,y:a/r+(f.y-a)*i,width:e.width,height:e.height}},_handleResizing:function(e){this._handle_mousemove(e);var t=this.node.getAngle(),n=this.node.getLocation(),i=this.node.getWidth()/2,s=this.node.getHeight()/2,o={x:n.x+i,y:n.y+s},u={x:-i,y:-s},a={x:-i,y:s},f={x:i,y:s},l={x:i,y:-s},c={x:0,y:-s},h={x:i,y:0},p={x:0,y:s},d={x:-i,y:0},v=this._getReverseZoomPoint(this.node,r.clone(o),this._endLogical);this.resizeDirection==="northwest"&&(this._transformPoint(f,o,t),u.x=v.x,u.y=v.y,o.x=(u.x+f.x)/2,o.y=(u.y+f.y)/2,this._reversPoint(u,o,t),this._reversPoint(f,o,t),this.resizingRect={x:u.x,y:u.y,width:f.x-u.x,height:f.y-u.y},r.isShiftDown(e)&&this._revertResizeRect(this.node,this.resizingRect,1));if(this.resizeDirection==="north"){var m={x:v.x,y:v.y};this._reversPoint(m,o,t),c.y=m.y-o.y,this._transformPoint(c,o,t),this._transformPoint(p,o,t),o.x=(c.x+p.x)/2,o.y=(c.y+p.y)/2,this._reversPoint(c,o,t),this._reversPoint(p,o,t),this.resizingRect={x:o.x-this.node.getWidth()/2,y:o.y-(p.y-c.y)/2,width:this.node.getWidth(),height:p.y-c.y}}this.resizeDirection==="northeast"&&(this._transformPoint(a,o,t),l.x=v.x,l.y=v.y,o.x=(a.x+l.x)/2,o.y=(a.y+l.y)/2,this._reversPoint(a,o,t),this._reversPoint(l,o,t),this.resizingRect={x:a.x,y:l.y,width:l.x-a.x,height:a.y-l.y},r.isShiftDown(e)&&this._revertResizeRect(this.node,this.resizingRect,2));if(this.resizeDirection==="west"){var m={x:v.x,y:v.y};this._reversPoint(m,o,t),d.x=m.x-o.x,this._transformPoint(h,o,t),this._transformPoint(d,o,t),o.x=(h.x+d.x)/2,o.y=(h.y+d.y)/2,this._reversPoint(h,o,t),this._reversPoint(d,o,t),this.resizingRect={x:o.x-(h.x-d.x)/2,y:o.y-this.node.getHeight()/2,width:h.x-d.x,height:this.node.getHeight()}}if(this.resizeDirection==="east"){var m={x:v.x,y:v.y};this._reversPoint(m,o,t),h.x=m.x-o.x,this._transformPoint(h,o,t),this._transformPoint(d,o,t),o.x=(h.x+d.x)/2,o.y=(h.y+d.y)/2,this._reversPoint(h,o,t),this._reversPoint(d,o,t),this.resizingRect={x:o.x-(h.x-d.x)/2,y:o.y-this.node.getHeight()/2,width:h.x-d.x,height:this.node.getHeight()}}this.resizeDirection==="southwest"&&(this._transformPoint(l,o,t),a.x=v.x,a.y=v.y,o.x=(a.x+l.x)/2,o.y=(a.y+l.y)/2,this._reversPoint(a,o,t),this._reversPoint(l,o,t),this.resizingRect={x:a.x,y:l.y,width:l.x-a.x,height:a.y-l.y},r.isShiftDown(e)&&this._revertResizeRect(this.node,this.resizingRect,4));if(this.resizeDirection==="south"){var m={x:v.x,y:v.y};this._reversPoint(m,o,t),p.y=m.y-o.y,this._transformPoint(c,o,t),this._transformPoint(p,o,t),o.x=(c.x+p.x)/2,o.y=(c.y+p.y)/2,this._reversPoint(c,o,t),this._reversPoint(p,o,t),this.resizingRect={x:o.x-this.node.getWidth()/2,y:o.y-(p.y-c.y)/2,width:this.node.getWidth(),height:p.y-c.y}}this.resizeDirection==="southeast"&&(this._transformPoint(u,o,t),f.x=v.x,f.y=v.y,o.x=(u.x+f.x)/2,o.y=(u.y+f.y)/2,this._reversPoint(u,o,t),this._reversPoint(f,o,t),this.resizingRect={x:u.x,y:u.y,width:f.x-u.x,height:f.y-u.y},r.isShiftDown(e)&&this._revertResizeRect(this.node,this.resizingRect,3)),this.resizingRect=this._getReverseZoomRect(this.resizingRect,this.node),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:e,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:e,element:this.node,resizeDirection:this.resizeDirection}))},_revertResizeRect:function(e,t,n){var r=e.getOriginalRect(),i=Math.max(t.width/r.width,t.height/r.height),s=r.width*i,o=r.height*i,u=t.x,a=t.y;n==1?(u+=t.width-s,a+=t.height-o):n==2?a+=t.height-o:n!=3&&n==4&&(u+=t.width-s),t.x=u,t.y=a,t.width=s,t.height=o},_isEditingShapeNode:function(e){var t=this.network.getEditPointSize();if(this.node instanceof n.ShapeNode){this.shapeNode=this.node;var r=this.network.getShapeNodeZoomPoints(this.node);for(var i=0,s=r.size();i<s;i++){var o=r.get(i);if(this._contains(e,o,t))return this._setCrossCursor(),this.pointIndex=i,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(e){var t=this.network.getEditPointSize(),n=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink.getPoints());for(var r=0,i=n.size();r<i;r++){var s=n.get(r);if(this._contains(e,s,t))return this._setCrossCursor(),this.pointIndex=r,!0}return this.pointIndex=-1,!1},_isResizingNode:function(e){var t=this.network.getResizePointSize();if(t<=0)return!1;var n=this.network.zoomManager,r=this.network.getElementUI(this.node),i=n._getElementZoomRect(r,this.node.getOriginalRect()),s=this.node.getAngle(),o={x:i.x,y:i.y},u=this._rotatePoint(o,s,i);return this._isResizing(e,u.x,u.y,"northwest","nwse-resize")?!0:(o={x:i.x+i.width/2,y:i.y},u=this._rotatePoint(o,s,i),this._isResizing(e,u.x,u.y,"north","ns-resize")?!0:(o={x:i.x+i.width,y:i.y},u=this._rotatePoint(o,s,i),this._isResizing(e,u.x,u.y,"northeast","nesw-resize")?!0:(o={x:i.x,y:i.y+i.height/2},u=this._rotatePoint(o,s,i),this._isResizing(e,u.x,u.y,"west","ew-resize")?!0:(o={x:i.x+i.width,y:i.y+i.height/2},u=this._rotatePoint(o,s,i),this._isResizing(e,u.x,u.y,"east","ew-resize")?!0:(o={x:i.x,y:i.y+i.height},u=this._rotatePoint(o,s,i),this._isResizing(e,u.x,u.y,"southwest","nesw-resize")?!0:(o={x:i.x+i.width/2,y:i.y+i.height},u=this._rotatePoint(o,s,i),this._isResizing(e,u.x,u.y,"south","ns-resize")?!0:(o={x:i.x+i.width,y:i.y+i.height},u=this._rotatePoint(o,s,i),this._isResizing(e,u.x,u.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(e,t,n){var r=m.createMatrix(t*Math.PI/180,n.x+n.width/2,n.y+n.height/2),i=r.transform(e);return i},_isResizing:function(e,t,n,r,i){var s=this.network.getGraphicsZoom(),o=this.network.getResizePointSize()/s;return this._contains(e,{x:t,y:n},o)?(this.resizeDirection!==r&&(this._removeCursor(),i=this._changeCursorWithAngle(r,this.node.getAngle()),this._setCursor(i),this.resizeDirection=r),!0):!1},_getRect:function(e,t,n,r){var i=e<n?e:n,s=t<r?t:r,o=Math.abs(e-n),u=Math.abs(t-r);return{x:i,y:s,width:o,height:u}},_contains:function(e,t,n){var r={x:t.x-n,y:t.y-n,width:n*2,height:n*2};return m.containsPoint(r,e)},getPointIndex:function(e,t,n){if(e.size()<2)return 0;var r=e.get(0),i;for(var s=1;s<e.size();s++){i=e.get(s);if(this.isPointOnLine(t,r,i,6))return s;r=i}return r=e.get(0),n&&this.isPointOnLine(t,r,i,6)?e.size():0},showRotateScale:function(e){var t=new n.List,i=this.network.getRotateScaleWidth(),s=this.network.getRotateScaleHeight(),o=this.network.getRotatePointSize(),u=this.node.getAngle(),a=this.network.zoomManager,f=this.network.getElementUI(this.node),l=a._getElementZoomRect(f,this.node.getOriginalRect()),c={x:l.x+l.width/2,y:l.y-this.network.getRotatePointOffset()-o},h=this._rotatePoint(c,u,l),p,d="13px Arial",v=u+"°",m,g,y,b,w=this.network.getViewRect();a.getLocationZoom()===1&&(e.translate(-w.x,-w.y),e.scale(this.network.getZoom(),this.network.getZoom())),this.node.getAngle()>=0&&this.node.getAngle()<=180?(m={x:h.x+o,y:h.y},g={x:m.x+i,y:m.y},y={x:g.x,y:g.y-s},b={x:m.x,y:y.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(m={x:h.x-o,y:h.y},g={x:m.x-i,y:m.y},y={x:g.x,y:g.y-s},b={x:m.x,y:y.y});var E=new n.List([m,g,y,b]),p=r.math.getRect(E);a.getLocationZoom()!==1&&(p.x-=w.x,p.y-=w.y),e.fillStyle=this.network.getRotateScaleFillColor(),e.fillRect(p.x,p.y,p.width,p.height),e.fillStyle=this.network.getRotateScaleFontColor(),e.textBaseline="middle",e.textAlign="center",e.font=d,e.fillText(v,p.x+p.width/2,p.y+p.height/2),a.getLocationZoom()===1&&(e.scale(1/this.network.getZoom(),1/this.network.getZoom()),e.translate(w.x,w.y))},isPointOnLine:function(e,t,n,r){r<0&&(r=0);var i=this.getDistanceFromPointToLine(e,t,n);return i<=r&&e.x>=Math.min(t.x,n.x)-r&&e.x<=Math.max(t.x,n.x)+r&&e.y>=Math.min(t.y,n.y)-r&&e.y<=Math.max(t.y,n.y)+r},getDistanceFromPointToLine:function(e,t,n){if(t.x===n.x)return Math.abs(e.x-t.x);var r=(n.y-t.y)/(n.x-t.x),i=(n.x*t.y-t.x*n.y)/(n.x-t.x);return Math.abs(r*e.x-e.y+i)/Math.sqrt(r*r+1)},_transformPoint:function(e,t,n){var r=Math.cos(n*Math.PI/180),i=Math.sin(n*Math.PI/180),s=e.x,o=e.y,u=s*r-o*i,a=s*i+o*r;e.x=u+t.x,e.y=a+t.y},_reversPoint:function(e,t,n){n*=-1;var r=Math.cos(n*Math.PI/180),i=Math.sin(n*Math.PI/180),s=e.x-t.x,o=e.y-t.y,u=s*r-o*i,a=s*i+o*r;e.x=u+t.x,e.y=a+t.y},_changeCursorWithAngle:function(e,t){var n,r=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(e){case"northwest":n=1;break;case"north":n=2;break;case"northeast":n=3;break;case"east":n=4;break;case"southeast":n=5;break;case"south":n=6;break;case"southwest":n=7;break;case"west":n=8;break;default:n=0}if(t>=360||t<=-360)t%=360;return t>22.5&&t<=67.5&&(n+=1),t<-22.5&&t>=-67.5&&(n-=1),t>67.5&&t<=112.5&&(n+=2),t<-67.5&&t>=-112.5&&(n-=2),t>112.5&&t<=157.5&&(n+=3),t<-112.5&&t>=-157.5&&(n-=3),t>157.5&&t<=202.5&&(n+=4),t<-157.5&&t>=-202.5&&(n-=4),t>202.5&&t<=247.5&&(n+=5),t<-202.5&&t>=-247.5&&(n-=5),t>247.5&&t<=292.5&&(n+=6),t<-247.5&&t>=-292.5&&(n-=6),t>292.5&&t<=337.5&&(n+=7),t<-292.5&&t>=-337.5&&(n-=7),n>8&&(n-=8),n<=0&&(n+=8),r[n]}}),n.vector.interaction.CreateLinkInteraction=function(e,t){t||(t=n.Link),n.Util.isTypeOf(t,n.Link)?this.linkFunction=function(e,r){var i=new t;return i instanceof n.Link&&(i.setFromNode(e),i.setToNode(r)),i}:this.linkFunction=t,n.vector.interaction.CreateLinkInteraction.superClass.constructor.call(this,e)},r.ext("twaver.vector.interaction.CreateLinkInteraction",n.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(e){e.beginPath();var t,n;e.lineWidth=this.network.getEditLineWidth();var r=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(t=this.network.getElementUI(this.currentNode).getZoomViewRect(!0),n=this.convertFromUIToMarkerRect(t,0,0),rs.rect(e,n.x,n.y,n.width,n.height,null,r)),this.fromNode&&(t=this.network.getElementUI(this.fromNode).getZoomViewRect(!0),n=this.convertFromUIToMarkerRect(t,0,0),rs.rect(e,n.x,n.y,n.width,n.height,null,r)),this.currentPoint&&this.paintLine(e),e.closePath()},convertFromUIToMarkerRect:function(e,t,n){var r=this.network.zoomManager,i=r.getGraphicsZoom();return{x:e.x*i-this.network.getViewRect().x+t*i,y:e.y*i-this.network.getViewRect().y+n*i,width:e.width*i,height:e.height*i}},getZoomNodeRectOrPoint:function(e,t){var n=this.network.getElementUI(e).getZoomBodyRect();return t?{x:n.x+n.width/2,y:n.y+n.height/2}:n},paintLine:function(e){var t=this.network.getEditLineColor(),n=this.network.getElementUI(this.fromNode).getZoomBodyRect(),r=this.convertPointFromView({x:n.x+n.width/2,y:n.y+n.height/2}),i=r.x,s=r.y,o=this.currentPoint.x,u=this.currentPoint.y;e.strokeStyle=t,e.beginPath(),e.moveTo(i,s),e.lineTo(o,u),e.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(e){if(!this.network.isValidEvent(e))return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var t=this.createLink();t&&this.network.addElementByInteraction(t)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(e){var t=this.getMarkerPoint(e);if(!t)return;if(this.network.isMovingElement()||this.network.isEditingElement()){this.clear();return}var n=null;this.fromNode?(this.currentNode=this.getToNode(e,this.fromNode),this.currentPoint=t,this.repaint()):(n=this.getFromNode(e),this.currentNode!==n&&(this.currentNode=n,this.repaint()))},getFromNode:function(e){return this.getNode(e)},getToNode:function(e,t){return this.getNode(e,t)},getNode:function(e,t){var n=this.network.getElementAt(e);return n instanceof es&&this.network.isLinkable(n,t)&&this.network.getElementBox().getSelectionModel().isSelectable(n)?n:null}}),n.vector.interaction.CreateShapeLinkInteraction=function(e,t){n.vector.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,e),t||(t=n.ShapeLink),n.Util.isTypeOf(t,n.ShapeLink)?this.linkFunction=function(e,r,i){var s=new t;if(s instanceof n.ShapeLink){s.setFromNode(e),s.setToNode(r);if(i){var o=this.network.zoomManager;s.setPoints(o._getShapeLinkZoomPoints(i,!0))}}return s}:this.linkFunction=t},r.ext("twaver.vector.interaction.CreateShapeLinkInteraction",n.vector.interaction.CreateLinkInteraction,{clear:function(){this.points=null,n.vector.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(e){if(e.button!==0)return;var t=this.network.getLogicalPoint2(e);if(!t)return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var r=this.createLink();r&&this.network.addElementByInteraction(r),this.clear()}else{this.points||(this.points=new n.List);if(this.points.size()>0){var i=this.points.get(this.points.size()-1);if(i.x===t.x&&i.y===t.y)return}this.points.add(t)}}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()},paintLine:function(e){if(this.currentPoint){var t=new n.List,r;r=this.convertPointFromView(this.getZoomNodeRectOrPoint(this.fromNode,!0)),t.add(r,0);if(this.points&&this.points.size()>0){var i=this.points.size();for(var s=0;s<i;s++)r=this.convertPointFromView(this.points.get(s)),t.add(r)}r=this.currentPoint,t.add(r),e.lineWidth=this.network.getEditLineWidth(),e.strokeStyle=this.network.getEditLineColor(),e.beginPath(),w.drawLinePoints(e,t),e.stroke()}}}),n.vector.interaction.CreateShapeNodeInteraction=function(e,t){t||(t=n.ShapeNode),n.Util.isTypeOf(t,n.ShapeNode)?this.shapeNodeFunction=function(e){var r=new t;if(r instanceof n.ShapeNode){var i=this.network.zoomManager,s=this.network.createElementUI(r);if(e){var o=i._getShapeNodeZoomPoints(s,e,!0);s.invalidateZoom(),r.setPoints(o)}}return r}:this.shapeNodeFunction=t,n.vector.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,e),this.timeStamp=-1},r.ext("twaver.vector.interaction.CreateShapeNodeInteraction",n.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(e){if(this.points&&this.points.size()>0&&this.currentPoint){var t=new n.List,r=this.points.size(),i;for(var s=0;s<r;s++)i=this.convertPointFromView(this.points.get(s)),t.add(i);i=this.convertPointFromView(this.currentPoint),t.add(i),e.lineWidth=this.network.getEditLineWidth(),e.strokeStyle=this.network.getEditLineColor(),e.beginPath(),w.drawLinePoints(e,t),e.stroke()}},handle_mousedown:function(e){if(e.button!==0)return;var t=this.network.getLogicalPoint2(e);if(!t)return;if(e.detail===2||e.timeStamp-this.timeStamp<300){if(this.points){var r=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(r),this.clear();var i=this;setTimeout(function(){i.network.setEditingElement(!1)},0)}}else{this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new n.List);if(this.points.size()>0){var s=this.points.get(this.points.size()-1);if(s.x===t.x&&s.y===t.y)return}this.points.add(t)}this.timeStamp=e.timeStamp,this.repaint()},handle_mousemove:function(e){this.points&&(this.currentPoint=this.network.getLogicalPoint2(e),this.repaint())}}),n.vector
.interaction.MagnifyInteraction=function(e,t,r,i,s){n.vector.interaction.MagnifyInteraction.superClass.constructor.call(this,e),this.scale=t||2,this.xRadius=r||100,this.yRadius=i||100,this.shape=s||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=b.createCanvas()},r.ext("twaver.vector.interaction.MagnifyInteraction",n.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.addListener("mousewheel"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.removeListener("mousewheel"),this.network.removeMarker(this)},paint:function(e){if(this.point){var t=this.network.zoomManager,n=t.getLocationZoom(),r=t.getGraphicsZoom(),i=t.getSizeZoom(),s=this.network.getZoom(),o=this.xRadius/this.scale/r,u=this.yRadius/this.scale/r;if(this.mouseFlag==="mousewheel"){var a={x:this.zoomPoint.x-o,y:this.zoomPoint.y-u,width:o*2,height:u*2};this.network.toCanvasByRegion(a,this.scale*r,this.markCanvas,"white");var f={x:this.zoomPoint.x-this.xRadius-this.network.viewRect.x,y:this.zoomPoint.y-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}else{var a={x:this.point.x*n-o,y:this.point.y*n-u,width:o*2,height:u*2};this.network.toCanvasByRegion(a,this.scale*r,this.markCanvas,"white");var f={x:this.point.x*n*r-this.xRadius-this.network.viewRect.x,y:this.point.y*n*r-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}e.save(),e.beginPath(),w.drawVector(e,this.shape,null,f.x,f.y,2*a.width*r,2*a.height*r),e.clip(),e.fillStyle=this.backgroundColor,e.beginPath(),e.rect(f.x,f.y,f.width,f.height),e.fill(),e.drawImage(this.markCanvas,f.x,f.y),e.restore(),e.beginPath(),e.lineWidth=this.borderWidth,w.drawVector(e,this.shape,null,f.x+this.borderWidth/2,f.y+this.borderWidth/2,2*a.width*r-this.borderWidth,2*a.height*r-this.borderWidth),e.strokeStyle=this.borderColor,e.stroke(),this.mouseFlag=null}},handle_mousemove:function(e){this.point=this.network.getLogicalPoint(e);if(!this.point)return;this.mouseFlag="mousemove",this.repaint()},handle_mousewheel:function(e){var t=this.network.zoomManager,n=t.getLocationZoom();n!==1&&(this.zoomPoint=this.network.getLogicalPoint2(e));if(!this.zoomPoint)return;this.mouseFlag="mousewheel",this.repaint()},getScale:function(){return this.scale},setScale:function(e){this.scale=e,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(e){this.shape=e,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(e){this.xRadius=e,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(e){this.yRadius=e,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(e){this.borderColor=e,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(e){this.borderWidth=e,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(e){this.backgroundColor=e,this.network.repaintTopCanvas()}}),n.vector.interaction.TouchInteraction=function(e){n.vector.interaction.TouchInteraction.superClass.constructor.call(this,e)},r.ext("twaver.vector.interaction.TouchInteraction",n.vector.interaction.BaseInteraction,{setUp:function(){var e=this.network.getView();b.addEventListener("touchstart","handleTouchstart",e,this),b.addEventListener("touchmove","handleTouchmove",e,this),b.addEventListener("touchend","handleTouchend",e,this),b.addEventListener("touchcancel","handleTouchend",e,this)},tearDown:function(){var e=this.network.getView();b.removeEventListener("touchstart",e,this),b.removeEventListener("touchmove",e,this),b.removeEventListener("touchend",e,this),b.removeEventListener("touchcancel",e,this)},_isDragToSelect:function(e){return!this.network._dragToPan},handleTouchstart:function(e){b.preventDefault(e),this.isMoving=!1,this.isSelecting=!1;if(e.touches.length==1){var t=this.network.getLogicalPoint2(e),n=this._element=this.network.getElementAt(t);this._startTouchTime=new Date,this._currentTouchPoint=t,this._startTouchClient=this._currentTouchClient=this.getMarkerPoint(e);if(n)if(!this.network.getSelectionModel().contains(n)){this.network.getSelectionModel().setSelection(n);var r=this.network.getSelectionModel();r.contains(n)&&(this.isSelecting=!0)}else this.isSelecting=!0;else this.isSelecting=!1,this.network.getSelectionModel().clearSelection();Or.handleClicked(this.network,e,n),this._endTouchTime&&this._startTouchTime.getTime()-this._endTouchTime.getTime()<=500&&m.getDistance(this._endTouchClient,this._startTouchClient)<=20?(delete this._endTouchTime,delete this._endTouchClient,Or.handleDoubleClicked(this.network,e,n)):(this._endTouchTime=this._startTouchTime,this._endTouchClient=this._startTouchClient)}else this._distance=kr.getDistance(e),this._zoom=this.network.getZoom()},handleTouchmove:function(e){b.preventDefault(e);if(e.touches.length>1){var t=kr.getDistance(e);if(Math.abs(t-this._distance)<20)return;var n=t/this._distance;this.network.setZoom(this._zoom*n,!1)}else if(this._zoom==null){var r=this.getMarkerPoint(e);if(m.getDistance(this._startTouchClient,r)<20)return;if(this._element)if(!this.isSelecting&&!this._isDragToSelect(e)){var i=this._currentTouchClient.x-r.x,s=this._currentTouchClient.y-r.y;this.network.panByOffset(i,s),this._currentTouchClient=r}else{var o=this.network.getLogicalPoint2(e),u=this.getOffset(o,this._currentTouchPoint),i=u.x,s=u.y;this._currentTouchPoint=o,this.network.moveSelectedElements(i,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e}))}else{var i=this._currentTouchClient.x-r.x,s=this._currentTouchClient.y-r.y;this.network.panByOffset(i,s),this._currentTouchClient=r}}},handleTouchend:function(e){b.preventDefault(e),this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e})),e.touches.length===0&&(this._distance=null,this._zoom=null,this._element=null,this._startTouchTime=null,this._currentTouchPoint=null,this._startTouchClient=this._currentTouchClient=null)}}),n.vector.interaction.MSTouchInteraction=function(e){n.vector.interaction.MSTouchInteraction.superClass.constructor.call(this,e),this._pointerMap={},this._pointerIdArray=[]},r.ext("twaver.vector.interaction.MSTouchInteraction",n.vector.interaction.BaseInteraction,{setUp:function(){var e=this.network.getView();b.addEventListener("MSPointerDown","handleTouchstart",e,this),b.addEventListener("MSPointerMove","handleTouchmove",e,this),b.addEventListener("MSPointerUp","handleTouchend",e,this),b.addEventListener("MSPointerCancel","handleTouchend",e,this),this.network.addMarker(this)},tearDown:function(){var e=this.network.getView();b.removeEventListener("MSPointerDown",e,this),b.removeEventListener("MSPointerMove",e,this),b.removeEventListener("MSPointerUp",e,this),b.removeEventListener("MSPointerCancel",e,this),this.network.removeMarker(this)},handleTouchstart:function(e){this.network.isFocusOnClick()&&n.Util.setFocus(this.network._view);if(this.network.isSelectingElement()&&e.pointerType==e.MSPOINTER_TYPE_MOUSE)return;var t=this.network.getLogicalPoint2(e),i=new Date;e.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(e),this._pointerMap[e.pointerId]||(this._pointerIdArray.push(e.pointerId),this._pointerMap[e.pointerId]=e);if(this._pointerIdArray.length==1){var s=this.network.getElementAt(t);this._startTouchElement=s,this._startClientPoint={x:e.clientX,y:e.clientY};var o=this.network.getSelectionModel();s?r.isCtrlDown(e)?o.contains(s)?o.removeSelection(s):o.appendSelection(s):o.contains(s)||o.setSelection(s):r.isCtrlDown(e)||o.clearSelection(),Or.handleClicked(this.network,e,s),this._startTouchTime&&this._startTouchPoint&&i.getTime()-this._startTouchTime.getTime()<=500&&m.getDistance(this._startTouchPoint,t)<=20?(Or.handleDoubleClicked(this.network,e,s),this._doubleClick=!0):(b.handle_mousedown(this,e),this._startTouchPoint=t,this._startTouchTime=i)}else this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(e){if(this._startTouchPoint==null||this._pointerIdArray.length==0||!this._pointerMap[e.pointerId]||m.getDistance({x:this._pointerMap[e.pointerId].pageX,y:this._pointerMap[e.pointerId].pageY},{x:e.pageX,y:e.pageY})<=10)return;this._pointerMap[e.pointerId]=e;if(this._pointerIdArray.length==2){var t=this._getDistance()/this._distance;this.network.setZoom(this._zoom*t,!1)}},handleTouchend:function(e){this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e}));if(this.network.isSelectingElement()){var t=m.getRect([this._startTouchPoint,this._moveTouchPoint]),n=this.network.getElementsAtRect(t,this.getIntersectMode(),this.network.getRectSelectFilter());if(n&&n.size()>0){var r=this.network.getSelectionModel(),i=r.toSelection();n.forEach(function(e){r.contains(e)?i.remove(e):i.add(e)},this),r.setSelection(i)}this.network.fireInteractionEvent({kind:"selectEnd",event:e}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);var s=-1;for(var o=0;o<this._pointerIdArray.length;o++)if(this._pointerIdArray[o]==e.pointerId){s=o;break}s>=0&&this._pointerIdArray.splice(s,1),delete this._pointerMap[e.pointerId],this._moveTouchPoint=null},_getDistance:function(){return m.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(e){var t={x:e.clientX,y:e.clientY};if(m.getDistance(this._startClientPoint,t)<3)return;if(this._startTouchPoint&&this._pointerIdArray.length==1){this._moveTouchPoint={x:this._startTouchPoint.x+(t.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(t.y-this._startClientPoint.y)/this.network.getZoom()};if(this._startTouchElement==null&&this.network.isRectSelectEnabled()){var n=this.network.getLogicalPoint2(e);if(!n)return;this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:e}):this.network.fireInteractionEvent({kind:"selectStart",event:e}),this.repaint()}else{var r=this.network.getElementAt(this._moveTouchPoint);if(this._startTouchElement==null&&!this.network.isRectSelectEnabled()){var i=this._startClientPoint.x-t.x,s=this._startClientPoint.y-t.y;this.network.panByOffset(i,s)}else if(this.network.isMovingElement()||this._startTouchElement!=null&&r==this._startTouchElement&&this.network.getMovableSelectedElements().contains(r)){var i=this._moveTouchPoint.x-this._startTouchPoint.x,s=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(i,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e}))}this._startClientPoint=t}}},handle_mouseup:function(e){this.handleTouchend(e),this._pointerIdArray=[],this._pointerMap={}},paint:function(e){if(!this._startTouchPoint||!this._moveTouchPoint||this._startTouchElement||!this.network.isRectSelectEnabled())return;var t=this.convertPointFromView(this._startTouchPoint),n=this.convertPointFromView(this._moveTouchPoint),r=t.x,i=t.y,s=n.x,o=n.y,u=m.getRect([{x:r,y:i},{x:s,y:o}]);if(u!=null){e.beginPath();var a=this.network.getSelectOutlineWidth(),f=this.getIntersectMode()?this.network.getSelectFillColor():null;e.strokeStyle=this.network.getSelectOutlineColor(),e.lineWidth=a,rs.rect(e,u.x,u.y,u.width,u.height,f,this.network.getSelectOutlineColor()),e.closePath()}}}),n.vector.interaction.MoveLinkInteraction=function(e,t){n.vector.interaction.MoveLinkInteraction.superClass.constructor.call(this,e),this.xoffset=0,this.yoffset=0},r.ext("twaver.vector.interaction.MoveLinkInteraction",n.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this.oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown"),this.network.getView().style.cursor=this.oldCursor,this.end()},handle_mousedown:function(e){if(e.button!==0)return;if(this.network.isSelectingElement()||this.network.isEditingElement())return;var t=this.network.getElementAt(e);if(!(t instanceof n.Link))return;this.element=t,this.end(e),this._handle_mousedown(e)},handle_mouseup:function(e){this.end(e)},handle_mousemove:function(e){if(!this._startLogical||this.network.isSelectingElement()||this.network.isEditingElement()){this.end(e);return}this._handle_mousemove(e),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y;if(this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:e,element:this.element});else{this.mark=b.createCanvas();var t;this.network.getMovableSelectedElements().forEach(function(e){var n=this.getElementUI(e);n&&(t=m.unionRect(t,n.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),b.setDiv(this.mark,t,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:e,element:this.element})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else{var r=new n.List([this.element.getFromNode(),this.element.getToNode()]);n.Util.moveElements(r,this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=b.getClientPoint(e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e,element:this.element}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e,element:this.element}))}},end:function(e){if(this._startLogical){if(this.lazyMode){if(this.mark){var t=this,r=function(){t.network.fireInteractionEvent({kind:"lazyMoveEnd",event:e,element:this.element}),t.mark&&(t.network.getTopDiv().removeChild(t.mark),t.mark=null,t.network.setMovingElement(!1))},i=new n.List([this.element.getFromNode(),this.element.getToNode()]);n.Util.moveElements(i,this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),r)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e,element:this.element}));this._handle_mouseup(e),delete this.element}}}),n.XmlSerializer=function(e,t,r){this.dataBox=e,this.settings=t?t:new n.SerializationSettings,this.filterFunction=r,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},r.ext("twaver.XmlSerializer",Object,{serialize:function(){return this.xmlString="<twaver version='"+n.Util.getVersion()+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</twaver>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(e){this.refMap[e.getId()]=this.ref++,e.getChildren().forEach(this.initRefs,this)},isSerializable:function(e){return this.dataBox.contains(e)?this.filterFunction&&!this.filterFunction(e)?!1:!0:!1},serializeData:function(e){if(this.isSerializable(e)){var t=e.newInstance(),n=this.refMap[e.getId()];this.xmlString+="<data class='"+e.getClassName()+"' ref='"+n+"'",this.settings.getPropertyType("id")!=null&&(this.xmlString+=" id='"+e.getId()+"'"),this.xmlString+=">\n",e.serializeXml(this,t),this.xmlString+="</data>\n"}e.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(e,t,n){var i=this.settings.getPropertyType(t);if(i){var s=r.getValue(e,t,i),o=r.getValue(n,t,i);s!==o&&this.serializeValue("p",t,s,o,i)}},serializeStyleXml:function(e,t,n){var r=this.settings.getStyleType(t);if(r){var i=e.getStyle(t),s=n.getStyle(t);i!=s&&this.serializeValue("s",t,i,s,r)}},serializeClientXml:function(e,t,n){var r=this.settings.getClientType(t);if(r!=null){var i=e.getClient(t),s=n.getClient(t);i!=s&&this.serializeValue("c",t,i,s,r)}},serializeValue:function(e,t,n,r,i){if(n==null)this.xmlString+="	<"+e+" n='"+t+"' none=''/>\n";else if(i==="cdata")this.xmlString+="	<"+e+" n='"+t+"'><![CDATA["+n+"]]></"+e+">\n";else if(i==="data"){var s=this.refMap[n.getId()];s!=null&&(this.xmlString+="	<"+e+" n='"+t+"' ref='"+s+"'/>\n")}else if(i==="point"){if(!r||n.x!==r.x||n.y!==r.y)this.xmlString+="	<"+e+" n='"+t+"' x='"+n.x+"' y='"+n.y+"'/>\n"}else i==="list.point"?(this.xmlString+="	<"+e+" n='"+t+"'>\n",n.forEach(function(e){this.xmlString+="		<p x='"+e.x+"' y='"+e.y+"'/>\n"},this),this.xmlString+="	</"+e+">\n"):i==="list.string"||i==="list.number"?(this.xmlString+="	<"+e+" n='"+t+"'>\n",n.forEach(function(e){this.xmlString+="		<s>"+e+"</s>\n"},this),this.xmlString+="	</"+e+">\n"):i==="rectangle"?this.xmlString+="	<"+e+" n='"+t+"' x='"+n.x+"' y='"+n.y+"' w='"+n.width+"' h='"+n.height+"'/>\n":this.xmlString+="	<"+e+" n='"+t+"'>"+n+"</"+e+">\n"},deserialize:function(e,t){r.isDeserializing=!0,this.xmlString=e;var n=r.xml(e).documentElement;this.refMap={},this.idMap={};var i=new Oi,s=new Oi,o,u,a,f=n.getElementsByTagName("data"),l=f.length;for(a=0;a<l;a++){u=f[a];var c=u.getAttribute("class"),h=this.settings.getPropertyType("id");if(h&&u.hasAttribute("id")){var p=null;if(h==="string")p=u.getAttribute("id");else if(h==="int")p=parseInt(u.getAttribute("id"));else{if(h!=="number")throw"Unsupported id type '"+h+"'";p=parseFloat(u.getAttribute("id"))}if(u.getAttribute("action")==="remove"){this.dataBox.removeById(p);continue}o=this.dataBox.getDataById(p),o||(o=r.newInstance(c,p))}else o=r.newInstance(c);if(u.hasAttribute("ref")){var d=u.getAttribute("ref");this.refMap[d]=o}i.add(o),s.add(u),this.idMap[o.getId()]=o}this.dataBox.forEach(function(e){this.idMap[e.getId()]=e},this),l=i.size();for(a=0;a<l;a++)o=i.get(a),u=s.get(a),o.deserializeXml(this,u);for(a=0;a<l;a++){o=i.get(a);if(this.dataBox.containsById(o.getId()))continue;t&&!o.getParent()&&o.setParent(t),this.dataBox.add(o)}this.settings.isDataBoxSerializable&&n.getElementsByTagName("dataBox").length===1&&this.dataBox.deserializeXml(this,n.getElementsByTagName("dataBox")[0]),r.isDeserializing=!1},deserializePropertyXml:function(e,t,n){var i=this.settings.getPropertyType(n);i&&r.setValue(e,n,this.deserializeValue(t,i))},deserializeStyleXml:function(e,t,n){var r=this.settings.getStyleType(n);r&&e.setStyle(n,this.deserializeValue(t,r))},deserializeClientXml:function(e,t,n){var r=this.settings.getClientType(n);r&&e.setClient(n,this.deserializeValue(t,r))},deserializeValue:function(e,t){if(e.hasAttribute("@none"))return null;if(t==="string")return e.textContent;if(t==="number")return parseFloat(e.textContent);if(t==="boolean")return e.textContent==="true";if(t==="int")return parseInt(e.textContent);if(t==="point")return{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y"))};if(t==="data"){var n=e.getAttribute("ref"),r=this.refMap[n];return r?r:this.idMap[n]}var i,s,o,u;if(t==="list.point"){var a=new Oi,f=e.getElementsByTagName("p");i=f.length;for(u=0;u<i;u++){var l=f[u];a.add({x:parseFloat(l.getAttribute("x")),y:parseFloat(l.getAttribute("y"))})}return a}if(t==="list.string"){var c=new Oi;o=e.getElementsByTagName("s"),i=o.length;for(u=0;u<i;u++)c.add(o[u].textContent);return c}if(t==="list.number"){s=new Oi,o=e.getElementsByTagName("s"),i=o.length;for(u=0;u<i;u++)s.add(parseFloat(o[u].textContent));return s}if(t==="array.string")return e.textContent.split(",");if(t==="array.number"){s=e.textContent.split(","),i=s.length;for(u=0;u<i;u++)s[u]=parseFloat(s[u]);return s}return t==="rectangle"?{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y")),width:parseFloat(e.getAttribute("w")),height:parseFloat(e.getAttribute("h"))}:e.textContent}}),r.addMethod(n.Data,{serializeXml:function(e,t){if(e.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientXml(e,n,t);this.serializePropertyXml(e,"name",t),this.serializePropertyXml(e,"icon",t),this.serializePropertyXml(e,"toolTip",t),this.serializePropertyXml(e,"parent",t)},serializePropertyXml:function(e,t,n){e.serializePropertyXml(this,t,n)},serializeClientXml:function(e,t,n){e.serializeClientXml(this,t,n)},deserializeXml:function(e,t){var n=t.getElementsByTagName("p"),r=n.length,i,s,o,u;for(i=0;i<r;i++)s=n[i],s.hasAttribute("n")&&this.deserializePropertyXml(e,s,s.getAttribute("n"));if(e.settings.isClientSerializable){o=t.getElementsByTagName("c"),r=o.length;for(i=0;i<r;i++)u=o[i],u.hasAttribute("n")&&this.deserializeClientXml(e,u,u.getAttribute("n"))}},deserializePropertyXml:function(e,t,n){e.deserializePropertyXml(this,t,n)},deserializeClientXml:function(e,t,n){e.deserializeClientXml(this,t,n)}}),r.addMethod(n.Element,{serializeXml:function(e,t){if(e.settings.isStyleSerializable&&this._styleMap)for(var r in this._styleMap)this.serializeStyleXml(e,r,t);n.Element.superClass.serializeXml.call(this,e,t),this.serializePropertyXml(e,"layerId",t),this._alarmState.getHighestNativeAlarmSeverity()&&e.settings.getPropertyType("alarmState")==="alarmstate"&&(e.xmlString+="	<p n='alarmState'>\n",n.AlarmSeverity.forEach(function(t){var n=this.getNewAlarmCount(t);n>0&&(e.xmlString+="		<n n='"+t.name+"' c='"+n+"'/>\n")},this._alarmState),n.AlarmSeverity.forEach(function(t){var n=this.getAcknowledgedAlarmCount(t);n>0&&(e.xmlString+="		<a n='"+t.name+"' c='"+n+"'/>\n")},this._alarmState),e.xmlString+="	</p>\n")},serializeStyleXml:function(e,t,n){e.serializeStyleXml(this,t,n)},deserializeXml:function(e,t){n.Element.superClass.deserializeXml.call(this,e,t);if(e.settings.isStyleSerializable){var r=t.getElementsByTagName("s"),i=r.length,s,o;for(s=0;s<i;s++)o=r[s],o.hasAttribute("n")&&this.deserializeStyleXml(e,o,o.getAttribute("n"))}},deserializeStyleXml:function(e,t,n){e.deserializeStyleXml(this,t,n)},deserializePropertyXml:function(e,t,r){if(r==="alarmState"){if(e.settings.getPropertyType("alarmState")==="alarmstate"){var i,s,o,u,a=t.getElementsByTagName("n");for(o=0;o<a.length;o++)u=a[o],s=n.AlarmSeverity.getByName(u.getAttribute("n")),this._alarmState.setNewAlarmCount(s,parseInt(u.getAttribute("c")));a=t.getElementsByTagName("a");for(o=0;o<a.length;o++)u=a[o],s=n.AlarmSeverity.getByName(u.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(s,parseInt(u.getAttribute("c")))}}else n.Element.superClass.deserializePropertyXml.call(this,e,t,r)}}),r.addMethod(es,{serializeXml:function(e,t){es.superClass.serializeXml.call(this,e,t),this.serializePropertyXml(e,"image",t),this.serializePropertyXml(e,"location",t),r.num(this._width)&&this._width>=0&&this.serializePropertyXml(e,"width",t),r.num(this._height)&&this._height>=0&&this.serializePropertyXml(e,"height",t)}}),r.addMethod(n.Link,{serializeXml:function(e,t){n.Link.superClass.serializeXml.call(this,e,t),this.serializePropertyXml(e,"fromNode",t),this.serializePropertyXml(e,"toNode",t)}}),r.addMethod(n.Follower,{serializeXml:function(e,t){n.Follower.superClass.serializeXml.call(this,e,t),this.serializePropertyXml(e,"host",t)}}),r.addMethod(ns,{serializeXml:function(e,t){ns.superClass.serializeXml.call(this,e,t),this.serializePropertyXml(e,"expanded",t)}}),r.addMethod(n.ShapeNode,{serializeXml:function(e,t){n.ShapeNode.superClass.serializeXml.call(this,e,t),this.serializePropertyXml(e,"points",t),this.serializePropertyXml(e,"segments",t)}}),r.addMethod(n.ShapeLink,{serializeXml:function(e,t){n.ShapeLink.superClass.serializeXml.call(this,e,t),this.serializePropertyXml(e,"points",t)}}),r.addMethod(n.RotatableNode,{serializeXml:function(e,t){n.RotatableNode.superClass.serializeXml.call(this,e,t),this.serializePropertyXml(e,"angle",t)}}),r.addMethod(n.DataBox,{serializeXml:function(e,t){if(e.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientXml(e,n,t);this.serializePropertyXml(e,"name",t),this.serializePropertyXml(e,"icon",t),this.serializePropertyXml(e,"toolTip",t)},serializePropertyXml:function(e,t,n){e.serializePropertyXml(this,t,n)},serializeClientXml:function(e,t,n){e.serializeClientXml(this,t,n)},deserializeXml:function(e,t){var n=t.getElementsByTagName("p"),r=n.length,i,s,o,u;for(i=0;i<r;i++)s=n[i],s.hasAttribute("n")&&this.deserializePropertyXml(e,s,s.getAttribute("n"));if(e.settings.isClientSerializable){o=t.getElementsByTagName("c"),r=o.length;for(i=0;i<r;i++)u=o[i],u.hasAttribute("n")&&this.deserializeClientXml(e,u,u.getAttribute("n"))}},deserializePropertyXml:function(e,t,n){e.deserializePropertyXml(this,t,n)},deserializeClientXml:function(e,t,n){e.deserializeClientXml(this,t,n)}}),r.addMethod(n.ElementBox,{serializeXml:function(e,t){e.settings.isLayerBoxSerializable&&(e.xmlString+="	<layerBox>\n",this._layerBox.forEachByDepthFirst(function(t){this._layerBox.getDefaultLayer()===t?e.xmlString+="		<layer ":e.xmlString+="		<layer id='"+t.getId()+"' ",t.getName()&&(e.xmlString+="name='"+t.getName()+"' "),e.xmlString+="visible='"+t.isVisible()+"' editable='"+t.isEditable()+"' movable='"+t.isMovable()+"'/>\n"},null,this),e.xmlString+="	</layerBox>\n");if(e.settings.isStyleSerializable&&this._styleMap)for(var r in this._styleMap)this.serializeStyleXml(e,r,t);n.ElementBox.superClass.serializeXml.call(this,e,t)},serializeStyleXml:function(e,t,n){e.serializeStyleXml(this,t,n)},deserializeStyleXml:function(e,t,n){e.deserializeStyleXml(this,t,n)},deserializeXml:function(e,t){n.ElementBox.superClass.deserializeXml.call(this,e,t);if(e.settings.isLayerBoxSerializable&&t.getElementsByTagName("layerBox").length==1){var r=t.getElementsByTagName("layerBox")[0].getElementsByTagName("layer");for(var i=0;i<r.length;i++){var s=r[i],o;if(s.hasAttribute("id")){var u=e.settings.getPropertyType("layerId");if(u==="string")o=new n.Layer(s.getAttribute("id"));else if(u==="int")o=new n.Layer(parseInt(s.getAttribute("id")));else{if(u!=="number")throw"Unsupported layer id type '"+u+"'";o=new n.Layer(parseFloat(s.getAttribute("id")))}this._layerBox.getDataById(o.getId())?o=this._layerBox.getDataById(o.getId()):this._layerBox.add(o)}else o=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(o);s.hasAttribute("name")&&o.setName(s.getAttribute("name")),s.hasAttribute("visible")&&o.setVisible(s.getAttribute("visible")==="true"),s.hasAttribute("editable")&&o.setEditable(s.getAttribute("editable")==="true"),s.hasAttribute("movable")&&o.setMovable(s.getAttribute("movable")==="true")}}if(e.settings.isStyleSerializable){var a=t.getElementsByTagName("s"),f=a.length;for(var i=0;i<f;i++){var l=a[i];l.hasAttribute("n")&&this.deserializeStyleXml(e,l,l.getAttribute("n"))}}}}),n.JsonSerializer=function(e,t,r){this.dataBox=e,this.settings=t?t:new n.SerializationSettings,this.filterFunction=r,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},r.ext("twaver.JsonSerializer",Object,{serialize:function(){return this.jsonObject={version:n.Util.getVersion(),platform:"html5"},this.settings.isImageSerializable&&(this.jsonObject.images={}),this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this);if(this.settings.isDataBoxSerializable){var e={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=e,this.dataBox.serializeJson(this,this.dataBox.newInstance(),e),r.isEmptyObject(e.p)&&delete e.p,r.isEmptyObject(e.s)&&delete e.s,r.isEmptyObject(e.c)&&delete e.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(e){this.refMap[e.getId()]=this.ref++,e.getChildren().forEach(this.initRefs,this)},isSerializable:function(e){return this.dataBox.contains(e)?this.filterFunction&&!this.filterFunction(e)?!1:!0:!1},serializeData:function(e){if(this.isSerializable(e)){var t=e.newInstance(),n=this.refMap[e.getId()],i={"class":e.getClassName(),ref:n,p:{},s:{},c:{}};this.settings.getPropertyType("id")&&(this.jsonObject.id=e.getId()),this.jsonObject.datas.push(i),e.serializeJson(this,t,i),r.isEmptyObject(i.p)&&delete i.p,r.isEmptyObject(i.s)&&delete i.s,r.isEmptyObject(i.c)&&delete i.c;if(this.settings.isImageSerializable&&e.getImage){var s=e.getImage();if(typeof s=="string"&&!ss[s]&&!this.jsonObject.images[s]){var o=r.getImageAsset(s),u=o&&o.getImage();u&&!si(u)&&(this.jsonObject.images[s]=u)}}}e.getChildren().forEach(this.serializeData,this)},serializePropertyJson:function(e,t,n,i){var s=this.settings.getPropertyType(t);if(s){var o=r.getValue(e,t,s),u=r.getValue(n,t,s);o!==u&&this.serializeValue(t,o,u,s,i.p)}},serializeStyleJson:function(e,t,n,r){var i=this.settings.getStyleType(t);if(i){var s=e.getStyle(t),o=n.getStyle(t);s!=o&&this.serializeValue(t,s,o,i,r.s)}},serializeClientJson:function(e,t,n,r){var i=this.settings.getClientType(t);if(i!=null){var s=e.getClient(t),o=n.getClient(t);s!=o&&this.serializeValue(t,s,o,i,r.c)}},serializeValue:function(e,t,n,r,i){if(t==null)i[e]=null;else if(t instanceof Oi)i[e]=t._as;else if(r==="data"){var s=this.refMap[t.getId()];s!=null&&(i[e]=s)}else i[e]=t},deserialize:function(e,t){r.isDeserializing=!0,this.jsonObject=JSON.parse(e);var n=this.jsonObject.images;this.settings.isImageSerializable&&n&&Object.keys(n).forEach(function(e){r.registerImage(e,n[e])}),this.refMap={},this.idMap={};var i=new Oi,s=new Oi,o,u=this.jsonObject.datas.length;for(var a=0;a<u;a++){var f=this.jsonObject.datas[a],l=f["class"],c=this.settings.getPropertyType("id");if(c&&f.id!=null){if(f.action==="remove"){this.dataBox.removeById(f.id);continue}o=this.dataBox.getDataById(f.id),o||(o=r.newInstance(l,f.id))}else o=r.newInstance(l);f.ref!=null&&(this.refMap[f.ref]=o),i.add(o),s.add(f),this.idMap[o.getId()]=o}this.dataBox.forEach(function(e){this.idMap[e.getId()]=e},this),u=i.size();for(a=0;a<u;a++)o=i.get(a),o.deserializeJson(this,s.get(a));for(a=0;a<u;a++){o=i.get(a);if(this.dataBox.containsById(o.getId()))continue;t&&!o.getParent()&&o.setParent(t),this.dataBox.add(o)}this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),r.isDeserializing=!1},deserializePropertyJson:function(e,t,n){var i=this.settings.getPropertyType(n);i&&r.setValue(e,n,this.deserializeValue(t,i))},deserializeStyleJson:function(e,t,n){var r=this.settings.getStyleType(n);r&&e.setStyle(n,this.deserializeValue(t,r))},deserializeClientJson:function(e,t,n){var r=this.settings.getClientType(n);r&&e.setClient(n,this.deserializeValue(t,r))},deserializeValue:function(e,t){if(t==="data"){var n=this.refMap[e];return n?n:this.idMap[e]}return t==="array.number"?e:e instanceof Array?new Oi(e):e}}),r.addMethod(n.Data,{serializeJson:function(e,t,n){if(e.settings.isClientSerializable&&this._clientMap)for(var r in this._clientMap)this.serializeClientJson(e,r,t,n);this.serializePropertyJson(e,"name",t,n),this.serializePropertyJson(e,"icon",t,n),this.serializePropertyJson(e,"toolTip",t,n),this.serializePropertyJson(e,"parent",t,n)},serializePropertyJson:function(e,t,n,r){e.serializePropertyJson(this,t,n,r)},serializeClientJson:function(e,t,n,r){e.serializeClientJson(this,t,n,r)},deserializeJson:function(e,t){var n;for(n in t.p)this.deserializePropertyJson(e,t.p[n],n);if(e.settings.isClientSerializable)for(n in t.c)this.deserializeClientJson(e,t.c[n],n)},deserializePropertyJson:function(e,t,n){e.deserializePropertyJson(this,t,n)},deserializeClientJson:function(e,t,n){e.deserializeClientJson(this,t,n)}}),r.addMethod(n.Element,{serializeJson:function(e,t,i){if(e.settings.isStyleSerializable&&this._styleMap)for(var s in this._styleMap)this.serializeStyleJson(e,s,t,i);n.Element.superClass.serializeJson.call(this,e,t,i),this.serializePropertyJson(e,"layerId",t,i);if(this._alarmState.getHighestNativeAlarmSeverity()&&e.settings.getPropertyType("alarmState")==="alarmstate"){var o={n:{},a:{}};i.p.alarmState=o,n.AlarmSeverity.forEach(function(e){var t=this.getNewAlarmCount(e);t>0&&(o.n[e.name]=
t)},this._alarmState),n.AlarmSeverity.forEach(function(e){var t=this.getAcknowledgedAlarmCount(e);t>0&&(o.a[e.name]=t)},this._alarmState),r.isEmptyObject(o.n)&&delete o.n,r.isEmptyObject(o.a)&&delete o.a,r.isEmptyObject(o)&&delete i.p.alarmState}},serializeStyleJson:function(e,t,n,r){e.serializeStyleJson(this,t,n,r)},deserializeJson:function(e,t){n.Element.superClass.deserializeJson.call(this,e,t);if(e.settings.isStyleSerializable)for(var r in t.s)this.deserializeStyleJson(e,t.s[r],r)},deserializeStyleJson:function(e,t,n){e.deserializeStyleJson(this,t,n)},deserializePropertyJson:function(e,t,r){if(r==="alarmState"){if(e.settings.getPropertyType("alarmState")==="alarmstate"){var i;for(i in t.n)this._alarmState.setNewAlarmCount(n.AlarmSeverity.getByName(i),t.n[i]);for(i in t.a)this._alarmState.setAcknowledgedAlarmCount(n.AlarmSeverity.getByName(i),t.a[i])}}else n.Element.superClass.deserializePropertyJson.call(this,e,t,r)}}),r.addMethod(es,{serializeJson:function(e,t,n){es.superClass.serializeJson.call(this,e,t,n),this.serializePropertyJson(e,"image",t,n),this.serializePropertyJson(e,"location",t,n),r.num(this._width)&&this._width>=0&&this.serializePropertyJson(e,"width",t,n),r.num(this._height)&&this._height>=0&&this.serializePropertyJson(e,"height",t,n)}}),r.addMethod(n.Link,{serializeJson:function(e,t,r){n.Link.superClass.serializeJson.call(this,e,t,r),this.serializePropertyJson(e,"fromNode",t,r),this.serializePropertyJson(e,"toNode",t,r)}}),r.addMethod(n.Follower,{serializeJson:function(e,t,r){n.Follower.superClass.serializeJson.call(this,e,t,r),this.serializePropertyJson(e,"host",t,r)}}),r.addMethod(ns,{serializeJson:function(e,t,n){ns.superClass.serializeJson.call(this,e,t,n),this.serializePropertyJson(e,"expanded",t,n)}}),r.addMethod(n.ShapeNode,{serializeJson:function(e,t,r){n.ShapeNode.superClass.serializeJson.call(this,e,t,r),this.serializePropertyJson(e,"points",t,r),this.serializePropertyJson(e,"segments",t,r)}}),r.addMethod(n.ShapeLink,{serializeJson:function(e,t,r){n.ShapeLink.superClass.serializeJson.call(this,e,t,r),this.serializePropertyJson(e,"points",t,r)}}),r.addMethod(n.RotatableNode,{serializeJson:function(e,t,r){n.RotatableNode.superClass.serializeJson.call(this,e,t,r),this.serializePropertyJson(e,"angle",t,r)}}),r.addMethod(n.DataBox,{serializeJson:function(e,t,n){if(e.settings.isClientSerializable&&this._clientMap)for(var r in this._clientMap)this.serializeClientJson(e,r,t,n);this.serializePropertyJson(e,"name",t,n),this.serializePropertyJson(e,"icon",t,n),this.serializePropertyJson(e,"toolTip",t,n)},serializePropertyJson:function(e,t,n,r){e.serializePropertyJson(this,t,n,r)},serializeClientJson:function(e,t,n,r){e.serializeClientJson(this,t,n,r)},deserializeJson:function(e,t){var n;for(n in t.p)this.deserializePropertyJson(e,t.p[n],n);if(e.settings.isClientSerializable)for(n in t.c)this.deserializeClientJson(e,t.c[n],n)},deserializePropertyJson:function(e,t,n){e.deserializePropertyJson(this,t,n)},deserializeClientJson:function(e,t,n){e.deserializeClientJson(this,t,n)}}),r.addMethod(n.ElementBox,{serializeJson:function(e,t,r){e.settings.isLayerBoxSerializable&&(r.layers=[],this._layerBox.forEachByDepthFirst(function(e){var t={};r.layers.push(t),this._layerBox.getDefaultLayer()!==e&&(t.id=e.getId()),e.getName()&&(t.name=e.getName()),t.visible=e.isVisible(),t.editable=e.isEditable(),t.movable=e.isMovable()},null,this));if(e.settings.isStyleSerializable&&this._styleMap)for(var i in this._styleMap)this.serializeStyleJson(e,i,t,r);n.ElementBox.superClass.serializeJson.call(this,e,t,r)},serializeStyleJson:function(e,t,n,r){e.serializeStyleJson(this,t,n,r)},deserializeStyleJson:function(e,t,n){e.deserializeStyleJson(this,t,n)},deserializeJson:function(e,t){n.ElementBox.superClass.deserializeJson.call(this,e,t);if(e.settings.isLayerBoxSerializable&&t.layers&&t.layers){var r=t.layers.length;for(var i=0;i<r;i++){var s,o=t.layers[i];o.id!=null?(s=new n.Layer(o.id),this._layerBox.getDataById(s.getId())?s=this._layerBox.getDataById(s.getId()):this._layerBox.add(s)):(s=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(s)),o.name&&s.setName(o.name),o.visible!=null&&s.setVisible(o.visible),o.editable!=null&&s.setEditable(o.editable),o.movable!=null&&s.setMovable(o.movable)}}if(e.settings.isStyleSerializable)for(var u in t.s)this.deserializeStyleJson(e,t.s[u],u)}}),n.layout.SpringLayouter=function(e){this._network=e,this._damper=1,this._maxMotion=0,this._motionRatio=0,this._isAdjusting=!1,this._timer=null,this._snodeMap={},this._snodes=new Oi,this._slinks=new Oi,this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this),this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this)},r.ext("twaver.layout.SpringLayouter",Object,{_nodeRepulsionFactor:.6,_linkRepulsionFactor:.6,_limitBounds:null,_interval:50,_stepCount:10,_motionLimit:.01,start:function(){if(this._timer)return;var t=this,n=function(){t.relax.call(t)};this._timer=e.setInterval(n,this._interval),this._damper=1},stop:function(){this._timer&&(e.clearInterval(this._timer),this._timer=null)},relax:function(){if(this._damper<.1&&this._maxMotion<this._motionLimit)return;this._rebuild();var e=this._snodes.size();for(var t=0;t<this._stepCount;t++){this._slinks.forEach(this._relaxLink,this);for(var n=0;n<e;n++)for(var r=0;r<e;r++){var i=this._snodes.get(n),s=this._snodes.get(r);i!=s&&this._relaxNodePair(i,s)}this._moveNodes()}this._isAdjusting=!0;for(var t=0;t<e;t++){var o=this._snodes.get(t);o.fix||o.element.setLocation(o.x,o.y)}this._isAdjusting=!1},isRunning:function(){return!!this._timer},getNetwork:function(){return this._network},isVisible:function(e){return this._network.isVisible(e)},isMovable:function(e){return this._network.isMovable(e)?this._network.getSelectionModel().contains(e)?!1:e instanceof ns?!1:!0:!1},getNodeRepulsionFactor:function(){return this._nodeRepulsionFactor},setNodeRepulsionFactor:function(e){e<.02&&(e=.02),this._nodeRepulsionFactor=e,this._damper=1},getLinkRepulsionFactor:function(){return this._linkRepulsionFactor},setLinkRepulsionFactor:function(e){e<.02&&(e=.02),this._linkRepulsionFactor=e,this._damper=1},getStepCount:function(){return this._stepCount},setStepCount:function(e){this._stepCount=e,this._damper=1},getInterval:function(){return this._interval},setInterval:function(t){if(this._interval===t)return;this._interval=t;if(this._timer){e.clearInterval(this._timer);var n=this,r=function(){n.relax.call(n)};this._timer=e.setInterval(r,this._interval)}},getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(e){this._limitBounds=e,this._damper=1},_handleDataPropertyChange:function(e){this._isAdjusting||(this._damper=1)},_handleDataBoxChange:function(e){this._network.getElementBox().size()===0?this._damper=0:this._damper=1},_handleNetworkPropertyChange:function(e){if(e.property==="elementBox"){var t=e.oldValue;t!=null&&(t.removeDataBoxChangeListener(this._handleDataBoxChange,this),t.removeDataPropertyChangeListener(this._handleDataPropertyChange,this)),this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this)}},_relaxLink:function(e){var t=e.toNode.x-e.fromNode.x,n=e.toNode.y-e.fromNode.y,r=Math.sqrt(t*t+n*n),i=t*.25,s=n*.25;i/=e.length*100;var o=e.length,u=o*100,a=s;s/=u,a/=e.length*100,e.toNode.dx=e.toNode.dx-i*r,e.toNode.dy=e.toNode.dy-s*r,e.fromNode.dx=e.fromNode.dx+i*r,e.fromNode.dy=e.fromNode.dy+s*r},_relaxNodePair:function(e,t){var r=0,i=0,s=e.x-t.x,o=e.y-t.y,u=s*s+o*o;u===0?(r=n.Util.random(),i=n.Util.random()):u<36e4&&(r=s/u,i=o/u);var a=e.repulsion*t.repulsion/100,f=a*.25;e.dx+=r*f,e.dy+=i*f,t.dx-=r*f,t.dy-=i*f},_moveNodes:function(){var e=this._maxMotion,t=0;for(var n=0,r=this._snodes.size();n<r;n++){var i=this._snodes.get(n),s=i.dx,o=i.dy;s*=this._damper,o*=this._damper,i.dx=s/2,i.dy=o/2;var u=Math.sqrt(s*s+o*o);if(!i.fix){i.x=i.x+Math.max(-30,Math.min(30,s)),i.y=i.y+Math.max(-30,Math.min(30,o));if(!this._limitBounds)i.x<1&&this._adjustLocation(1,0),i.y<1&&this._adjustLocation(0,1);else{i.x<this._limitBounds.x&&(i.x=this._limitBounds.x,this._adjustLocation(1,0)),i.y<this._limitBounds.y&&(i.y=this._limitBounds.y,this._adjustLocation(0,1));var a,f=this._network.getElementUI(i.element);f?a=f._viewRect:a=i.element.getRect(),a&&(i.x+a.width>this._limitBounds.x+this._limitBounds.width&&(i.x=this._limitBounds.x+this._limitBounds.width-a.width,this._adjustLocation(-1,0)),i.y+a.height>this._limitBounds.y+this._limitBounds.height&&(i.y=this._limitBounds.y+this._limitBounds.height-a.height,this._adjustLocation(0,-1)))}}t=Math.max(u,t)}this._maxMotion=t,this._maxMotion>0?this._motionRatio=e/this._maxMotion-1:this._motionRatio=0,this._damp()},_damp:function(){this._motionRatio<=.001&&((this._maxMotion<.2||this._maxMotion>1&&this._damper<.9)&&this._damper>.01?this._damper-=.01:this._maxMotion<.4&&this._damper>.003?this._damper-=.003:this._damper>1e-4&&(this._damper-=1e-4)),this._maxMotion<this._motionLimit&&(this._damper=0)},_rebuild:function(){this._snodeMap={},this._snodes.clear(),this._slinks.clear(),this._network.getElementBox().forEach(function(e){this.isVisible(e)&&(e instanceof n.Link?this._addLink(e):e instanceof es&&this._addNode(e))},this)},_addNode:function(e){var t=this._snodeMap[e.getId()];return t?t:(t={},t.element=e,t.repulsion=this._getRepulsion(e),t.x=e.getX(),t.y=e.getY(),t.dx=0,t.dy=0,t.fix=!this.isMovable(e),this._snodeMap[e.getId()]=t,this._snodes.add(t),t)},_addLink:function(e){var t={};t.fromNode=this._addNode(e.getFromNode()),t.toNode=this._addNode(e.getToNode()),t.element=e;var n=this._network.getElementUI(e.getToNode()),r=this._network.getElementUI(e.getFromNode()),i,s;n&&n._viewRect&&r&&r._viewRect?(i=n._viewRect.width+r._viewRect.width,s=n._viewRect.height+r._viewRect.height):(i=e.getToNode().getWidth()+e.getFromNode().getWidth(),s=e.getToNode().getHeight()+e.getFromNode().getHeight()),t.length=Math.floor(Math.sqrt(i*i+s*s)*this._linkRepulsionFactor),t.length<=0&&(t.length=100),this._slinks.add(t)},_getRepulsion:function(e){var t=this._network.getElementUI(e),n;if(t&&t._viewRect){var r=t._viewRect;n=Math.floor(Math.sqrt(r.width*r.width+r.height*r.height)*this._nodeRepulsionFactor)}else n=100;return n<=0&&(n=100),n},_adjustLocation:function(e,t){for(var n=0,r=this._snodes.size();n<r;n++){var i=this._snodes.get(n),s,o=this._network.getElementUI(i.element);o?s=o._viewRect:s=i.element.getRect();if(!s)return;if(e>0){if(!this._limitBounds||i.x+s.width+e<this._limitBounds.x+this._limitBounds.width)i.x+=e}else if(!this._limitBounds||i.x+e>this._limitBounds.x)i.x+=e;if(t>0){if(!this._limitBounds||i.y+s.height+t<this._limitBounds.y+this._limitBounds.height)i.y+=t}else if(!this._limitBounds||i.y+t>this._limitBounds.y)i.y+=t}}}),n.layout.CloudLayouter=function(e){n.layout.CloudLayouter.superClass.constructor.apply(this,arguments),this._network=e,this._centerX=0,this._centerY=0,this._radius=1,this._rect=null,this._localPoint=null,this._lastWidth=-1e3,this._lastHeight=-1e3,this._nodes=new Oi,this._sa=0,this._ca=0,this._sb=0,this._cb=0,this._sc=0,this._cc=0,this._lasta=0,this._lastb=0,this._active=!1,this._horizontalElliptical=1,this._verticalElliptical=1,this._timer=null,this._centering=!1,this._centeringNode=null,this._freeze=!1,this._network.getClassName()==="twaver.network.Network"?this._network.setInteractions([new n.network.interaction.SelectInteraction(this._network)]):this._network.setInteractions([new n.canvas.interaction.SelectInteraction(this._network)])},r.ext("twaver.layout.CloudLayouter",n.PropertyChangeDispatcher,{__accessor:["updateNodeFunction","mouseMoveFunction","mouseOverFunction","percentPadding","ceaseRate","ceaseLimit"],__bool:["elliptical","active","updateLayoutRectOnResized","reloadOnDataBoxChanged"],_moveSpeed:2,_ceaseRate:.9,_ceaseLimit:.01,_percentPadding:.2,_elliptical:!0,_interval:50,_reloadOnDataBoxChanged:!0,_updateLayoutRectOnResized:!0,getNetwork:function(){return this._network},isLayoutable:function(e){return this._network.isVisible(e)&&this._network.isMovable(e)},start:function(t){arguments.length===0&&(t=!0);if(this._timer)return;this._installListeners(),t&&this.updateLayoutRect(!0);var n=this,r=function(){n._update.call(n)};this._timer=e.setInterval(r,this._interval),this._update()},stop:function(){this._timer&&(e.clearInterval(this._timer),this._timer=null)},isRunning:function(){return!!this._timer},getInterval:function(){return this._interval},setInterval:function(t){if(this._interval===t)return;var n=this._interval;this._interval=t;if(this._timer){e.clearInterval(this._timer);var r=this,i=function(){r._update.call(r)};this._timer=e.setInterval(i,this._interval)}this.firePropertyChange("interval",n,t)},getMoveSpeed:function(){return this._moveSpeed},setMoveSpeed:function(e){var t=this._moveSpeed;this._moveSpeed=e,this.firePropertyChange("moveSpeed",t,e)},getLayoutRect:function(){var e=this._network.getView().offsetWidth/this._network.getZoom(),t=this._network.getView().offsetHeight/this._network.getZoom(),n=e*this._percentPadding,r=t*this._percentPadding;return{x:n,y:r,width:e-2*n,height:t-2*r}},getCount:function(){return this._nodes.size()},updateLayoutRect:function(e){var t=this._radius;this._rect=this.getLayoutRect(),this._rect.width<=2&&(this._rect.width=2),this._rect.height<=2&&(this._rect.height=2),this._radius=Math.min(this._rect.width/2,this._rect.height/2),this.isElliptical()?(this._horizontalElliptical=this._rect.width/2/this._radius,this._verticalElliptical=this._rect.height/2/this._radius):(this._horizontalElliptical=1,this._verticalElliptical=1),this._centerX=this._rect.x+this._rect.width/2,this._centerY=this._rect.y+this._rect.height/2;if(e)this.reload();else{this._lasta=1,this._lastb=1;var n=this._nodes.size();for(var r=0;r<n;r++){var i=this._nodes.get(r);i.cx*=this._radius/t,i.cy*=this._radius/t,i.cz*=this._radius/t}this._freeze?this._updateNodes(0,0,0):this._update()}this._lastWidth=this._network.getView().offsetWidth,this._lastHeight=this._network.getView().offsetHeight},reload:function(){this._freeze=!1,this._centeringNode=null,this._localPoint=null,this._centering=!1,this._nodes=new Oi,this._box.forEach(function(e){if(e&&this.isLayoutable(e)){var t={};t.node=e,this._nodes.add(t)}},this),this._sineCosine(0,0,0),this._active=!1,this._lasta=1,this._lastb=1;var e=0,t=0,n=this._nodes.size();for(var r=0;r<n;r++){e=Math.acos(-1+(2*(r+1)-1)/n),t=Math.sqrt(n*Math.PI)*e;var i=this._nodes.get(r);i.cx=this._radius*Math.cos(t)*Math.sin(e),i.cy=this._radius*Math.sin(t)*Math.sin(e),i.cz=this._radius*Math.cos(e)}},_sineCosine:function(e,t,n){var r=Math.PI/180;this._sa=Math.sin(e*r),this._ca=Math.cos(e*r),this._sb=Math.sin(t*r),this._cb=Math.cos(t*r),this._sc=Math.sin(n*r),this._cc=Math.cos(n*r)},handleSelectionChange:function(e){this.centerNode(this._network.getSelectionModel().getLastData())},handleDataBoxChange:function(e){(this._reloadOnDataBoxChanged||e.kind==="clear")&&this.reload()},handleMouseMove:function(e){this._centering||this._updateLogicalPoint(e),this._mouseMoveFunction?this._active=this._mouseMoveFunction(e):this._active=!0},handleMouseOver:function(e){this._centering||this._updateLogicalPoint(e),this._mouseOverFunction?this._active=this._mouseOverFunction(e):this._active=!0},_updateLogicalPoint:function(e){this._localPoint=this._network.getLogicalPoint(e)},handleRollOut:function(e){this._active=!1},handleResize:function(e){if(e.kind==="validateEnd"){if(!this._updateLayoutRectOnResized)return;if(Math.abs(this._network.getView().offsetWidth-this._lastWidth)<=2&&Math.abs(this._network.getView().offsetHeight-this._lastHeight)<=2)return;this.updateLayoutRect()}},handleNetworkPropertyChange:function(e){e.property==="elementBox"&&(this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this.reload()),e.property==="zoom"&&(this._localPoint=null,this.updateLayoutRect())},_adjustIndex:function(){this._nodes.sort(this._sortFunction);var e=this._nodes.size();for(var t=0;t<e;t++){var n=this._nodes.get(t).node,r=this._box.getDatas().indexOf(n);this._box.getDatas().removeAt(r),this._box.getDatas().add(n,t),this._box.fireIndexChange(n,r,t),this.updateNode(n,t,e,this._nodes.get(t).alpha)}},_sortFunction:function(e,t){return t.cz>e.cz?1:t.cz<e.cz?-1:0},updateNode:function(e,t,n,r){this._updateNodeFunction&&this._updateNodeFunction(e,t,n,r)},_update:function(){if(this._freeze)return;var e,t;if(this._centering&&this._centeringNode){var n=this.isAtCenter(this._centeringNode.node,this._centeringNode.perspective,this._centeringNode.cx,this._centeringNode.cy,this._centeringNode.cz);if(n){this._freeze=!0,this._centering=!1,this._centeringNode=null;return}}!this._freeze&&(this._active||this._centering)&&this._localPoint?this.isElliptical()?(e=(this._centerY-this._localPoint.y)/(this._rect.height/2)*this._moveSpeed,t=(this._localPoint.x-this._centerX)/(this._rect.width/2)*this._moveSpeed):(e=(this._centerY-this._localPoint.y)/this._radius*this._moveSpeed,t=(this._localPoint.x-this._centerX)/this._radius*this._moveSpeed):(e=this._lasta*this._ceaseRate,t=this._lastb*this._ceaseRate),this._lasta=e,this._lastb=t;if(Math.abs(e)>this._ceaseLimit||Math.abs(t)>this._ceaseLimit){var r=0;this._sineCosine(e,t,r);for(var i=0,s=this._nodes.size();i<s;i++){var o=this._nodes.get(i),u=o.cx,a=o.cy*this._ca+o.cz*-this._sa,f=o.cy*this._sa+o.cz*this._ca,l=u*this._cb+f*this._sb,c=a,h=u*-this._sb+f*this._cb,p=l*this._cc+c*-this._sc,d=l*this._sc+c*this._cc,v=h;o.cx=p,o.cy=d,o.cz=v;var m=this._radius*2;m/=m+v,o.perspective=m,o.alpha=(this._radius-v)/(this._radius*2);var g=this._horizontalElliptical*p*m-this._horizontalElliptical*2+this._centerX,y=d*m*this._verticalElliptical+this._centerY;o.node.setCenterLocation(g,y)}this._adjustIndex()}},centerNode:function(e){if(e&&this.isLayoutable(e)){if(this._centeringNode&&e===this._centeringNode.node&&this._freeze)return;for(var t=0,n=this._nodes.size();t<n;t++){var r=this._nodes.get(t);if(r&&e===r.node){this._centering=!0,this._freeze=!1,this._active=!0,this._centeringNode=r,this._localPoint=this.createControlPoint(this._centeringNode.node);break}}}else this._centering=!1,this._freeze=!1,this._active=!1,this._localPoint=null},createControlPoint:function(e){var t=e.getCenterLocation(),n=this.getLayoutRect(),r=n.x+n.width/2,i=n.y+n.height/2,s=Math.atan2(t.y-i,t.x-r),o=n.width+n.height;return{x:r+o*Math.cos(s),y:i+o*Math.sin(s)}},isAtCenter:function(e,t,n,r,i){if(this._moveSpeed<=0)return!0;var s=16/this._moveSpeed;return s>20?s=20:s<2&&(s=2),-i/Math.sqrt(n*n+r*r)>s},_updateNodes:function(e,t,n){this._sineCosine(e,t,n);for(var r=0,i=this._nodes.size();r<i;r++){var s=this._nodes.get(r),o=s.cx,u=s.cy*this._ca+s.cz*-this._sa,a=s.cy*this._sa+s.cz*this._ca,f=o*this._cb+a*this._sb,l=u,c=o*-this._sb+a*this._cb,h=f*this._cc+l*-this._sc,p=f*this._sc+l*this._cc,d=c;s.cx=h,s.cy=p,s.cz=d;var v=this._radius*2;v/=v+d,s.perspective=v;var m=this._horizontalElliptical*h*v-this._horizontalElliptical*2+this._centerX,g=p*v*this._verticalElliptical+this._centerY;s.node.setCenterLocation(m,g)}this._adjustIndex()},_installListeners:function(){this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._network.addViewListener(this.handleResize,this),b.addEventListener("mouseout","handleRollOut",this._network.getView(),this),b.addEventListener("mousemove","handleMouseMove",this._network.getView(),this),b.addEventListener("mouseover","handleMouseOver",this._network.getView(),this),this._network.addPropertyChangeListener(this.handleNetworkPropertyChange,this)},_uninstallListeners:function(){this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._network.removeViewListener(this.handleResize,this),b.removeEventListener("mouseout",this._network.getView(),this),b.removeEventListener("mousemove",this._network.getView(),this),b.removeEventListener("mouseover",this._network.getView(),this),this._network.removePropertyChangeListener(this.handleNetworkPropertyChange,this)}}),n.layout.AutoLayouter=function(e,t){this._box=e,this._network=t},r.ext("twaver.layout.AutoLayouter",Object,{_expandGroup:!1,_repulsion:1,_type:null,_animate:!0,_explicitXOffset:Number.NaN,_explicitYOffset:Number.NaN,_xOffset:0,_yOffset:0,isExpandGroup:function(){return this._expandGroup},setExpandGroup:function(e){this._expandGroup=e},getRepulsion:function(){return this._repulsion},setRepulsion:function(e){this._repulsion=e},getType:function(){return this._type},isAnimate:function(){return this._animate},setAnimate:function(e){this._animate=e},getElementBox:function(){return this._box},getExplicitXOffset:function(){return this._explicitXOffset},setExplicitXOffset:function(e){this._explicitXOffset=e},getExplicitYOffset:function(){return this._explicitYOffset},setExplicitYOffset:function(e){this._explicitYOffset=e},getNodeRect:function(e){var t=this;if(e instanceof n.Group&&e.isExpanded()&&e.getChildrenSize()>0){var r=null;for(var i=0,s=e.getChildrenSize();i<s;i++){var o=e.getChildAt(i);o instanceof n.Node&&(r=n.Util.unionRect(r,t.getNodeRect(o)))}var u=e.s("group.padding"),a=e.s("group.padding.top"),f=e.s("group.padding.bottom"),l=e.s("group.padding.left"),c=e.s("group.padding.right");return u&&n.Util.grow(r,u,u),a&&(r.y-=a,r.height+=a),f&&(r.height+=a),l&&(r.x-=l,r.width+=l),c&&(r.width+=c),r}if(this._network){var h=this._network.getElementUI(e);return h.invalidate(),h.validate(),h.getViewRect()}return null},getDimension:function(e){var t=this.getNodeRect(e);return t?{width:t.width,height:t.height}:{width:e.getWidth(),height:e.getHeight()}},isVisible:function(e){return!0},isMovable:function(e){return!0},getGroupLayoutType:function(e){return this._type},getElements:function(){var e,t=this._box,r=t.getSelectionModel().size()>1;r?e=t.getSelectionModel().getSelection():(e=new Oi,t.forEachByBreadthFirst(e.add,null,e)),this._xOffset=-1,this._yOffset=-1;var i=new Oi;for(var s=0,o=e.size();s<o;s++){var u=e.get(s);if(this.isVisible(u))if(u instanceof n.Link)i.add(u);else if(this.isMovable(u)&&u instanceof es){i.add(u);if(r){if(this._xOffset<0||u.getX()<this._xOffset)this._xOffset=u.getX();if(this._yOffset<0||u.getY()<this._yOffset)this._yOffset=u.getY()}}}return r||(isNaN(this._explicitXOffset)?this._xOffset=50/this._repulsion:this._xOffset=this._explicitXOffset,isNaN(this._explicitYOffset)?this._yOffset=50/this._repulsion:this._yOffset=this._explicitYOffset),i},getLayoutResult:function(e){var t={};return this.doLayoutImpl(e,null,t),t},doLayout:function(e,t){return this.doLayoutImpl(e,t)},doLayoutImpl:function(e,t,i){var s=this,o=t;t=function(){s._box._layoutMovingElements=!1,o&&o()},this._type=e;var u=null;if("round"===e)u=new Eo;else if("symmetry"===e)u=new Ho;else if("hierarchic"===e)u=new Xo;else if(e==="topbottom"||e==="bottomtop"||e==="rightleft"||e==="leftright")u=new oo;if(u==null)return!1;s._box._layoutMovingElements=!0;var a={},f=this.getElements(),l=new Bo(this,f,!0,null);f=l.process();var c=new Oo(this,f,e,!0,null);try{u.i2(c)}catch(h){return l.resetGroup(),t!=null&&t(),!1}var p,d;for(p in c._a){d=c._a[p];var v=c.g4(d);a[p]={x:v.x+this._xOffset,y:v.y+this._yOffset}}var m;if(e==="rightleft"||e==="leftright"||e==="bottomtop"){var g=Bo.createMatrix(e),y=Number.MAX_VALUE,b=Number.MAX_VALUE;for(p in a){d=c._a[p],m=a[p];var w=g.transform(m);m.x=w.x,m.y=w.y;var E;e==="rightleft"||e==="leftright"?(E=w.x-c.g9(d)/2/this._repulsion,E<y&&(y=E),E=w.y-c.gj(d)/2/this._repulsion,E<b&&(b=E)):(E=w.x-c.gj(d)/2/this._repulsion,E<y&&(y=E),E=w.y-c.g9(d)/2/this._repulsion,E<b&&(b=E))}for(p in a)d=c._a[p],m=a[p],m.x=m.x-y+this._xOffset,m.y=m.y-b+this._yOffset}if(i==null&&this._animate){var S=new Oi,x=new Oi;for(p in a)S.add(c._a[p].node),x.add(a[p]);n.animate.AnimateManager.endAnimate(),s._box._dataBoxChangeDispatcher.fire({kind:"layouting"}),n.animate.AnimateManager.start(new n.animate.AnimateCenterLocation(S,x,function(){l.resetGroup(),s._box._dataBoxChangeDispatcher.fire({kind:"layoutEnd"}),t!=null&&r.callLater(t)}))}else{s._box._dataBoxChangeDispatcher.fire({kind:"layouting"});for(p in a)d=c._a[p],m=a[p],i==null?d.node.setCenterLocation(m.x,m.y):i[d.node.getId()]=m;l.resetGroup(),s._box._dataBoxChangeDispatcher.fire({kind:"layoutEnd"}),t!=null&&r.callLater(t)}return!0}});var us=function(e,t){this.x=e,this.y=t};r.ext(us,Object,{equals:function(e){return this===e?!0:e instanceof us?e.x==this.x&&e.y==this.y:!1}});var as=function(e,t){this.width=e,this.height=t};r.ext(as,Object,{});var fs=function(e,t){this.x=e,this.y=t};r.ext(fs,Object,{});var ls=function(){arguments.length===2?(ls.superClass.constructor.call(this,arguments[1].width,arguments[1].height),this.x=arguments[0].x,this.y=arguments[0].y):(ls.superClass.constructor.call(this,arguments[2],arguments[3]),this.x=arguments[0],this.y=arguments[1])};r.ext(ls,as,{});var cs=function(e,t){if(cs.a2(e.x,t.x))this._a=1,this._b=0,this._c=-e.x;else{this._b=-1;var n=(t.y-e.y)/(t.x-e.x),r=e.y-e.x*n;this._a=n,this._c=r}};r.ext(cs,Object,{a3:function(){return this._a},a4:function(){return this._b},a5:function(){return this._c}}),cs.a6=function(e,t){if(cs.a1(e.a3())&&cs.a1(t.a3()))return null;if(cs.a1(e.a4())&&cs.a1(t.a4()))return null;if(cs.a1(t.a4())){var n=e;e=t,t=n}var r=e.a3(),i=e.a4(),s=-e.a5(),o,u;cs.a1(e.a3())?(o=t.a4(),u=-t.a5()):(o=t.a4()-t.a3()/e.a3()*e.a4(),u=-t.a5()-t.a3()/e.a3()*-e.a5());var a=u/o,f=(s-a*i)/r;return new us(f,a)},cs.a1=function(e){return cs.a2(e,0)},cs.a2=function(e,t){return Math.abs(e-t)<1e-5};var hs=function(e){this._a=new Ds;if(e)for(var t=0;t<e.size();t++)this._a.aa(e.get(t))};r.ext(hs,Object,{c:function(){return this._a.ah()},d:function(){return this._a.ah()},a:function(){var e=new Oi;for(var t=this.c();t.i1();t.i2())e.add(t.i6(),0);return new hs(e)},b:function(){return this._a.ay()}});var ps=function(e,t){this.x=e,this.y=t};r.ext(ps,Object,{a:function(e,t){this.x=e,this.y=t}});var ds=function(e,t){this.x=e||0,this.y=t||0};r.ext(ds,Object,{b:function(){return new ds(this.x,this.y)},a:function(e){this.z=e},c:function(){return this.x},d:function(){return this.y},f:function(e,t){this.x=e,this.y=t}});var vs=function(e){this._c=new Ds,e?(this.ac(e.a8().b()),this.ad(e.a9().b())):(this.ac(new ds),this.ad(new ds))};r.ext(vs,Object,{a6:function(){return this.a5(this)},ac:function(e){e.a(this),this._a=e},ad:function(e){e.a(this),this._b=e},a8:function(){return this._a},a9:function(){return this._b},a1:function(e,t){return this.a4(e,t,this.aa())},a2:function(){return this._c.ay()},a7:function(e){return this._c.ak(e)},aa:function(){return this._c.ay()===0?null:this._c.as()},a3:function(){this._c.af()},i2:function(e){var t=this.a7(e);return t!=null?new us(t.x,t.y):null},i1:function(){return this.a2()},i6:function(){var e=this.a8();return new us(e.c(),e.d())},i7:function(){var e=this.a9();return new us(e.c(),e.d())},i8:function(e){this.a8().f(e.x,e.y)},i9:function(e){this.a9().f(e.x,e.y)},i3:function(e,t,n){var r=this.a7(e);r!=null&&r.a(t,n)},i4:function(e,t){this.a1(e,t)},i5:function(){this.a3()}});var ms=function(e){ms.superClass.constructor.call(this,e)};r.ext(ms,vs,{a5:function(e){return new ms(e)},a4:function(e,t,n){var r=new ps(e,t);return this.ab(r,n),r},ab:function(e,t){this._c.an(e,this._c.al(t))}});var gs=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this._s=!1,this._w=30,this._h=30,this._x=e-this._w/2,this._y=t-this._h/2}else{var n=arguments[0];this._s=n._s,this._w=n._w,this._h=n._h,this._x=n._x,this._y=n._y}};r.ext(gs,Object,{m3:function(){return this.m2(this)},m4:function(){return this._x+this._w/2},m5:function(){return this._y+this._h/2},m6:function(e,t){this._x=e-this._w/2,this._y=t-this._h/2},i1:function(){return this._x},i2:function(){return this._y},i5:function(e,t){this._x=e,this._y=t},i3:function(){return this._w},i4:function(){return this._h},i6:function(e,t){var n=(this._w-e)/2,r=(this._h-t)/2;this._x+=n,this._y+=r,this._w=e,this._h=t},m1:function(e){var t,n,r,i;e.width<=0?(t=this._x,n=this._x+this._w,r=this._y,i=this._y+this._h):(t=Math.min(this._x,e.x),n=Math.max(this._x+this._w,e.x+e.width),r=Math.min(this._y,e.y),i=Math.max(this._y+this._h,e.y+e.height)),e.x=t,e.y=r,e.width=n-t,e.height=i-r}});var ys=function(e){e?ys.superClass.constructor.call(this,e):ys.superClass.constructor.call(this,0,0)};r.ext(ys,gs,{m2:function(e){return new ys(e)}});var bs={};bs.a2=function(e){var t=no.a2(Qo.a(e.xa()));return bs.a4(e,t,bs.a3(e,t))},bs.a3=function(e,t){for(var n=e.x9();n.i1();n.i2())t.i7(n.i9(),-1);var r=0,i=new Is(e.xa());for(var s=e.x9();s.i1();s.i2()){var o=s.i9();t.i2(o)===-1&&bs.a(o,i,t,r++)}return r},bs.a6=function(e){var t=new Ps,n=bs.a2(e);for(var r=0;r<n.length-1;r++){var i=e.xo(n[r].x2(),n[r+1].x3());t.aa(i)}return t},bs.a4=function(e,t,n){var r=[];for(var i=0;i<n;i++)r[i]=new Ys;for(var s=e.x9();s.i1();s.i2())r[t.i2(s.i9())].ae(s.i9());return r},bs.a=function(e,t,n,r){t.c(e),n.i7(e,r);while(!t.a()){e=t.b();for(var i=e.ag();i!=null;i=i.a8()){var s=i.a3();n.i2(s)===-1&&(n.i7(s,r),t.c(s))}for(var o=e.ae();o!=null;o=o.a7()){var u=o.a2();n.i2(u)===-1&&(n.i7(u,r),t.c(u))}}},bs.a1=function(e,t,n){var r=new Ls(t,n);return r.a8(e),r._i},bs.a5=function(e,t,n){var r=[];for(var i=0;i<n;i++)r[i]=new Ps;for(var s=e.xf();s.i1();s.i2())r[t.i2(s.i8())].aa(s.i8());return r},bs.a7=function(e){var t=new Ps,n=no.a3(Qo.b(e.xa())),r=no.a4(Qo.a(e.xh())),i=bs.a1(e,r,n),s=bs.a5(e,r,i);if(s.length>1){var o=new Ys;for(var u=0;u<s.length;u++){var a=s[u],f=null;if(a.ay()===1){var l=a.c2();l.a2().ad()===1?f=l.a2():l.a3().ad()===1&&(f=l.a3())}else{for(var c=a.c1();c.i1();c.i2()){var h=c.i8();if(n.i4(h.a2()))if(f==null)f=h.a2();else if(f!==h.a2()){f=null;break}if(!n.i4(h.a3()))continue;if(f==null){f=h.a3();continue}if(f===h.a3())continue;f=null;break}if(f!=null){var p=a.c2();p.a2()!==f?f=p.a2():f=p.a3()}}f!=null&&o.aa(f)}var d;for(var v=o.x4();!o.ar();v=d)d=o.x4(),t.ac(e.xo(v,d))}return t};var ws=function(){this._c=0,this._d=0,this._e=0,this._b=!0,this._f=!1};r.ext(ws,Object,{a6:function(e){this._f=e},a7:function(e){this._b=e},a8:function(e){e.x0()!==0&&this.a9(e,e.x9().i9())},a9:function(e,t){this._xx=e.xk(),this._c=e.xl(),this._d=0,this._e=0,this.a0(t);if(this._b)for(var n=e.x9();n.i1();n.i2()){var r=n.i9();this._xx.i1(r)==null&&(this.a1(r),this.a0(r))}e.xi(this._xx),e.xj(this._c)},a0:function(e){var t=++this._d;this._xx.z1(e,ws._B),this.a5(e,t);for(var n=this._f?e.ap():e.af();n.i1();n.i2()){var r=n.i8();if(!this._c.i4(r)){this._c.i7(r,!0);var i=r.a1(e);this._xx.i1(i)==null?(this.a3(r,i,!0),this.a0(i),this.a2(r,i)):this.a3(r,i,!1)}}this.a4(e,t,++this._e),this._xx.z1(e,ws._C)},a5:function(e,t){},a4:function(e,t,n){},a3:function(e,t,n){},a2:function(e,t){},a1:function(e){}}),ws._B={},ws._C={};var Es=function(e){this._a=e};r.ext(Es,ws,{a5:function(e,t){var n=this._a._ah.i2(e);this._a._ad[n].ae(e)}});var Ss=function(e){this._a=e};r.ext(Ss,ws,{a2:function(e,t){var n=e.a1(t),r=this._a[n.al()],i=this._a[t.al()];i._a+1>r._a?(r._c=r._a,r._b=r._d,r._a=i._a+1,r._d=e):i._a+1>r._c&&(r._c=i._a+1,r._b=e)}});var xs=function(e){this._a=e};r.ext(xs,ws,{a3:function(e,t,n){n&&e.a2()===t&&this._a.ac(e)}});var Ts=function(){this._a=0,this._c=0};r.ext(Ts,Object,{});var Ns=function(){this._a=0};r.ext(Ns,Object,{a1:function(e,t){this._a=0;for(var n=t.length-1;n>=0;n--)t[n]=-1;for(var r=e.x9();r.i1();r.i2()){var i=r.i9();if(i.ak()!==0)continue;this.a2(i,i.al(),t);break}for(var s=e.x9();s.i1();s.i2()){var o=s.i9(),u=o.al();t[u]===-1&&this.a2(o,u,t)}},a2:function(e,t,n){n[t]=-2;for(var r=e.ag();r!=null;){var i=r.a3(),s=i.al();switch(n[s]){case-1:this.a2(i,s,n);case-2:default:r=r.a8()}}n[t]=this._a++}});var Cs={};Cs.a1=function(e){var t=new ks;return t.a8(e),t._n},Cs.a2=function(e){var t=e.x9(),n=null,r=0;t.i4();for(;t.i1();t.i2())t.i9().ak()===0&&(n=t.i9(),r++);if(r===1)return n;r=0,t.i4();for(;t.i1();t.i2())t.i9().ao()===0&&(n=t.i9(),r++);return r===1?n:Cs.a8(e)},Cs.a8=function(e){var t=Qo.a(e.x0()),n=no.a2(t);return Cs.a6(e,n)},Cs.a6=function(e,t){var n=e.xd(),r=Qo.d(1),i=Qo.a(e.x0(),-1),s=Cs.a4(e,n);Cs.a7(n,t,r,i,-1);for(var o=s.c1();o.i1();o.i2())e.x3(o.i8());return r[0]},Cs.a7=function(e,t,n,r,i){var s=0;for(var o=e.ag();o!=null;o=o.a8()){var u=o.a3(),a=Cs.a7(u,t,n,r,i);a>i&&(i=a),s+=r[u.al()]}var f=s*(e._g.xa()-1-s);for(var l=e.ag();l!=null;l=l.a8()){var c=l.a3();for(var h=l.a8();h!=null;h=h.a8()){var p=h.a3();f+=r[c.al()]*r[p.al()]}}return t
.i7(e,f),r[e.al()]=s+1,f>i&&(i=f,n[0]=e),i},Cs.a4=function(e,t){var n=new Ps,r=new xs(n);r.a6(!1),r.a9(e,t);for(var i=n.c1();i.i1();i.i2())e.x3(i.i8());return n},Cs.a3=function(e){return Cs.a4(e,Cs.a2(e))};var ks=function(){this._n=!0,this.a6(!1)};r.ext(ks,ws,{a3:function(e,t,n){n||(this._n=!1)},a1:function(e){this._n=!1}});var Ls=function(e,t){this._i=0,this._m=t,this._j=e,this._l=!1};r.ext(Ls,ws,{a8:function(e){this._h=Qo.a(e.x0()),this._k=Qo.a(e.x0()),this._g=new Is(e.xh()),Ls.superClass.a8.call(this,e)},a5:function(e,t){this._k[e.al()]=this._h[e.al()]=t},a3:function(e,t,n){this._g.c(e);if(!n){var r=e.a1(t);this._h[r.al()]=Math.min(this._h[r.al()],this._k[t.al()])}},a1:function(e){this._l=!1},a2:function(e,t){var n=e.a1(t);if(this._h[t.al()]>=this._k[n.al()]){for(;this._g.d()!==e;this._j.i5(this._g.b(),this._i));this._j.i5(this._g.b(),this._i),this._i++,this._g.a()?this._l?this._m.i5(n,!0):this._l=!0:this._m.i5(n,!0)}this._h[n.al()]=Math.min(this._h[n.al()],this._h[t.al()])}});var As=function(e,t){this._h=!1,this._i=e,this._g=t};r.ext(As,Object,{z1:function(e,t){e._c[this._i]=t},i1:function(e){return e._c[this._i]},i5:function(e,t){e._c[this._i]=t},i4:function(e){return e._c[this._i]},i7:function(e,t){e._c[this._i]=t},i2:function(e){var t=e._c[this._i];return t==null?0:t},i6:function(e,t){e._c[this._i]=t},i3:function(e){var t=e._c[this._i];return t==null?0:t},c:function(){return this._h},d:function(){this._h=!0}});var Os=function(e,t){this._c=!1,this._d=e,this._b=t};r.ext(Os,Object,{i8:function(e,t){e._c[this._d]=t},i1:function(e){return e._c[this._d]},i7:function(e,t){e._c[this._d]=t},i4:function(e){var t=e._c[this._d];return t==null?!1:t},i5:function(e,t){e._c[this._d]=t},i2:function(e){var t=e._c[this._d];return t==null?0:t},i6:function(e,t){e._c[this._d]=t},i3:function(e){var t=e._c[this._d];return t==null?0:t},a:function(){return this._c},b:function(){this._c=!0}});var Ms=function(e){this._bb=e,this.i4()};r.ext(Ms,Object,{i1:function(){return this._aa!=null},i2:function(){this._aa=this._aa._a},i3:function(){this._aa=this._aa._b},i4:function(){this._aa=this._bb._b},i5:function(){this._aa=this._bb._c},i7:function(){return this._bb.ay()},i6:function(){return this._aa._c}});var _s=function(e){_s.superClass.constructor.call(this,e)};r.ext(_s,Ms,{i8:function(){return this.i6()}});var Ds=function(e){this._id=r.id(),this._a=0;if(e){e.i4();for(;e.i1();e.i2())this.ae(e.i6())}};r.ext(Ds,Object,{ac:function(e){var t=this.ag(e);return this._b==null?this._b=this._c=t:(this._b._b=t,t._a=this._b,this._b=t),this._a++,t},ae:function(e){var t=this.ag(e);return this._c==null?this._b=this._c=t:(this._c._a=t,t._b=this._c,this._c=t),this._a++,t},z1:function(e){e._b=null,e._a=null,this._c==null?this._b=this._c=e:(this._c._a=e,e._b=this._c,this._c=e),this._a++},ad:function(e){e._b=null,e._a=null,this._b==null?this._b=this._c=e:(this._b._b=e,e._a=this._b,this._b=e),this._a++},aa:function(e){return this.ae(e),!0},ab:function(e){for(;e.i1();e.i2())this.ae(e.i6())},ao:function(e,t){if(t===this._b)return this.ac(e);if(t==null)return this.ae(e);var n=this.ag(e);return this.aq(n,t),n},aq:function(e,t){if(t==null)this.ad(e);else if(t===this._b)this.ad(e);else{if(this._c==null)e._b=null,e._a=null,this._b=this._c=e;else{var n=t._b;t._b=e,e._a=t,n._a=e,e._b=n}this._a++}},ap:function(e,t){if(t==null)this.z1(e);else if(t===this._c)this.z1(e);else{if(this._b==null)e._b=null,e._a=null,this._b=this._c=e;else{var n=t._a;t._a=e,e._a=n,n._b=e,e._b=t}this._a++}},an:function(e,t){if(t===this._c)return this.ae(e);if(t==null)return this.ac(e);var n=this.ag(e);return this.ap(n,t),n},ay:function(){return this._a},ar:function(){return this._a===0},af:function(){this._b=this._c=null,this._a=0},am:function(){return this._b._c},at:function(){var e=this.am();return this.aw(this._b),e},as:function(){return this._c._c},au:function(){return this.aw(this._c)},ak:function(e){var t=0;for(var n=this._b;n!=null;){if(e===t)return n._c;n=n._a,t++}return null},aj:function(e){return e._a==null?this._b:e._a},ai:function(e){return e._b==null?this._c:e._b},aw:function(e){return e!==this._b?e._b._a=e._a:this._b=e._a,e!==this._c?e._a._b=e._b:this._c=e._b,this._a--,e._c},av:function(e){return this.aw(e._aa)},ah:function(){return new Ms(this)},al:function(e){var t=this._b;while(t!=null){if(t._c==null&&e==null)return t;if(t._c===e)return t;t=t._a}return null},a0:function(){var e=Qo.d(this._a),t=0;for(var n=this._b;n!=null;)e[t]=n._c,n=n._a,t++;return e},ax:function(){for(var e=this._b;e!=null;e=e._b){var t=e._a;e._a=e._b,e._b=t}var n=this._b;this._b=this._c,this._c=n},a1:function(e){var t=this.a0();t.sort(e);var n=0;for(var r=this._b;r!=null;)r._c=t[n],r=r._a,n++},a2:function(){var e=this.a0();e.sort(Qo.c);var t=0;for(var n=this._b;n!=null;)n._c=e[t],n=n._a,t++},az:function(e){this._b==null?(this._b=e._b,this._c=e._c):e._b!=null&&(this._c._a=e._b,e._b._b=this._c,this._c=e._c),this._a+=e._a,e._b=e._c=null,e._a=0},ag:function(e){return new js(e)}});var Ps=function(e){Ps.superClass.constructor.call(this,e)};r.ext(Ps,Ds,{c1:function(){return new _s(this)},c2:function(){return this.am()},c3:function(){return this.at()}});var Hs=function(){this._c=0};r.ext(Hs,Object,{a:function(e){this._c++,e._b=this._b,e._a=null,this._b!=null?(this._b._a=e,this._b=e):this._b=this._a=e},b:function(e,t){if(t==null){this.a(e);return}var n=t._b;n!=null?n._a=e:this._a=e,e._b=n,e._a=t,t._b=e,this._c++},c:function(e){var t=e._a,n=e._b;this._c--,t!=null?t._b=n:this._b=n,n!=null?n._a=t:this._a=t}});var Bs=function(e,t){this._p=e,this._j=t,this._o=e._o[t]};r.ext(Bs,Object,{i1:function(){return this._o!=null},i2:function(){this._o=this._o._k[this._j]},i3:function(){this._o=this._o._f[this._j]},i4:function(){this._o=this._p._o[this._j]},i5:function(){this._o=this._p._q[this._j]},i7:function(){return this._p._n[this._j]},i6:function(){return this._o},i8:function(){return this._o}});var js=function(e){this._c=e};r.ext(js,Object,{a:function(){return this._a},b:function(){return this._b},c:function(e){this._c=e},d:function(){return this._c}});var Fs=function(e,t,n,r){this._r=e,this._s=t,this._q=n,this._p=r};r.ext(Fs,Object,{i1:function(e){return this._p[e.a5()]},i3:function(e){return this._r[e.a5()]},i2:function(e){return this._s[e.a5()]},i4:function(e){return this._q[e.a5()]},i8:function(e,t){this._p[e.a5()]=t},i6:function(e,t){this._r[e.a5()]=t},i5:function(e,t){this._s[e.a5()]=t},i7:function(e,t){this._q[e.a5()]=t}});var Is=function(e){this._a=Qo.d(e),this._b=-1};r.ext(Is,Object,{d:function(){return this._a[this._b]},b:function(){return this._a[this._b--]},c:function(e){this._a[++this._b]=e},a:function(){return this._b<0}});var qs=function(){};r.ext(qs,Object,{a0:function(e){this._c=Qo.d(e)}});var Rs=function(e,t,n,r,i,s,o){this._g=0,e.xt(this,t,n,r,i,s,o)};r.ext(Rs,qs,{a5:function(){return this._h._u&&this._h.b1(),this._g},a2:function(){return this._d},a3:function(){return this._e},a1:function(e){return this._d!==e?this._d:this._e},a4:function(){for(var e=0;e<=1;e++)this._k[e]=null,this._f[e]=null},a8:function(){return this._k[0]},a7:function(){return this._k[1]},a6:function(e,t,n,r){this.a0(r),this._h=e,this._k=Qo.d(2),this._f=Qo.d(2),this._d=t,this._e=n}});var Us=function(e){this._j=0,this._h=e,this.i4()};r.ext(Us,Object,{i2:function(){this._k=this._k._k[this._j],this._k==null&&this._j===0&&(this._k=this._h._o[1],this._j=1)},i3:function(){this._k=this._k._f[this._j],this._k==null&&this._j===1&&(this._k=this._h._q[0],this._j=0)},i4:function(){this._k=this._h._o[0],this._k==null?(this._k=this._h._o[1],this._j=1):this._j=0},i5:function(){this._k=this._h._q[1],this._k==null?(this._k=this._h._q[0],this._j=0):this._j=1},i1:function(){return this._k!=null},i6:function(){return this._k},i8:function(){return this._k},i7:function(){return this._h.ad()}});var zs=function(){this._a=xo._A,this._b=xo._A,this._c=new Oi};r.ext(zs,Object,{i1:function(){return this._c.size()},i2:function(e){return this._c.get(e)},i3:function(e,t,n){this._c.set(e,new us(t,n))},i4:function(e,t){this._c.add(new us(e,t))},i5:function(){this._c.clear()},i6:function(){return this._a},i7:function(){return this._b},i8:function(e){this._a=e},i9:function(e){this._b=e}});var Ws=function(){this._x=0,this._y=0,this._w=0,this._h=0};r.ext(Ws,Object,{i5:function(e,t){this._x=e,this._y=t},i6:function(e,t){this._w=e,this._h=t},i4:function(){return this._h},i3:function(){return this._w},i1:function(){return this._x},i2:function(){return this._y}});var Xs=function(e,t,n,r){this._m=e,this._n=t,this._l=n,this._k=r};r.ext(Xs,Object,{i1:function(e){return this._k[e.al()]},i3:function(e){return this._m[e.al()]},i2:function(e){return this._n[e.al()]},i4:function(e){return this._l[e.al()]},z1:function(e,t){this._k[e.al()]=t},i6:function(e,t){this._m[e.al()]=t},i7:function(e,t){this._n[e.al()]=t},i5:function(e,t){this._l[e.al()]=t}});var Vs=function(e,t){this._b=e,this._r=t,this._a=[];for(var n=this._b-1;n>=0;n--)this._a.push(n);this._c=new Oi};r.ext(Vs,Object,{a1:function(e){var t;if(this._a.length===0){this.a2(e,this._b,this._b+this._r);for(var n=this._b+this._r-1;n>this._b;n--)this._a.push(n);t=this._b,this._b+=this._r}else t=this._a.pop();return t},b:function(e){var t=this.a1(e),n=new As(t,this);return this._c.add(n),this.a4(e,t),n},c:function(e){var t=this.a1(e),n=new Os(t,this);return this._c.add(n),this.a4(e,t),n},a2:function(e,t,n){for(var r=e._a;r!=null;r=r._a){var i=Qo.d(n);Qo.f(r._c,i,t),r._c=i}},a3:function(e,t,n){var r=Qo.d(n);Qo.f(e._c,r,t),e._c=r},a4:function(e,t){for(var n=e._a;n!=null;n=n._a)n._c[t]=null},a5:function(e,t){if(e instanceof As){var n=e;if(n.c())throw"Error";n.d();var r=e._i;this._a.indexOf(r)<0&&(this.a4(t,r),this._a.push(r),this._c.remove(e))}},a6:function(e,t){if(e instanceof Os){var n=e;if(n.a())throw"Error";n.b();var r=n._d;this._a.indexOf(r)<0&&(this.a4(t,r),this._a.push(r),this._c.remove(e))}}});var $s=function(e){this._id=r.id(),this._p=0,e.xs(this)};r.ext($s,qs,{ad:function(){return this._n[0]+this._n[1]},ak:function(){return this._n[1]},ao:function(){return this._n[0]},al:function(){return this._g._y&&this._g.c(),this._p},ag:function(){return this._o[0]},ae:function(){return this._o[1]},af:function(){return new Us(this)},am:function(){return new Bs(this,1)},ap:function(){return new Bs(this,0)},an:function(){return new Ks(this)},aq:function(){return new Js(this,1)},aw:function(){return new Js(this,0)},ah:function(e){for(var t=this._o[0];t!=null;t=t._k[0])if(t.a3()===e)return t;return null},ai:function(e){for(var t=this._o[1];t!=null;t=t._k[1])if(t.a2()===e)return t;return null},aj:function(e){var t=this.ah(e);return t==null&&(t=this.ai(e)),t},au:function(e){this.at(e,1,Qo.d(this.ak()))},av:function(e){this.at(e,0,Qo.d(this.ao()))},as:function(e,t){this.a0(t),this._g=e,this._o=Qo.d(2),this._q=Qo.d(2),this._n=Qo.a(2)},ab:function(e,t,n,r,i){if(t==null){this.aa(e,n,r);return}var s;t._d===t._e?s=r:s=this!==t._d?1:0;if(i===0){var o=t._k[s];e._f[r]=t,e._k[r]=o,t._k[s]=e,o==null?this._q[n]=e:o._d===o._e?o._f[r]=e:o._f[this!==o._d?1:0]=e}else{var u=t._f[s];e._k[r]=t,e._f[r]=u,t._f[s]=e,u==null?this._o[n]=e:u._d===u._e?u._k[r]=e:u._k[this!==u._d?1:0]=e}this._n[n]++},aa:function(e,t,n){var r=this._q[t];e._k[n]=null,r==null?(this._o[t]=e,e._f[n]=null):(e._f[n]=r,r._d===r._e?r._k[n]=e:r._k[this!==r._d?1:0]=e),this._q[t]=e,this._n[t]++},ar:function(e,t,n){var r,i;r=e._k[n],i=e._f[n],r==null?this._q[t]=i:r._f[r._d!==this?1:0]=i,i==null?this._o[t]=r:i._k[i._d!==this?1:0]=r,this._n[t]--},ac:function(){for(var e=0;e<=1;e++)this._o[e]=null,this._q[e]=null,this._n[e]=0},at:function(e,t,n){if(this._n[t]<2)return;var r=this._n[t],i=0,s;for(s=this._o[t];s!=null;s=s._k[t])n[i]=s,i++;Qo.s(n,r,e);var o=this._o[t]=n[0];o._f[t]=null;for(var u=1;u<r;)s=n[u],s._f[t]=o,o._k[t]=s,u++,o=s;this._q[t]=s,s._k[t]=null}});var Js=function(e,t){Js.superClass.constructor.call(this,e,t),this._h=t!==1?1:0};r.ext(Js,Bs,{i6:function(){return this.i9()},i9:function(){return this._h!==0?this._o._e:this._o._d}});var Ks=function(e){Ks.superClass.constructor.call(this,e)};r.ext(Ks,Us,{i6:function(){return this._k.a1(this._h)},i9:function(){return this._k.a1(this._h)}});var Qs=function(e){Qs.superClass.constructor.call(this,e)};r.ext(Qs,Ms,{i9:function(){return this.i6()}});var Gs=function(e){this._o=e,this._c=e._a};r.ext(Gs,Object,{i1:function(){return this._c!=null},i2:function(){this._c=this._c._a},i3:function(){this._c=this._c._b},i5:function(){this._c=this._o._b},i4:function(){this._c=this._o._a},i7:function(){return this._o._c},i6:function(){return this._c},i9:function(){return this._c},i8:function(){return this._c}});var Ys=function(e){if(e&&e.length){Ys.superClass.constructor.call(this);for(var t=0;t<e.length;t++)this.ae(e[t])}else Ys.superClass.constructor.call(this,e)};r.ext(Ys,Ds,{x1:function(){return new Qs(this)},x2:function(){return this.am()},x3:function(){return this.as()},x4:function(){return this.at()}});var Zs=function(e){this._d=e,Zs.superClass.constructor.call(this)};r.ext(Zs,Ys,{});var eo=function(e){this._a=e,this._b=new Ps,this._c=new Ys};r.ext(eo,Object,{a:function(){for(var e=this._a.x9();e.i1();e.i2())this.e(e.i9())},b:function(){this.c(),this.d()},c:function(){while(!this._c.ar()){var e=this._c.x4();this._a.xq(e)||this.g(e)}},d:function(){while(!this._b.ar()){var e=this._b.c3();this._a.xp(e)||this.f(e)}},e:function(e){for(var t=e.af();t.i1();t.i2())this._b.ac(t.i8()),this._a.h1(t.i8());this._c.ac(e),this._a.h2(e)},f:function(e){this._a.u1(e)},g:function(e){this._a.h3(e)}}),eo.h=function(e,t){t.i4();for(;t.i1();t.i2()){var n=t.i8();e.xq(n.a2())||e.h3(n.a2()),e.xq(n.a3())||e.h3(n.a3()),e.xp(n)||e.u1(n)}},eo.i=function(e,t){t.i4();for(;t.i1();t.i2()){var n=t.i8();e.xp(n)&&e.h1(n),n.a2().ad()===0&&e.h2(n.a2()),n.a3().ad()===0&&e.h2(n.a3())}};var to=function(){this._g=arguments[0],this._f=this._g.xk(),this._h=this._g.xk(),this._d=new Ds,this._e=0,arguments.length!==1&&this.a(arguments[1],arguments[2],arguments[3],arguments[4])};r.ext(to,Object,{a:function(e,t,n,r){var i=Qo.d(n-t+1);for(var s=t;s<=n;s++)i[s]=new Zs(s);for(var o=this._g.x9();o.i1();o.i2()){var u=o.i9();if(r==null||r.i4(u))this._f.z1(u,i[e.i2(u)-t].ac(u)),this._e++}for(var a=0;a<i.length;a++){var f=i[a],l=this._d.ae(f);for(var c=f.x1();c.i1();c.i2())this._h.z1(c.i9(),l)}},c:function(){this._g.xi(this._h),this._g.xi(this._f)},e:function(){return this._e===0},g:function(){for(;this._d.am().ar();this._d.at());this._e--;var e=this._d.am().x4();return this._h.z1(e,null),this._f.z1(e,null),e},f:function(){for(;this._d.as().ar();this._d.au());this._e--;var e=this._d.as().x4();return this._h.z1(e,null),this._f.z1(e,null),e},d:function(e){var t=this._f.i1(e),n=this._h.i1(e),r=n.d(),i=null,s=n.a();s!=null?(i=s.d(),this._h.z1(e,s)):(i=new Zs(r._d+1),this._h.z1(e,this._d.ae(i))),r.aw(t),this._f.z1(e,i.ac(e))},b:function(e){var t=this._f.i1(e),n=this._h.i1(e),r=n.d(),i=null,s=n.b();s!=null?(i=s.d(),this._h.z1(e,s)):(i=new Zs(r._d-1),this._h.z1(e,this._d.ac(i))),r.aw(t),this._f.z1(e,i.ac(e))}});var no={};no.a1=function(e){return new Xs(e,null,null,null)},no.a2=function(e){return new Xs(null,e,null,null)},no.a3=function(e){return new Xs(null,null,e,null)},no.a4=function(e){return new Fs(null,e,null,null)},no.a5=function(e){return new Fs(null,null,e,null)},no.a6=function(e){return new Fs(null,null,null,e)};var ro=function(){if(arguments.length===2){this._a=new Ds,this._b=new Ds,this._c=0;var e=arguments[0],t=arguments[1],n=new io(e._j2.gj(t)/2,0);this._a.ac(n),n=new io(e._j2.gj(t)/2,0),this._b.ac(n)}else this._a=arguments[1],this._b=arguments[2],this._c=arguments[3]};r.ext(ro,Object,{});var io=function(e,t){this._b=e,this._a=t};r.ext(io,Object,{});var so=function(){this._cx=!0,this._cs=new yo,this._ct=new mo,this._cw=new go};r.ext(so,Object,{i5:function(e){this._cx=e},k:function(){var e=new bo(this);return this._cx&&(this._cs.w1(e),e=this._cs),this._cw.w1(e),e=this._cw,this._ct.w1(e),e=this._ct,e},i2:function(e){this.k().i2(e)},i1:function(e){return this.k().i1(e)}});var oo=function(){oo.superClass.constructor.call(this),this._jv=20,this._jw=40,this._jx=function(e,t){var n=e.a3(),r=t.a3(),i=n._g;return Math.floor(100*(i.g5(n)-i.g5(r)))}};r.ext(oo,so,{i4:function(e){return Cs.a1(e)},i3:function(e){if(!this.i4(e))throw"Error";var t=Cs.a3(e);this._j2=e,this._j3=new uo(e),Mo.c(e),this._jy=e.xk();if(!e.xb()){this.bu();var n=this._j3.c1();this.f(n),this.b(this._j3),this.c(this._j3)}var r;for(;!t.ar();e.x3(r))r=t.c3(),Mo.b(e.g2(r))},bu:function(){if(this._jx!=null)for(var e=this._j2.x9();e.i1();e.i2())e.i9().av(this._jx)},c:function(e){var t=this.a2(e),n=Qo.a(t.length);for(var r=0;r<t.length;r++){var i=t[r],s=0;for(var o=i.ah();o.i1();o.i2()){var u=o.i6();s=Math.max(s,this._j2.g9(u))}n[r]=s}var a=-this._jw;for(var f=0;f<t.length;f++){a+=this._jw+n[f];var l=t[f];for(var c=l.ah();c.i1();c.i2()){var h=c.i6();this._j2.s2(h,this._j2.g5(h),a-n[f]/2)}}},a2:function(e){var t=Qo.d(e.b());for(var n=0,r=e.b();n<r;n++)t[n]=new Ds;return e.c1(),this.a1(e.c1(),0,t),t},a1:function(e,t,n){n[t].ae(e);for(var r=e.aw();r.i1();r.i2())this.a1(r.i9(),t+1,n)},b:function(e){var t=e.c1();this._j2.s2(t,0,this._j2.g6(t)),this.g(t)},g:function(e){for(var t=e.aw();t.i1();t.i2()){var n=t.i9(),r=this._jy.i1(n);this._j2.s2(n,this._j2.g5(e)+r._c,this._j2.g6(n)),this.g(n)}},f:function(e){if(this._j3.c2(e)){this._jy.z1(e,new ro(this,e));return}var t=e.aw(),n=t.i9();t.i2(),this.f(n);var r=this._jy.i1(n),i=new ro(this,r._a,r._b,0);if(!t.i1()){i._a.ac(new io(this._j2.gj(e)/2,0)),i._b.ac(new io(this._j2.gj(e)/2,0)),this._jy.z1(e,i);return}while(t.i1()){n=t.i9(),t.i2(),this.f(n),r=this._jy.i1(n);var s=i._b.ah(),o=r._a.ah(),u=2147483647,a=0,f=0;while(s.i1()&&o.i1()){var l=s.i6();s.i2();var c=o.i6();o.i2(),f+=l._a,a+=c._a,u=Math.min(u,a-f-l._b-c._b)}r._c=this._jv-u,a+=r._c;var h=r._b.am();h._a=r._c;if(s.i1()&&!o.i1())for(var p=f-this.a3(r._b);s.i1();p=0){var d=s.i6();s.i2(),r._b.ae(new io(d._b,d._a+p))}else if(!s.i1()&&o.i1()){var v=this.a3(i._a);for(v=a-v;o.i1();v=0){var m=o.i6();o.i2(),i._a.ae(new io(m._b,m._a+v))}}i._b=r._b}this._jy.z1(e,i);var g=-r._c/2;for(var y=e.aw();y.i1();){var b=y.i9();y.i2();var w=this._jy.i1(b);w._c+=g;var E=w._b.am();E._a+=g,E=w._a.am(),E._a+=g}i._a.ac(new io(this._j2.gj(e)/2,0)),i._b.ac(new io(this._j2.gj(e)/2,0))},a3:function(e){var t=0;for(var n=e.ah();n.i1();n.i2()){var r=n.i6();t+=r._a}return t}});var uo=function(e){this._b=e,this.a()};r.ext(uo,Object,{c1:function(){return this._a==null&&this.a(),this._a},b:function(){return this._a==null?-1:this.d(this._a)},d:function(e){var t=0;for(var n=e.aw();n.i1();n.i2())t=Math.max(t,this.d(n.i9()));return t+1},c2:function(e){return e.ao()===0},a:function(){for(var e=this._b.x9();e.i1();e.i2())if(e.i9().ak()===0){this._a=e.i9();return}}});var ao=function(e){this._d=0,this._e=0,this._f=0,this._a=0,this._b=0,this._g=e,this._c=new Ds};r.ext(ao,Object,{a:function(){return this._d+this._e+this._f}});var fo=function(){fo.superClass.constructor.call(this),this._kl=340,this._km=360,this._kk=40,this._ko=.5};r.ext(fo,so,{ic:function(){return this._km},ia:function(){return this._kl},i9:function(){return this._ko},i3:function(e){if(!Cs.a1(e))throw"Error";this._a=e;var t=this.i8(),n=Cs.a4(e,t);Mo.c(e),this._kn=Qo.d(e.x0());for(var r=e.x9();r.i1();r.i2()){var i=r.i9();i!==t?this.aa(i,new ao(this._kk+this.q(i.aq().i9()))):this.aa(i,new ao(this._kk))}this.s(t),e.s2(t,0,0),this.t(t);var s;for(;!n.ar();e.x3(s))s=n.c3()},i4:function(e){return Cs.a1(e)},i0:function(e){return this._kn[e.al()]},i8:function(){return Cs.a2(this._a)},i7:function(e){var t=this.ib(e),n;do{n=this.i6(e);if(n<=t)break;for(var r=e.aw();r.i1();r.i2()){var i=r.i9();this.i0(i)._g*=1+this._ko}}while(!0);var s=(t-n)/(2*e.ao());n=0;for(var o=e.aw();o.i1();o.i2()){var u=this.i0(o.i9());u._d+=s,u._e+=s,n+=u._d+u._e}this.id(e)},id:function(e){var t=Qo.d(e.ao()),n=0;for(var r=e.ap();r.i1();)t[n]=r.i8(),r.i2(),n++;var i=this;t.sort(function(e,t){var n=e.a3(),r=t.a3(),s=i.i0(n).a()-i.i0(r).a();return s>0?1:s>=0?0:-1});for(var s=0;s<t.length;s++)this._a.h1(t[s]);for(var o=0;o<t.length;o+=2)this._a.u1(t[o]);n=t.length-1,n%2===0&&n--;for(;n>0;n-=2)this._a.u1(t[n])},ib:function(e){return e.ak()===0?this._km:e.ao()===2?Math.min(180,this._kl):this._kl},i6:function(e){var t=0;for(var n=e.ap();n.i1();n.i2()){var r=n.i8(),i=r.a3(),s=this.i0(i),o=-s._g,u=s._b,a=s._c,f=0,l=f+1,c=a._b,h=c.d(),p;for(;l>f;l=(p.y-u)/(p.x-o))p=h,c=a.ai(c),h=c.d(),f=(h.y-p.y)/(h.x-p.x);s._d=-Math.atan(l)*180/Math.PI,f=0,l=f-1,c=a._b;for(h=c.d();c.a().d().x===h.x;h=c.d())c=c.a();var d;for(;l<f;l=(d.y-u)/(d.x-o))d=h,c=a.aj(c),h=c.d(),f=(h.y-d.y)/(h.x-d.x);s._e=Math.atan(l)*180/Math.PI,t+=s._d+s._e}return t},aa:function(e,t){this._kn[e.al()]=t},p:function(e){var t=this.i0(e),n=new Ds,r=2*this.q(e);n.aa(new us(0,0)),n.aa(new us(0,r)),n.aa(new us(r,r)),n.aa(new us(r,0)),t._c=n,t._a=r/2,t._b=r/2},r:function(e){if(e.ao()===0)this.p(e);else{var t=this.i0(e),n=this.q(e),r=new Ds;r.aa(new us(-n,-n)),r.aa(new us(-n,n)),r.aa(new us(n,-n)),r.aa(new us(n,n));for(var i=e.aw();i.i1();i.i2()){var s=this.i0(i.i9());r.az(s._c)}var o=xo.h(r),u=Number.MAX_VALUE,a=Number.MAX_VALUE,f=Number.MIN_VALUE,l=Number.MIN_VALUE;for(var c=o.ah();c.i1();c.i2()){var h=c.i6();h.x<u&&(u=h.x),h.x>f&&(f=h.x),h.y<a&&(a=h.y),h.y>l&&(l=h.y)}var p=new Ds;for(var d=o.ah();d.i1();d.i2()){var v=d.i6();p.aa(new us(v.x-u,v.y-a))}t._c=p,t._a=-u,t._b=-a}},s:function(e){if(e.ao()===0)this.r(e);else{for(var t=e.aw();t.i1();t.i2())this.s(t.i9());this.i7(e);var n=0;for(var r=e.aw();r.i1();r.i2()){var i=r.i9(),s=this.i0(i),o=180-(360-this.ib(e))/2-n-(s._e+s._f);n+=s.a(),o=o/180*Math.PI;var u=Math.sin(o),a=Math.cos(o);for(var f=s._c._b;f!=null;f=f.a()){var l=f.d(),c=l.x+s._g,h=l.y-s._b,p=new us(c*a-u*h,c*u+a*h);f.c(p)}var d=s._a+s._g;s._a=d*a,s._b=d*u}this.r(e)}},t:function(e){var t=this._a.g4(e),n=0;if(e.ak()>0){var r=e.aq().i9(),i=this._a.g4(r);n=Math.PI+Math.atan2(i.y-t.y,i.x-t.x)}for(var s=e.aw();s.i1();s.i2()){var o=s.i9(),u=this.i0(o);if(n!==0){var a=Math.cos(n),f=Math.sin(n),l=u._a*a-f*u._b,c=u._a*f+a*u._b;u._a=l,u._b=c}this._a.s2(o,t.x+u._a,t.y+u._b),this.t(o)}},q:function(e){return 1.41*(Math.max(this._a.gj(e),this._a.g9(e))/2)}});var lo=function(){};r.ext(lo,Object,{i2:function(e){return e.ad()},i1:function(e){throw"Error"},i3:function(e){throw"Error"},i4:function(e){throw"Error"}});var co=function(e){this._a=e};r.ext(co,Object,{i2:function(e){var t=0;for(var n=e.an();n.i1();n.i2())this._a.i1(n.i9())!=null&&t++;return t},i4:function(e){return this._a.i1(e)==null},i1:function(e){throw"Error"},i3:function(e){throw"Error"}});var ho=function(){ho.superClass.constructor.call(this),this._kq=!1,this._kp=90};r.ext(ho,fo,{a:function(e,t){this._kr=t,this._ks=e,this._kq=!0},i7:function(e){if(!this.u(e)){ho.superClass.i7.call(this,e);return}var t=this.i9(),n=this.ib(e),r=(360-n)/2+n,i=new Ps(e.ap());do{var s=this.i6(e);s=(360-n)/2;var o=null,u=null;for(var a=i._b;a!=null;a=a.a()){var f=a.d(),l=f.a3(),c=this.i0(l),h=this._ks.i3(f),p=h-(s+c._e);p>=0&&h+c._d>=r&&(s+c.a()<=r?p=r-s-c.a():p=2*(r-(h+c._d))),c._f=0;if(p>=0)c._f=p,o=a,u=c;else{-p>c._d+c._e?p=(c._d+c._e)/2:p/=-2,s-=p,s<=r&&s+c.a()>r&&(s+=p,p=s+c.a()-r,s-=p);for(;o!=null&&p>u._f;u=this.i0(o.d().a3())){p-=u._f,u._f=0,o=o.b();if(o!=null)continue;u=null;break}o!=null?u._f-=p:s+=p}s+=c.a()}if(s<=r){var d=0,v=(360-n)/2;for(var m=e.ap();m.i1();m.i2()){var g=m.i8(),y=g.a3(),b=this._ks.i3(g),w=this.i0(y),E=v+w._f+w._e;d<Math.abs(E-b)&&(d=Math.abs(E-b)),v+=w.a()}if(d<=this._kp)break}for(var S=e.aw();S.i1();S.i2()){var x=S.i9();this.i0(x)._g*=1+t}}while(!0)},ib:function(e){return this.u(e)?e.ak()===0?this.ic():this.ia():ho.superClass.ib.call(this,e)},u:function(e){return!this._kq||e.ao()===0?!1:this._ks.i1(e.ag())!=null}});var po=function(e){this._a=e};r.ext(po,Object,{i1:function(e){return this._a.i1(e)},i2:function(e){throw"Error"},i3:function(e){throw"Error"},i4:function(e){throw"Error"}});var vo=function(){};r.ext(vo,Object,{w1:function(e){this._bb=e},w2:function(){return this._bb},w4:function(e){this._bb!=null&&this._bb.i2(e)},w3:function(e){return this._bb!=null?this._bb.i1(e):!0}});var mo=function(){this._cg=45,this._ce=400,this._ch=400,this._cf=0};r.ext(mo,vo,{i1:function(e){if(this.w2()!=null){var t=!0,n=e.xk(),r=bs.a3(e,n),i=Qo.d(r),s=Qo.d(r);for(var o=0;o<r;o++)i[o]=new Ys,s[o]=new Ps;for(var u=e.xf();u.i1();u.i2()){var a=u.i8();s[n.i2(a.a2())].aa(a),e.h1(a)}for(var f=e.x9();f.i1();f.i2()){var l=f.i9();i[n.i2(l)].aa(l),e.h2(f.i9())}for(var c=0;c<r;c++){for(var h=i[c].x1();h.i1();h.i2())e.h3(h.i9());for(var p=s[c].c1();p.i1();p.i2())e.u1(p.i8());t=this.w3(e);for(var d=s[c].c1();d.i1();d.i2())e.h1(d.i8());for(var v=i[c].x1();v.i1();v.i2())e.h2(v.i9());if(!t)break}for(var m=0;m<r;m++)for(var g=i[m].x1();g.i1();g.i2())e.h3(g.i9());for(var y=0;y<r;y++)for(var b=s[y].c1();b.i1();b.i2())e.u1(b.i8());return e.xi(n),t}return!0},i2:function(e){if(e.xb())return;var t=e.xk(),n=bs.a3(e,t),r=Qo.d(n),i=Qo.d(n),s=Qo.d(n),o=Qo.d(n);for(var u=0;u<n;u++)r[u]=new Ys,i[u]=new Ps;for(var a=e.xf();a.i1();a.i2()){var f=a.i8();i[t.i2(f.a2())].aa(f),e.h1(f)}for(var l=e.x9();l.i1();l.i2()){var c=l.i9();r[t.i2(c)].aa(c),e.h2(l.i9())}for(var h=0;h<n;h++){for(var p=r[h].x1();p.i1();p.i2())e.h3(p.i9());for(var d=i[h].c1();d.i1();d.i2())e.u1(d.i8());this.w4(e);var v=e.g3();s[h]=new ls(v.x,v.y,v.width,v.height);var m={};o[h]=m;if(this._cf>0){var g=this._cg+Math.ceil((v.width+1)/this._cf)*this._cf,y=this._cg+Math.ceil((v.height+1)/this._cf)*this._cf;m.x=v.x,m.y=v.y,m.width=g,m.height=y}else m.x=v.x,m.y=v.y,m.width=v.width+this._cg,m.height=v.height+this._cg;for(var b=i[h].c1();b.i1();b.i2())e.h1(b.i8());for(var w=r[h].x1();w.i1();w.i2())e.h2(w.i9())}for(var E=0;E<n;E++)for(var S=r[E].x1();S.i1();S.i2())e.h3(S.i9());for(var x=0;x<n;x++)for(var T=i[x].c1();T.i1();T.i2())e.u1(T.i8());Mo.a(o,null,this._ce/this._ch);if(this._cf<=0)for(var N=0;N<o.length;N++)this.w5(e,r[N],i[N],new us(o[N].x,o[N].y),s[N]);else for(var C=0;C<o.length;C++){var k=Math.floor((o[C].x-s[C].x)/this._cf)*this._cf,L=Math.floor((o[C].y-s[C].y)/this._cf)*this._cf,A=s[C].x+k,O=s[C].y+L;this.w5(e,r[C],i[C],new us(A,O),s[C])}e.xi(t)},w5:function(e,t,n,r,i){var s=-i.x+r.x,o=-i.y+r.y;for(var u=t.x1();u.i1();u.i2()){var a=e.ga(u.i9());e.s4(u.i9(),new us(a.x+s,a.y+o))}for(var f=n.c1();f.i1();f.i2()){var l=f.i8(),c=new Oi;for(var h=e.gp(l).c();h.i1();h.i2()){var p=h.i6();c.add(new us(p.x+s,p.y+o))}e.s5(l,new hs(c))}}});var go=function(){};r.ext(go,vo,{i1:function(e){return this.w3(e)},i2:function(e){this.w7(e),this.w2()!=null&&this.w4(e),this.w6(e)},w7:function(e){this.e(e),this.k(e),this.i(e)},e:function(e){for(var t=e.x9();t.i1();t.i2()){var n=e.g4(t.i9());e.s1(t.i9(),n)}},w6:function(e){this.l(e),this.j(e),this.f(e)},l:function(e){for(var t=e.x9();t.i1();t.i2()){var n=e.g4(t.i9());e.s1(t.i9(),n)}},j:function(e){for(var t=e.xf();t.i1();t.i2()){var n=e.g7(t.i8()),r=n.i6();n.i8(r),r=n.i7(),n.i9(r);for(var i=0;i<n.i1();i++){var s=n.i2(i);n.i3(i,s.x,s.y)}}},k:function(e){for(var t=e.xf();t.i1();t.i2()){var n=e.g7(t.i8()),r=n.i6();n.i8(r),r=n.i7(),n.i9(r);for(var i=0;i<n.i1();i++){var s=n.i2(i);n.i3(i,s.x,s.y)}}},f:function(e){this._ca!=null&&(e.x1("A",this._ca),this._ca=null,this._b6=null),this._b8!=null&&(e.x1("B",this._b8),this._b8=null,this._b9=null)},i:function(e){this._ca=e.xc("A"),this._ca!=null&&(this._b6=new po(this._ca),e.x1("A",this._b6)),this._b8=e.xc("B"),this._b8!=null&&(this._b9=new po(this._b8),e.x1("B",this._b9))}});var yo=function(){this._a=new Ps,this._c=10};r.ext(yo,vo,{i2:function(e){this._b=e.xl(),this.w9(e),this.w4(e),this.c(e),this.w8(e,this._b),e.xj(this._b)},i1:function(e){if(this.w2()==null)return!0;this._b=e.xl(),this.w9(e);var t=this.w3(e);return this.c(e),e.xj(this._b),t},w8:function(e,t){for(var n=e.xf();n.i1();n.i2()){var r=n.i8();if(t.i1(r)!=null){var i=t.i1(r);Mo.g(e,r,i,this._c)}}},w9:function(e){var t=e.xk();for(var n=e.x9();n.i1();n.i2()){var r=n.i9();for(var i=r.af();i.i1();i.i2()){var s=i.i8(),o=s.a1(r),u=t.i1(o);if(u!==s)if(u==null)t.z1(o,s);else{this._b.i1(u)==null&&this._b.i8(u,new Ps);var a=this._b.i1(u);a.aa(s),this._a.ac(s),e.h1(s)}}for(var f=r.af();f.i1();f.i2()){var l=f.i8(),c=l.a1(r);t.z1(c,null)}}e.xi(t)},c:function(e){for(;!this._a.ar();e.u1(this._a.c3()));}});var bo=function(e){this._a=e};r.ext(bo,Object,{i2:function(e){this._a.i3(e)},i1:function(e){return this._a.i4(e)}});var wo=function(){wo.superClass.constructor.call(this),this._jo=30,this._jp=new To,this._jt=5};r.ext(wo,so,{i4:function(e){return!0},i3:function(e){this._ju=e,Mo.c(e);var t=this._jp.i1(e),n=0;for(var r=e.x9();r.i1();r.i2())n=Math.max(n,this.e(r.i9()));n<this._jt&&(n=this._jt),this.a(t,n)},a:function(e,t){var n=e.i7(),r=2*Math.PI/n,i=0,s=Qo.a(n);e.i4();for(var o=0;o<n;)s[o]=this.e(e.i9())+this._jo,i+=s[o],o++,e.i2();var u=i/n,a=i/(Math.PI*2);a<t&&(a=t),e.i4();var f=0;for(var l=0;l<n;){var c=r/u*s[l];f+=c/2;var h=Math.cos(f)*a,p=Math.sin(f)*a;f+=c/2,this._ju.s2(e.i9(),h,p),l++,e.i2()}return a},e:function(e){var t=this._ju.gj(e),n=this._ju.g9(e);return t<=n?n:t}});var Eo=function(){Eo.superClass.constructor.call(this),this._jm=new wo,this._jk=new ho};r.ext(Eo,so,{i4:function(e){return!0},i3:function(e){if(e.x0()<2)return;this._jn=e,Mo.c(this._jn),Mo.e(this._jn);var t=new Ao(this._jn);t.a1(),t.h();var n=new eo(this._jn);n.a();for(var r=t.x9();r.i1();r.i2()){var i=r.i9(),s=t.c2(i);if(s.ay()>1){var o=t.d1(i);eo.h(this._jn,o.c1()),this._jm.i3(this._jn);var u=this._jn.g3();t.s7(i,u.width,u.height)}else if(s.ay()===1){var a=s.x2();t.s8(i,this._jn.gm(a)),this._jn.s2(a,0,0)}else t.s7(i,1,1);eo.i(this._jn,this._jn.xf())}n.b();var f=this.a7(t);Cs.a4(t,f);var l=t.xk(),c=t.xl();this.a2(t,c,l),this.a1(t,c),this.a3(t,f,c),this._jk.a(c,l),this._jk.i3(t),this.a5(t,f,l);for(var h=t.x9();h.i1();h.i2()){var p=h.i9(),d=t.g4(p);for(var v=t.c2(p).x1();v.i1();v.i2()){var m=v.i9();this._jn.s2(m,d.x+this._jn.g5(m),d.y+this._jn.g6(m))}}},a7:function(e){var t=-1,n=null;for(var r=e.x9();r.i1();r.i2()){var i=r.i9();e.c2(i).ay()>t&&(n=i,t=e.c2(i).ay())}return n},a1:function(e,t){var n=function(e,n){var r=t.i3(e)-t.i3(n);return r>0?1:r>=0?0:-1};for(var r=e.x9();r.i1();r.i2())r.i9().av(n)},a2:function(e,t,n){var r=Qo.a(this._jn.x0());for(var i=e.x9();i.i1();i.i2()){var s=i.i9(),o=e.c2(s);for(var u=o.x1();u.i1();u.i2()){var a=u.i9();r[a.al()]=s.al()}}var f=Cs.a2(e);this.a4(e,f,r,t,n)},a3:function(e,t,n){if(e.c2(t).ay()>1){var r=0,i=0,s=0;for(var o=t.ap();o.i1();o.i2()){var u=o.i8(),a=n.i3(u);a-r>i&&(i=a-r,s=(r+a)/2),r=a}360-r>i&&(s=(360+r)/2),this.a6(e,t,s);for(var f=t.ap();f.i1();f.i2()){var l=f.i8(),c=n.i3(l);for(c-=s;c<0;c+=360);n.i6(l,c)}t.av(function(e,t){var r=n.i3(e)-n.i3(t);return r>0?1:r>=0?0:-1})}},a4:function(e,t,n,r,i){var s=t.al(),o=i.i3(t);for(var u=t.ap();u.i1();u.i2()){var a=u.i8(),f=e.b(a),l=0,c=0,h=0,p=0;for(var d=f.c1();d.i1();d.i2()){var v=d.i8(),m=null,g=null;n[v.a2().al()]===s?(m=v.a2(),g=v.a3()):(m=v.a3(),g=v.a2()),h-=this._jn.g5(m),p+=this._jn.g6(m),l-=this._jn.g5(g),c+=this._jn.g6(g)}if(h!==0||p!==0){var y;for(y=Math.atan2(p,h)*180/Math.PI-o;y<0;y+=360);r.i6(a,y)}if(l!==0&&c!==0){var b=Math.atan2(c,l)*180/Math.PI;b<0&&(b+=360),i.i6(a.a3(),b)}this.a4(e,a.a3(),n,r,i)}},a5:function(e,t,n){var r=e.g4(t);for(var i=t.ap();i.i1();i.i2()){var s=i.i8(),o=s.a3(),u=e.g4(o),a=u.x-r.x,f=u.y-r.y,l=Math.atan2(f,a)*180/Math.PI;if(n.i1(o)!=null){var c=n.i3(o);l+=c}this.a6(e,o,l),this.a5(e,o,n)}},a6:function(e,t,n){n=n/180*Math.PI;var r=e.c2(t);if(r.ay()<=1)return;for(var i=r.x1();i.i1();i.i2()){var s=i.i9(),o=this._jn.g5(s),u=this._jn.g6(s),a=Math.cos(n),f=Math.sin(n),l=o*a-f*u,c=o*f+a*u;this._jn.s2(s,l,c)}}});var So=function(){this._a=(new Date).getTime()};r.ext(So,Object,{b:function(){return(new Date).getTime()-this._a}});var xo={};xo._A=new us(0,0),xo.b=function(e,t,n){return xo.c(e.x,e.y,t.x,t.y,n.x,n.y)},xo.c=function(e,t,n,r,i,s){n-=e,r-=t,i-=e,s-=t;var o=i*r-s*n;return Math.abs(o)<1e-5?0:o>=0?o<=0?0:-1:1},xo.d=function(e,t,n){return xo.b(e,t,n)>0},xo.f=function(e,t,n){return xo.b(e,t,n)<0},xo.g=function(e,t,n){return xo.b(e,t,n)===0},xo.h=function(e){return xo.i(e)},xo.i=function(e){var t=new Ds(e.ah()),n=new Ds;t.a2();if(t.ar())return n;var r=t.at();n.ae(r);for(;!t.ar()&&r.equals(t.am());t.at());if(t.ar())return n;r=t.at();var i=n.ae(r);for(var s=t.ah();s.i1();s.i2()){var o=s.i6();if(!o.equals(r)){r=o;if(n.ay()===2&&xo.g(n.am(),n.as(),o))i.c(o);else{var u;for(u=i;!xo.f(n.ai(u).d(),u.d(),o);u=n.ai(u));var a;for(a=i;!xo.d(n.aj(a).d(),a.d(),o);a=n.aj(a));for(;a!==n.aj(u);n.aw(n.aj(u)));i=n.an(o,u)}}}return n},xo.j=function(){return xo.k(Number.MAX_VALUE)},xo.k=function(e){return Math.floor(n.Util.random()*e)},xo.l=function(e,t){return n.Util.random()*(t-e)+e};var To=function(){};r.ext(To,Object,{i1:function(e){this._b=e;var t=new Ps;t=bs.a6(e),t.az(bs.a7(e));var n=this.a1();for(
;!t.ar();e.x5(t.c3()));return n.x1()},a1:function(){if(this._b.x0()<3)return new Ys(this._b.x9());var e=this._b.xk(),t=this._b.xk(),n=this._b.xl(),r=new to(this._b,new lo,0,this.a3(this._b)),i=this._b.x0(),s=new Ps,o=new Ps,u=new eo(this._b);for(;i>3;i--){var a=r.g();for(var f=a.an();f.i1();f.i2())e.z1(f.i9(),i),t.i5(f.i9(),!1);for(var l=a.an();l.i1();l.i2()){var c=l.i9();for(var h=c.ap();h.i1();h.i2()){var p=h.i8();e.i2(p.a3())===i&&(o.aa(p),t.i5(p.a2(),!0),t.i5(p.a3(),!0))}}if(o.ay()<a.ad()-1){var d=null;for(var v=a.an();v.i1();v.i2()){var m=v.i9();if(e.i2(m)===i&&!t.i4(m))if(d==null)d=m;else{var g=this._b.xo(d,m);n.i7(g,!0),o.aa(g),d=null}}if(d!=null)for(var y=a.an();y.i1();y.i2()){var b=y.i9();if(b===d||b.aj(d)!=null)continue;var w=this._b.xo(d,b);n.i7(w,!0),o.aa(w);break}if(o.ay()<a.ad()-1){var E=2147483647,S=null;for(var x=a.an();x.i1();x.i2()){var T=x.i9();T.ad()<E&&(S=T,E=T.ad())}for(var N=a.an();N.i1();N.i2()){var C=N.i9();if(S.aj(C)!=null||S===C)continue;var k=this._b.xo(S,C);n.i7(k,!0),o.aa(k);if(o.ay()>=a.ad()-1)break}}}for(var L=a.an();L.i1();L.i2())r.b(L.i9());for(var A=o.c1();A.i1();A.i2()){var O=A.i8();n.i4(O)&&(r.d(O.a2()),r.d(O.a3()))}s.az(o),u.e(a)}u.b(),r.c();for(var M=s.c1();M.i1();M.i2()){var _=M.i8();_._h!=null&&(n.i4(_)?this._b.x5(_):this._b.h1(_))}var D=this.a4(this._b),P=new Ys,H=D.ak(0),B=D.ak(1),j=null;H.a2()===B.a2()||H.a2()===B.a3()?j=H.a3():j=H.a2(),P.aa(j);for(var F=D.c1();F.i1();F.i2()){var I=F.i8();j=I.a1(j),P.aa(j)}for(var q=s.c1();q.i1();q.i2()){var R=q.i8();!n.i4(R)&&R._h==null&&this._b.u1(R)}return this._b.xi(t),this._b.xj(n),this._b.xi(e),this.a2(P),P},a2:function(e){if(e.ay()<this._b.x0()){var t=this._b.xk();for(var n=e._b;n!=null;n=n.a()){var r=n.d();t.z1(r,n)}var i;for(i=new to(this._b,new co(t),0,e.ay(),new co(t));!i.e();){var s=i.f();for(var o=s.an();o.i1();o.i2()){var u=o.i9();if(t.i1(u)==null)continue;var a=t.i1(u),f=e.ai(a).d(),l=null;s.aj(f)!=null?l=e.ao(s,a):l=e.an(s,a),t.z1(s,l);break}for(var c=s.an();c.i1();c.i2()){var h=c.i9();t.i1(h)==null&&i.d(h)}}this._b.xi(t),i.c()}},a3:function(e){var t=0;for(var n=e.x9();n.i1();n.i2())t=Math.max(t,n.i9().ad());return t},a4:function(e){var t=[];for(var n=0,r=e.x0();n<r;n++)t[n]=new Ts;var i=new Ss(t);i.a6(!1),i.a8(e);var s=-1,o=null;for(var u=e.x9();u.i1();u.i2()){var a=u.i9(),f=t[a.al()];f._a+f._c>s&&(s=f._a+f._c,o=a)}var l=new Ps,c=o;for(var h=t[c.al()]._d;h!=null;h=t[c.al()]._d)l.ac(h),c=h.a1(c);c=o;for(var p=t[c.al()]._b;p!=null;p=t[c.al()]._d)l.ae(p),c=p.a1(c);return l}});var No=function(){this._v=new Hs,this._x=new Hs,this._z=new Vs(3,5),this._w=new Vs(3,5),this._y=!1,this._u=!1,this._t={}};r.ext(No,Object,{xm:function(){var e=new $s(this);return e},xo:function(e,t){return this.xn(e,null,t,null,0,0)},xn:function(e,t,n,r,i,s){return new Rs(this,e,t,n,r,i,s)},x4:function(e){this.b3(e)},b3:function(e){var t;while((t=e._o[0])!=null)this.x5(t);while((t=e._o[1])!=null)this.x5(t);this._v.c(e),e._g=null,this._y=!0},x5:function(e){this.a11(e)},a11:function(e){if(e._h!==this)throw"Error";var t=e.a2(),n=e.a3();this.a12(e,t,n),this._x.c(e),e._h=null,this._u=!0},x7:function(e){e._p=this._v._c,e._g=this,e.ac(),e._c.length<this._z._b&&this._z.a3(e,e._c.length,this._z._b),this._v.a(e),this._y=!0},x8:function(e){if(e._h!=null)throw"Error";e._c.length<this._w._b&&this._w.a3(e,e._c.length,this._w._b),e._a==null||e._a._h!==this?this._x.a(e):this._x.b(e,e._a),e._h=this,e.a4(),this.b2(e,e.a2(),null,e.a3(),null,0,0),this._u=!0},xr:function(e,t,n){var r=e.a2(),i=e.a3();e._h==null?(e._d=t,e._e=n):(r!==t&&(r.ar(e,0,0),e._d=t,t.ab(e,null,0,0,0)),i!==n&&(i.ar(e,1,1),e._e=n,n.ab(e,null,1,1,0)))},x3:function(e){this.xr(e,e.a3(),e.a2())},h1:function(e){this.a11(e)},u1:function(e){this.x8(e)},h2:function(e){this.x4(e)},h3:function(e){this.x7(e)},xa:function(){return this._v._c},x0:function(){return this._v._c},xh:function(){return this._x._c},xg:function(){return this._x._c},xb:function(){return this._v._c===0},xq:function(e){return e._g===this},xp:function(e){return e._h===this},xd:function(){return this._v._a},x9:function(){return new Gs(this._v)},xf:function(){return new Gs(this._x)},x2:function(e,t){var n=Qo.d(this.xh());if(e!=null&&t!=null)for(var r=this.x9();r.i1();r.i2())r.i9().at(e,1,n),r.i9().at(t,0,n);else if(t==null&&e!=null)for(var i=this.x9();i.i1();i.i2())i.i9().at(e,1,n);else if(t!=null&&e==null)for(var s=this.x9();s.i1();s.i2())s.i9().at(t,0,n)},xk:function(){return this._z.b(this._v)},xl:function(){return this._w.c(this._x)},xi:function(e){this._z.a5(e,this._v)},xj:function(e){this._w.a6(e,this._x)},xc:function(e){return this._t[e]},x1:function(e,t){this._t[e]=t},x6:function(e){delete this._t[e]},b2:function(e,t,n,r,i,s,o){t.ab(e,n,0,0,s),r.ab(e,i,1,1,o)},a12:function(e,t,n){t.ar(e,0,0),n.ar(e,1,1)},c:function(){var e=0;for(var t=this.x9();t.i1();t.i2())t.i9()._p=e++;this._y=!1},b1:function(){var e=0;for(var t=this.xf();t.i1();t.i2())t.i8()._g=e++;this._u=!1},xs:function(e){e.as(this,this._z._b),e._p=this._v._c,this._v.a(e)},xt:function(e,t,n,r,i,s,o){e.a6(this,t,r,this._w._b),e._g=this._x._c,this._x.a(e),this.b2(e,e.a2(),n,e.a3(),i,s,o)}});var Co=function(){Co.superClass.constructor.call(this)};r.ext(Co,No,{gb:function(e){return this.g1(e)},g7:function(e){return this.g2(e)},g5:function(e){var t=this.g1(e);return t.i1()+t.i3()/2},g6:function(e){var t=this.g1(e);return t.i2()+t.i4()/2},g4:function(e){return new us(this.g5(e),this.g6(e))},gi:function(e){return this.g1(e).i1()},gh:function(e){return this.g1(e).i2()},ga:function(e){var t=this.g1(e);return new us(t.i1(),t.i2())},gj:function(e){return this.g1(e).i3()},g9:function(e){return this.g1(e).i4()},gm:function(e){return new as(this.gj(e),this.g9(e))},s1:function(e,t){this.s2(e,t.x,t.y)},s2:function(e,t,n){var r=this.g1(e);r.i5(t-r.i3()/2,n-r.i4()/2)},s7:function(e,t,n){this.g1(e).i6(t,n)},s8:function(e,t){this.s7(e,t.width,t.height)},s3:function(e,t,n){this.g1(e).i5(t,n)},s4:function(e,t){this.s3(e,t.x,t.y)},gp:function(e){var t=this.g2(e),n=new Oi;for(var r=0;r<t.i1();r++)n.add(t.i2(r));return new hs(n)},gf:function(e){var t=this.g2(e),n=new Ds;for(var r=0;r<t.i1();r++)n.aa(t.i2(r));return n},gc:function(e){var t=new Oi;t.add(this.gs(e));for(var n=this.gp(e).d();n.i1();n.i2())t.add(n.i6());return t.add(this.gl(e)),new hs(t)},gd:function(e){var t=new Ds;t.aa(this.gs(e));for(var n=this.gp(e).d();n.i1();n.i2())t.aa(n.i6());return t.aa(this.gl(e)),t},m1:function(e,t){var n=this.g2(e);n.i5();var r=t.ah(),i=r.i6();this.gx(e,i);var s=t.as();r.i2();for(;r.i6()!==s;r.i2()){var o=r.i6();n.i4(o.x,o.y)}this.gy(e,s)},s5:function(e,t){var n=this.g2(e);n.i5();for(var r=t.d();r.i1();r.i2()){var i=r.i6();n.i4(i.x,i.y)}},s6:function(e,t){var n=this.g2(e);n.i5();for(var r=t.ah();r.i1();r.i2()){var i=r.i6();n.i4(i.x,i.y)}},m2:function(e,t,n){this.gx(e,t),this.gy(e,n)},gn:function(e){return this.g2(e).i6()},gk:function(e){return this.g2(e).i7()},gt:function(e,t){this.g2(e).i8(t)},gz:function(e,t){this.g2(e).i9(t)},gs:function(e){var t=this.g2(e).i6();if(t==null)return this.g4(e.a2());var n=new us(this.g5(e.a2())+t.x,this.g6(e.a2())+t.y);return n},gl:function(e){var t=this.g2(e).i7();if(t==null)return this.g4(e.a3());var n=new us(this.g5(e.a3())+t.x,this.g6(e.a3())+t.y);return n},gx:function(e,t){var n=new us(t.x-this.g5(e.a2()),t.y-this.g6(e.a2()));this.g2(e).i8(n)},gy:function(e,t){var n=new us(t.x-this.g5(e.a3()),t.y-this.g6(e.a3()));this.g2(e).i9(n)},g8:function(){var e=new Ps;for(var t=this.xf();t.i1();t.i2())e.aa(t.i8());return e},g3:function(){var e,t=e=Number.MAX_VALUE,n,r=n=Number.MIN_VALUE;for(var i=this.x9();i.i1();i.i2()){var s=this.ga(i.i9()),o=this.gm(i.i9());t=Math.min(s.x,t),e=Math.min(s.y,e),r=Math.max(s.x+o.width,r),n=Math.max(s.y+o.height,n)}for(var u=this.xf();u.i1();u.i2())for(var a=this.gp(u.i8()).c();a.i1();a.i2()){var f=a.i6();t=Math.min(f.x,t),e=Math.min(f.y,e),r=Math.max(f.x,r),n=Math.max(f.y,n)}return{x:Math.floor(t),y:Math.floor(e),width:Math.floor(r-t),height:Math.floor(n-e)}}});var ko=function(){ko.superClass.constructor.call(this),this.a(new ys,new ms)};r.ext(ko,Co,{a:function(e,t){this._a3=e,this._a4=t},xo:function(e,t){return this.l2(e,t,this._a4.a6())},l2:function(e,t,n){return this.l1(e,null,t,null,0,0,n)},xn:function(e,t,n,r,i,s){return this.l1(e,t,n,r,i,s,this._a4.a6())},l1:function(e,t,n,r,i,s,o){var u=new Rs(this,e,t,n,r,i,s);return u._l=o,u},xm:function(){var e=new $s(this);return e._r=this._a3.m3(),e},g3:function(){var e={x:0,y:0,width:-1,height:-1};for(var t=this.x9();t.i1();t.i2())t.i9()._r.m1(e);return e},g1:function(e){return e._r},g2:function(e){return e._l},g5:function(e){return e._r.m4()},g6:function(e){return e._r.m5()},gi:function(e){return e._r.i1()},gh:function(e){return e._r.i2()},gj:function(e){return e._r.i3()},g9:function(e){return e._r.i4()},s2:function(e,t,n){e._r.m6(t,n)},s7:function(e,t,n){e._r.i6(t,n)},s3:function(e,t,n){e._r.i5(t,n)}});var Lo=function(){Lo.superClass.constructor.call(this),this._ap=this.xk(),this._as=this.xl()};r.ext(Lo,Co,{g1:function(e){var t=this._ap.i1(e);return t==null&&(t=new Ws,this._ap.z1(e,t)),t},g2:function(e){var t=this._as.i1(e);return t==null&&(t=new zs,this._as.i8(e,t)),t}});var Ao=function(e){Ao.superClass.constructor.call(this),this._ay=e,this._a0=this.xk(),this._au=this.xl()};r.ext(Ao,Lo,{c2:function(e){var t=this._a0.i1(e);return t},a2:function(e,t){this._a0.z1(e,t)},h:function(){this._az==null&&(this._az=this.xk());var e=Qo.a(this._ay.x0()+1),t=1;for(var n=this.x9();n.i1();){var r=this.c2(n.i9());for(var i=r.x1();i.i1();i.i2()){var s=i.i9();e[s.al()]=t}var o=new Ps;for(var u=r.x1();u.i1();u.i2()){var a=u.i9(),f=e[a.al()];for(var l=a.ap();l.i1();l.i2()){var c=l.i8(),h=c.a3(),p=e[h.al()];p===f&&o.ac(c)}}this._az.z1(n.i9(),o),n.i2(),t++}},d1:function(e){return this._az.i1(e)},b:function(e){return this._au.i1(e)},a3:function(e,t){this._au.i8(e,t)},a1:function(){var e=this._ay.xk(),t=no.a4(Qo.a(this._ay.xh())),n=bs.a1(this._ay,t,e),r=bs.a5(this._ay,t,n);this.d2(e,r),this._ay.xi(e)},c1:function(e){var t=null,n=-1;for(var r=0,i=e.length;r<i;r++){var s=e[r];s.ay()>n&&(t=s,n=s.ay())}return t},d2:function(e,t){var n=this._ay.xl(),r=this._ay.xk(),i=t.length;for(var s=0;s<i;s++){var o=t[s];for(var u=o.c1();u.i1();u.i2())n.i8(u.i8(),o)}var a=this.c1(t);this.a4(a,e,n,new Oi,r);var f={};i=t.length;for(var l=0;l<i;l++){var c=t[l];if(c.ay()>1){var h=this.xm();f[c._id]=h}}for(var p=this._ay.x9();p.i1();p.i2()){var d=p.i9();if(e.i4(d)&&r.i1(d)==null){var v=this.xm();f[d._id]=v;var m=new Ys;m.aa(d),this.a2(v,m)}}var g=Qo.d(2);i=t.length;for(var y=0;y<i;y++){var b=t[y];if(b.ay()===1){var w=b.c2();g[0]=w.a2(),g[1]=w.a3();for(var E=0;E<2;E++){var S=g[E];if(S.ad()===1){var x=this.xm();f[S._id]=x;var T=new Ys;T.aa(S),this.a2(x,T)}}}}for(var N=this._ay.x9();N.i1();N.i2()){var C=N.i9();if(r.i1(C)!=null){var k=r.i1(C),L=f[k._id];for(var A=C.af();A.i1();A.i2()){var O=A.i8();if(n.i1(O)!==k){var M=f[n.i1(O)._id];if(M==null){var _=O.a1(C),D=r.i1(_);D!=null?M=f[D._id]:M=f[_._id]}var P=L.aj(M),H=null;P==null?(P=this.xo(L,M),H=new Ps):H=this.b(P),H.aa(O),this.a3(P,H)}}}else if(e.i4(C)){var B=f[C._id];for(var j=C.af();j.i1();j.i2()){var F=j.i8(),I=F.a1(C),q=f[I._id];if(q!=null){var R=B.aj(q);if(R==null){var U=this.xo(B,q),z=new Ps;z.aa(F),this.a3(U,z)}}}}}if(this._ay.x0()===2&&this._ay.xg()===1){var W=this._ay.xf().i8(),X=f[W.a2()._id],V=f[W.a3()._id];if(V!=null&&X!=null&&V.aj(X)==null){var $=this.xo(X,V),J=new Ps;J.aa(W),this.a3($,J)}}var K=Qo.a(this._ay.x0()),Q=1;i=t.length;for(var G=0;G<i;G++){var Y=t[G],Z=f[Y._id];if(Z!=null){var et=this.c2(Z);et==null&&(et=new Ys,this.a2(Z,et));for(var tt=Y.c1();tt.i1();tt.i2()){var nt=tt.i8(),rt=nt.a2();K[rt.al()]!==Q&&(!e.i4(rt)||r.i1(rt)===Y)&&(K[rt.al()]=Q,et.aa(rt)),rt=nt.a3(),K[rt.al()]!==Q&&(!e.i4(rt)||r.i1(rt)===Y)&&(K[rt.al()]=Q,et.aa(rt))}}}this._ay.xj(n),this._ay.xi(r)},a4:function(e,t,n,r,i){if(r.contains(e))return;r.add(e);var s=[];for(var o=e.c1();o.i1();o.i2()){var u=o.i8();s[0]=u.a2(),s[1]=u.a3();for(var a=0;a<2;a++){var f=s[a];if(t.i4(f)&&i.i1(f)==null){e.ay()>1&&i.z1(f,e);for(var l=f.af();l.i1();l.i2()){var c=n.i1(l.i8());this.a4(c,t,n,r,i)}}}}}});var Oo=function(e,t,r,i,s){this._a={},Oo.superClass.constructor.call(this);var o=new Oi,u,a;for(u=0,a=t.size();u<a;u++){var f=t.get(u);if(f instanceof n.Link)o.add(f);else{var l=i&&s==null&&f instanceof ns;l&&f.setExpanded(!0);var c=e.getDimension(f);l&&f.setExpanded(!1);if(c==null)continue;var h=this.xm(),p=e._repulsion;r==="rightleft"||r==="leftright"?this.s7(h,c.height*p,c.width*p):this.s7(h,c.width*p,c.height*p),h.node=f,this._a[f.getId()]=h}}for(u=0,a=o.size();u<a;u++){var d=o.get(u),v=d.getFromAgent(),m=d.getToAgent(),g=this._a[v.getId()],y=this._a[m.getId()];if(g==null||y==null||g===y)continue;this.xo(g,y)}};r.ext(Oo,ko,{});var Mo={};Mo._D=new hs,Mo._E=new us(0,0),Mo.b=function(e){if(e.i1()>0){var t=new Oi;for(var n=e.i1()-1;n>=0;n--)t.add(e.i2(n));e.i5();for(var r=0,i=t.size();r<i;r++){var s=t.get(r);e.i4(s.x,s.y)}}var o=e.i6();e.i8(e.i7()),e.i9(o)},Mo.c=function(e){Mo.d(e,!0)},Mo.d=function(e,t){if(t)for(var n=e.xf();n.i1();n.i2()){var r=n.i8();e.gt(r,Mo._E),e.gz(r,Mo._E),e.s5(r,Mo._D)}else for(var i=e.xf();i.i1();i.i2())e.s5(i.i8(),Mo._D)},Mo.e=function(e){var t=new us(0,0);for(var n=e.xf();n.i1();n.i2()){var r=n.i8();e.gt(r,t),e.gz(r,t)}},Mo.f=function(e,t,n,r){var i=e.gc(t).b(),s=Qo.d(i),o=0;for(var u=e.gc(t).c();u.i1();u.i2()){var a=u.i6();if(o<=0||!a.equals(s[o-1]))s[o]=new us(a.x,a.y),o++}i=o;if(i<2)return;var f=new Oi,l=new fs(s[1].x-s[0].x,s[1].y-s[0].y),c=Mo.i(l);c.x*=r,c.y*=r;var h=Mo.h(s[0],c),p=Mo.h(s[1],c),d=new cs(h,p);for(var v=1;v<i-1;v++){var m=d,g=Mo.i(new fs(s[v+1].x-s[v].x,s[v+1].y-s[v].y));g.x*=r,g.y*=r;var y=Mo.h(s[v],g),b=Mo.h(s[v+1],g);d=new cs(y,b);var w=cs.a6(m,d);w!=null&&f.add(new us(w.x,w.y))}var E=new fs(s[i-1].x-s[i-2].x,s[i-1].y-s[i-2].y);E=Mo.i(E),E.x*=r,E.y*=r;var S=Mo.h(s[i-1],E),x=new hs(f);t.a2()===n.a2()?(e.s5(n,x),e.m2(n,h,S)):(e.s5(n,x.a()),e.m2(n,S,h))},Mo.g=function(e,t,n,r){var i=r;for(var s=n.c1();s.i1();s.i2()){var o=s.i8();Mo.f(e,t,o,i),i<0&&(i-=r),i=-i}},Mo.a=function(e,t,n){return Mo.j(e,t,n,1)},Mo.l=function(e,t,n){if(e==null||e.length<1)return t!=null&&(t.x=0,t.y=0,t.width=0,t.height=0),{width:0,height:0};var r=0,i=0;for(var s=0;s<e.length;s++){var o=e[s];r=Math.max(r,o.width),i=Math.max(i,o.height)}var u=r*i*e.length,a=Math.sqrt(u/n),f=u/a,l=Math.floor(f/r),c=Math.ceil(f/r),h=Math.ceil(e.length/l),p=Math.ceil(e.length/c),d,v;l*h<c*p?(d=l,v=h):(d=c,v=p);var m=0,g=0,y=0,b=0,w;if(r>i)for(var E=0;E<e.length;E++)w=e[E],w.x=g*r,w.y=m*i,y=Math.max(y,w.x+w.width),b=Math.max(b,w.y+w.height),++g>=d&&(m++,g=0);else for(var S=0;S<e.length;S++)w=e[S],w.x=g*r,w.y=m*i,y=Math.max(y,w.x+w.width),b=Math.max(b,w.y+w.height),++m>=v&&(g++,m=0);return t!=null&&(t.x=0,t.y=0,t.width=y,t.height=b),{width:v,height:d}},Mo.j=function(e,t,n,r){if(e==null||e.length<1)return t!=null&&(t.x=0,t.y=0,t.width=0,t.height=0),0;var i,s=i=e[0].width,o,u=o=e[0].height,a=e.length;for(var f=1;f<a;f++){var l=e[f].width;s=Math.min(s,l),i=Math.max(i,l);var c=e[f].height;u=Math.min(u,c),o=Math.max(o,c)}if(u/o>.95&&s/i>.95)return Mo.l(e,t,n).width;var h=new Ds,p=0;for(var d=0;d<a;d++){var v=e[d];h.aa(e[d]),p=Math.floor(p+v.width*v.height)}h.a1(function(e,t){var n=Math.floor(t.height)-Math.floor(e.height);return n===0?Math.floor(t.width)-Math.floor(e.width):n});var m=0,g=0,y=Math.floor(n*Math.sqrt(p/n)),b=y,w=0,E=new Ds;do{var S=new Ds;E.aa(S);var x,T,N=x=T=0;for(var C=h.ah();C.i1();C.i2()){var k=C.i6();N+k.width>b&&S.ay()>0?(T=Math.max(T,N),S=new Ds,S.aa(k),E.aa(S),N=Math.floor(k.width)):(S.aa(k),N=Math.floor(N+k.width)),S.ay()===1&&(x=Math.floor(x+S.am().height))}T=Math.max(T,N),n*x>T&&w!==T&&(E.af(),b=Math.floor(b*1.1),w=T)}while(E.ar());var L=0;for(var A=E.ah();A.i1();A.i2()){var O=0,M=A.i6();for(var _=M.ah();_.i1();_.i2()){var D=_.i6();D.x=O,D.y=L,O+=D.width}m=Math.max(m,O),L+=Mo.k(M),g=Math.max(g,L)}return t!=null&&(t.x=0,t.y=0,t.width=m,t.height=g),E.ay()},Mo.k=function(e){var t=0;for(var n=e.ah();n.i1();n.i2())t=Math.max(n.i6().height,t);return t},Mo.h=function(e,t){return new us(e.x+t.x,e.y+t.y)},Mo.i=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);return new fs(-e.y/t,e.x/t)};var _o=function(e){this._a=e,this._b=!1};r.ext(_o,Object,{a:function(){return this._b},b:function(){return this._a},c:function(){return this._a===1},d:function(){return this._a===2},e:function(){return this._a===4},f:function(){return this._a===8},g:function(){return this._a===0}}),_o.h=function(e,t){var n=e.xc("A");return n==null?null:n.i1(t)},_o.i=function(e,t){var n=e.xc("B");return n==null?null:n.i1(t)},_o.j=function(e){switch(e){case 1:return _o.k;case 2:return _o.l}return null},_o.k=new _o(1),_o.l=new _o(2);var Do=function(e,t,n,r,i){this._o=0,this._l=0,this._i=0,this._d=0,this._f=0,this._b=e,this._a=1e-4,this._r=t,this._p=1,this._e=(i.gj(e)+i.g9(e))/4;var s=.45*n*Math.sqrt(r);this._k=xo.l(-s,s),this._h=xo.l(-s,s),this._g=xo.l(-s,s)};r.ext(Do,Object,{});var Po=function(){this._a=0,this._c=0,this._b=0};r.ext(Po,Object,{});var Ho=function(){Ho.superClass.constructor.call(this),this._dj=0,this._dh=0,this._dq=0,this._dp=0,this._dt=0,this._de=0,this._d3=0,this._dr=0,this._ed=0,this._dw=.65,this._ea=1,this._dl=80,this._dx=3,this._d8=!0,this._eb=3e5,this._ee=2,this._di=2,this._df=1e3};r.ext(Ho,so,{i4:function(e){return!0},i3:function(e){if(e==null)return;this._d5=e;if(!this.s(e))return;var t=new Po,n=0,r=Math.floor(this._dx*this._dz.length*this._dz.length+20*this._dz.length);r=Math.max(r,1e4);var i=this._ea*this._ea*this._dz.length,s=this._df;try{for(;this._dj>i&&n<r;n++){var o=this.b(n&2147483647);s--===0&&(this._dy.b()>this._eb&&(n=r),s=this._df),this.h(o,t),this.d(o,t),this.i(o,t),this._d8?(this.g(o,t),this.j(o,t)):(this.f(o,t),this.c(o,t));var u=Math.sqrt(t._a*t._a+t._c*t._c+t._b*t._b);this.ac(o,t,u),this.aa(o,t,u)}}catch(a){}finally{this.r()}},s:function(e){if(e==null||e.xa()<1)return!1;this._d5=e,this._dp=1,this._dy=new So,this._dt=e.x0(),this._d2=Qo.d(this._dt),this._df=1+1e5/this._dt,this._ed=1/(2*this._di),this._de=this._ed*this._ee/(this._dl*.05),this._d3=Math.pow(this._dl,-1)*this._ed,this._dr=Math.pow(this._dl,3)*this._ed,this._dj=0,this._du=new Po,this._dq=Math.max(20*this._dl,10);var t=Math.max(.1,Math.min(this._dw*this._dl,this._dq)),n=this._dt;Mo.c(e),this._dz=Qo.d(n);for(var r=e.x9();r.i1();r.i2()){var i=r.i9(),s=new Do(i,t,this._dl,this._dt,e);this._dz[--n]=s,this._dj+=s._r,this._dh+=s._r*s._r,this._du._a+=s._k,this._du._c+=s._h,this._du._b+=s._g,this._d2[i.al()]=s}return this._d8=!1,this._dz.length>0},b:function(e){var t=this._dz.length,n=t-e%t-1,r=xo.k(n+1),i=this._dz[r];return this._dz[r]=this._dz[n],this._dz[n]=i,i},f:function(e,t){var n,r,i=n=r=0;for(var s=e._b.ae();s!=null;s=s.a7()){var o=this._d2[s.a2().al()],u=o._k-e._k,a=o._h-e._h,f=o._g-e._g,l=u*u+a*a+f*f,c,h=Math.sqrt(l),p=h-(o._e+e._e);if(p<=0)continue;c=p*p*this._d3/h,i+=u*c,n+=a*c,r+=f*c}for(var d=e._b.ag();d!=null;d=d.a8()){var v=this._d2[d.a3().al()],m=v._k-e._k,g=v._h-e._h,y=v._g-e._g,b=m*m+g*g+y*y,w,E=Math.sqrt(b),S=E-(v._e+e._e);if(S<=0)continue;w=S*S*this._d3/E,i+=m*w,n+=g*w,r+=y*w}t._a+=i,t._c+=n,t._b+=r},g:function(e,t){var n,r,i=n=r=0;this._dp++,e._f=this._dp;for(var s=e._b.ae();s!=null;s=s.a7()){var o=this._d2[s.a2().al()];o._f=this._dp;var u=o._k-e._k,a=o._h-e._h,f=o._g-e._g,l=u*u+a*a+f*f,c=Math.sqrt(l);if(c!==0){var h=Math.max(1e-6,c-(e._e+o._e)),p=-this._ef[s.a5()]/(h*h);p+=h*h*this._d1[s.a5()],p/=c,i+=u*p,n+=a*p,r+=f*p}}for(var d=e._b.ag();d!=null;d=d.a8()){var v=this._d2[d.a3().al()];v._f=this._dp;var m=v._k-e._k,g=v._h-e._h,y=v._g-e._g,b=m*m+g*g+y*y,w=Math.sqrt(b);if(w!==0){var E=Math.max(1e-6,w-(e._e+v._e)),S=-this._ef[d.a5()]/(E*E);S+=E*E*this._d1[d.a5()],S/=w,i+=m*S,n+=g*S,r+=y*S}}t._a+=i,t._c+=n,t._b+=r},j:function(e,t){var n,r,i=n=r=0;for(var s=this._dt-1;s>=0;s--){var o=this._d2[s];if(o._f!==e._f){var u=e._k-o._k,a=e._h-o._h,f=e._g-o._g,l=u*u+a*a+f*f;if(l!==0){var c=Math.sqrt(l),h=Math.max(1e-6,c-(e._e+o._e)),p=this._dr/(h*h*c);i+=u*p,n+=a*p,r+=f*p}}}t._a+=i,t._c+=n,t._b+=r},c:function(e,t){var n,r,i=n=r=0;for(var s=this._dt-1;s>=0;s--){var o=this._d2[s],u=e._k-o._k,a=e._h-o._h,f=e._g-o._g,l=u*u+a*a+f*f;if(l!==0){var c=Math.sqrt(l),h,p=c-(e._e+o._e);p<=0?h=this._dr/(1e-8*c):h=this._dr/(p*p*c),i+=u*h,n+=a*h,r+=f*h}}t._a+=i,t._c+=n,t._b+=r},i:function(e,t){var n=this._du._b/this._dt-e._g;t._b+=n*this._dl*this._dt/this._dh},d:function(e,t){if(this._de!==0){var n=this._du._a/this._dt-e._k,r=this._du._c/this._dt-e._h,i=this._du._b/this._dt-e._g;t._a+=n*this._de,t._c+=r*this._de,t._b+=i*this._de}},h:function(e,t){var n=.05*(e._r+2);n>0&&(t._a=xo.l(-n,n),t._c=xo.l(-n,n),t._b=xo.l(-n,n))},ac:function(e,t,n){if(n!==0&&e._a!==0){var r=t._a*e._o+t._c*e._l+t._b*e._i,i=r/(n*e._a);this._dh-=e._r*e._r,this._dj-=e._r,e._p*i>0?e._r+=i*.45:e._r+=i*.15,e._r>this._dq?e._r=this._dq:e._r<.1&&(e._r=.1),this._dj+=e._r,this._dh+=e._r*e._r,e._p=i}},aa:function(e,t,n){if(n>0){var r=e._r/n,i=t._a*r,s=t._c*r,o=t._b*r;e._k+=i,e._h+=s,e._g+=o,this._du._a+=i,this._du._c+=s,this._du._b+=o,e._a=n,e._o=t._a,e._l=t._c,e._i=t._b}},r:function(){for(var e=this._d2.length-1;e>=0;e--){var t=this._d2[e];this._d5.s2(t._b,t._k,t._h)}}});var Bo=function(e,t,n,r){this._e=e,this._f=t,this._a=n,this._b=r,this._c={}};r.ext(Bo,Object,{resetGroup:function(){if(!this._a||this._b!=null)return;for(var e in this._c){var t=this._c[e];this._e.isExpandGroup()?t.group.setExpanded(!0):t.group.setExpanded(t.b)}},process:function(){var e=new Oi;for(var t=0,r=this._f.size();t<r;t++){var i=this._f.get(t);if(i instanceof n.Link)i.isLooped()||e.add(i);else{if(this._b==null&&i.getParent()instanceof ns)continue;(this._b==null||this._b!=null&&this._b!==i)&&e.add(i),this._b==null&&i instanceof ns&&this.layoutGroup(i)}}return e},layoutGroup:function(e){if(!this._a||this._c[e.getId()]!=null||this._b!=null)return;this._c[e.getId()]={group:e,b:e.isExpanded()};var t=this._e.getGroupLayoutType(e);if(!t)return;e.setExpanded(!0);var r=new Oi,i=e.getChildren(),s;for(var o=0,u=i.size();o<u;o++){s=i.get(o),s instanceof ns&&(this.layoutGroup(s),s.setExpanded(!1)),!(s instanceof n.Link)&&!r.contains(s)&&r.add(s);if(s instanceof es){var a=s.getLinks();if(a!=null)for(var f=0,l=a.size();f<l;f++){var c=a.get(f);r.contains(c)||r.add(c)}}}var h=new Oo(this._e,r,t,this._a,this._b);try{var p=null;if("round"===t)p=new Eo;else if("symmetry"===t)p=new Ho;else if("hierarchic"===t)p=new Xo;else if(t==="topbottom"||t==="bottomtop"||t==="rightleft"||t==="leftright")p=new oo;if(p!=null){p.i2(h);var d=Bo.createMatrix(t),v={},m={};for(var g in h._a){var y=h._a[g],b=y.node,w=h.g4(y);v[g]=b.getCenterLocation();if(d!=null){var E=d.transform(w);b.setCenterLocation(E.x,E.y)}else b.setCenterLocation(w.x,w.y);m[g]=b.getCenterLocation()}}}catch(S){}i=e.getChildren();for(o=0,u=i.size();o<u;o++)s=i.get(o),s instanceof ns&&s.setExpanded(!0)}}),Bo.createMatrix=function(e){return e==="rightleft"?m.createMatrix(Math.PI/2,0,0):e==="leftright"?m.createMatrix(-Math.PI/2,0,0):e==="bottomtop"?m.createMatrix(Math.PI,0,0):null};var jo=function(){};r.ext(jo,Object,{i1:function(e,t,n){var r=this.a1(e,t);return this.a2(e,t,n),r},a1:function(e,t){var n=jo.i4(e);n.ax();var r=0;for(var i=n.x1();i.i1();i.i2())t.i7(i.i9(),-1);for(var s=n.x1();s.i1();s.i2()){var o=s.i9(),u=-1;for(var a=o.aq();a.i1();a.i2())u=Math.max(u,t.i2(a.i9()));t.i7(o,u+1),r=Math.max(r,u+1)}return r+1},a2:function(e,t,n){n.az(jo.i3(e,t))}}),jo.i3=function(e,t){var n=new Ps;for(var r=e.xf();r.i1();r.i2()){var i=r.i8();t.i2(i.a2())>t.i2(i.a3())&&(e.x3(i),n.ac(i))}return n},jo.i4=function(e){var t=Qo.a(e.xa());return(new Ns).a1(e,t),jo.i2(e,t)},jo.i2=function(e,t){var n=Qo.d(e.x0());for(var r=e.x9();r.i1();r.i2()){var i=r.i9(),s=i.al();n[t[s]]=i}return new Ys(n)};var Fo=function(){Fo.superClass.constructor.call(this),this.c0()};r.ext(Fo,Ps,{c0:function(){this._bc=1,this._bd=0}});var Io=function(){this._m1=20,this._m2=60,this._m3=5,this._m4=0};r.ext(Io,Object,{i4:function(e){this._m3=e},i5:function(e){this._m4=e},i3:function(e){this._m1=e},i6:function(e){this._m2=e},i2:function(e){this._m5=e},t1:function(){return this._m2},a1:function(e,t){var n=Qo.d(t.length);for(var r=0;r<t.length;r++)n[r]=t[r].x1();this.a2(e,n)},a2:function(e,t){var n=Qo.a(t.length),r=0;for(var i=0;i<t.length;i++){var s=0,o=t[i];o.i4();for(;o.i1();o.i2())s=Math.max(s,e.g9(o.i9()));n[i]=s,o.i4();for(;o.i1();o.i2()){var u=(n[i]-e.g9(o.i9()))/2;e.s4(o.i9(),new us(e.gi(o.i9()),r+u))}var a=this.t1();r+=n[i]+a,o.i4()}},i1:function(e,t,n){this._m6=e,this.t2(t,n)}});var qo=function(e,t){qo.superClass.constructor.call(this)};r.ext(qo,Io,{t2:function(e,t){var n=this._m6;this._a=n.xc("D"),this._h=n.xc("C"),this.a1(n,e),this.tg(n,e),this.tf(e,no.a5(this._e),this._m5,this._l),this.tb(n,this._f[0]),this.ta(e),this.th(n,this._f[0],e),this.b(e),this.tb(n,this._f[1]),this.ta(e),this.th(n,this._f[1],e),this.b(e),this.a11(this._f[1]),this.a12(e),this.tb(n,this._f[2]),this.ta(e),this.th(n,this._f[2],e),this.b(e),this.tb(n,this._f[3]),this.ta(e),this.th(n,this._f[3],e),this.b(e),this.a11(this._f[3]),this.a12(e),this.tc(n),this.tj()},a11:function(e){for(var t=0;t<e.length;t++)e[t]=-e[t]},b:function(e){for(var t=0;t<e.length;t++){var n=e[t];n.ax()}for(var r=0;r<e.length;r++){var i=0,s=null;for(var o=e[r].x1();o.i1();o.i2()){var u=o.i9(),a=u.al();this._l[a]=i++,this._b[a]=s,this._k[a]=null,s!=null&&(this._k[s.al()]=u),s=u}}var f=this._a;this._a=this._h,this._h=f;for(var l=this._m6.xf();l.i1();l.i2()){var c=l.i8(),h=this._m6.gn(c);this._m6.gt(c,new us(-h.x,h.y));var p=this._m6.gk(c);this._m6.gz(c,new us(-p.x,p.y))}var d=this._l,v=function(e,t){return e==null&&t!=null?1:e!=null&&t==null?-1:e==null&&t==null?0:d[e.a2().al()]-d[t.a2().al()]},m=function(e,t){return e==null&&t!=null?1:e!=null&&t==null?-1:e==null&&t==null?0:d[e.a3().al()]-d[t.a3().al()]};this._m6.x2(v,m)},a12:function(e){for(var t=this._m6.xf();t.i1();t.i2()){var n=t.i8();this._m6.x3(n);var r=this._m6.gn(n),i=this._m6.gk(n);this._m6.gz(n,r),this._m6.gt(n,i)}var s=new Ds;for(var o=0;o<e.length;o++)s.ae(e[o]);for(var u=0;u<e.length;u++)e[u]=s.au();var a=this._l,f=function(e,t){return e==null&&t!=null?1:e!=null&&t==null?-1:e==null&&t==null?0:a[e.a2().al()]-a[t.a2().al()]},l=function(e,t){return e==null&&t!=null?1:e!=null&&t==null?-1:e==null&&t==null?0:a[e.a3().al()]-a[t.a3().al()]};this._m6.x2(f,l)},tg:function(e,t){var n=e.x0(),r=e.xg();this._l=Qo.a(n),this._b=Qo.d(n),this._k=Qo.d(n),this._m=Qo.d(n),this._i=Qo.d(n),this._o=Qo.d(n),this._f=Qo.e(4,n),this._c=Qo.a(n),this._g=Qo.a(n),this._j=Qo.a(n),this._d=Qo.b(n),this._e=Qo.b(r);for(var i=0;i<t.length;i++){var s=0,o=null;for(var u=t[i].x1();u.i1();u.i2()){var a=u.i9(),f=a.al();this._l[f]=s++,this._b[f]=o,this._k[f]=null,o!=null&&(this._k[o.al()]=a),o=a}}var l=this._l,c=function(e,t){return e==null&&t!=null?1:e!=null&&t==null?-1:e==null&&t==null?0:l[e.a2().al()]-l[t.a2().al()]},h=function(e,t){return e==null&&t!=null?1:e!=null&&t==null?-1:e==null&&t==null?0:l[e.a3().al()]-l[t.a3().al()]};e.x2(c,h)},tb:function(e,t){for(var n=e.x9();n.i1();n.i2()){var r=n.i9(),i=r.al();this._m[i]=r,this._i[i]=r,t[i]=Number.MAX_VALUE,this._o[i]=r,this._c[i]=Number.MAX_VALUE,this._d[i]=!1,this._j[i]=this._g[i]=0}},ta:function(e){for(var t=1;t<e.length;t++){var n=-1;for(var r=e[t]._b;r!=null;r=r.a()){var i=r.d(),s=i.al(),o=i.ak();if(o!==0){var u=Math.floor((o+1)/2),a=Math.ceil((o+1)/2),f=1,l;for(l=i.ae();f<u;l=l.a7())f++;for(var c=!1;f<=a&&!c;f++){var h=this._m6.g2(l),p=l.a2(),d=p.al();this._i[s]===i&&!this._e[l.a5()]&&n<this._l[d]&&(n=this._l[d],this._i[d]=i,this._m[s]=this._m[d],this._i[s]=this._m[s],c=!0,this._j[d]=h.i6().x,this._g[s]=h.i7().x),l=l.a7()}}}}},th:function(e,t,n){for(var r=e.x9();r.i1();r.i2()){var i=r.i9(),s=i.al();this._m[s]===i&&this.td(e,i,t)}for(var o=0;o<n.length;o++){var u=n[o].x1();if(u.i1()){var a=n[o].x1().i9(),f=a.al();this._o[this._m[f].al()]===a&&this.tk(e,a,t)}}for(var l=e.x9();l.i1();l.i2()){var c=l.i9(),h=c.al(),p=this._c[this._o[this._m[h].al()].al()];p<Number.MAX_VALUE&&(t[h]+=p)}},td:function(e,t,n){var r=t.al();if(n[r]===Number.MAX_VALUE){n[r]=0;var i=t,s=0;do{var o=i.al();o!==r&&(s-=this._g[o]);if(this._l[o]>0){var u=this._b[o],a=this._m[this._b[o].al()],f=a.al();this.td(e,a,n),this._o[r]===t&&(this._o[r]=this._o[f]),this._o[r]===this._o[f]&&(n[r]=Math.max(n[r],n[u.al()]+this.ti(e,u,i)-s))}s+=this._j[o],i=this._i[o]}while(i!==t);s=0,i=t;do{var l=i.al();l!==r&&(s-=this._g[l]),n[l]=n[r]+s,s+=this._j[l],i=this._i[l]}while(i!==t)}},tk:function(e,t,n){var r=t.al();if(this._d[r])return;this._d[r]=!0;var i=t;do{var s=i.al(),o=this._k[s];if(o!=null){var u=o.al(),a=this._o[this._m[u].al()];if(a!==this._o[r]){var f=n[u]-n[r]-this.ti(e,i,o);this._c[a.al()]!==Number.MAX_VALUE&&(f+=this._c[a.al()]),this._c[this._o[r].al()]=Math.min(this._c[this._o[r].al()],f)}else this.tk(e,this._m[u],n)}i=this._i[s]}while(i!==t)},tc:function(e){var t=Qo.a(4),n=Qo.a(4);for(var r=e.x9();r.i1();r.i2()){var i=r.i9(),s=i.al();n[0]+=this._f[0][s],n[1]+=this._f[1][s],n[2]+=this._f[2][s],n[3]+=this._f[3][s]}n[0]/=e.xa(),n[1]/=e.xa(),n[2]/=e.xa(),n[3]/=e.xa();for(var o=e.x9();o.i1();o.i2()){var u=o.i9(),a=u.al(),f=e.g4(u);t[0]=this._f[0][a]-n[0],t[1]=this._f[1][a]-n[1],t[2]=this._f[2][a]-n[2],t[3]=this._f[3][a]-n[3],t.sort(Qo.n);var l=(t[1]+t[2])/2;e.s1(u,new us(l,f.y))}},ti:function(e,t,n){var r=e.gj(t),i=e.gj(n),s;return r>1&&i>1?s=this._m1+(r+i)/2:s=this._m3+(r+i)/2,this._l[t.al()]<this._l[n.al()]?(this._a!=null&&(s+=this._a.i3(n)),this._h!=null&&(s+=this._h.i3(t))):(this._a!=null&&(s+=this._a.i3(t)),this._h!=null&&(s+=this._h.i3(n))),s},tj:function(){this._l=null,this._b=null,this._k=null,this._e=null,this._m=null,this._i=null,this._f=null,this._c=null,this._o=null,this._d=null,this._j=null,this._g=null},tf:function(e,t,n,r){var i=e.length;for(var s=2;s<i-1;s++){var o=-1,u=0,a=0,f=e[s].x1();for(var l=e[s].x1();l.i1();l.i2()){var c=l.i9(),h=null,p=!1;c.ak()===1&&(h=c.ae().a2(),n.i1(h)!=null&&n.i1(c)!=null&&(p=!0));if(a===e[s].ay()-1||p){var d=p?r[h.al()]:e[s-1].ay();for(;u<=a;u++){var v=f.i9();for(var m=v.am();m.i1();m.i2()){var g=m.i8(),y=r[g.a2().al()];(y<o||y>d)&&t.i7(m.i8(),!0)}f.i2()}o=d}a++}}}});var Ro=function(e,t){this._b=20,this._a=t,this._d=e,this._f={}};r.ext(Ro,Object,{a3:function(e){this._b=e},a4:function(e,t,n,r,i){if(this.a2(e)){var s=this.b2(e);s._o=t,s._m=i,s._n=r,s._f=n}},b2:function(e){var t=this._f[e._id];return t==null&&(t=new Uo,this._f[e._id]=t),t},a2:function(e){return this._f[e._id]!=null},c:function(){var e=no.a1(Qo.a(this._d.xa())),t=no.a1(Qo.a(this._d.xa()));for(var n=this._d.x9();n.i1();n.i2()){var r=n.i9();if(this.a2(r)){var i=this.b2(r);e.i6(r,this._b*(i.c()-1)),t.i6(r,this._b*(i.b()-1))}}this._d.x1("D",e),this._d.x1("C",t)},g:function(){this._d.x6("D"),this._d.x6("C")},f:function(){for(var e=this._d.x9();e.i1();e.i2()){var t=e.i9();if(this.a2(t)){var n=this._d.gi(t),r=this._d.gh(t),i=this._d.gj(t),s=this._d.g9(t),o=this.b2(t),u=o._q.ay()+o._b.ay()+o._f,a=o._d.ay()+o._g.ay()+o._o,f=o._i.ay()+o._l.ay()+o._n,l=o._h.ay()+o._k.ay()+o._m,c=this._a.a7(i,u),h=this._a.a7(i,a),p=this._a.a7(s,l),d=this._a.a7(s,f);o.a2(this._a.a8(i,u,c),this._a.a8(i,a,h),this._a.a8(s,l,p),this._a.a8(s,f,d));for(var v=o._j.c1();v.i1();v.i2()){var m=v.i8(),g=this.a1(m),y=this.b1(m),b=new Ds;if(g.b()===y.b())g.c()?(b.aa(new us(n+o._g._bd*h+o._c,r)),b.aa(new us(n+o._g._bd*h+o._c,r-this._b)),o._g._bd++,b.aa(new us(n+o._g._bd*h+o._c,r-this._b)),b.aa(new us(n+o._g._bd*h+o._c,r)),o._g._bd++,o._g._bc=Math.max(o._g._bc,2)):g.d()?(b.aa(new us(n+o._b._bd*c+o._p,r+s)),b.aa(new us(n+o._b._bd*c+o._p,r+s+this._b)),o._b._bd++,b.aa(new us(n+o._b._bd*c+o._p,r+s+this._b)),b.aa(new us(n+o._b._bd*c+o._p,r+s)),o._b._bd++,o._b._bc=Math.max(o._b._bc,2)):g.f()?(b.aa(new us(n,r+o._i._bd*d+o._a)),b.aa(new us(n-this._b,r+o._i._bd*d+o._a)),o._i._bd++,b.aa(new us(n-this._b,r+o._i._bd*d+o._a)),b.aa(new us(n,r+o._i._bd*d+o._a)),o._i._bd++,o._i._bc=Math.max(o._i._bc,2)):g.e()&&(b.aa(new us(n+i,r+o._h._bd*p+o._e)),b.aa(new us(n+i+this._b,r+o._h._bd*p+o._e)),o._h._bd++,b.aa(new us(n+i+this._b,r+o._h._bd*p+o._e)),b.aa(new us(n+i,r+o._h._bd*p+o._e)),o._h._bd++,o._h._bc=Math.max(o._h._bc,2)),this._d.m1(m,b);else if(g.c()||y.c()){if(g.e()||y.e())b.aa(new us(n+i-o._d._bd*h-o._c,r)),b.aa(new us(n+i-o._d._bd*h-o._c,r-this._b*o._d._bc)),b.aa(new us(n+i+this._b*o._h._bc,r-this._b*o._d._bc)),b.aa(new us(n+i+this._b*o._h._bc,r+o._h._bd*p+o._e)),b.aa(new us(n+i,r+o._h._bd*p+o._e)),o._d._bd++,o._d._bc++,o._h._bd++,o._h._bc++,y.c()&&b.ax(),this._d.m1(m,b);else if(g.f()||y.f())b.aa(new us(n+o._g._bd*h+o._c,r)),b.aa(new us(n+o._g._bd*h+o._c,r-this._b*o._g._bc)),b.aa(new us(n-this._b*o._i._bc,r-this._b*o._g._bc)),b.aa(new us(n-this._b*o._i._bc,r+o._i._bd*d+o._a)),b.aa(new us(n,r+o._i._bd*d+o._a)),o._g._bd++,o._g._bc++,o._i._bd++,o._i._bc++,y.c()&&
b.ax(),this._d.m1(m,b);else if(g.d()||y.d())b.aa(new us(n+i-o._d._bd*h-o._c,r)),b.aa(new us(n+i-o._d._bd*h-o._c,r-this._b*o._d._bc)),b.aa(new us(n+i+this._b*o.b(),r-this._b*o._d._bc)),b.aa(new us(n+i+this._b*o.b(),r+s+this._b*o._q._bc)),b.aa(new us(n+i-o._q._bd*c-o._p,r+s+this._b*o._q._bc)),b.aa(new us(n+i-o._q._bd*c-o._p,r+s)),o._d._bd++,o._d._bc++,o._k._bc++,o._h._bc++,o._q._bc++,o._q._bd++,y.c()&&b.ax(),this._d.m1(m,b)}else if(g.d()||y.d()){if(g.e()||y.e())b.aa(new us(n+i-o._q._bd*c-o._p,r+s)),b.aa(new us(n+i-o._q._bd*c-o._p,r+s+this._b*o._q._bc)),b.aa(new us(n+i+this._b*o._k._bc,r+s+this._b*o._q._bc)),b.aa(new us(n+i+this._b*o._k._bc,r+s-o._k._bd*p-o._e)),b.aa(new us(n+i,r+s-o._k._bd*p-o._e)),o._q._bd++,o._q._bc++,o._k._bd++,o._k._bc++,y.d()&&b.ax(),this._d.m1(m,b);else if(g.f()||y.f())b.aa(new us(n+o._b._bd*c+o._p,r+s)),b.aa(new us(n+o._b._bd*c+o._p,r+s+this._b*o._b._bc)),b.aa(new us(n-this._b*o._l._bc,r+s+this._b*o._b._bc)),b.aa(new us(n-this._b*o._l._bc,r+s-o._l._bd*d-o._a)),b.aa(new us(n,r+s-o._l._bd*d-o._a)),o._b._bd++,o._b._bc++,o._l._bd++,o._l._bc++,y.d()&&b.ax(),this._d.m1(m,b)}else b.aa(new us(n,r+s-o._l._bd*d-o._a)),b.aa(new us(n-this._b*o._l._bc,r+s-o._l._bd*d-o._a)),b.aa(new us(n-this._b*o._l._bc,r+s+this._b*o.a1())),b.aa(new us(n+i+this._b*o._k._bc,r+s+this._b*o.a1())),b.aa(new us(n+i+this._b*o._k._bc,r+s-o._k._bd*p-o._e)),b.aa(new us(n+i,r+s-o._k._bd*p-o._e)),o._l._bd++,o._l._bc++,o._b._bc++,o._q._bc++,o._k._bc++,o._k._bd++,y.f()&&b.ax(),this._d.m1(m,b)}}}},a5:function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=t[n];for(var s=r.x1();s.i1();s.i2()){var o=s.i9();if(this.a2(o)){var u=this.b2(o);i._g=Math.max(i._g,this._b*(u.d()-1)),i._j=Math.max(i._j,this._b*(u.a1()-1))}}}},a1:function(e){var t=this._d.xc("A"),n=null;t!=null&&(n=t.i1(e));if(n==null||n.g()){var r=this._d.xc("B");if(r==null)return _o.j(1);var i=r.i1(e);if(i==null||i.g())return _o.j(1);if(i.c())return _o.j(8);if(i.f())return _o.j(1);if(i.d())return _o.j(4);if(i.e())return _o.j(2)}return n},b1:function(e){var t=this._d.xc("B"),n=null;t!=null&&(n=t.i1(e));if(n==null||n.g()){var r=this._d.xc("A");if(r==null)return _o.j(8);var i=r.i1(e);if(i==null||i.g())return _o.j(8);if(i.c())return _o.j(8);if(i.f())return _o.j(1);if(i.d())return _o.j(4);if(i.e())return _o.j(2)}return n}});var Uo=function(){this._o=0,this._f=0,this._n=0,this._m=0,this._c=0,this._p=0,this._e=0,this._a=0,this._j=new Ps,this._g=new Fo,this._d=new Fo,this._b=new Fo,this._q=new Fo,this._h=new Fo,this._k=new Fo,this._i=new Fo,this._l=new Fo};r.ext(Uo,Object,{a1:function(){return Math.max(this._q._bc,this._b._bc)},d:function(){return Math.max(this._d._bc,this._g._bc)},b:function(){return Math.max(this._k._bc,this._h._bc)},c:function(){return Math.max(this._l._bc,this._i._bc)},a2:function(e,t,n,r){this._c=t,this._a=r,this._p=e,this._e=n,this._g.c0(),this._d.c0(),this._b.c0(),this._q.c0(),this._k.c0(),this._h.c0(),this._l.c0(),this._i.c0()}});var zo=function(e,t,n,r){this._k=20,this._r=.5,this._d=e,this._c=t,this._j=n,this._m=r,this._i=e.xc("A")!=null||e.xc("B")!=null,this._t=new Vo(e,t,n,r),this._b=new Ro(e,this)};r.ext(zo,Object,{a6:function(e){this._k=e,this._t.a1(e),this._b.a3(e)},g1:function(){return this._k},a9:function(e){return this.c1(),e},a5:function(e){return this.a1(),e},b3:function(e){return this.c1(),e=this.c4(e),this._b.c(),e},g2:function(e){return this._b.g(),e},e2:function(e){e=this.f(e),this._b.f()},e1:function(){this._t.d(),this._n!=null&&this._d.xi(this._n),this.a1(),this._d=null},a1:function(){if(!this._i)return;this._q!=null&&(this._d.x1("A",this._q),this._q=null),this._p!=null&&(this._d.x1("B",this._p),this._p=null),this._h!=null&&(this._d.xj(this._h),this._h=null),this._l!=null&&(this._d.xj(this._l),this._l=null)},c1:function(){if(!this._i)return;this._h==null&&(this._h=this._d.xl()),this._l==null&&(this._l=this._d.xl());for(var e=this._d.xf();e.i1();e.i2()){var t=e.i8(),n=this._j.i1(t.a2())!=null,r=this._j.i1(t.a3())!=null;if(n&&!r){var i=this._j.i1(t.a2());this._m.i4(i)?this._l.i8(t,_o.h(this._d,i)):this._l.i8(t,_o.i(this._d,i))}else if(!n&&r){var s=this._j.i1(t.a3());this._m.i4(s)?this._h.i8(t,_o.i(this._d,s)):this._h.i8(t,_o.h(this._d,s))}else!n&&!r&&(this._m.i4(t)?(this._h.i8(t,_o.i(this._d,t)),this._l.i8(t,_o.h(this._d,t))):(this._h.i8(t,_o.h(this._d,t)),this._l.i8(t,_o.i(this._d,t))))}this._q=this._d.xc("A"),this._p=this._d.xc("B"),this._d.x1("A",this._h),this._d.x1("B",this._l)},c4:function(e){this._n=this._d.xk(),this._a=this._d.xl(),this._g=this._d.xl();var t=new Ps,n=new Ps,r=new Ps,i=new Ps,s=new Ps,o=new Ps,u=new Ps,a=new Ps,f=new Ps,l=this._d.xk();for(var c=0;c<e.length;c++){var h=0;for(var p=e[c].x1();p.i1();)l.i6(p.i9(),h),p.i2(),h++}var d=function(e,t){var n=l.i3(e.a3())-l.i3(t.a3());return n<=0?n>=0?0:-1:1},v=function(e,t){var n=l.i3(e.a2())-l.i3(t.a2());return n<=0?n>=0?0:-1:1};for(var m=0;m<e.length;m++){var g=e[m];for(var y=g._b;y!=null;y=y.a()){var b=y.d();b.av(d),b.au(v);var w=0;t.af(),n.af(),r.af(),i.af(),s.af(),o.af(),u.af(),a.af(),f.af();for(var E=b.ap();E.i1();){var S=E.i8(),x=this.b1(S);x==null||x.d()||x.g()?r.aa(S):x.e()?t.aa(S):x.f()?(n.aa(S),f.aa(S)):x.c()&&(a.aa(S),f.aa(S)),E.i2(),w++}w=0;for(var T=b.am();T.i1();){var N=T.i8(),C=this.a2(N);C==null||C.c()||C.g()?i.aa(N):C.e()?t.aa(N):C.f()?(n.aa(N),f.aa(N)):C.d()&&(o.aa(N),f.aa(N)),T.i2(),w++}var k=l.i3(b);if(!f.ar()){var L=.1/f.ay();for(var A=k-.4;!f.ar();A+=L){var O=f.c3();if(O.a2()===b){var M=this._d.xm();this._n.z1(M,O.a2()),this._d.s7(M,1,1),this._c.z1(M,this._c.i1(b)),l.i6(M,A),this._a.i8(O,this._d.gn(O)),this._d.gt(O,xo._A),this._d.xr(O,M,O.a3()),g.ao(M,y)}else{var _=this._d.xm();this._n.z1(_,O.a3()),this._d.s7(_,1,1),this._c.z1(_,this._c.i1(b)),l.i6(_,A),this._g.i8(O,this._d.gk(O)),this._d.gz(O,xo._A),this._d.xr(O,O.a2(),_),g.ao(_,y)}}}if(!t.ar()){var D=.1/t.ay();for(var P=k+.1;!t.ar();P+=D){var H=t.c3();if(H.a2()===b){var B=this._d.xm();this._n.z1(B,H.a2()),this._d.s7(B,1,1),this._c.z1(B,this._c.i1(b)),l.i6(B,P),this._a.i8(H,this._d.gn(H)),this._d.gt(H,xo._A),this._d.xr(H,B,H.a3()),y=g.an(B,y)}else{var j=this._d.xm();this._n.z1(j,H.a3()),this._d.s7(j,1,1),this._c.z1(j,this._c.i1(b)),l.i6(j,P),this._g.i8(H,this._d.gk(H)),this._d.gz(H,xo._A),this._d.xr(H,H.a2(),j),y=g.an(j,y)}}}var F=zo._z;this._b.a2(b)&&(F=this._b.b2(b));var I=F._b.ay()+o.ay()+b.ao()+s.ay()+F._q.ay();if(I>0){var q=this._d.g9(b)/2,R=this._d.gj(b),U=this.a7(R,I),z=-0.5*R+this.a8(this._d.gj(b),I,U)+U*(F._b.ay()+o.ay());for(var W=b.ap();W.i1();W.i2()){var X=W.i8();!this.c2(X)&&this._j.i1(X.a2())==null&&(this._d.g2(X).i8(new us(z,q)),z+=U)}}var V=this._t.a3(b),$=0,J=0,K=0,Q=0;V!=null&&($=V._e.ay(),J=V._c.ay(),K=V._b.ay(),Q=V._d.ay()),I=F._g.ay()+$+a.ay()+b.ak()+u.ay()+J+F._d.ay();if(I>0){var G=this._d.gj(b),Y=this.a7(G,I),Z=this.a8(G,I,Y),et=-0.5*G+Z+Y*(F._g.ay()+$+a.ay()),tt=-this._d.g9(b)/2;for(var nt=b.am();nt.i1();nt.i2()){var rt=nt.i8();!this.d1(rt)&&this._j.i1(rt.a3())==null&&(this._d.g2(rt).i9(new us(et,tt)),et+=Y)}if(V!=null){var it=-0.5*G+Z+Y*(F._g.ay()+a.ay()+V._e.ay()-1);for(var st=V._e.c1();st.i1();st.i2()){var ot=st.i8();this._d.u1(ot),ot.a2()===b&&!this.c2(ot)?(this._d.g2(st.i8()).i8(new us(it,tt)),it-=Y):this.d1(ot)||(this._d.g2(st.i8()).i9(new us(it,tt)),it-=Y),this._d.h1(ot)}it=.5*G-Z-Y*(F._d.ay()+u.ay());for(var ut=V._c.c1();ut.i1();ut.i2()){var at=ut.i8();this._d.u1(at),at.a2()===b&&!this.c2(at)?(this._d.g2(ut.i8()).i8(new us(it,tt)),it-=Y):this.d1(at)||(this._d.g2(ut.i8()).i9(new us(it,tt)),it-=Y),this._d.h1(at)}}}this._b.a2(b)&&this._b.a4(b,$+a.ay()+b.ak()+u.ay()+J,o.ay()+b.ao()+s.ay(),K+n.ay(),Q+t.ay())}}return this._d.xi(l),e},a7:function(e,t){return t<=1?0:e/(t-1+2*this._r)},a8:function(e,t,n){return t<=1?e*.5:(e-n*(t-1))*.5},f:function(e){var t=this.g1();this._f=this._d.xk();for(var n=0;n<e.length;n++){var r=e[n];for(var i=r._b;i!=null;){var s=i.d(),o=this._n.i1(s);if(o!=null||this._t.b2(s))i=i.a();else{var u=new Ys,a=new Ys,f=new Ys,l=new Ys,c=new Ys,h=new Ys,p=new Ps,d=new Ps,v=new Ko(u,a,f,l,c,h,p,d);this._f.z1(s,v),p.ab(s.am()),d.ab(s.ap());for(var m=i.b();m!=null&&this._n.i1(m.d())===s;m=m.b()){var g=m.d(),y=this.c3(g);y.f()?a.ac(g):y.c()?l.ac(g):y.d()&&h.ac(g)}var b;for(b=i.a();b!=null&&this._n.i1(b.d())===s;b=b.a()){var w=b.d(),E=this.c3(w);E.e()?u.aa(w):E.c()?f.aa(w):E.d()&&c.aa(w)}i=b}}}var S=this.d2(e),x=0;for(var T=0;T<e.length;T++){var N=S[T];T>0&&(x+=S[T-1]._j+S[T-1]._h+S[T-1]._b),x+=N._g+N._f+N._a+N._d;for(var C=e[T].x1();C.i1();C.i2()){var k=C.i9();this._d.s3(k,this._d.gi(k),this._d.gh(k)+x)}N._c+=x,N._i+=x}for(var L=0;L<e.length;L++){var A=e[L];for(var O=A.x1();O.i1();O.i2()){var M=O.i9();this._n.i1(M)!=null&&A.av(O)}}var _=this,D=function(e,t){return _.a3(e)?_.a3(t)?_._d.gi(e)>=_._d.gi(t)?-1:1:1:_.a3(t)?-1:_._d.gi(e)>=_._d.gi(t)?1:-1},P=function(e,t){return _.a3(e)?_.a3(t)?_._d.gi(e)>=_._d.gi(t)?1:-1:1:_.a3(t)?-1:_._d.gi(e)>=_._d.gi(t)?-1:1};for(var H=0;H<e.length;H++){var B=S[H];for(var j=e[H].x1();j.i1();j.i2()){var F=j.i9();if(!this._t.b2(F)){var I=this._f.i1(F),q=I._d,R=I._a,U=I._b,z=I._h,W=I._f,X=I._c,V=I._g,$=I._e,J=0,K=0,Q=0,G=0,Y=F.ao(),Z=F.ak(),et=this._d.gi(F),tt=this._d.gh(F),nt=this._d.gj(F),rt=this._d.g9(F),it=this._t.a3(F),st=zo._z;this._b.a2(F)&&(st=this._b.b2(F));if(it!=null){J=it._d.ay(),K=it._b.ay(),Q=it._e.ay(),G=it._c.ay();if(J>0){var ot=st._h.ay()+q.ay()+J+st._k.ay(),ut=this.a7(rt,ot),at=this.a8(rt,ot,ut),ft=tt+at+ut*(st._h.ay()+this.a4(q));for(var lt=it._d.c1();lt.i1();lt.i2()){var ct=lt.i8();this._d.u1(ct),ct.a2()===F?this.c2(ct)||this._d.gx(ct,new us(et+nt,ft)):(this.d1(ct),this._d.gy(ct,new us(et+nt,ft))),ft+=ut,this._d.h1(ct)}}if(K>0){var ht=st._i.ay()+R.ay()+K+st._l.ay(),pt=this.a7(rt,ht),dt=this.a8(rt,ht,pt),vt=tt+dt+pt*(st._i.ay()+this.a4(R));for(var mt=it._b.c1();mt.i1();mt.i2()){var gt=mt.i8();this._d.u1(gt),gt.a2()===F?this.c2(gt)||this._d.gx(gt,new us(et,vt)):this.d1(gt)||this._d.gy(gt,new us(et,vt)),vt+=pt,this._d.h1(gt)}}}if(q.ay()>0){q.a1(D);var yt=st._h.ay()+q.ay()+J+st._k.ay(),bt=this.a7(rt,yt),wt=this.a8(rt,yt,bt),Et=tt+wt+bt*st._h.ay(),St=!0;while(!q.ar()){var xt=q.x4();if(this.a3(xt)){St&&(St=!1,Et+=bt*J);var Tt=xt.ag(),Nt=this._d.gd(Tt),Ct=Nt.at();Nt.ac(new us(Ct.x,B.b()));if(this.c2(Tt)){var kt=this._a.i1(Tt);Nt.ac(new us(Ct.x,kt.y+this._d.g6(F))),Nt.ac(new us(kt.x+this._d.g5(F),kt.y+this._d.g6(F)))}else Nt.ac(new us(Ct.x,Et)),Nt.ac(new us(et+nt,Et));this._d.xr(Tt,F,Tt.a3()),this._d.m1(Tt,Nt)}else{var Lt=xt.ae(),At=this._d.gd(Lt),Ot=At.au();At.ae(new us(Ot.x,B.a()));if(this.d1(Lt)){var Mt=this._g.i1(Lt);At.ae(new us(Ot.x,Mt.y+this._d.g6(F))),At.ae(new us(Mt.x+this._d.g5(F),Mt.y+this._d.g6(F)))}else At.ae(new us(Ot.x,Et)),At.ae(new us(et+nt,Et));this._d.xr(Lt,Lt.a2(),F),this._d.m1(Lt,At)}this._d.x4(xt),Et+=bt}}if(R.ay()>0){R.a1(P);var _t=st._i.ay()+R.ay()+K+st._l.ay(),Dt=this.a7(rt,_t),Pt=this.a8(rt,_t,Dt),Ht=tt+Pt+Dt*st._i.ay(),Bt=!0;while(!R.ar()){var jt=R.x4();if(this.a3(jt)){Bt&&(Bt=!1,Ht+=Dt*K);var Ft=jt.ag(),It=this._d.gd(Ft),qt=It.at();It.ac(new us(qt.x,B.b()));if(this.c2(Ft)){var Rt=this._a.i1(Ft);It.ac(new us(qt.x,Rt.y+this._d.g6(F))),It.ac(new us(Rt.x+this._d.g5(F),Rt.y+this._d.g6(F)))}else It.ac(new us(qt.x,Ht)),It.ac(new us(et,Ht));this._d.xr(Ft,F,Ft.a3()),this._d.m1(Ft,It)}else{var Ut=jt.ae(),zt=this._d.gd(Ut),Wt=zt.au();zt.ae(new us(Wt.x,B.a()));if(this.d1(Ut)){var Xt=this._g.i1(Ut);zt.ae(new us(Wt.x,Xt.y+this._d.g6(F))),zt.ae(new us(Xt.x+this._d.g5(F),Xt.y+this._d.g6(F)))}else zt.ae(new us(Wt.x,Ht)),zt.ae(new us(et,Ht));this._d.xr(Ut,Ut.a2(),F),this._d.m1(Ut,zt)}this._d.x4(jt),Ht+=Dt}}var Vt=st._g.ay()+st._d.ay()+Z+z.ay()+U.ay()+Q+G;nt=this._d.gj(F);var $t=this.a7(nt,Vt),Jt=this.a8(nt,Vt,$t);Vt=st._b.ay()+st._q.ay()+Y+X.ay()+W.ay();var Kt=this.a7(nt,Vt),Qt=this.a8(nt,Vt,Kt);if(z.ay()>0){var Gt=$t,Yt=t,Zt=this._d.gi(F)+Jt+Gt*(st._g.ay()+z.ay()-1),en=this._d.gh(F),tn=B._c-B._g-z.ay()*Yt,nn;for(;!z.ar();this._d.x4(nn)){nn=z.x4();var rn=nn.ag(),sn=this._d.gd(rn),on=sn.at();sn.ac(new us(on.x,B.b())),sn.ac(new us(on.x,tn));if(this.c2(rn)){var un=this._a.i1(rn);sn.ac(new us(un.x+this._d.g5(F),tn)),sn.ac(new us(un.x+this._d.g5(F),un.y+this._d.g6(F)))}else sn.ac(new us(Zt,tn)),sn.ac(new us(Zt,en)),Zt-=Gt;tn+=Yt,this._d.xr(rn,F,rn.a3()),this._d.m1(rn,sn)}}if(U.ay()>0){var an=$t,fn=t,ln=this._d.gi(F)+this._d.gj(F)-Jt-an*st._d.ay(),cn=this._d.gh(F),hn=B._c-B._g-fn,pn;for(;!U.ar();this._d.x4(pn)){pn=U.x4();var dn=pn.ag(),vn=this._d.gd(dn),mn=vn.at();vn.ac(new us(mn.x,B.b())),vn.ac(new us(mn.x,hn));if(this.c2(dn)){var gn=this._a.i1(dn);vn.ac(new us(gn.x+this._d.g5(F),hn)),vn.ac(new us(gn.x+this._d.g5(F),gn.y+this._d.g6(F)))}else vn.ac(new us(ln,hn)),vn.ac(new us(ln,cn)),ln-=an;hn-=fn,this._d.xr(dn,F,dn.a3()),this._d.m1(dn,vn)}}if(X.ay()>0){var yn=Kt,bn=t,wn=this._d.gi(F)+Qt+yn*(st._b.ay()+X.ay()-1),En=this._d.gh(F)+this._d.g9(F),Sn=En+X.ay()*bn,xn;for(;!X.ar();this._d.x4(xn)){xn=X.x4();var Tn=xn.ae(),Nn=this._d.gd(Tn),Cn=Nn.au();Nn.ae(new us(Cn.x,B.a())),Nn.ae(new us(Cn.x,Sn));if(this.d1(Tn)){var kn=this._g.i1(Tn);Nn.ae(new us(kn.x+this._d.g5(F),Sn)),Nn.ae(new us(kn.x+this._d.g5(F),kn.y+this._d.g6(F)))}else Nn.ae(new us(wn,Sn)),Nn.ae(new us(wn,En)),wn-=yn;Sn-=bn,this._d.xr(Tn,Tn.a2(),F),this._d.m1(Tn,Nn)}}if(W.ay()>0){var Ln=Kt,An=t,On=this._d.gi(F)+this._d.gj(F)-Qt-Kt*st._q.ay(),Mn=this._d.gh(F)+this._d.g9(F),_n=Mn+An,Dn;for(;!W.ar();this._d.x4(Dn)){Dn=W.x4();var Pn=Dn.ae(),Hn=this._d.gd(Pn),Bn=Hn.au();Hn.ae(new us(Bn.x,B.a())),Hn.ae(new us(Bn.x,_n));if(this.d1(Pn)){var jn=this._g.i1(Pn);Hn.ae(new us(jn.x+this._d.g5(F),_n)),Hn.ae(new us(jn.x+this._d.g5(F),jn.y+this._d.g6(F)))}else Hn.ae(new us(On,_n)),Hn.ae(new us(On,Mn)),On-=Ln;_n+=An,this._d.xr(Pn,Pn.a2(),F),this._d.m1(Pn,Hn)}}while(!$.ar()){var Fn=$.c3(),In=this._d.gl(Fn);B.a()+12<In.y&&this._d.g7(Fn).i4(In.x,B.a())}while(!V.ar()){var qn=V.c3(),Rn=this._d.gs(qn);if(B.b()-12>Rn.y){var Un=this._d.gf(qn);Un.ac(new us(Rn.x,B.b())),this._d.s6(qn,Un)}}}}}for(var zn=0;zn<e.length;zn++){var Wn=e[zn];for(var Xn=Wn._b;Xn!=null;Xn=Xn.a()){var Vn=Xn.d(),$n=this._t.a3(Vn);$n!=null&&$n._a!=null&&(this._d.x4($n._a),Wn.aw(Xn.b()))}}return this._d.xi(this._f),this._d.xj(this._a),this._d.xj(this._g),e},c3:function(e){return this.a3(e)?this.b1(e.ag()):this.a2(e.ae())},b1:function(e){return this._h==null?zo.s:this._h.i1(e)},a2:function(e){return this._l==null?zo.u:this._l.i1(e)},c2:function(e){if(e==null)return!1;var t=this.b1(e);return t!=null&&t.a()},d1:function(e){if(e==null)return!1;var t=this.a2(e);return t!=null&&t.a()},a3:function(e){return e.ao()===1},b2:function(e){return e.ak()===1},a4:function(e){var t=0;for(var n=e._b;n!=null;n=n.a())this.b2(n.d())&&t++;return t},d2:function(e){var t=this._k,n=Qo.d(e.length+1);for(var r=0;r<e.length;r++){var i=e[r],s=new $o;n[r]=s,s._c=Number.MAX_VALUE,s._i=Number.MIN_VALUE;for(var o=i.x1();o.i1();o.i2()){var u=o.i9(),a=this._d.gb(u);s._c=Math.min(s._c,a.i2()),s._i=Math.max(s._i,a.i2()+a.i4())}}this._b.a5(e,n);for(var f=0;f<e.length;f++){var l=n[f];for(var c=e[f].x1();c.i1();c.i2()){var h=c.i9(),p=this._f.i1(h);p!=null&&(l._h=Math.max(l._h,Math.max(p._f.ay()*t,p._c.ay()*t)),l._f=Math.max(l._f,Math.max(p._b.ay()*t,p._h.ay()*t)))}}return n}}),zo.s=_o.j(2),zo.u=_o.j(1),zo._z=new Uo;var Wo=function(){this._af=0,this._b=0};r.ext(Wo,Object,{ib:function(e){this._af=e},ia:function(e,t,n){this.a6(e,t,n),this.b2(!1);var r=this.g();if(this.o()&&r>0){var i=this.r();for(var s=0;s<20&&r>0&&this.o();s++){this.b2(!0);var o=this.g();o<r&&(this.a7(i),r=o)}this.b3(i),this.b1()}return this.c()},a6:function(e,t,n){this._b=(new Date).getTime(),this._ac=e,this._ah=t;var r=this;this._p=function(e,t){var n=r._n[e.al()]-r._n[t.al()];return n>0?1:n>=0?0:-1},this._ad=Qo.d(n);for(var i=0;i<this._ad.length;i++)this._ad[i]=new Ys;this._ab=Qo.a(this._ac.x0()),this._f=Qo.d(this._ac.x0()),this._n=Qo.a(this._ac.x0()+1);var s=this._ab;this._o=function(e,t){if(e==null&&t!=null)return 1;if(e!=null&&t==null)return-1;if(e==null&&t==null)return 0;var n=e,r=t,i=n._h,o=n.a2(),u=r.a2(),a=s[o.al()]-s[u.al()];if(a===0){var f=Wo.b(_o.h(i,n),i.gn(n)),l=Wo.b(_o.h(i,r),i.gn(r)),c=f-l;if(c===0){var h=s[n.a3().al()]-s[r.a3().al()];if(h===0){var p=Wo.a(_o.i(i,n),i.gk(n)),d=Wo.a(_o.i(i,r),i.gk(r));return p-d}return h}return c}return a},this._l=function(e,t){if(e==null&&t!=null)return 1;if(e!=null&&t==null)return-1;if(e==null&&t==null)return 0;var n=e,r=t,i=n._h,o=n.a3(),u=r.a3(),a=s[o.al()]-s[u.al()];if(a===0){var f=Wo.a(_o.i(i,n),i.gk(n)),l=Wo.a(_o.i(i,r),i.gk(r)),c=f-l;if(c===0){var h=s[n.a2().al()]-s[r.a2().al()];if(h===0){var p=Wo.b(_o.h(i,n),i.gn(n)),d=Wo.b(_o.h(i,r),i.gn(r));return p-d}return h}return c}return a},this._z=function(e,t){if(e==null&&t!=null)return 1;if(e!=null&&t==null)return-1;if(e==null&&t==null)return 0;var n=e,r=t,i=n._h,s=Wo.b(_o.h(i,n),i.gn(n)),o=Wo.b(_o.h(i,r),i.gn(r));return s-o},this._e=function(e,t){if(e==null&&t!=null)return 1;if(e!=null&&t==null)return-1;if(e==null&&t==null)return 0;var n=e,r=t,i=n._h,s=Wo.a(_o.i(i,n),i.gk(n)),o=Wo.a(_o.i(i,r),i.gk(r));return s-o},this._ac.x2(this._e,this._z)},c:function(){this._ah=null,this._aa=null,this._f=null,this._n=null,this._p=null,this._o=null,this._l=null,this._ac=null;var e=this._ad;return this._ad=null,e},o:function(){var e=(new Date).getTime()-this._b;return e<=this._af},m:function(){var e=this,t=function(t,n){return Math.ceil(e._n[t.a3().al()])-Math.ceil(e._n[n.a3().al()])};for(var n=this._ac.x9();n.i1();n.i2()){for(var r=n.i9().aw();r.i1();r.i2())this._n[r.i9().al()]=xo.j();n.i9().av(t)}},b2:function(e){for(var t=0;t<this._ad.length;t++)this._ad[t].af();if(e){this.m();for(var n=0,r=this._ab.length;n<r;n++)this._ab[n]=0;this._ac.x2(null,this._z)}var i=this._ac.xm();this._ah.i7(i,0);for(var s=this._ac.x9();s.i1();s.i2())s.i9().ak()===0&&s.i9()!==i&&this._ac.xo(i,s.i9());var o=new Es(this);o.a6(!0),o.a9(this._ac,i),this._ad[0].at(),this._ac.x4(i),this.d()},a1:function(){this._ac.x2(this._o,this._l);var e=0;for(var t=1;t<this._ad.length;t++){var n=this.a2(this._ad[t-1],this._ad[t]);e+=n}var r=0;return e+=r,e},a2:function(e,t){var n=e.ah(),r=t.ah(),i=new Ds,s=new Ds;this._aa=Qo.d(this._ac.x0());var o=0;for(;n.i1()&&r.i1();r.i2())o+=this.a8(n.i6(),i,s,!0),o+=this.a8(r.i6(),s,i,!1),n.i2();for(;n.i1();n.i2())o+=this.a8(n.i6(),i,s,!0);for(;r.i1();r.i2())o+=this.a8(r.i6(),s,i,!1);return o},a8:function(e,t,n,r){var i=0,s=0,o=0;if(this._aa[e.al()]!=null){var u=this._aa[e.al()].a();for(var a=t._b;a!==u;a=a.a()){var f=a._c;f===e?(i++,o+=s,t.aw(a)):s++}}var l=i*n.ay()+o;if(r)for(var c=e.ag();c!=null;c=c.a8()){var h=c.a3();this._ab[h.al()]>=this._ab[e.al()]&&(this._aa[h.al()]=n.ae(h))}else for(var p=e.ae();p!=null;p=p.a7()){var d=p.a2();this._ab[d.al()]>this._ab[e.al()]&&(this._aa[d.al()]=n.ae(d))}return l},g:function(){var e=this.r(),t=this.a1(),n=!0;for(var r=0;r<3&&this.o()&&t>0;){var i=this.k();i<t?(this.a7(e),t=i):r++,n=!n}this.b3(e),this.b1();if(t>0){var s=1;for(var o=0;s===1&&t>0;o++){this.e(),this.i();var u=this.a1();u<t?(s=1,this.a7(e)):s=-1,t=u}this.b3(e),this.b1()}return t},e:function(){var e=this.l(),t=this.r(),n=Qo.d(this._ac.x0());for(var r=this._ad.length-1;r>=0;r--)for(var i=this._ad[r].ah();i.i1();i.i2()){var s=i.i6();if(s.ak()===1&&s.ao()===1){var o=e.i1(s.ag());if(o!=null&&n[o.al()]==null){var u=this.a4(s,o),a=o.al(),f=n[a]=Qo.d(u+1);for(var l=f.length-1;l>=0;l--)f[l]=new Ds}}}for(var c=0;c<this._ad.length;c++)for(var h=this._ad[c].ah();h.i1();h.i2()){var p=h.i6();if(p.ak()===1&&p.ao()===1){var d=e.i1(p.ag());if(d!=null){var v=d.al(),m=this.a4(p,d)-1;n[v][m].ae(p.ae())}}else for(var g=p.ae();g!=null;g=g.a7()){var y=e.i1(g);if(y!=null){var b=y.al(),w=this.a4(p,y)-1;n[b][w].ae(g)}}}for(var E=this._ac.x9();E.i1();E.i2()){var S=E.i9();if(n[S.al()]!=null)for(var x=S.ag();x!=null;x=x.a8()){var T=e.i1(x);if(T!=null)for(var N=n[T.al()];N[0].ay()>0;){var C=0,k;do{k=N[C].am();var L=k.a3();if(L.ak()!==1||L.ao()!==1)break;C++}while(!0);var A=N[C].at().a3();C--,A=k.a2(),k=N[C].at();var O=k.a3();while(C>=0){t[A.al()]!==t[O.al()]&&(this._ab[A.al()]=t[O.al()]),A=A.ae().a2();if(--C>=0){var M=N[C].at();O=M.a3()}}}}}this.b1(),this._ac.xj(e)},i:function(){var e=this.f(),t=this.r(),n=Qo.d(this._ac.x0());for(var r=0;r<this._ad.length;r++)for(var i=this._ad[r].ah();i.i1();i.i2()){var s=i.i6();if(s.ak()===1&&s.ao()===1){var o=e.i1(s.ae());if(o!=null&&n[o.al()]==null){var u=this.a4(o,s),a=o.al(),f=n[a]=Qo.d(u+1);for(var l=f.length-1;l>=0;l--)f[l]=new Ds}}}for(var c=this._ad.length-1;c>=0;c--)for(var h=this._ad[c].ah();h.i1();h.i2()){var p=h.i6();if(p.ak()===1&&p.ao()===1){var d=e.i1(p.ae());if(d!=null){var v=d.al(),m=this.a4(d,p)-1;n[v][m].ae(p.ag())}}else for(var g=p.ag();g!=null;g=g.a8()){var y=e.i1(g);if(y!=null){var b=y.al(),w=this.a4(y,p)-1;n[b][w].ae(g)}}}for(var E=this._ac.x9();E.i1();E.i2()){var S=E.i9();if(n[S.al()]!=null)for(var x=S.ae();x!=null;x=x.a7()){var T=e.i1(x);if(T!=null)for(var N=n[T.al()];N[0].ay()>0;){var C=0,k;do{k=N[C].am();var L=k.a2();if(L.ak()!==1||L.ao()!==1)break;C++}while(!0);var A=N[C].at().a2();C--,A=k.a3(),k=N[C].at();var O=k.a2();while(C>=0){t[A.al()]!==t[O.al()]&&(this._ab[A.al()]=t[O.al()]),A=A.ag().a3();if(--C>=0){var M=N[C].at();O=M.a2()}}}}}this.b1(),this._ac.xj(e)},a4:function(e,t){return this._ah.i2(e)-this._ah.i2(t)},l:function(){var e=no.a6(Qo.d(this._ac.xg()));for(var t=this._ac.x9();t.i1();t.i2()){var n=t.i9();if(n.ao()>1){var r=0;for(var i=n.ag();i!=null;i=i.a8()){var s=i.a3();s.ak()===1&&s.ao()===1&&r++}if(r>1)for(var o=n.ag();o!=null;o=o.a8()){var u=o,a=u.a3();if(a.ak()===1&&a.ao()===1){for(;a.ak()===1&&a.ao()===1;a=u.a3())e.i8(u,n),u=a.ag();e.i8(u,n)}}}}return e},f:function(){var e=no.a6(Qo.d(this._ac.xg()));for(var t=this._ac.x9();t.i1();t.i2()){var n=t.i9();if(n.ak()>1){var r=0;for(var i=n.ae();i!=null;i=i.a7()){var s=i.a2();s.ak()===1&&s.ao()===1&&r++}if(r>1)for(var o=n.ae();o!=null;o=o.a7()){var u=o,a=u.a2();if(a.ak()===1&&a.ao()===1){for(;a.ak()===1&&a.ao()===1;a=u.a2())e.i8(u,n),u=a.ae();e.i8(u,n)}}}}return e},k:function(){for(var e=1;e<this._ad.length;e++){var t=this._ad[e];for(var n=t.ah();n.i1();n.i2()){var r=n.i6();this._n[r.al()]=this.a5(r,t.ay(),r.am(),this._ad[e-1].ay()),this._n[r.al()]+=this._ab[r.al()]/(this._ad[e-1].ay()*3)}this.a3(t,this._p)}return this.a1()},a5:function(e,t,n,r){var i=0;if(n.i7()===0)i=r*this._ab[e.al()]/t;else{for(;n.i1();n.i2()){var s=n.i8();s.a2()===e?i+=this._ab[s.a3().al()]:i+=this._ab[s.a2().al()]}i/=n.i7()}return i},a7:function(e){Qo.f(this._ab,e,e.length)},b3:function(e){Qo.f(e,this._ab,e.length)},r:function(){var e=Qo.a(this._ab.length);return this.a7(e),e},d:function(){for(var e=0;e<this._ad.length;e++){var t=0;for(var n=this._ad[e].ah();n.i1();)this._ab[n.i6().al()]=t,n.i2(),t++}},b1:function(){for(var e=0;e<this._ad.length;e++){var t=this._ad[e];for(var n=t._b;n!=null;n=n.a()){var r=n.d();this._f[this._ab[r.al()]]=r}var i=0;for(var s=t._b;s!=null;)s.c(this._f[i]),s=s.a(),i++}},a3:function(e,t){var n=e.ah();for(var r=0;r<e.ay();n.i2())this._f[r]=n.i6(),r++;Qo.s(this._f,e.ay(),t);var i=0;for(var s=e._b;s!=null;)s.c(this._f[i]),this._ab[this._f[i].al()]=i,s=s.a(),i++}}),Wo.b=function(e,t){if(e==null)return 0;var n=e.a()?Math.floor(t.x):0,r=e.a()?Math.floor(t.y):0;return e.e()?1e4-r:e.f()?-1e4+r:e.c()?-2e4-n:n},Wo.a=function(e,t){if(e==null)return 0;var n=e.a()?Math.floor(t.x):0,r=e.a()?Math.floor(t.y):0;return e.e()?1e4+r:e.f()?-1e4-r:e.d()?-2e4-n:n};var Xo=function(){Xo.superClass.constructor.call(this),this._i6=0,this._i3=2147483647,this._i0=60,this._iz=20,this._i2=20,this._i4=20,this.i5(!1),this._i7=new jo,this._i1=new Wo,this._i8=new qo};r.ext(Xo,so,{j2:function(){return this._i2},i4:function(e){return!0},i3:function(e){this._i6=(new Date).getTime(),Mo.d(e,!1);var t=e.xk(),n=e.xk(),r=e.xl(),i=new Ps,s=new zo(e,t,n,r);s.a6(this.j2()),this._i8.i3(this._iz),this._i8.i6(this._i0),this._i8.i4(this._i2),this._i8.i5(this._i4),this._i8.i2(n);var o=this._i7.i1(e,t,i);for(var u=i.c1();u.i1();u.i2()){var a=u.i8();r.i7(a,!0);var f=e.gn(a);e.gt(a,e.gk(a)),e.gz(a,f)}this.a2(e,t,n),o=s.a9(o);var l=this.j1(e,t,o);l=s.a5(l),l=s.b3(l),this._i8.i1(e,l,t),l=s.g2(l),s.e2(l),this.b(e,n),this.w(e),this.a1(e,i),s.e1(),e.xj(r),e.xi(n),e.xi(t)},j1:function(e,t,n){if(this._i1 instanceof Wo){var r=this._i1,i=(new Date).getTime()-this._i6;r.ib(this._i3-i)}var s=this._i1.ia(e,t,n);return s},a1:function(e,t){for(var n=t.c1();n.i1();n.i2()){var r=n.i8(),i=e.gs(r),s=e.gl(r);e.x3(r);var o=e.gp(r);e.s5(r,o.a()),e.gy(r,i),e.gx(r,s)}},b:function(e,t){for(var n=e.x9();n.i1();n.i2()){var r=n.i9(),i=t.i1(r);if(i!=null&&!e.xp(i)){for(var s=r.am().i8().a2();t.i1(s)!=null;s=r.am().i8().a2())r=s;e.u1(i);var o=r.ae(),u=new Ds;for(;t.i1(o.a3())!=null;o=o.a3().ag()){var a=e.gs(o);u.aa(a),u.az(e.gf(o));var f=e.gl(o);f.equals(a)||u.aa(f)}var l=e.gs(o);u.aa(l),u.az(e.gf(o));var c=e.gl(o);c.equals(l)||u.aa(c),e.m1(i,u)}}for(var h=e.x9();h.i1();h.i2())t.i1(h.i9())!=null&&e.x4(h.i9())},w:function(e){for(var t=e.xf();t.i1();t.i2()){var n=t.i8(),r=e.g2(n);if(r.i1()>0){var i=new Oi,s=e.gc(n),o=s.c(),u=o.i6();o.i2();var a=u.x,f=u.y;if(o.i1()){var l=o.i6(),c=l.x,h=l.y;o.i2();for(;o.i1();o.i2()){var p=o.i6(),d=p.x,v=p.y,m=(a-d)*(h-v)/(f-v)+d;Math.abs(m-c)>=1&&(i.add(l),a=c,f=h),l=p,c=d,h=v}}i.size()<r.i1()&&e.s5(n,new hs(i))}}},a2:function(e,t,n){var r=e.g8().c1();r.i5();for(;r.i1();r.i3()){var i=r.i8().a2(),s=r.i8().a3(),o=t.i2(s)-t.i2(i);if(o>1){var u=null,a=null,f=i;for(;o>1;o--)u=e.xm(),e.s7(u,1,1),e.s4(u,xo._A),a=e.xo(f,u),f===i&&e.gt(a,e.gn(r.i8())),t.i7(u,t.i2(f)+1),n.z1(u,r.i8()),f=u;a=e.xo(u,s),e.gz(a,e.gk(r.i8())),e.h1(r.i8())}}}});var Vo=function(e,t,n,r){this._i=20,this._j=e,this._g=t,this._a=n,this._h=r};r.ext(Vo,Object,{a1:function(e){this._i=e},b2:function(e){return this._e==null?!1:this._e.i4(e)},a3:function(e){return this._f==null?null:this._f.i1(e)},d:function(){this._j.xi(this._f),this._j.xi(this._e)}});var $o=function(){this._c=0,this._i=0,this._g=0,this._j=0,this._f=0,this._h=0,this._d=0,this._e=0,this._a=0,this._b=0};r.ext($o,Object,{a:function(){return this._c-this._g-this._f-this._a},b:function(){return this._i+this._j+this._h+this._b}});var Jo=function(){this._d=new Ps,this._b=new Ps,this._c=new Ps,this._e=new Ps};r.ext(Jo,Object,{});var Ko=function(e,t,n,r,i,s,o,u){this._d=e,this._a=t,this._b=n,this._h=r,this._f=i,this._c=s,this._e=o,this._g=u};r.ext(Ko,Object,{});var Qo={};Qo.a=function(e,t){var n=[];for(var r=0;r<e;r++)n[r]=t||0;return n},Qo.b=function(e){var t=[];for(var n=0;n<e;n++)t[n]=!1;return t},Qo.c=function(e,t){if(e instanceof us)return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y<=t.y?0:1;if(e instanceof as)return t.width>e.width?-1:t.width<e.width?1:t.height>e.height?-1:t.height>=e.height?0:1;if(e instanceof ls)return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:t.width>e.width?-1:t.width<e.width?1:t.height>e.height?-1:t.height>=e.height?0:1;throw"Unkown Type: "+e},Qo.d=function(e){var t=[];for(var n=0;n<e;n++)t[n]=null;return t},Qo.e=function(e,t){var n=[];for(var r=0;r<e;r++)n[r]=Qo.a(t);return n},Qo.f=function(e,t,n){for(var r=0;r<n;r++)t[r]=e[r]},Qo.s=function(e,t,n){var r=[];Qo.f(e,r,t),r.sort(n),Qo.f(r,e,t)},Qo.n=function(e,t){return e-t};var Go=e.make={},Yo={},Zo={},eu=[],tu={};Go.Default={path:"./",resPath:"",getImagePath:function(e){return this.path+this.resPath+"res/images/"+(e||"")},register:function(e,t,n){n=n||{},n.name=n.name||e,n.modelDefaultParameters=n.modelDefaultParameters||{},n.description=n.description||n.name,Yo[e]&&console.log(e," already exist"),Yo[e]=t;var r=n.category||"",i=Zo[r]||{};i[e]=t,Zo[r]=i,tu[e]=n,eu.indexOf(r)==-1&&eu.push(r),this.checkModelDefaultParameters(n.modelDefaultParameters)},checkModelDefaultParameters:function(e){if(!e)return;for(var n in e){var r=e[n];r instanceof Object||(r={value:r},e[n]=r),r.propertyName=n,r.hidden=!!r.hidden,r.propertyType=r.propertyType||Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,r.type=r.type||Go.Default.PARAMETER_TYPE_STRING,r.category=r.category||Go.Default.PARAMETER_CATEGORY_DETAIL,r.editable=r.editable===t?!0:!!r.editable,r.index=r.index===t?100:parseInt(r.index)}},remove:function(e){if(!Yo[e])console.log(e," not exist");else{Yo[e]=t,delete Yo[e];var n=Go.Default.getCategory(e),r=Zo[n];delete r[e];var i=0;for(var s in r)s&&i++;if(i==0)for(var s=0;s<eu.length;s++){var o=eu.indexOf(n);o>=0&&eu.splice(o,1)}delete tu[e]}},getCategories:function(){return eu},getCreatorsForCategory:function(e){return Zo[e]},getCreator:function(e){return Yo[e]},getIds:function(e){var t=[];for(var n in Yo)(!e||e&&e(this.getParameters(n)))&&t.push(n);return t},getModelDefaultParameters:function(e){var t=this.getParameters(e);return t.modelDefaultParameters},getDescription:function(e){var t=this.getParameters(e);return t.description},getName:function(e){var t=this.getParameters(e);return t.name},getIcon:function(e){var t=this.getParameters(e);return this.path+t.icon},isAsync:function(e){var t=this.getParameters(e);return t.async},isCombo:function(e){var t=this.getParameters(e);return t.combo},getCategory:function(e){var t=this.getParameters(e);return t.category},getOrder:function(e){var t=this.getParameters(e);return t.order||0},getType:function(e){var t=this.getParameters(e);return t.type},getOtherParameter:function(e,t){var n=this.getParameters(e);return n[t]},registerIcon:function(e,t){var n=this.getParameters(e);if(!n)return;return n.icon=t,n.icon},registerDescription:function(e,t){var n=this.getParameters(e);return n.description=t,n.description},registerName:function(e,t){var n=this.getParameters(e);return n.name=t,n.name},registerOther:function(e,t,n){var r=i[t],i=this.getParameters(e);return i[t]=n,t==="modelDefaultParameters"&&(console.warn("rewrite modelDefaultParameters: id={0}, oldValue={}, newValue={}",e,r,n),this.checkModelDefaultParameters(n)),r},appendModelDefaultParameter:function(e,t,n,r,i,s,o){var u={name:t,category:n,propertyType:r}},getParameters:function(e){return tu[e]||{}},load:function(e,t,n){var r=this,n=n||{},i=n.isRelation,s;if(t){var o=t;t=function(t){i&&e instanceof Array&&e.length>1&&t instanceof Array&&t.length>1&&this._relation(e,t),o(t)}}if(e instanceof Array){var u={},a=0;if(t){var f=function(n,r){var i=e.length;return function(e){n.datas=n.datas||[],n.datas.push(e),n._total===i&&t(n.datas)}(r)};u._total=0;for(var l=0;l<e.length;l++){var c=e[l];this.load(c,function(e){u._total++,f(u,e)})}return null}s=[];for(var l=0;l<e.length;l++){var c=e[l],h=this.load(c);h&&s.push(h)}}else{var p={};typeof e=="string"?p.id=e:p=e,p=this.filterJson(p),t?this._load(p,t):s=this._load(p)}return i&&s instanceof Array&&s.length>1&&this._relation(e,s),s},_relation:function(e,t){var n={};t.forEach(function(e){e.getId&&(n[e.getId()]=e)}),e.forEach(function(e){e.objectId&&e.parentId&&n[e.objectId]&&n[e.parentId]&&n[e.objectId].setParent&&n[e.objectId].setParent(n[e.parentId])})},_load:function(e,t){var n=e.id,r=this.getCreator(n);if(!r)return console.log("unknown id: ",n),null;if(!t){var i=r(e);return Go.Default._setObjectClientId(i,n),i}r(e,function(e){Go.Default._setObjectClientId(e,n),t&&t(e)})},_setObjectClientId:function(e,t){e&&e.setClient&&e.setClient("id",t)},copyArray:function(e,t,n){t=[];if(e){var r,i=0,s=e.length;for(;i<s;i++)r={},this.copyProperties(e[i],r),t.push(r)}return t},copyProperties:function(e,n,r){if(e&&n)for(var i in e)r&&r.indexOf(i)>=0||i.indexOf("_")==0||(n[i]===t&&(e[i]instanceof Array?n[i]=[]:e[i]instanceof Function?n[i]=e[i]:e[i]instanceof Object?n[i]={}:n[i]=e[i]),!(e[i]instanceof Function)&&e[i]instanceof Object&&n[i]instanceof Object&&Go.Default.copyProperties(e[i],n[i]))},getModelDefaultParametersValues:function(e,t){var n=this.getModelDefaultParameters(e),r={};for(var i in n){var s=n[i];if(t&&t(s))continue;s.propertyType==Go.Default.PARAMETER_PROPERTY_TYPE_CLIENT?(r.client=r.client||{},r.client[i]=s.value):s.propertyType==Go.Default.PARAMETER_PROPERTY_TYPE_STYLE?(r.style=r.style||{},r.style[i]=s.value):r[i]=s.value}return r},getModelDefaultParameterProperties:function(e){var t=this,n=[],r=this.getModelDefaultParameters(e);if(!r)return n;r.id||(r.id={propertyName:"id",name:"模型ID",category:Go.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:Go.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-2}),r.objectId||(r.objectId={propertyName:"objectId",name:"实例ID",category:Go.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:Go.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-1});for(var i in r)n.push(r[i]);return n.sort(function(e,t){return e.index-t.index}),n=n.map(function(e){return t.modelParameterToProperty(e)}),n},_getNameFromPropertyName:function(e){var t=e.split("."),n="";for(var r=0;r<t.length;r++)t[r].length>0&&(n+=t[r].substring(0,1).toUpperCase()+t[r].substring(1,t[r].length)),r<t.length-1&&(n+=" ");return n},modelParameterToProperty:function(e){var t=new n.Property;return t.setCategoryName(e
.category),e.name||(e.name=this._getNameFromPropertyName(e.propertyName)),t.setName(e.name),t.setEditable(e.editable),t.setPropertyType(e.propertyType),t.setPropertyName(e.propertyName),t.setValueType(e.type),t.setEnumInfo(e.enumInfo),t.isVisible=function(){return!e.hidden},t},filterJson:function(e){var n=this.getModelDefaultParameters(e.id);for(var r in n){var i=n[r].propertyType||"client",s=n[r].value;if(i==Go.Default.PARAMETER_PROPERTY_TYPE_STYLE){if(!e.style||e.style[r]===t)e.style=e.style||{},e.style[r]=s}else if(i==Go.Default.PARAMETER_PROPERTY_TYPE_CLIENT){if(!e.client||e.client[r]===t)e.client=e.client||{},e.client[r]=s}else e[r]===t&&(e[r]=s)}return e},UNIT_HEIGHT:4.445,EQUIPMENT_WIDTH:45.5,RACK_OFFSET_X:7.25,RACK_OFFSET_Y:6.655,RACK_WIDTH:60,getUnitHeight:function(){return this.UNIT_HEIGHT},getEquipmentWidth:function(){return this.EQUIPMENT_WIDTH},getEquipmentHeight:function(e){return parseInt(e)>0||console.error("method getEquipmentHeight's first argument scale value is zero"),this.UNIT_HEIGHT*e},getRackWidth:function(){return this.RACK_WIDTH},getRackHeight:function(e){return parseInt(e)>0||console.error("method getRackHeight's first argument scale value is zero"),this.RACK_OFFSET_Y+this.UNIT_HEIGHT*parseInt(e)+this.RACK_OFFSET_Y}},Go.Default.toJson=function(e,t){if(e&&e.getClient){var n=e.getClient("id"),i=Go.Default.getModelDefaultParameters(n),s={},o=null,u=null;for(var a in i){if(i[a].exportable===!1)continue;var f=i[a].propertyType,u=i[a].value;f==Go.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR?(o=e[r.getter(a)](),Go.Default.equals(o,u)||(s[a]=o)):f==Go.Default.PARAMETER_PROPERTY_TYPE_FIELD?(o=e[a],Go.Default.equals(o,u)||(s[a]=o)):f==Go.Default.PARAMETER_PROPERTY_TYPE_STYLE?(o=e.getStyle(a),Go.Default.equals(o,u)||(s.style=s.style||{},s.style[a]=o)):f==Go.Default.PARAMETER_PROPERTY_TYPE_CLIENT&&(o=e.getClient(a),Go.Default.equals(o,u)||(s.client=s.client||{},s.client[a]=o))}return s.id=n,Go.Default.EXPORT_OBJECT_ID&&(s.objectId=e.getId()),t&&(s=t(s)),s}return t&&(e=t(e)),e},Go.Default.copy=function(e,t,n,r,i){var s=function(e,t,n,r,i){i=i||{};var s={},o={},u=Go.Default.getParameters(t);Go.Default.copyProperties(u,o),r instanceof Function?s=r(o)||{}:Go.Default.copyProperties(r,s),i.copyDefaultParamCoverage&&delete o.modelDefaultParameters,i.copyParamCoverage||Go.Default.copyProperties(o,s),Go.Default.register(e,function(e,r){var i={id:t};n instanceof Function?n(e):Go.Default.copyProperties(n,i),Go.Default.copyProperties(e,i);var s=Go.Default.load(i,r);return s},s)};s(e,t,n,r,i)},Go.Default.PARAMETER_CATEGORY_BASIC="BASIC",Go.Default.PARAMETER_CATEGORY_DETAIL="Detail",Go.Default.PARAMETER_TYPE_STRING="string",Go.Default.PARAMETER_TYPE_BOOLEAN="boolean",Go.Default.PARAMETER_TYPE_COLOR="color",Go.Default.PARAMETER_TYPE_INT="int",Go.Default.PARAMETER_TYPE_NUMBER="number",Go.Default.PARAMETER_TYPE_IMAGE="image",Go.Default.PARAMETER_TYPE_ARRAY_STRING="array.string",Go.Default.PARAMETER_TYPE_ARRAY_NUMBER="array.number",Go.Default.PARAMETER_TYPE_ARRAY_INT="array.int",Go.Default.PARAMETER_PROPERTY_TYPE_FIELD="field",Go.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR="accessor",Go.Default.PARAMETER_PROPERTY_TYPE_STYLE="style",Go.Default.PARAMETER_PROPERTY_TYPE_CLIENT="client",String.prototype.replaceAll=function(e,t,n){return RegExp.prototype.isPrototypeOf(e)?this.replace(e,t):this.replace(new RegExp(e,n?"gi":"g"),t)},String.prototype.format=function(e){var t=this;if(arguments.length>1){var n=[];for(var r=0;r<arguments.length;r++)n.push(arguments[r]);e=n}if(e){var i=typeof e;if(e instanceof Array)e.forEach(function(e,n){e instanceof Object&&(e=JSON.stringify(e)),t=t.replaceAll("{"+n+"}",e)});else{if(!(e instanceof Object))return t.replaceAll("{}",e);for(var s in e){var o=e[s];o instanceof Object&&(o=JSON.stringify(o)),t=t.replaceAll("{"+s+"}",o)}}}return t},Go.Default.getId=function(e){return e.getClient("id")},Go.Default.objectWrapper=function(e,t,n,r){Object.defineProperty(e,t,{get:function(){var r=e["___"+t];return n&&(r=n.call(e,r,e,t)),r},set:function(n){var i=e[t];r&&(n=r.call(e,n,e,t)),i!==n&&(e["___"+t]=n,this.firePropertyChange&&this.firePropertyChange(t,i,n))}})},Go.Default.equals=function(e,t){return e instanceof Object&&t instanceof Object?JSON.stringify(e)==JSON.stringify(t):e==t},Go.Default.EXPORT_OBJECT_ID=!0,Go.Utils2D={create2dShapeNode:function(e){var t=e.position||[0,0,0],n=e.data,r=e.image,i=e.objType,s=e.objectId,o=e.closed,u=new Go.Default.WallShapeNode(s);e.objType=="innerWall"?u=new Go.Default.InnerWallShapeNode(s):e.objType=="floor"?u=new Go.Default.FloorShapeNode(s):e.objType=="cable"&&(u=new Go.Default.LineWidthShapeNode(s));var a=Go.Default.create2dShapePath(n,t);return Go.Default.objectWrapper(u,"id",function(){return this.getClient("id")}),Go.Default.objectWrapper(u,"objectId",function(){return this.getId()}),u.setSegments(a.segments),u.setPoints(a.points),o&&u.setClient("closed",!0),r&&u.setClient("imageSrc",r),Go.Default.setObject2dCSProps(u,e),u},create2dShapePath:function(e,t){var r=new n.List,i=new n.List;if(e.length>0){r.add("moveto");if(e[0]instanceof Array){i.add({x:parseFloat(e[0][0])+parseFloat(t[0]),y:parseFloat(e[0][1])+parseFloat(t[2])});for(var s=1;s<e.length;s++){var o=e[s];o[0]=="c"?(r.add("quadto"),i.add({x:parseFloat(o[1])+parseFloat(t[0]),y:parseFloat(o[2])+parseFloat(t[2])}),i.add({x:parseFloat(o[3])+parseFloat(t[0]),y:parseFloat(o[4])+parseFloat(t[2])})):(r.add("lineto"),i.add({x:parseFloat(o[0])+parseFloat(t[0]),y:parseFloat(o[1])+parseFloat(t[2])}))}}else{i.add({x:parseFloat(e[0])+parseFloat(t[0]),y:parseFloat(e[1])+parseFloat(t[2])});for(var s=2;s<e.length;s+=2)r.add("lineto"),i.add({x:parseFloat(e[s])+parseFloat(t[0]),y:parseFloat(e[s+1])+parseFloat(t[2])})}}return{segments:r,points:i}},setObject2dCSProps:function(e,t){var n=t.style,r=t.client;if(n)for(var i in n)e.setStyle(i,n[i]);if(r)for(var i in r)e.setClient(i,r[i])},createBlockObject:function(e,t){var n=e.objectId,r=new Go.Default.Block(n);"door"==t?r=new Go.Default.Door(n):"window"==t&&(r=new Go.Default.Window(n)),e.width&&r.setClient("length",e.width);var i=e.client||{};return r.setClient("edgeIndex",i.edgeIndex||1),r.setClient("offset",i.offset||0),Go.Default.setObject2dCSProps(r,e),r},createNode:function(e){var t=e.position||[0,0,0],r=e.rotation||[0,0,0],i=e.width||50,s=e.depth||50,o=e.image,u=e.objectId,a=new n.Follower(u),f=e.color||"#CCCCFF";return Go.Default.objectWrapper(a,"id",function(){return this.getClient("id")}),Go.Default.objectWrapper(a,"objectId",function(){return this.getId()}),a.setSize(parseFloat(i),parseFloat(s)),a.setCenterLocation({x:parseFloat(t[0]),y:parseFloat(t[2])}),a.setAngle(r[1]),a.setClient("positionY",t[1]),typeof o=="string"?a.setImageUrl(o):typeof o=="object"?a.setImage(o):(a.setStyle("body.type","vector"),a.setStyle("vector.shape","rectangle"),a.setStyle("vector.fill.color",f)),a.setStyle("select.style","border"),a.setStyle("select.color","#F07819"),a.setStyle("select.width",.7),a.setStyle("vector.outline.width",1),a.setStyle("vector.outline.color","#BEC9BE"),a.setStyle("label.position","center"),Go.Default.setObject2dCSProps(a,e),a},createFollower:function(e){var t=e,e={};Go.Default.copyProperties(t,e),e.id=e.objectId||r.id(),e.scale=e.scale||1,e.depth=e.depth||5,e.position=e.position||[0,0,0],e.rotation=e.rotation||[0,0,0];var i=new n.Follower(e);return Go.Default.objectWrapper(i,"id",function(){return i.getClient("id")}),Go.Default.objectWrapper(i,"objectId",function(){return i.getId()}),Go.Default.objectWrapper(i,"depth"),Go.Default.objectWrapper(i,"position",null,function(e){return this.setLocation({x:e[0],y:e[1]}),e}),Go.Default.objectWrapper(i,"rotation",null,function(e){return this.setAngle(e[2]),e}),Go.Default.objectWrapper(i,"scale",null,function(e){var t=this.getSize();t.width=t.width*e,t.height=t.height*e,this.setSize(t);var n=this.getLocation();return n.x=n.x*e,n.y=n.y*e,i.setLocation(n),e}),i.depth=e.depth,i.position=e.position,i.rotation=e.rotation,i.scale=e.scale,i.addPropertyChangeListener(function(e){var t=e.property,n=e.source;t=="location"?(n.position[0]=e.newValue.x,n.position[1]=e.newValue.y):t=="angle"&&(n.rotation[2]=e.newValue)},i),e.x&&i.setX(e.x),e.y&&i.setY(e.y),i.z=e.z,e.location&&(e.location instanceof Array?i.setLocation({x:e.location[0],y:e.location[1]}):i.setLocation(e.location)),e.centerLocation&&(e.centerLocation instanceof Array?i.setCenterLocation({x:e.centerLocation[0],y:e.centerLocation[1]}):i.setCenterLocation(e.centerLocation)),e.size&&i.setSize(e.size),e.angle&&i.setAngle(e.angle),i.setStyle("select.style","border"),i.setStyle("select.color","#F07819"),i.setStyle("select.width",.7),i.setStyle("vector.outline.color","#BEC9BE"),Go.Default.setObject2dCSProps(i,e),i},align:function(e,t){if(!t)return;if(!e||e.size()<2)return;var n=this["_align_"+t];if(!n)return;n.call(this,e)},_align_up:function(e){var t=e.get(0).getLocation().y;for(var n=1;n<e.size();n++)t=Math.min(t,e.get(n).getLocation().y);e.forEach(function(e){e.setY(t)})},_align_down:function(e){var t=e.get(0).getLocation().y+e.get(0).getSize().height;for(var n=1;n<e.size();n++)t=Math.max(t,e.get(n).getLocation().y+e.get(n).getSize().height);e.forEach(function(e){e.setY(t-e.getSize().height)})},_align_left:function(e){var t=e.get(0).getLocation().x;for(var n=1;n<e.size();n++)t=Math.min(t,e.get(n).getLocation().x);e.forEach(function(e){e.setX(t)})},_align_right:function(e){var t=e.get(0).getLocation().x+e.get(0).getSize().width;for(var n=1;n<e.size();n++)t=Math.max(t,e.get(n).getLocation().x+e.get(n).getSize().width);e.forEach(function(e){e.setX(t-e.getSize().width)})},_align_center:function(e){var t=0;for(var n=0;n<e.size();n++)t+=e.get(n).getCenterLocation().y;var r=t/e.size();e.forEach(function(e){e.setY(r-e.getSize().height/2)})},_align_middle:function(e){var t=0;for(var n=0;n<e.size();n++)t+=e.get(n).getCenterLocation().x;var r=t/e.size();e.forEach(function(e){e.setX(r-e.getSize().width/2)})},flow:function(e,t,n){if(!t)return;if(!e||e.size()<2)return;var r=this["_flow_"+t];if(!r)return;r.call(this,e,n)},_flow_hor:function(e,t){this.sort(e,function(e,t){return e.getLocation().y-t.getLocation().y}),this.sort(e,function(e,t){return e.getLocation().x-t.getLocation().x});var n=e.get(0);for(var r=1;r<e.size();r++){var i=e.get(r),s=n.getLocation().x;i.setX(s+t),n=i}},_flow_ver:function(e,t){this.sort(e,function(e,t){return e.getLocation().x-t.getLocation().x}),this.sort(e,function(e,t){return e.getLocation().y-t.getLocation().y});var n=e.get(0);for(var r=1;r<e.size();r++){var i=e.get(r),s=n.getLocation().y;i.setY(s+t),n=i}},sort:function(e,t){var n=e.size(),r,i,s,o;for(var u=0;u<n;u++){r=e.get(u);for(var a=u+1;a<n;a++)i=e.get(a),s=t?t(r,i):0,s>0&&(o=i,i=r,r=o,e.set(u,r),e.set(a,i))}},wrapper:function(e,t){Go.Default.objectWrapper(e,"id",function(){return this.getClient("id")}),Go.Default.objectWrapper(e,"objectId",function(){return this.getId()}),Go.Default.objectWrapper(e,"width"),Go.Default.objectWrapper(e,"height"),Go.Default.objectWrapper(e,"depth"),Go.Default.objectWrapper(e,"px"),Go.Default.objectWrapper(e,"py"),Go.Default.objectWrapper(e,"pz"),Go.Default.objectWrapper(e,"rx"),Go.Default.objectWrapper(e,"ry"),Go.Default.objectWrapper(e,"rz"),Go.Default.objectWrapper(e,"position"),Go.Default.objectWrapper(e,"rotation"),t&&t.forEach(function(t){Go.Default.objectWrapper(e,t)})}},Go.Default.register("twaver.cube.top",function(e,t){var n=Go.Utils2D.createNode(e);return t&&t(n),n});for(var pr in Go.Utils2D)Go.Default[pr]=Go.Utils2D[pr];Go.Utils3D={positionFloor:"floor-top",_objMap:{},_objObject:{},_envMaps:{envmap1:"envmap1.jpg",envmap2:"envmap2.jpg",envmap3:"envmap3.jpg",envmap4:"envmap4.jpg",envmap5:"envmap5.jpg"},getEnvMap:function(e){var t=Go.Default.getImagePath()+Go.Default._envMaps[e];return[t,t,t,t,t,t]},getOBjPath:function(e){return e?e.indexOf("http")>=0?e:this.path+e:this.path+"obj/"},createFloorForWall:function(e){var t={type:"twaver.floor",data:e.getClient("data")},n=this.getCreator(t.type);if(n){var r=this.loadData(t);r.setParent(e)}},createCombo:function(e,t){var n=[],r=[],i=[],s=[];e&&!(e instanceof Array)&&(e=[e]);for(var o=0;o<e.length;o++){var u=e[o],a=u.op||"+",f=u.style,l=u.client,c=u.position||[0,0,0],h=u.rotation||[0,0,0],p=u.scale||[1,1,1],d=null;u.type==="cube"&&(d=this.createCube(u)),u.type==="cylinder"&&(d=this.createCylinder(u)),u.type==="sphere"&&(d=this.createSphere(u)),u.type==="polygon"&&(d=this.createPolygon(u)),u.type==="torus"&&(d=this.createTorus(u)),u.type==="path"&&(d=this.createPathCube(u)),u.type==="pathNode"&&(d=this.createPathNode(u)),u.type==="shapeNode"&&(d=this.createShapeNode(u));if(d){h&&!u.rotationAnchor&&d.setRotation(h[0],h[1],h[2]);if(u.rotationAnchor){var v=d.getPosition();c=[c[0]+v.x,c[1]+v.y,c[2]+v.z]}d.setPosition(c[0],c[1],c[2]),d.setScale(p[0],p[1],p[2]),f&&d.s(f),l&&d.c(l),u.op?(d.getChildren().size()>0&&(n=n.concat(d.getChildren().toArray())),n.push(d),d.getChildren().size()>0?d.getChildren().forEach(function(){i.push(a)}):n.length>1&&i.push(a),s.push(d.getId())):r.push(d)}}if(n.length>0){var m;return t?m=new mono.ComboNode(n,i,!1,t):m=new mono.ComboNode(n,i),m.setNames(s),m}return r.length==1?r[0]:r},setMainObject:function(e){function i(e,t){if(e){var n=e.getBoundingBox(),r=t.getBoundingBox(),i=n.min,s=n.max,o=r.min,u=r.max;if(s.x-i.x<u.x-o.x||s.z-i.z<u.z-o.z)e=t}else e=t;return e}var t=null;if(e instanceof Array){for(var n=0;n<e.length;n++){var r=e[n];if(!(r instanceof mono.Entity))continue;t=i(t,r)}for(var n=0;n<e.length;n++){var r=e[n];if(!(r instanceof mono.Entity))continue;t!=r&&e[n].setParent(t)}}else t=e;return t&&t.setClient("main",!0),t},createCube:function(e){var t=e.width,n=e.height,r=e.depth,i=e.color,s=e.position||[0,0,0],o=e.rotation||[0,0,0],u=e.rotationAnchor,a=e.topColor||i,f=e.repeatX||1,l=e.repeatY||1,c=e.image,h=e.frontImage,p=e.wrapMode,d;e.objectId?d=new mono.Cube({id:e.objectId,width:t,height:n,depth:r}):d=new mono.Cube(t,n,r),i&&d.s({"m.color":i,"m.ambient":i}),a&&d.s({"top.m.color":a,"top.m.ambient":a,"bottom.m.color":a,"bottom.m.ambient":a}),c&&d.s({"m.texture.image":c,"m.texture.repeat":new mono.Vec2(f,l),"m.texture.anisotropy":15}),h&&d.setStyle("front.m.texture.image",h),p&&d.setWrapMode(p);if(u){var v,m;u==="left"&&(v=new mono.Vec3(t/2,0,0),m=new mono.Vec3(0,1,0)),u==="right"&&(v=new mono.Vec3(-t/2,0,0),m=new mono.Vec3(0,1,0)),d.rotateFromAxis(m.clone(),v.clone(),o[1])}else d.setRotation(o[0]/180*Math.PI,o[1]/180*Math.PI,o[2]/180*Math.PI);return Go.Default.setObject3dCSProps(d,e),d},createCylinder:function(e){var t=e.radius,n=e.topRadius||t,r=e.bottomRadius||t,i=e.height,s=e.color,o=e.image,u=new mono.Cylinder(n,r,i);return u.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":s,"m.ambient":s,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),o&&u.setStyle("m.texture.image",o),u},createSphere:function(e){var t=e.radius,n=e.color||"#F5F5F5",r=e.image,i=new mono.Sphere(t);return i.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":n,"m.ambient":n,"m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),r&&i.setStyle("m.texture.image",r),i},createPolygon:function(e){var t=e.radius||100,n=e.topRadius||t,r=e.bottomRadius||t,i=e.height||200,s=e.radialSegments||3,o=e.color||"#F5F5F5",u=e.topColor||o,a=e.smooth||!0,f=e.image,l=new mono.Cylinder(n,r,i,s,a);return l.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":o,"m.ambient":o,"top.m.color":u,"top.m.ambient":u,"bottom.m.color":u,"bottom.m.ambient":u,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),f&&l.setStyle("m.texture.image",f),l},createTorus:function(e){var t=e.radius||50,n=e.tube||30,r=e.tubularSegments||3,i=e.radialSegments||6,s=e.color||"#F5F5F5",o=e.image,u=new mono.Torus(t,n,r,i);return u.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":s,"m.ambient":s,"m.lightmap.image":this.getImagePath("outside_lightmap.jpg")}),o&&u.setStyle("m.texture.image",o),u},createBillboard:function(e){var t=e.position||[0,0,0],n=e.scale||[1,1,1],r=e.image||this.getImagePath("outside_lightmap.jpg"),i=new mono.Billboard;return i.s({"m.texture.image":r,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.depthTest":!1}),i.setScale(n[0],n[1],n[2]),i.p(t[0],t[1],t[2]),i},createPathNodePath:function(e){var t;if(e[0]&&e[0]instanceof Array)for(var n=0;n<e.length;n++){var r=e[n];t?r[0]==="c"?t.quadraticCurveTo(r[1],r[2],r[3],r[4],r[5],r[6]):t.lineTo(r[0],0,r[1]):(t=new mono.Path,t.moveTo(r[0],0,r[1]))}else for(var n=0;n<e.length;n+=2)t?t.lineTo(e[n],0,e[n+1]):(t=new mono.Path,t.moveTo(e[n],0,e[n+1]));return t},createPathNode:function(e){var t=e.radius,n=e.pathImage,r=e.repeat||50,i=e.offset||new mono.Vec2(0,0),s=e.startCap||"plain",o=e.endCap||"plain",u=e.pathWidth,a=e.pathHeight,f=u/2,l=a/2,c=[{x:f,y:-l},{x:f,y:l},{x:-f,y:l},{x:-f,y:-l}],h=this.createPathNodePath(e.data),p=h.getLength(),d;return u&&a?d=new mono.PathNode({path:h,shape:c,segments:10,segmentsR:5}):(h=mono.PathNode.prototype.adjustPath(h,t,2),d=new mono.PathNode({path:h,radius:t})),d.s({"m.texture.image":n,"m.texture.repeat":new mono.Vec2(p/r,1),"m.texture.offset":i}),s&&d.setStartCap(s),o&&d.setEndCap(o),Go.Default.setObject3dCSProps(d,e),d},createShapeNodePath:function(e){var t;if(e[0]&&e[0]instanceof Array)for(var n=0;n<e.length;n++){var r=e[n];t?r[0]==="c"?t.quadraticCurveTo(r[1],-r[2],0,r[3],-r[4],0):t.lineTo(r[0],-r[1],0):(t=new mono.Path,t.moveTo(r[0],-r[1],0))}else for(var n=0;n<e.length;n+=2)t?t.lineTo(e[n],-e[n+1],0):(t=new mono.Path,t.moveTo(e[n],-e[n+1],0));return t},createShapeNode:function(e){var n=e.repeat||100,r=e.amount||2,i=!0;if(e.vertical!==null||e.vertical!=t)i=e.vertical;var s=this.createShapeNodePath(e.data),o;return e.id?o=new mono.ShapeNode({id:e.id,path:s}):o=new mono.ShapeNode(s),e.curveSegments&&o.setCurveSegments(e.curveSegments),o.setAmount(r),o.setVertical(i),o.setRepeat(n),o},createPathCube:function(e){var t=e.width,n=e.height,r=e.data,i=e.insideColor,s=e.outsideColor,o=e.asideColor,u=e.zsideColor,a=e.topColor,f=e.bottomColor,l=e.insideImage||e.image,c=e.outsideImage||e.image,h=e.insideMap,p=e.outsideMap,d=e.repeat||e.height,v=e.closed,m=this.createShapeNodePath(r);v&&m.closePath();var g=new mono.PathCube(m,t,n);return g.s({"outside.m.color":s,"inside.m.type":"basic","inside.m.color":i,"aside.m.color":o||s,"zside.m.color":u||s,"top.m.color":a,"bottom.m.color":f||a,"inside.m.lightmap.image":h,"outside.m.lightmap.image":p,"aside.m.lightmap.image":p,"zside.m.lightmap.image":p,"inside.m.texture.image":l,"outside.m.texture.image":c}),g.setRepeat(d),g},getPicInfo:function(e,t){var n={};typeof t=="string"&&(t=[t]);for(var r=0;r<t.length;r++){var i=t[r],s=i.substring(0,i.indexOf(".")).toLowerCase();i=e+i,n[s]=i}return n},getRByD:function(e){return e*Math.PI/180},getDByR:function(e){return e*180/Math.PI},getRsByDs:function(e){var t;if(e&&e.length>0){t=[];for(var n=0;n<e.length;n++)t.push(Go.Default.getRByD(e[n]))}return t},setObject3dCSProps:function(e,t){t.client&&e.c(t.client),t.style&&e.s(t.style)},setObject3dCommonProps:function(e,t){var n=Go.Default.getRsByDs(t.rotation)||[0,0,0],r=t.scale||[1,1,1],i=t.position||[0,0,0];e.setRotation(n[0],n[1],n[2]),e.setScale(r[0],r[1],r[2]),e.setPosition(i[0],0,i[2]),Go.Default.setPositionY(e,i[1]),Go.Default.setObject3dCSProps(e,t)},cloneObjElement:function(e,t){var n=Go.Default.getRsByDs(e.rotation)||[0,0,0],r=e.scale||[1,1,1],i=e.position||[0,0,0];i[1]=parseFloat(i[1])||0;var s=this._objObject[e.name],o=s.getBoundingBoxWithChildren(),u=(o.max.y-o.min.y)/2,a=s.clonePrefab();e._id&&(a._id=e._id);if(e.client)for(var f in e.client)a.setClient(f,e.client[f]);return e.s&&a.s(e.s),a.setClient("type",e.name),a.setClient("showShadow",e.showShadow),e.showShadow&&a.setClient("shadowImage",e.shadowImage),e.shadowType&&a.setClient("shadowType",e.shadowType),typeof e.interepter=="function"&&e.interepter.call(this,a),a.setClient("json",e),a.setScale(r[0],r[1],r[2]),a.setPosition(i[0],i[1]+u*r[1],i[2]),a.setRotation(n[0],n[1],n[2]),t&&t(a),a},setDefaultEnvMap:function(e){var t=this.getEnvMap("envmap5");e.setStyle("m.envmap.image",t);var n=e.getDescendants();return n.forEach(function(e){e.setStyle("m.envmap.image",t)}),e},setShadowImage:function(e,t){e.setClient("shadowImage",t),n.Util.registerImageByUrl(t,t)},createObj:function(e,t){var r=this;if(this._objObject[e.name]){var i=this.getOBjPath(e.path),s=e.shadowImage=i+e.name+"S.png";return this.cloneObjElement(e,t)}if(!this._objMap[e.name]){this._objMap[e.name]=[];var i=this.getOBjPath(e.path),o=i+e.name+".obj",u=i+e.name+".mtl",a=e.scale||[1,1,1];if(e.showShadow){var s=e.shadowImage=i+e.name+"S.png";n.Util.registerImageByUrl(s,s)}var f=new mono.OBJMTLLoader;f.load(o,u,null,function(t){e.merged&&(t=mono.Utils.mergeElements(t.getDescendants())),r._objObject[e.name]=t,r._objMap[e.name].forEach(function(e){return r.cloneObjElement(e.json,e.callback)})})}this._objMap[e.name].push({json:e,callback:t})},getTextSize:function(e,t){var n=l.createElement("canvas"),r=n.getContext("2d"),i=e.split("\n"),s=0;r.font=t;for(var o=0;o<i.length;o++){var u=i[o],a=r.measureText(u).width;a>s&&(s=a)}var f=r.measureText("e").width*i.length*3+4,c={w:s,h:f};return c},generateTextCanvas:function(e,t,n,r,i){var s=l.createElement("canvas"),n=n||"bold 80px 微软雅黑,sans-serif",o=s.getContext("2d"),u=e.split("\n"),a=Go.Default.getTextSize(e,n),f=a.w,c=a.h,h={width:f,height:c};s.height=mono.Utils.nextPowerOfTwo(a.h),s.width=mono.Utils.nextPowerOfTwo(a.w),r&&(o.save(),o.globalAlpha=1,o.fillStyle=i||"#FE642E",o.beginPath(),o.moveTo(0,0),o.lineTo(f,0),o.lineTo(f,c),o.lineTo(0,c),o.closePath(),o.fill()),o.restore(),o.fillStyle=t||"white",o.textBaseline="middle",o.textAlign="center",o.font=n,o.shadowColor="#585858",o.shadowBlur=25,o.shadowOffsetX=10,o.shadowOffsetY=10;var p=o.measureText("o").width,d=p*2.5;for(var v=0;v<u.length;v++){var m=f/2,g=d*v+d/2+(s.height-h.height);o.fillText(u[v],m,g)}return s.drawRect=h,s},generateShadowNode:function(e,t){var n=null,r=e.getDescendants();r.forEach(function(e){e instanceof mono.Entity&&e.getClient("type")&&"floor"==e.getClient("type")&&(n=e)});if(!n)return;var i=n.getBoundingBox(),s=i.max.z-i.min.z,o=i.max.x-i.min.x,u=e.getRotation();e.setRotation(0,0,0);var a=Go.Default.createShadowImage(e,n,t);return n.setStyle("top.m.lightmap.image",a),n.invalidateTexture(),Go.Default.canvas=Go.Default.canvas||a,e.setRotation(u),n},_getWorldRotation:function(e){var t=(new mono.Mat4).extractRotation(e.worldMatrix),n=new mono.Vec3;return n.setEulerFromRotationMatrix(t),n},createShadowImage:function(e,t,r){var i=t.getBoundingBox(),s=i.max.z-i.min.z,o=i.max.x-i.min.x,u=Math.max(2048,Math.max(o,s)),a=u/2048,f=Go.Default.canvas||l.createElement("canvas"),c=mono.Utils.nextPowerOfTwo(o/a),h=mono.Utils.nextPowerOfTwo(s/a),p=o/c,d=s/h;f.width=c,f.height=h;var v=f.getContext("2d");v.clearRect(0,0,c,h),v.fillStyle="white",v.fillRect(0,0,c,h),v.beginPath();var m=e.getPosition(),g=e?e.getBoundingBox():null,y=-(g.max.x+g.min.x)/2-m.x,b=-(g.max.z+g.min.z)/2-m.z,w=e.getDescendants(),E;w.forEach(function(e){if(e.getClient&&e.getClient("id")=="wallCombos"){E=e;return}});if(E){var S=E.getClient("combos");S.forEach(function(e){if(e.getClient&&!e.getClient("resetPos")){var t=e.getPosition();e.p(t.x+parseFloat(m.x),t.y+parseFloat(m.y),t.z+parseFloat(m.z)),e.setClient("resetPos",!0)}w.push(e)})}var x;w.forEach(function(e){if(e.getClient&&e.getClient("id")=="columnCombos"){x=e;return}});if(x){var S=x.getClient("combos");S.forEach(function(e){if(e.getClient&&!e.getClient("resetPos")){var t=e.getPosition();e.p(t.x+parseFloat(m.x),t.y+parseFloat(m.y),t.z+parseFloat(m.z)),e.setClient("resetPos",!0)}w.push(e)})}return w.push(e),w.forEach(function(e){var t=e.getWorldPosition(),i=c/2+t.x/p,s=h/2+t.z/d,u=Go.Default._getWorldRotation(e),a=e.getClient("type");if(a=="wall"||a=="inner_wall"||a=="glass_wall"){var f=e.getClient("data");v.save(),v.translate(i,s),v.beginPath();if(f[0]&&f[0]instanceof Array){for(var l=0;l<f.length;l++)l==0?v.moveTo(f[l][0]/p+y/p,f[l][1]/d+b/d):v.lineTo(f[l][0]/p+y/p,f[l][1]/d+b/d);a=="wall"&&v.lineTo(f[0][0]/p+y/p,f[0][1]/d+b/d)}else{for(var l=0;l<f.length;l+=2)l==0?v.moveTo(f[l]/p+y/p,f[l+1]/d+b/d):v.lineTo(f[l]/p+y/p,f[l+1]/d+b/d);a=="wall"&&v.lineTo(f[0]/p+y/p,f[1]/d+b/d)}v.lineWidth=20/p,v.strokeStyle="#ccc",v.shadowColor="#000";var m=Math.min(parseInt(o/15),300);v.shadowBlur=parseInt(m/p);if(a=="inner_wall"||a=="glass_wall")v.translate(i,s),v.lineWidth=10/p,v.shadowBlur=parseInt(m/p);v.shadowOffsetX=0,v.shadowOffsetY=0,v.stroke(),v.stroke(),parseInt(o/15)>200&&(v.stroke(),v.stroke()),v.restore()}var g=e.getClient("showShadow");r&&(g=g&&r(e));var w=e.getClient("shadowImage"),E=e.getClient("shadowType")||0,S=e.getClient("shadowRatio")||.99,x=e.getClient("shadowWeight")||2;if(g){var T=e.getBoundingBox(),N=T.size(),C=N.x/p*S,k=depth=N.z/d*S;u.y%(Math.PI/2)==0&&(C=N.x/d*S,k=depth=N.z/p*S),u.y%Math.PI==0&&(C=N.x/p*S,k=depth=N.z/d*S);if(E==1){var L=Math.min(N.x,N.z);C=L/p*S,k=depth=L/d*S,u.y%(Math.PI/2)==0&&(C=L/d*S,k=depth=L/p*S),u.y%Math.PI==0&&(C=L/p*S,k=depth=L/d*S)}if(w){u=e.getRotation();var A=n.Util.getImageAsset(w);if(!A)return;v.save(),v.translate(i+y/p,s+b/d),v.rotate(-u.y);var O=Math.max(C,depth)*.3,M,_,D,P;u.y%(Math.PI/2)==0&&(M=-C/2-O/2,_=-depth/2-O/2,D=C+O,P=depth+O),u.y%Math.PI==0&&(M=-C/2-O/2,_=-depth/2-O/2,D=C+O,P=depth+O),v.drawImage(A.getImage(),M,_,D,P),v.drawImage(A.getImage(),M,_,D,P),v.restore()}else if(E==0){v.save(),v.translate(i+y/p,s+b/d),v.rotate(-u.y),v.beginPath(),v.moveTo(-C/2,0),v.lineTo(C/2,0),v.lineWidth=k,v.strokeStyle="gray",v.shadowColor="#333";var H=Math.min(C,depth);v.shadowBlur=H*2,v.shadowOffsetX=0,v.shadowOffsetY=0,x==1?(v.shadowBlur=H*3,v.stroke()):x==2&&(v.stroke(),v.stroke()),v.restore()}else if(E==1){var i=i+y/p,s=s+b/d,B=e.getClient("shadowRadius");B?B/=d:B=Math.sqrt(C*C+depth*depth)/2,v.save(),v.beginPath(),v.arc(i,s,B,0,2*Math.PI,!1),v.fillStyle="gray",v.shadowColor="black",v.shadowBlur=B*2,v.shadowOffsetX=0,v.shadowOffsetY=0,x==1?(v.shadowBlur=B*3,v.fill()):x==2&&(v.fill(),v.fill()),v.restore()}}}),f},getRelativePosition:function(e,t){var n,r;n=(new mono.Mat4).getInverse(e.worldMatrix.clone()),r=(new mono.Mat4).multiplyMatrices(n,t.worldMatrix.clone());var i=main.position=(new mono.Vec3).getPositionFromMatrix(r);return i},getPathBoundingBox:function(e){var t={},n={centerPoint:{x:0,y:0},min:{x:0,y:0},max:{x:0,y:0},size:{x:0,y:0}};if(e.length==0)return n;var r,i,s,o;if(e[0]instanceof Array){r=e[0][0],i=e[0][0],s=-e[0][1],o=-e[0][1];for(var u=1;u<e.length;u++)r=Math.min(r,e[u][0]),i=Math.max(i,e[u][0]),s=Math.min(s,-e[u][1]),o=Math.max(o,-e[u][1])}else{if(e.length<2)return n;r=e[0],i=e[0],s=-e[1],o=-e[1];for(var u=2;u<e.length;u+=2)r=Math.min(r,e[u]),i=Math.max(i,e[u]),s=Math.min(s,-e[u+1]),o=Math.max(o,-e[u+1])}return t.centerPoint={x:(r+i)/2,y:(s+o)/2},t.min={x:r,y:s},t.max={x:i,y:o},t.size={x:i-r,y:o-s},t},setPositionY:function(e,t){if(typeof t=="number")e.setPositionY(t);else if(t==Go.Default.positionFloor){var n=e.getBoundingBox().size();e.setPositionY(n.y/2)}},playAnimation:function(e,t,n){var r=t.split(":");if(r[0]==="move"){var i=r[1],s=r[2],o=parseInt(r[3])||1e3,u=parseInt(r[4]),a=r[5];this.animateMove(e,i,s,o,u,a,n)}if(r[0]==="rotation"){var f=r[1],l=r[2],o=parseInt(r[3])||1e3,u=parseInt(r[4]),a=r[5];this.animateRotate(e,f,l,o,u,a,n)}},animateMove:function(e,t,r,i,s,o,u){var a=e.getBoundingBox().size().multiply(e.getScale()),r=r||.8,f=new mono.Vec3(0,0,1),l=0;t==="right"&&(f=new mono.Vec3(1,0,0),l=a.x),t==="left"&&(f=new mono.Vec3(-1,0,0),l=a.x),t==="top"&&(f=new mono.Vec3(0,1,0),l=a.y),t==="bottom"&&(f=new mono.Vec3(0,-1,0),l=a.y),t==="front"&&(f=new mono.Vec3(0,0,1),l=a.z),t==="back"&&(f=new mono.Vec3(0,0,-1),l=a.z),l*=r,e.getClient("animated")&&(f=f.negate());var c=e.getPosition().clone();e.setClient("animated",!e.getClient("animated")),(new n.Animate({from:0,to:1,dur:i,easing:o,delay:s,onUpdate:function(t){e.setPosition(c.clone().add(f.clone().multiplyScalar(l*t)))},onDone:function(){u&&u()}})).play()},animateRotate:function(e,r,i,s,o,u,a){u=u||"easeInStrong";var f=e.getBoundingBox().size().multiply(e.getScale()),l=0,c=1;e.getClient("animated")&&(c=-1),e.setClient("animated",!e.getClient("animated"));var h,p;if(r==="left"){h=new mono.Vec3(-f.x/2,0,0);var p=new mono.Vec3(0,1,0)}if(r==="right"){h=new mono.Vec3(f.x/2,0,0);var p=new mono.Vec3(0,1,0)}if(r==="center-z"){h=new mono.Vec3(0,0,0);var p=new mono.Vec3(0,0,1)}var d=new n.Animate({from:l,to:c,dur:s,delay:o,easing:u,onUpdate:function(n){this.lastValue===t&&(this.lastValue=0),e.rotateFromAxis(p.clone(),h.clone(),Math.PI/180*-i*(n-this.lastValue)),this.lastValue=n},onDone:function(){delete this.lastValue,a&&a()}});d.play()},animateCameraPosition:function(e,t,r,i){var s=e.getPosition(),o=new n.Animate({from:0,to:1,dur:r,easing:"easeBoth",onUpdate:function(n){var r=s.x+(t.x-s.x)*n,i=s.y+(t.y-s.y)*n,o=s.z+(t.z-s.z)*n,u=new mono.Vec3(r,i,o);e.setPosition(u)}});return o.onDone=i,o}};for(var pr in Go.Utils3D)Go.Default[pr]=Go.Utils3D[pr];Go.Default.register("twaver.cube",function(e,t){e.image&&e.image.indexOf("http")<0&&(e.image=Go.Default.path+e.image);var n=Go.Default.createCube(e);return e.visible==0&&n.setStyle("m.visible",!1),Go.Default.setObject3dCommonProps(n,e),t&&t(n),n},{category:"基本模型",type:"mono.Element",name:"立方体",icon:"model/idc/icons/cube.png",description:"立方体是make里面提供的最基本的模型，可以用这种模型扩展出各种立方体形状的模型，比如箱子，柱子，盒子等。支持更改长，宽，高，贴图等基本参数",modelDefaultParameters:{width:{name:"宽",value:100,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},depth:{name:"深",value:100,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:Go.Default.PARAMETER_TYPE_COLOR,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:Go.Default.PARAMETER_TYPE_IMAGE,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Go.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Go.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Go.Default.register("twaver.cylinder",function(e,t){var n=Go.Default.createCylinder(e),r=e.position||[0,0,0];return n.p(r[0],0,r[2]),Go.Default.setPositionY(n,r[1]),t&&t(n),n},{category:"基本模型",type:"mono.Element",name:"圆柱体",icon:"model/idc/icons/cylinder.png",description:"圆柱体是make中提供的最基本模型，支持更改半径，高度的参数。可以更改这些参数扩展出各个圆柱体形状的模型，比如圆形柱子，桌子腿，瓶子，圆筒等",modelDefaultParameters:{topRadius:{name:"顶半径",value:60,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:60,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:Go.Default.PARAMETER_TYPE_COLOR,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:Go.Default.PARAMETER_TYPE_IMAGE,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Go.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Go.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Go.Default.register("twaver.sphere",function(e,t){var n=Go.Default.createSphere(e),r=e.position||[0,0,0];return n.p(r[0],0,r[2]),n.setClient("showShadow",!0),n.setClient("shadowType",1),n.setClient("shadowRatio",.3),Go.Default.setPositionY(n,r[1]),t&&t(n),n},{category:"基本模型",type:"mono.Element",name:"球体",icon:"model/idc/icons/sphere.png",description:"球体是make中提供的最基本模型，支持更改半径的参数。可以更改这些参数扩展出各个球体形状的模型，比如圆球等",modelDefaultParameters:{radius:{name:"半径",value:80,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"#F5F5F5",type:Go.Default.PARAMETER_TYPE_COLOR,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:Go.Default.PARAMETER_TYPE_IMAGE,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Go.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Go.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Go.Default.register("twaver.polygon",function(e,t){var n=Go.Default.createPolygon(e)
,r=e.position||[0,0,0];return n.p(r[0],0,r[2]),Go.Default.setPositionY(n,r[1]),t&&t(n),n},{category:"基本模型",type:"mono.Element",name:"多边形",icon:"model/idc/icons/polygon.png",description:"多边形是make中提供的最基本模型，支持更改半径，高度，边数的参数。可以更改这些参数扩展出各个多边形状的模型，比如多边形柱子，多边形箱子，各种支架等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:Go.Default.PARAMETER_TYPE_COLOR,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:Go.Default.PARAMETER_TYPE_IMAGE,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},topRadius:{name:"顶半径",value:100,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:100,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:200,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:3,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Go.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Go.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Go.Default.register("twaver.torus",function(e,t){var n=Go.Default.createTorus(e),r=e.position||[0,0,0];return n.p(r[0],0,r[2]),Go.Default.setPositionY(n,r[1]),t&&t(n),n},{category:"基本模型",type:"mono.Element",name:"圆环",icon:"model/idc/icons/torus.png",description:"圆环体是make中提供的最基本模型，支持更改半径，高度，扁平程度，管半径的参数。可以更改这些参数扩展出各个圆环体形状的模型，比如轮胎等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:Go.Default.PARAMETER_TYPE_COLOR,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:Go.Default.PARAMETER_TYPE_IMAGE,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},radius:{name:"半径",value:50,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},tube:{name:"内外径差",value:30,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},tubularSegments:{name:"扁平程度",value:3,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:6,type:Go.Default.PARAMETER_TYPE_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Go.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Go.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Go.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}});var nu=0;Go.Default.register("twaver.combo",function(e,t){var n="pack_"+nu++,r=e.data;if(r&&mono.Utils.isArray(r)){var i=null,s=null,o=[],u=[];for(var a=0;a<r.length;a++){s=Go.Default.load(r[a]);if(!i)i=s;else{var f=s.getClient("type");f=="inner_wall"||f=="glass_wall"?(o.push(s),s.getChildren().size()>0&&s.getChildren().forEachReverse(function(e){e.setParent(i)})):f=="column"?u.push(s):s.setParent(i)}s.setClient?s.setClient("pack",n):(s.client=s.client||{},s.client.pack=n)}if(o&&o.length>0){var l=new mono.ComboNode(o);l.setClient("id","wallCombos"),l.setClient("combos",l.getCombos()),l.setParent(i)}if(u&&u.length>0){var l=new mono.ComboNode(u);l.setClient("id","columnCombos"),l.setClient("combos",l.getCombos()),l.setParent(i)}return t&&t(i),i}},{icon:"model/idc/icons/combo.png",category:"基本模型",type:"mono.Element",name:"组合模型",description:"组合模型，可以把多个不同的模型组合在一块，组成一个新的模型，传如参数是一个数组"}),Go.Default.registerObj=function(e,t,n,r,i,s,o){r=r||{},r.async=!0;var u=function(e,u){return e.name=t,e.path=n,e.showShadow=i,s&&(e.shadowType=s),e.merged=o,e.merged==null&&(e.merged=!0),e.interepter=r.interepter,Go.Default.createObj(e,u)};Go.Default.register(e,u,r)},Go.Default.register("twaver.loader",function(e,t){return Go.Default.load(e.data,t)}),Go.Utils3D.getRectOfPoints=function(e){if(!e||e.length/2<2)return null;var t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=0,o=e.length,u=[],a=function(e,s){r=Math.min(r,e),i=Math.max(i,e),t=Math.min(t,s),n=Math.max(n,s),u.push({x:e,y:s})};if(o>0&&e[s]instanceof Array)for(;s<o;s++){var f=e[s];f.length==2?a(f[0],f[1]):f.length==5&&f[0]=="c"&&a(f[3],f[4])}else for(;s<o;s+=2)a(e[s],e[s+1]);return{min:{x:r,y:t},max:{x:i,y:n},center:function(){return{x:(this.min.x+this.max.x)/2,y:(this.min.y+this.max.y)/2}},width:i-r,height:n-t,points:u}}})(this);